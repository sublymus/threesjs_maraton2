import{H as S,u as re,j as e,L as Z,g as J,b as K,a as F,l as W,t as he,c as me,C as G}from"./BindToParentScroll-S7eEfNX0.js";import{c as L,S as Pe,r as x,R as Re}from"./index-BsdOv613.js";import{G as H,F as te,c as ge,d as fe,e as ae,S as be,f as ye,I,O as we,U as je,i as Ae,A as Ie,h as Me,g as ke}from"./ChoiseRole-C5NKNkBu.js";import{E as ve}from"./EditorTopBar-COMpa9IM.js";import{t as Ce,e as Te}from"./emoji-BTL-tVpr.js";const Ue={"/":{stores:{store_info:{}},roles:{edit_role:{},create_role:{}},users:{user_profile:{}},chat:{discussions:{discussions_all:{},discussions_new:{},discussions_blocked:{}},services:{services_stores:{},services_all:{},services_new:{},services_blocked:{}},surveys:{}},interfaces:{},statistic:{},moderators:{moderator_profile:{},new_moderator:{}}}},oe=L(o=>({T:localStorage.getItem("theme"),back_color:"",blur:!1,setT(s){s&&localStorage.setItem("theme",s),o(()=>({T:s}))},currentChild:void 0,openChild(s,a,i){o(()=>({currentChild:s,blur:a,back_color:s&&i||""}))}})),E=new Pe(Ue,["/","chat"]).getStore(),f=L(o=>({user:void 0,userStore:void 0,async updateUser({name:s,photos:a,id:i}){const t=new FormData;if(s&&t.append("name",s),a!=null&&a[0])t.append("photos_0",a[0]);else return;t.append("id",i),t.append("photos",'["photos_0"]');const c=await(await fetch(`${S}/edit_me`,{method:"POST",body:t})).json();c.id&&(o(()=>({user:{...c,photos:c.photos.map(l=>`${S}${l}`)}})),localStorage.setItem("user",JSON.stringify(c)))},async disconnection(){const s=f.getState().getHeaders();if(!s)return;const a={method:"GET",headers:s.headers};await fetch(`${S}/disconnection`,a),localStorage.removeItem("user"),localStorage.removeItem("store_name"),o(()=>({user:void 0,store:void 0,userStore:void 0,openAuth:!0}))},async getAccess(){window.open(`${S}/google_connexion`,void 0,"popup");const s=setInterval(()=>{const a=localStorage.getItem("user"),i=a&&JSON.parse(a);i&&(console.log("getAccess",{token:i.token}),o(()=>({user:i})),clearInterval(s),f.getState().authenticateUser())},100)},async authenticateUser(){let s=localStorage.getItem("user");if(s){const a=JSON.parse(s),i=new Headers;i.append("Authorization",`Bearer ${a.token}`);const t={method:"GET",headers:i},r=await fetch(`${S}/can_manage_sublymus`,t);let c;const l=()=>{localStorage.removeItem("user"),localStorage.removeItem("store"),o(()=>({user:void 0,userStore:void 0,store:void 0,openAuth:!0}))};try{if(c=await r.json(),!c.user)return l()}catch{return l()}const n={...a,...c.user};o(()=>({user:n,userStore:c.userStore,store:c.store,openAuth:!1})),localStorage.setItem("user",JSON.stringify(n))}else localStorage.removeItem("user"),localStorage.removeItem("store"),o(()=>({user:void 0,userStore:void 0,store:void 0,openAuth:!0}))},getHeaders(){let s=f.getState().user;if(!s)return;const a=new Headers;return a.append("Authorization",`Bearer ${s.token}`),{headers:a,user:s}}})),ie=L(o=>({stores:void 0,store:void 0,setStore(s){o(()=>({store:s}))},async setStoreById(s){var i,t;const a=(i=ie.getState().stores)==null?void 0:i.list.find(r=>r.id==s);if(a)return o(()=>({store:a}));{const r=(t=await ie.getState().fetchStores({text:"#"+s},!0))==null?void 0:t.list[0];if(r)return o(()=>({store:r}))}},async fetchStores(s,a){const i=f.getState().getHeaders(),t=new URLSearchParams({});for(const l in s){const n=s[l];t.set(l,n)}const c=await(await fetch(`${S}/get_stores/?${t}`,{headers:i==null?void 0:i.headers})).json();if(c!=null&&c.list)return a||o(()=>({stores:c})),c}}));function Oe(){var B;const{current:o,setAbsPath:s,navBack:a,json:i}=E(),{store:t,setStoreById:r}=ie(),{openChild:c}=oe(),{user:l}=f(),[n,d]=x.useState(t||{}),[h,j]=x.useState(t?{url:(o("store_info")||"")&&`${t.logo[0]}`}:null),[g,m]=x.useState(t?{url:(o("store_info")||"")&&`${(B=t.banners)==null?void 0:B[0]}`}:null),C=re().width<1050?"wrap":"";x.useEffect(()=>{setTimeout(()=>{var b;t&&o("store_info")&&(d(t),m({url:`${t.banners[0]}`}),j({url:`${(b=t.logo)==null?void 0:b[0]}`}))}),t||(d({}),j(null),m(null))},[t]);const _=o("store_info");x.useEffect(()=>{o("store_info")&&(i!=null&&i.store_id)&&l&&r(i.store_id)},[i,l]);const D=t;return _&&!t?e.jsx("div",{className:"store-select-btn",onClick:()=>{s(["stores"])},children:"Select Store Before Edition"}):o("store_info")&&e.jsxs("div",{className:"store-info",children:[t&&e.jsxs("div",{className:"editor-top",children:[e.jsx("div",{className:"nav-back",onClick:()=>a()}),e.jsx(ve,{terme:"dark",deteleKey:t.id,mode:"delete",onDelete:()=>{console.log("DELETE REQUIRED")},onCreate:()=>{},title:"Store Information"}),e.jsxs("div",{className:"open-opt",children:[e.jsx("div",{className:"btn-dash btn demo",onClick:()=>{localStorage.setItem("store",JSON.stringify(t)),window.open(`${Z}/demo/${t.name}`,void 0)},children:"Open Demo Store"}),e.jsx("div",{className:"btn-dash btn",onClick:()=>{localStorage.setItem("store",JSON.stringify(t)),window.open(`${Z}/${t==null?void 0:t.name}/dash/admin`,void 0)},children:"Open Dashboard"})]})]}),e.jsxs("div",{className:"center-content "+C,children:[e.jsx("div",{className:"center-left",children:e.jsxs("div",{className:"store "+(t?"anim":"void"),children:[e.jsx("div",{className:"banner "+(g!=null&&g.url?"":"void"),style:g!=null&&g.url?{background:J((g==null?void 0:g.url)||"")}:{},onClick:()=>{},children:e.jsxs("div",{className:"more",children:[e.jsx("div",{className:"logo "+(h!=null&&h.url?"":"void"),style:h!=null&&h.url?{background:J((h==null?void 0:h.url)||"")}:{},onClick:b=>{b.currentTarget==b.target&&h!=null&&h.url&&c(e.jsx("div",{className:"big-img",onClick:()=>c(void 0,!1),children:e.jsx("div",{className:"img",style:{background:J((h==null?void 0:h.url)||"")}})}),!0,"#3455")}}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"name",children:n.name}),e.jsx("div",{className:"owner-email",children:n.store_email}),e.jsx("div",{className:"id",children:n.id&&`#${n.id.split("-")[0]}`})]})]})}),e.jsxs("div",{className:"btm",children:[e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"stat",children:[e.jsxs("div",{className:"products",children:[e.jsx("div",{className:"value",children:t?42:0}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"clients",children:[e.jsx("div",{className:"value",children:t?205:0}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"collaborators",children:[e.jsx("div",{className:"value",children:t?9:0}),e.jsx("div",{className:"icon"})]})]}),e.jsxs("div",{className:"other",children:[e.jsx("div",{className:"site",children:n.website}),e.jsx("div",{className:"phone",children:n.phone})]})]}),t&&e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"open-store",onClick:()=>{localStorage.setItem("store",JSON.stringify(D)),window.open(`${Z}/${n.name}`,void 0)},children:"STORE"}),e.jsx("div",{className:"open-dash",onClick:()=>{localStorage.setItem("store",JSON.stringify(D)),window.open(`${Z}/${n.name}/dash/admin`)},children:"DASH"})]})]})]})}),e.jsxs("div",{className:"center-right",children:[_&&e.jsxs("div",{className:"id",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"id",style:{opacity:"0.5"},children:"Id"}),e.jsx("input",{type:"text",id:(t==null?void 0:t.id)+"id",value:n.id||"",style:{opacity:"0.5"},placeholder:"Name",onChange:()=>""})]}),e.jsxs("div",{className:"name",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"name",children:"Name"}),e.jsx("input",{type:"text",id:(t==null?void 0:t.id)+"name",value:n.name||"",placeholder:"Name",onChange:b=>{d({...n,name:b.currentTarget.value})}})]}),e.jsxs("div",{className:"phone",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"phone",children:"Phone"}),e.jsx("input",{type:"text",id:(t==null?void 0:t.id)+"phone",value:n.phone||"",placeholder:"Phone",onChange:b=>{d({...n,phone:b.currentTarget.value})}})]}),e.jsxs("div",{className:"store_email",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"store_email",children:"Store Email"}),e.jsx("input",{type:"email",id:(t==null?void 0:t.id)+"store_email",value:n.store_email||"",placeholder:"Store email",onChange:b=>{d({...n,store_email:b.currentTarget.value})}})]}),e.jsxs("div",{className:"website",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"website",children:"Web Site"}),e.jsx("input",{type:"text",id:(t==null?void 0:t.id)+"website",value:n.website||"",placeholder:"Web Site",onChange:b=>{d({...n,website:b.currentTarget.value})}})]}),e.jsxs("div",{className:"desciption",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"desciption",children:"Description"}),e.jsx("input",{type:"text",id:(t==null?void 0:t.id)+"description",value:n.description||"",placeholder:"Description",onChange:b=>{d({...n,description:b.currentTarget.value})}})]}),e.jsxs("div",{className:"address",children:[e.jsx("label",{htmlFor:(t==null?void 0:t.id)+"address",children:"Address"}),e.jsx("input",{type:"text",id:(t==null?void 0:t.id)+"address",value:"",placeholder:"Address",onChange:()=>{d({...n})}})]})]})]}),e.jsx("div",{className:"bottom-bar"})]})}const X={name:"Sublymus",logo:["/src/res/img/img3.svg"]};function Ne({blur:o,className:s}){const{setAbsPath:a,pathList:i}=E(),{T:t,setT:r}=oe(),[c,l]=x.useState(i[1]||"products"),{user:n,disconnection:d}=f();return x.useEffect(()=>{l(i[1]||"products")},[i]),e.jsxs("div",{className:"nav-bar "+(s||"min")+" "+(n?o?"blur":"":"blur"),children:[e.jsxs("div",{className:"nav-logo",children:[e.jsx("div",{className:"logo",style:{backgroundImage:`url(${`${X==null?void 0:X.logo[0]}`})`}}),e.jsx("div",{className:"label",children:X==null?void 0:X.name})]}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+t,onClick:()=>{r(t?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]}),e.jsx("div",{className:"nav-link",children:e.jsxs("ul",{children:[e.jsxs("li",{className:c=="stores"?"active":"no",onClick:()=>{l("stores"),a(["stores"])},children:[e.jsx("span",{className:"stores"}),e.jsx("label",{children:"STORE"})]}),e.jsxs("li",{className:c=="users"||c=="moderators"||c=="roles"?"active":"no",onClick:()=>{l("users"),a(["users"])},children:[e.jsx("span",{className:"users"}),e.jsx("label",{children:"USERS"})]}),e.jsxs("li",{className:c=="chat"?"active":"no",onClick:()=>{l("chat"),a(["chat"])},children:[e.jsx("span",{className:"chat"}),e.jsx("label",{children:"CHAT"})]}),e.jsxs("li",{className:c=="interfaces"?"active":"no",onClick:()=>{l("interfaces"),a(["interfaces"])},children:[e.jsx("span",{className:"interface"}),e.jsx("label",{children:"INTERFACE"})]}),e.jsxs("li",{className:c=="statistic"?"active":"no",onClick:()=>{l("statistic"),a(["statistic"])},children:[e.jsx("span",{className:"state"}),e.jsx("label",{children:"STATISTIC"})]})]})}),e.jsxs("div",{className:"nav-profile",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${n!=null&&n.photos[0].startsWith("/")?S:""}${n==null?void 0:n.photos[0]})`}}),e.jsx("div",{className:"name",children:n==null?void 0:n.name}),e.jsx("div",{className:"logout",onClick:()=>{d()},children:"logout"})]}),e.jsx("div",{className:"logut-icon",onClick:()=>{d()}})]})}function Be(){const{current:o,qs:s,pathList:a}=E(),{user:i}=f(),{stores:t,fetchStores:r,setStore:c}=ie();return x.useEffect(()=>{i&&o("stores")&&r({text:""})},[i,a]),o("stores")&&e.jsxs("div",{className:"stores-page",children:[e.jsx("div",{className:"sreach-stores",children:e.jsxs("div",{className:"ctn",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search by #id, name, email",name:"sreach-stores",id:"sreach-stores",onChange:l=>{r({text:l.currentTarget.value})}})]})}),e.jsx("div",{className:"stores",children:t==null?void 0:t.list.map(l=>e.jsxs("div",{className:"store",children:[e.jsx("div",{className:"banner",style:{background:J(l.banners[0])},onClick:()=>{c(l),s({store_id:l.id}).setAbsPath(["stores","store_info"])},children:e.jsxs("div",{className:"more",children:[e.jsx("div",{className:"logo",style:{background:J(l.logo[0])}}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"name",children:l.name}),e.jsx("div",{className:"owner-email",children:l.store_email}),e.jsxs("div",{className:"id",children:["#",l.id.split("-")[0]]})]})]})}),e.jsxs("div",{className:"btm",children:[e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"stat",children:[e.jsxs("div",{className:"products",children:[e.jsx("div",{className:"value",children:"42"}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"clients",children:[e.jsx("div",{className:"value",children:"205"}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"collaborators",children:[e.jsx("div",{className:"value",children:"9"}),e.jsx("div",{className:"icon"})]})]}),e.jsxs("div",{className:"other",children:[e.jsx("div",{className:"site",children:l.website}),e.jsx("div",{className:"phone",children:l.phone})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"open-store",onClick:()=>{localStorage.setItem("store",JSON.stringify(l)),window.open(`${Z}/${l.name}`)},children:"STORE"}),e.jsx("div",{className:"open-dash",onClick:()=>{localStorage.setItem("store",JSON.stringify(l)),window.open(`${Z}/${l.name}/dash`)},children:"DASH"})]})]})]},l.id))})]})}function He(){const{getAccess:o}=f();return e.jsx("div",{className:"page-auth",children:e.jsxs("div",{className:"auth-ctn",children:[e.jsx("div",{className:"image"}),e.jsxs("div",{className:"form",children:[e.jsx("h1",{className:"auth-title",children:"SUBLYMUS DASHBOARD"}),e.jsxs("h5",{className:"auth-prompt",children:["Read more ?"," ",e.jsx("span",{onClick:()=>{},children:"Click here"})]}),e.jsxs("div",{className:"google",onClick:()=>{o()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Connexion"})]}),e.jsx("p",{children:"Google connexion is required to get access to sublymus Dash board service."})]})]})})}const ne=L(o=>({users:void 0,selectedUser:void 0,async setUserById(s){const a=ne.getState().users,i=a==null?void 0:a.list.find(t=>t.id==s);if(i)o(()=>({selectedUser:i}));else{const t=await ne.getState().fetchUsers({query:{user_id:s}});o(()=>({selectedUser:t==null?void 0:t.list.find(r=>r.id==s)}))}},async setSelectedUser(s){o(()=>({selectedUser:s}))},async fetchUsers(s){var l,n,d;const a=f.getState().getHeaders();if(!a)return;const i={};s!=null&&s.page&&(i.page=Number(s.page)),s!=null&&s.limit&&(i.limit=Number(s.limit)),s!=null&&s.order_by&&(i.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(i.text=s.query.text),(n=s==null?void 0:s.query)!=null&&n.user_id&&(i.user_id=s.query.user_id),(d=s==null?void 0:s.query)!=null&&d.phone&&(i.phone=s.query.phone);const t=new URLSearchParams({});for(const h in i){const j=i[h];t.set(h,j)}const c=await(await fetch(`${S}/get_users/?${t.toString()}`,{headers:a.headers})).json();if(console.log("users",c),!(!c||!c.list))return o(()=>({users:c})),c},async banUser(){}}));function qe(){const{current:o,qs:s}=E(),{users:a,setSelectedUser:i,fetchUsers:t}=ne(),{user:r}=f();return x.useEffect(()=>{o("users")&&t()},[r]),o("users")&&e.jsx("div",{className:"user-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(H,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:ge(["PAUSE","TRASH","NEW"],[]),index:fe([0,100]),is_dynamic_price:ae(),hasScene:ae()}},items_height:80,id:"user_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{photos:{getView(c,l,n,d){return H.ImageElement().getView(c,`${l[0].startsWith("/")?S:""}${l[0]}`,n,d)}},id:{getView(c,l,n,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},n.id)}},name:H.StringElement({size_interval:[50,200]}),status:{getView(c,l,n,d){return be.getView(c,"VISIBLE",n,d)}},created_at:H.DateStringElement({size:200})},onItemsSelected:(c,l)=>{l.forEach(n=>{n.$itemRef&&(n.$itemRef.style.background="")}),c.forEach(n=>{n.$itemRef&&(n.$itemRef.style.background="#00f2")}),i(c[0]),s({user_id:c[0].id}).setAbsPath(["users","user_profile"])},onQuery:c=>{t(c)},top_height:40,canPaginate:!0})})})}function Fe(){const{current:o,json:s}=E(),{selectedUser:a,setUserById:i}=ne(),{user:t}=f(),[r]=x.useState(!1),l=re().width<1e3?"wrap":"";return x.useEffect(()=>{o("user_profile")&&(s!=null&&s.user_id)&&t&&i(s==null?void 0:s.user_id)},[s,t]),o("user_profile")&&(a?e.jsxs("div",{className:"user-profile",ref:K,children:[e.jsx("h1",{children:"User Information"}),e.jsxs("section",{className:"editor "+l,children:[e.jsx("div",{className:"left-right",children:e.jsx(ye,{name:"user_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(I,{isCheckRequired:r,label:"User Id",value:(a==null?void 0:a.id)||""}),e.jsx(I,{prompt:"User Name",isCheckRequired:r,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(I,{prompt:"User Email",isCheckRequired:r,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(I,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(I,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(we,{user:a,channel:"sessions"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Le(){const{check:o,current:s,setAbsPath:a}=E();return o("users")&&e.jsxs("div",{className:"user-page",children:[s("users","user_profile")&&e.jsx(je,{collabo:!1,active:"users",setActive:i=>a(i.path)}),e.jsx(qe,{}),e.jsx(Fe,{})]})}const Y=L(o=>({moderators:void 0,selectedModerator:void 0,async change_moderator_role(s){const a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("new_role_id",s.new_role_id),i.append("moderator_id",s.moderator_id);const r=await(await fetch(`${S}/change_moderator_role`,{method:"PUT",body:i,headers:a.headers})).json();!r||r.id},async addModerator(s){console.log(s);let a=f.getState().getHeaders();if(!a)return;const i=new FormData;if(!s.email||!s.role_id)return;i.append("email",s.email),i.append("role_id",s.role_id);const r=await(await fetch(`${S}/add_moderator`,{method:"POST",body:i,headers:a.headers})).json();if(!(!r||!r.id))return o(()=>({moderators:r})),r},async removeModerator(s){let a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("moderator_id",s);const t={method:"DELETE",headers:a.headers,body:i};(await(await fetch(`${S}/remove_moderator`,t)).json()).deleted&&o(()=>({selectedModerator:void 0}))},async setModeratorById(s){const a=Y.getState().moderators,i=a==null?void 0:a.list.find(t=>t.id==s);if(i)o(()=>({selectedModerator:i}));else{const t=await Y.getState().fetchModerators({query:{user_id:s}});o(()=>({selectedModerator:t==null?void 0:t.list.find(r=>r.id==s)}))}},async setSelectedModerator(s){o(()=>({selectedModerator:s}))},async fetchModerators(s){var l,n,d,h,j,g;const a=f.getState().getHeaders();if(!a)return;const i={};s!=null&&s.page&&(i.page=Number(s.page)),s!=null&&s.limit&&(i.limit=Number(s.limit)),s!=null&&s.sortBy&&(i.order_by=s.sortBy),(l=s==null?void 0:s.query)!=null&&l.text&&(i.text=(n=s.query)==null?void 0:n.text),(d=s==null?void 0:s.query)!=null&&d.user_id&&(i.user_id=(h=s.query)==null?void 0:h.user_id),(j=s==null?void 0:s.query)!=null&&j.phone&&(i.phone=(g=s.query)==null?void 0:g.phone);const t=new URLSearchParams({});for(const m in i){const y=i[m];t.set(m,y)}console.log(s,i);const c=await(await fetch(`${S}/get_moderators/?${t.toString()}`,{headers:a.headers})).json();if(console.log("moderators",c),!(!c||!c.list))return o(()=>({moderators:c})),c},async banModerator(){}}));function ze(){const{current:o,qs:s,setAbsPath:a}=E(),{moderators:i,setSelectedModerator:t,fetchModerators:r}=Y(),{user:c}=f();return x.useEffect(()=>{o("moderators")&&r()},[c]),o("moderators")&&e.jsx("div",{className:"moderator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(H,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:ge(["PAUSE","TRASH","NEW"],[]),index:fe([0,100]),is_dynamic_price:ae(),hasScene:ae()}},items_height:80,id:"moderator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(l,n,d,h){return H.ImageElement().getView(l,`${n[0].startsWith("/")?S:""}${n[0]}`,d,h)}},id:{getView(l,n,d,h){return e.jsxs("div",{ref:h,children:["#",n.split("-")[0]]},d.id)}},name:H.StringElement({size_interval:[50,200]}),status:{getView(l,n,d,h){return be.getView(l,"VISIBLE",d,h)}},created_at:H.DateStringElement({size:200})},onItemsSelected:(l,n)=>{n.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),t(l[0]),s({moderator_id:l[0].id}).setAbsPath(["moderators","moderator_profile"])},onQuery:l=>{console.log(l),r(l)},canAddNew:!0,onNewRequired:()=>{a(["moderators","new_moderator"])},top_height:40,canPaginate:!0})})})}function We(){const{current:o,json:s}=E(),{selectedModerator:a,setModeratorById:i,removeModerator:t}=Y(),{user:r}=f(),[c]=x.useState(!1),n=re().width<1e3?"wrap":"";return x.useEffect(()=>{o("moderator_profile")&&(s!=null&&s.moderator_id)&&i(s==null?void 0:s.moderator_id)},[s,r]),o("moderator_profile")&&(a?e.jsxs("div",{className:"moderator-profile",ref:K,children:[e.jsx(ve,{title:"Moderator Information",mode:"delete",deteleKey:a.id,onDelete:()=>{t(a.id)}}),e.jsxs("section",{className:"editor "+n,children:[e.jsx("div",{className:"left-right",children:e.jsx(ye,{name:"moderator_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(I,{isCheckRequired:c,label:"Moderator Id",value:(a==null?void 0:a.id)||""}),e.jsx(I,{prompt:"Moderator Name",isCheckRequired:c,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(I,{prompt:"Moderator Email",isCheckRequired:c,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(I,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(I,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(we,{user:a,channel:"sessions"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}const se=L(o=>({json_roles:void 0,roles:void 0,selectedRole:void 0,async setSelectedRole(s){o(()=>({selectedRole:s}))},async setRoleById(s){const a=se.getState().roles,i=a==null?void 0:a.list.find(t=>t.id==s);if(i)o(()=>({selectedRole:i}));else{const t=await se.getState().fetchRoles({role_id:s});o(()=>({selectedRole:t==null?void 0:t.list.find(r=>r.id==s)}))}},async newRole(s){var c;if(!s.name)return console.log("Name required");if(!s.options||s.options.length==0)return;const a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("name",s.name),(c=s.options)==null||c.forEach(l=>{i.append(l,"1")});const r=await(await fetch(`${S}/create_moderator_role`,{method:"POST",body:i,headers:a.headers})).json();!r||!r.id||(console.log("new role",r),o(()=>({selectedRole:r})),E.getState().setAbsPath(["roles","edit_role"]))},async updateRole(s){var l,n;const a=f.getState().getHeaders();if(!a)return;const i=se.getState().selectedRole;if(!i)return;if(!s.name&&!s.options)return console.log("data",s);const t=new FormData;t.append("role_id",i.id),s.name&&t.append("name",s.name),((l=s.options)==null?void 0:l.length)>0&&t.append("newOptions","ok"),(n=s.options)==null||n.forEach(d=>{t.append(d,"1")});const c=await(await fetch(`${S}/update_role`,{method:"PUT",body:t,headers:a.headers})).json();!c||!c.id||o(()=>({selectedRole:c}))},async deleteRole(s){console.log(s);let a=f.getState().user;if(!a)return;const i=new Headers;i.append("Authorization",`Bearer ${a.token}`);const t=new FormData;t.append("role_id",s);const r={method:"DELETE",headers:i,body:t};(await(await fetch(`${S}/delete_role`,r)).json()).deleted&&o(()=>({selectedRole:void 0}))},async fetchRolesJson(){const a=await(await fetch(`${S}/get_roles_json/?type=moderator`)).json();a&&o(()=>({json_roles:a}))},async fetchRoles(s={}){let a=f.getState().getHeaders();if(!a)return;const i={method:"GET",headers:a.headers},t=new URLSearchParams({});s.type="moderator";for(const l in s){const n=s[l];t.set(l,n)}const c=await(await fetch(`${S}/get_store_roles/?${t.toString()}`,i)).json();if(!(!c||!c.list))return o(()=>({roles:c})),c}}));function Je(){const{current:o,setAbsPath:s}=E(),{addModerator:a,setSelectedModerator:i}=Y(),{roles:t,fetchRoles:r}=se(),{user:c}=f(),n=re().width<1e3?"wrap":"",[d]=x.useState({});return x.useEffect(()=>{r()},[c]),o("new_moderator")&&e.jsxs("div",{className:"moderator-profile",ref:K,children:[e.jsx(ve,{terme:"white",mode:"create",title:"Collaborator Information",onCreate:()=>{a({email:d.email,role_id:d.role_id}).then(h=>{h!=null&&h.id&&(i(h),s(["moderators","moderator_profile"]))})}}),e.jsxs("section",{className:"editor "+n,children:[e.jsx("div",{className:"left-right",children:e.jsx(I,{editable:!0,prompt:"Collaborator Email",min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:"",onChange:h=>{d.email=h}})}),e.jsx("div",{className:"left-side",children:e.jsx(Ae,{roles:(t==null?void 0:t.list)||[],onChange:h=>{d.role_id=h},canChange:()=>!0})})]})]})}function Ve(){const{check:o,current:s,setAbsPath:a}=E();return o("moderators")&&e.jsxs("div",{className:"moderator-page",children:[s("moderators","moderator_profile")&&e.jsx(je,{collabo:!1,active:"moderators",setActive:i=>a(i.path)}),e.jsx(ze,{}),e.jsx(We,{}),e.jsx(Je,{})]})}function Ge(){const{current:o,setAbsPath:s,qs:a}=E(),{roles:i,setSelectedRole:t,fetchRoles:r}=se(),{user:c}=f();return x.useEffect(()=>{o("roles")&&c&&r()},[c]),o("roles")&&e.jsx("div",{className:"collaborator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(H,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:ge(["PAUSE","TRASH","NEW"],[]),index:fe([0,100]),is_dynamic_price:ae(),hasScene:ae()}},items_height:80,id:"collaborator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{id:{getView(l,n,d,h){return e.jsxs("div",{ref:h,children:["#",n.split("-")[0]]},d.id)}},name:H.StringElement({size_interval:[50,200]}),created_at:H.DateStringElement({size:200})},onItemsSelected:(l,n)=>{n.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),t(l[0]),a({role_id:l[0].id}).setAbsPath(["roles","edit_role"])},onQuery:l=>{r(l)},canAddNew:!0,onNewRequired:()=>{s(["roles","create_role"])},top_height:40,canPaginate:!0})})})}function Ye(){const{selectedRole:o,setRoleById:s,updateRole:a,newRole:i,deleteRole:t,fetchRolesJson:r,json_roles:c}=se(),{current:l,json:n}=E(),{user:d}=f(),[h]=x.useState({}),j=l("edit_role"),g=l("create_role");return x.useEffect(()=>{(j||g)&&(n!=null&&n.role_id)&&d&&s(n==null?void 0:n.role_id)},[n,d]),x.useEffect(()=>{(j||g)&&r()},[n]),(j||g)&&(!o&&j?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"role-dash",ref:K,children:[e.jsx(ve,{title:"Role Information",mode:j?"delete":"create",deteleKey:o==null?void 0:o.id,onDelete:()=>{o&&t(o.id)},onCreate:()=>{i(h)}}),e.jsxs("section",{className:"editor",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(I,{min:3,max:25,placeholder:"Role Name",prompt:"Role Name",editable:!0,label:"Name",value:j?o==null?void 0:o.name:"",onChange:m=>{j?a({name:m}):h.name=m}}),j&&e.jsxs(e.Fragment,{children:[e.jsx(I,{label:"Id",value:o==null?void 0:o.id}),e.jsx(I,{label:"Created At",value:o==null?void 0:o.created_at}),e.jsx(I,{label:"Update At",value:o==null?void 0:o.updated_at}),e.jsx(Ie,{})]})]}),e.jsx("div",{className:"right-side",children:e.jsx(Me,{json_roles:c,role:o,isNew:g,onChange:m=>{j?a({options:m}):h.options=m}})})]})]}))}function Ke(){const{check:o,current:s,setAbsPath:a}=E();return o("roles")&&e.jsxs("div",{className:"role-page",children:[s("roles","edit_role")&&e.jsx(je,{collabo:!1,active:"roles",setActive:i=>a(i.path)}),e.jsx(Ge,{}),e.jsx(Ye,{})]})}const Qe="new_discussion",Xe="new_distore",ee=L(o=>({async fetchEditMessage(s){const a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("message_id",s.message_id),i.append("text",s.text);const t=await fetch(`${S}/edit_message`,{method:"PUT",headers:a.headers,body:i});try{const r=await t.json();return console.log("edit_message ",r),r!=null&&r.id?r:void 0}catch(r){console.log(r)}},async fetchDeleteMessageBoth(s){const a=f.getState().getHeaders();if(!a)return;console.log("$$$$$$$$");const i=await fetch(`${S}/delete_message/${s}`,{method:"DELETE",headers:a.headers});try{const t=await i.json();return console.log("fetchDeleteMessageBoth",t),t==null?void 0:t.deleted}catch(t){console.log(t)}},async fetchDeleteMessageMe(s){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${S}/delete_message/${s}`,{method:"DELETE",headers:a.headers});try{const t=await i.json();return console.log("fetchDeleteMessageMe",t),t==null?void 0:t.deleted}catch(t){console.log(t)}},async fetchSendMessage({context:s,context_name:a,files:i,text:t}){if(!s||!s.id)return;if(s.id.startsWith(Qe)){const n=await $.getState().createDiscussion({other_id:s.other.id,store_id:s.to_id});if(console.log("D"),!n||!n.id)return;s=n,$.getState().setDiscussion(n)}else s.id.startsWith(Xe);const r=f.getState().getHeaders();if(!r)return;const c=new FormData;if(!t&&!i)return;if(i)for(let n=0;n<i.length;n++){const d=i[n];c.append("files_"+n,d)}if(c.append("context_id",s.id),c.append("context_name",a),t&&c.append("text",t),i)for(let n=0;n<i.length;++n){const d=i[n];c.append("files_"+n,d)}const l=await fetch(`${S}/send_message`,{headers:r.headers,body:c,method:"POST"});try{const n=await l.json();return console.log("fetchSendMessage",n),n!=null&&n.id?n:void 0}catch(n){console.log(n)}},async fetchMessages(s,a){if(s.toLowerCase().startsWith("new_"))return;const i=f.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/get_messages/?context_id=${s}&context_name=${a}`,{headers:i.headers});try{const r=await t.json();return r!=null&&r.list?r:void 0}catch{}}})),pe="new_discussion";let ce;const ue=[],$=L(o=>({discussion:void 0,discussions:void 0,messages:void 0,setDiscussion(s){o(()=>({discussion:s}))},async setDiscussionByOtherId({other_id:s,store_id:a,findOther:i},t){var j,g,m;const r=t||o,c=f.getState().getHeaders();if(!c||s==c.user.id)return;const l=(j=$.getState().discussions)==null?void 0:j.list,n=l==null?void 0:l.find(y=>y.other.id==s&&(a?!!F(void 0,y):!F(void 0,y)));if(n){if(((g=$.getState().messages)==null?void 0:g.list[0].table_id)==n.id)return;const y=await ee.getState().fetchMessages(n.id,"discussions");r(()=>({discussion:n,messages:y}));return}const d=(m=await $.getState().fetchDiscussions({no_save:!0,other_id:s,store_id:a}))==null?void 0:m.list[0];if(d){const y=await ee.getState().fetchMessages(d.id,"discussions");r(()=>({discussion:d,messages:y}));return}const h=await i(s,a);h&&$.getState().addDiscussion({other:h,store_id:a})},async openDiscussionMessages(s){const a=await ee.getState().fetchMessages(s,"discussions");o(()=>({messages:a}))},async unBlockDiscussion(s){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${S}/unblock_discussion/${s.id}`,{method:"PUT",headers:a.headers});try{const t=await i.json();return console.log("unblock_discussion ",t),t!=null&&t.id?(o(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(c=>c.id==t.id?{...c,...t}:c)}})),t):void 0}catch(t){console.log(t)}},async blockDiscussion(s){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${S}/block_discussion/${s.id}`,{method:"PUT",headers:a.headers});try{const t=await i.json();return console.log("unblock_discussion ",t),t!=null&&t.id?(o(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(c=>c.id==t.id?{...c,...t}:c)}})),t):void 0}catch(t){console.log(t)}},async deleteDiscussion(s){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${S}/delete_discussion/${s.id}`,{method:"DELETE",headers:a.headers});try{const t=await i.json();return console.log("deleteDiscussion ",t),t!=null&&t.deleted?(o(({discussions:r,messages:c,discussion:l})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).filter(n=>n.id!==s.id)},messages:(l==null?void 0:l.id)==s.id?void 0:c})),!0):void 0}catch(t){console.log(t)}},async createDiscussion({other_id:s,store_id:a}){const i=f.getState().getHeaders();if(!i)return;const t=new FormData;t.append("receiver_id",s),a&&t.append("to_id",a);const r=await fetch(`${S}/create_discussion`,{headers:i.headers,body:t,method:"POST"});try{const c=await r.json();return console.log("createDiscussion",c),c!=null&&c.id?c:void 0}catch(c){console.log(c)}},async addDiscussion({other:s,store_id:a}){var n,d;const i=f.getState().getHeaders();if(!i||s.id==i.user.id)return;const t=(n=$.getState().discussions)==null?void 0:n.list,r=t==null?void 0:t.find(h=>h.other.id==s.id&&(a?!F(void 0,h):!!F(void 0,h)));if(console.log("addDiscussion",{exist:r}),r){const h=await ee.getState().fetchMessages(r.id,"discussions");return o(()=>({discussion:r,messages:h})),r}const c=(d=$.getState().discussions)==null?void 0:d.list.filter(h=>h.id.startsWith(pe)?(h.receiver_id==s.id||h.creator_id==s.id)&&F(void 0,h)===(a||null):!1);if(c!=null&&c[0]){o(({discussions:h})=>({discussions:h&&{...h}}));return}const l={id:pe+Date.now(),creator_id:i.user.id,receiver_id:s.id,deleted:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s,from_id:void 0,to_id:a,last_message:void 0,other_att:"creator"};return o(({discussions:h})=>({messages:{list:[],limit:25,page:1,total:0},discussion:l,discussions:h&&{...h,list:[l,...h.list]}})),console.log("NEW DISCUSSION",l),l},async fetchDiscussions({discussion_id:s,no_save:a,other_id:i,store_id:t}){const r=f.getState().getHeaders();if(!r)return;const c=new URLSearchParams({});t&&(c.set("to_id",t),c.set("add_store","true")),s&&c.set("discussion_id",s),i&&c.set("other_id",i);const n=await(await fetch(`${S}/get_discussions?${c}`,{headers:r.headers})).json();if(console.log("fetch Discussions",n),!n)return;ce=o,n.list.forEach(async h=>{_e(h)});const d=`${r.user.id}/`;if(!ue.includes(d)){ue.push(d);const h=Ce.subscription(d);await h.create(),h.onMessage(async j=>{var g;if(j.new_discussion){console.log("new_discussion ==>  ",j.new_discussion),_e(j.new_discussion);const m=j.new_discussion,y=m.receiver.id!=r.user.id?"receiver":"creator";m.other_att=y,m.other=m[y];const C=(g=$.getState().discussions)==null?void 0:g.list.filter(_=>_.id.startsWith(pe)?!(_.other.id==m.other.id&&(_.from_id||null)==(m.from_id||null)&&(_.to_id||null)==(m.to_id||null)):!0);o(({discussions:_})=>({discussions:_&&{..._,list:[m,...C||[]]}}))}j.reload_discussion&&(console.log("reload_discussion ==>  "),$.getState().fetchDiscussions({}))})}return a||o(({discussions:h})=>({discussions:{...n,list:[...((h==null?void 0:h.list)||[]).filter(j=>j.id.startsWith("new_")),...n.list]}})),n}}));async function _e(o){if(!f.getState().getHeaders()||ue.includes(o.id))return;ue.push(o.id);const a=Ce.subscription(o.id);await a.create(),a.onMessage(async i=>{var r,c;if(!ce)return;const t=$.getState().discussion;if(i.reload){const l=(r=$.getState().discussions)==null?void 0:r.list,n=(c=await $.getState().fetchDiscussions({discussion_id:o.id,no_save:!0}))==null?void 0:c.list;if(console.log("reload Discussion ___________ ",n==null?void 0:n.length),!(n!=null&&n[0].id))return;const d=[...(l==null?void 0:l.map(h=>h.id==o.id?n==null?void 0:n[0]:h))||[]];ce(({discussions:h})=>({discussions:h&&{...h,list:d}})),(t==null?void 0:t.id)==(n==null?void 0:n[0].id)&&ce(()=>({discussion:{...n==null?void 0:n[0]}}))}if(i.reloadMessage&&(t==null?void 0:t.id)==o.id){console.log("reload Message___________",t);const l=await ee.getState().fetchMessages(o.id,"discussions");ce(()=>({messages:l,discussion:{...o}}))}})}function xe(){var A;const{discussion:o,discussions:s,fetchDiscussions:a,addDiscussion:i,blockDiscussion:t,deleteDiscussion:r,unBlockDiscussion:c,setDiscussionByOtherId:l}=$(),{json:n,pathList:d,qs:h,check:j}=E(),g=(A=d[3])==null?void 0:A.split("_")[1],[m,y]=x.useState(g||"all"),{openChild:C}=oe(),{user:_}=f(),{fetchUsers:D}=ne(),{fetchModerators:B}=Y();if(x.useEffect(()=>{_&&(n!=null&&n.collaborator_id||n!=null&&n.moderator_id)&&l({async findOther(p){var P;return(P=await D({query:{user_id:p}}))==null?void 0:P.list[0]},other_id:(n==null?void 0:n.collaborator_id)||(n==null?void 0:n.moderator_id),store_id:n==null?void 0:n.store_id}),y(g||"all")},[n,_]),x.useEffect(()=>{j("discussions")&&!s&&_&&a({store_id:null})},[_]),x.useEffect(()=>{y(g||"all")},[d]),!_)return;const b=s==null?void 0:s.list.filter(p=>{var P;return!((P=p.blocked)!=null&&P.includes(_.id))}),w=s==null?void 0:s.list.filter(p=>{var P;return(P=p.blocked)==null?void 0:P.includes(_.id)}),M=b==null?void 0:b.filter(p=>p.unchecked_count>0);let q=[];m=="all"?q=b:m=="new"?q=M:q=w;let O=0;M==null||M.forEach(p=>{O+=p.unchecked_count});let T=0;return M==null||M.forEach(p=>{T+=p.unchecked_count}),e.jsxs("div",{className:"discussion-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Chats "}),e.jsxs("div",{className:"add-new",onClick:()=>{C(e.jsx(ke,{user:_,openChild:C,fetchUsers:B,setUser:p=>{i({other:p})}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{h(n||{}).setAbsPath(["chat","discussions","discussions_all"])},children:e.jsxs("div",{className:m=="all"?"active":"",children:["All",((b==null?void 0:b.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{h(n||{}).setAbsPath(["chat","discussions","discussions_new"])},children:e.jsxs("div",{className:m=="new"?"active":"",children:["New ",((M==null?void 0:M.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{h(n||{}).setAbsPath(["chat","discussions","discussions_blocked"])},children:e.jsxs("div",{className:m=="blocked"?"active":"",children:["Blocked  ",((w==null?void 0:w.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"discussions",children:q==null?void 0:q.map(p=>{var V,v,u;let P="";return((V=p.last_message)==null?void 0:V.user_id)==_.id&&(p[`${p.other_att}_opened_at`]?new Date(p[`${p.other_att}_opened_at`])<new Date(p.last_message.created_at)?P="one":P="double":P="one"),e.jsxs("div",{className:"discussion "+((o==null?void 0:o.id)==p.id?"active":""),onClick:N=>{p.unchecked_count=0,h({store_id:F(void 0,p),[F(void 0,p)?"collaborator_id":"moderator_id"]:p.other.id,nav:document.querySelector(".back-close.nav").getBoundingClientRect().width==0?void 0:"min"}).setAbsPath(["chat","discussions","discussions_"+(m||"_all")]);const R=N.currentTarget.querySelector(".count");R.style.display="none"},onContextMenu:N=>{N.preventDefault(),C(e.jsx(Ze,{blocked:!!(w!=null&&w.includes(p)),x:N.clientX,y:N.clientY,onBlock:R=>{R?(t(p),h(n||{}).setAbsPath(["chat","discussions","discussions_blocked"])):(c(p),h(n||{}).setAbsPath(["chat","discussions","discussions_all"]))},onAsRead:()=>{},onDelete:()=>{r(p)}}))},children:[e.jsx("div",{className:"photo",style:{background:J((u=(v=p.other)==null?void 0:v.photos)==null?void 0:u[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:W(p.other.name,16)}),e.jsx("div",{className:"date",children:p.last_message&&he(p.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+P}),e.jsx("div",{className:"text",children:p.last_message?W(p.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(o==null?void 0:o.id)==p.id?"none":p.unchecked_count>0?"flex":"none"},children:p.unchecked_count})]}),p.store&&e.jsx("div",{className:"store-name",children:p.store.name})]})]},p.id)})})]})}function Ze({x:o,y:s,onBlock:a,onAsRead:i,onDelete:t,blocked:r}){const c=x.useRef(null);return x.useEffect(()=>{c.current&&me(c.current)}),e.jsxs("div",{ref:c,className:"discussion-popu",style:{top:`${s}px`,left:`${o}px`},children:[e.jsxs("div",{className:"as-read",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>a(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function de(){var V;const{discussion:o,messages:s}=$(),{fetchSendMessage:a,fetchDeleteMessageBoth:i,fetchDeleteMessageMe:t,fetchEditMessage:r}=ee(),{user:c}=f(),{openChild:l}=oe(),{qs:n}=E(),[d,h]=x.useState(!1),[j,g]=x.useState(1),[m,y]=x.useState(!1),C=x.useRef(null),_=x.useRef(null),[D,B]=x.useState(null),[b]=x.useState(Date.now()+""),[w,M]=x.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),q=re(),O=()=>{if(!_.current)return;const v=_.current,u=Math.ceil(v.scrollHeight/(v.getBoundingClientRect().height||20)),N=Math.ceil(v.scrollHeight/20),R=v.value.split(`
`).length;let U=Math.max(u,R,N);U=U>10?10:U-1>=1?U-1:1,g(U)};x.useEffect(()=>{O()},[q]),x.useEffect(()=>{window.addEventListener("click",()=>{m&&y(!1)})},[]);const T=o==null?void 0:o.other.photos[0],A=(v,u)=>v.list[u].user_id==(c==null?void 0:c.id)?"right":"left",p=(v,u)=>v.list[u-1]&&v.list[u-1].user_id==(c==null?void 0:c.id)?"right":"left",P=(v,u)=>v.list[u+1]&&(v.list[u+1].user_id==(c==null?void 0:c.id)?"right":"left");return o?c&&e.jsxs("div",{className:"discussion-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"open-nonav",onClick:()=>{n({nav:"max"}).apply()}}),e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${T!=null&&T.startsWith("/")?S:""}${T})`},onClick:()=>{n({collaborator_id:o.other.id}).setAbsPath(["moderators","moderator_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:W(o.other.name,50)}),o[`${o.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",he(o[`${o.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:G()})})]}),e.jsx("div",{className:"messages",ref:v=>{C.current=v,d||(C.current&&C.current.scrollTo({top:C.current.scrollHeight}),h(!0))},onScroll:v=>{const u=v.currentTarget;clearInterval(w.lastid);const N=setTimeout(()=>{const R={isOpen:!1,height:u.scrollHeight,bottom:u.scrollHeight-(u.scrollTop+u.getBoundingClientRect().height),top:u.scrollTop,onProcess:!1,lastid:N};R.bottom>150&&(R.isOpen=!0),M(R),console.log(N)},100);w.lastid=N},children:(V=s==null?void 0:s.list)==null?void 0:V.map((v,u)=>{var z;const N=A(s,u),R=p(s,u),U=P(s,u);let Q="";return N==R?U&&R==U&&(Q="mid"):U&&N==U&&(Q="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+N+" "+Q,onContextMenu:k=>{k.preventDefault(),l(e.jsx(es,{forMe:c.id==v.user_id,x:k.clientX,y:k.clientY,onDeleteBoth:()=>{i(v.id)},onDeleteMe:()=>{t(v.id)},onEdit:()=>{l(e.jsx(ss,{x:k.clientX,y:k.clientY,text:v.text,onEdit:le=>{l(void 0),r({message_id:v.id,text:le})}}),!0)},other:o.other}))},children:[e.jsx("div",{className:"text",children:v.text&&v.text.split(" ").map((k,le)=>k.includes(`
`)?k.split(`
`).map((Ee,$e)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:Ee}),e.jsx("br",{})]},le+"_"+$e)):e.jsx("span",{style:{marginRight:"4px"},children:k},le))}),e.jsx("div",{className:"files",children:(z=v.files)==null?void 0:z.map(k=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${k.startsWith("/")?S:""}${k}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:k.length>35?W(k,25)+k.substring(k.length-8,k.length):k})]},k))}),e.jsxs("div",{className:"info",children:[v.created_at!=v.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:he(v.created_at)})]})]})},v.id)})}),e.jsxs("div",{className:"sender",children:[w.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{C.current&&C.current.scrollTo({behavior:"smooth",top:w.height})}}),m&&e.jsx("div",{className:"emoji-list",onClick:v=>{v.preventDefault(),v.stopPropagation()},children:Te.map(v=>e.jsx("span",{onClick:u=>{u.preventDefault(),u.stopPropagation(),_.current&&(_.current.value+=v.char)},children:v.char},v.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:b+"message_file",onChange:v=>{if(!v.currentTarget.files)return;const u=[];for(let N=0;N<v.currentTarget.files.length;N++){const R=v.currentTarget.files[N];u.push(R)}B(u.length>0?D?[...D,...u]:u:null)}}),e.jsx("label",{htmlFor:b+"message_file",className:"add-file",onClick:G()}),e.jsx("div",{className:"emoji-min",onClick:v=>{v.preventDefault(),v.stopPropagation(),G()(v),y(!m)}})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",children:D&&D.map(v=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{D&&B(D.filter(u=>u!==v))}}),e.jsx("div",{className:"text",children:v.name})]},v.name))}),e.jsx("textarea",{autoFocus:!0,ref:_,name:"discussion_sender",placeholder:"Type a message here..",id:"discussion_sender",style:{height:`${j*20}px`},cols:30,rows:10,onChange:v=>{O()},onKeyDown:()=>{y(!1)}})]}),e.jsx("div",{className:"right",children:e.jsx("div",{className:"send",onClick:v=>{var u;G()(v),a({context:o,context_name:"discussions",files:D,text:(u=_.current)==null?void 0:u.value}),B(null),_.current&&(_.current.value="")},children:e.jsx("div",{className:"icon"})})})]})]})]}):e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})})}function es({x:o,y:s,onEdit:a,onDeleteBoth:i,onDeleteMe:t,other:r,forMe:c}){const l=x.useRef(null);return x.useEffect(()=>{l.current&&me(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${o}px`},children:[c&&e.jsxs("div",{className:"edit",onClick:n=>{n.preventDefault(),n.stopPropagation(),a()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),c&&e.jsxs("div",{className:"delete-both",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function ss({x:o,y:s,onEdit:a,text:i}){const t=x.useRef(null),[r,c]=x.useState(i);return x.useEffect(()=>{t.current&&me(t.current)}),e.jsxs("div",{ref:t,className:"message-edit-popu",style:{top:`${s}px`,left:`${o}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{c(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{a(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}const De=L(o=>({serviceStore:void 0,serviceStores:void 0,serviceDiscussions:void 0,serviceDiscussion:void 0,async fetchServiceDiscussions(s){const a=await $.getState().fetchDiscussions({...s,no_save:!0});return o(()=>({serviceDiscussions:a})),a},async fetchServiceStores(s){const a=await ie.getState().fetchStores(s,!0);return o(()=>({serviceStores:a})),a},async setServiceStore(s){o(()=>({serviceStore:s}))},async setServiceDiscussionById(s){$.getState().setDiscussionByOtherId(s,o)},async setServiceStoreById(s){var i;const a=(i=De.getState().serviceStores)==null?void 0:i.list.find(t=>t.id==s);if(a)o(()=>({serviceStore:a}));else{const t=await ie.getState().fetchStores({text:`#${s}`},!0);o(()=>({serviceStore:t==null?void 0:t.list[0]}))}}}));function ts(){var v;const{addDiscussion:o,blockDiscussion:s,deleteDiscussion:a,unBlockDiscussion:i}=$(),{serviceStore:t,serviceStores:r,setServiceStoreById:c,fetchServiceStores:l,serviceDiscussions:n,serviceDiscussion:d,setServiceDiscussionById:h,fetchServiceDiscussions:j}=De(),{check:g,json:m,pathList:y,qs:C}=E(),_=(v=y[3])==null?void 0:v.split("_")[1],[D,B]=x.useState(_||"all"),{openChild:b}=oe(),{user:w}=f(),{fetchUsers:M}=ne(),{fetchModerators:q}=Y();if(x.useEffect(()=>{w&&(m!=null&&m.collaborator_id||m!=null&&m.moderator_id)?(console.log({json:m}),h({async findOther(u){var N;return(N=await M({query:{user_id:u}}))==null?void 0:N.list[0]},other_id:(m==null?void 0:m.collaborator_id)||(m==null?void 0:m.moderator_id),store_id:m==null?void 0:m.store_id})):m&&w&&g("services")&&m.store_id&&c(m.store_id),B(_||"all")},[m,w]),x.useEffect(()=>{B(_||"all")},[y]),x.useEffect(()=>{w&&g("services")&&l({})},[w]),x.useEffect(()=>{t&&j({store_id:t.id})},[t]),!w)return;const O=n==null?void 0:n.list.filter(u=>{var N;return!((N=u.blocked)!=null&&N.includes(w.id))}),T=n==null?void 0:n.list.filter(u=>{var N;return(N=u.blocked)==null?void 0:N.includes(w.id)}),A=O==null?void 0:O.filter(u=>u.unchecked_count>0);let p=[];D=="all"?p=O:D=="new"?p=A:p=T;let P=0;A==null||A.forEach(u=>{P+=u.unchecked_count});let V=0;return A==null||A.forEach(u=>{V+=u.unchecked_count}),e.jsxs("div",{className:"service-nav",children:[e.jsxs("div",{className:"title",children:[e.jsxs("div",{className:"label",children:[(t==null?void 0:t.name)||"Services"," "]}),t&&e.jsxs("div",{className:"add-new",onClick:()=>{b(e.jsx(ke,{user:w,openChild:b,fetchUsers:q,setUser:u=>{o({other:u})}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),!t&&e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{C(m||{}).setAbsPath(["chat","services","services_all"])},children:e.jsxs("div",{className:D=="all"?"active":"",children:["All",((O==null?void 0:O.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{C(m||{}).setAbsPath(["chat","services","services_new"])},children:e.jsxs("div",{className:D=="new"?"active":"",children:["New ",((A==null?void 0:A.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{C(m||{}).setAbsPath(["chat","services","services_blocked"])},children:e.jsxs("div",{className:D=="blocked"?"active":"",children:["Blocked  ",((T==null?void 0:T.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"service-stores",children:r==null?void 0:r.list.map(u=>{var N;return e.jsxs("div",{className:"store "+((t==null?void 0:t.id)==u.id?"active":""),onClick:()=>{C({store_id:u.id}).setAbsPath(["chat","services","services_all"])},children:[e.jsx("div",{className:"logo",style:{background:J((N=u.logo)==null?void 0:N[0])}}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"top-ctn",children:e.jsx("div",{className:"name",children:W(u.name,16)})}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"email",children:W(u.store_email,24)}),e.jsx("div",{className:"count",style:{display:"flex"},children:"5"})]})]})]})})}),e.jsx("div",{className:"services",children:p==null?void 0:p.map(u=>{var R,U,Q;let N="";return((R=u.last_message)==null?void 0:R.user_id)==w.id&&(u[`${u.other_att}_opened_at`]?new Date(u[`${u.other_att}_opened_at`])<new Date(u.last_message.created_at)?N="one":N="double":N="one"),e.jsxs("div",{className:"service "+((d==null?void 0:d.id)==u.id?"active":""),onClick:z=>{u.unchecked_count=0,C({store_id:F(void 0,u),[F(void 0,u)?"collaborator_id":"moderator_id"]:u.other.id}).setAbsPath(["chat","services","services_"+(D||"_all")]);const k=z.currentTarget.querySelector(".count");k.style.display="none"},onContextMenu:z=>{z.preventDefault(),b(e.jsx(as,{blocked:!!(T!=null&&T.includes(u)),x:z.clientX,y:z.clientY,onBlock:k=>{k?(s(u),C(m||{}).setAbsPath(["chat","services","services_blocked"])):(i(u),C(m||{}).setAbsPath(["chat","services","services_all"]))},onAsRead:()=>{},onDelete:()=>{a(u)}}))},children:[e.jsx("div",{className:"photo",style:{background:J((Q=(U=u.other)==null?void 0:U.photos)==null?void 0:Q[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:W(u.other.name,16)}),e.jsx("div",{className:"date",children:u.last_message&&he(u.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+N}),e.jsx("div",{className:"text",children:u.last_message?W(u.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(d==null?void 0:d.id)==u.id?"none":u.unchecked_count>0?"flex":"none"},children:u.unchecked_count})]})]})]},u.id)})})]})}function as({x:o,y:s,onBlock:a,onAsRead:i,onDelete:t,blocked:r}){const c=x.useRef(null);return x.useEffect(()=>{c.current&&me(c.current)}),e.jsxs("div",{ref:c,className:"service-popu",style:{top:`${s}px`,left:`${o}px`},children:[e.jsxs("div",{className:"as-read",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>a(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function is(){const{check:o,qs:s,json:a,pathList:i}=E(),{user:t}=f(),r={discussions:e.jsx(xe,{}),groups:e.jsx(xe,{}),services:e.jsx(ts,{}),surveys:e.jsx(xe,{})},c={discussions:e.jsx(de,{}),groups:e.jsx(de,{}),services:e.jsx(de,{}),surveys:e.jsx(de,{})},l=(i==null?void 0:i[2])||"discussions",n=(a==null?void 0:a.nav)||"max";return o("chat")&&t&&e.jsxs("div",{className:"page-chat",children:[e.jsx("div",{className:"back-close nav",style:{display:n=="min"?"none":""},onClick:d=>{d.currentTarget==d.target&&s({...a,nav:"min"}).apply()}}),e.jsxs("div",{className:"chat-nav "+n,children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"nav-size "+n,onClick:d=>{G(.4)(d),s({...a,nav:n=="min"?"max":"min"}).apply()}}),e.jsx("div",{className:"icon discussions-icon "+(l=="discussions"?"active":""),onClick:d=>{G(.4)(d),s({nav:n}).setAbsPath(["chat","discussions"])}}),e.jsx("div",{className:"icon services "+(l=="services"?"active":""),onClick:d=>{G(.4)(d),s({nav:n}).setAbsPath(["chat","services"])}}),e.jsx("div",{className:"icon profile",style:{background:`no-repeat center/cover url(${t.photos[0].startsWith("/")?S:""}${t.photos[0]})`},onClick:()=>{}})]}),n=="max"&&e.jsx("div",{className:"nav-ctn",children:r[l]})]}),e.jsx("div",{className:"chat-center",children:c[l]})]})}const Se={stores:"Stores",store_info:"Store Info",roles:"Roles",edit_role:"Edit Role",create_role:"Create Role",users:"Users",user_profile:"User Profile",chat:"Chat",discussions:"Discussions",groups:"Groups",surveys:"Surveys",interface:"Interfaces",statistic:"Statistic",action:"Action",moderators:"Moderators",moderator_profile:"Moderator Profile"};function ns(){const{currentChild:o,blur:s,openChild:a,T:i,setT:t,back_color:r}=oe(),{authenticateUser:c,user:l}=f(),{pathList:n,setAbsPath:d}=E(),h=[],j=x.useRef(null);return n.forEach(g=>{Se[g]&&h.push(Se[g])}),x.useEffect(()=>{c(),window.addEventListener("blur",()=>{a(void 0)})},[]),e.jsxs("div",{className:"dash "+(i?"sombre-mode-variable":""),ref:j,children:[e.jsx(Ne,{blur:s}),!l&&e.jsx(He,{}),e.jsx("div",{className:"dash-ctn "+(l?s?"blur":"":"blur"),children:e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"center-top",children:[e.jsxs("div",{className:"nav-min",onClick:()=>{a(e.jsx(Ne,{className:"max",blur:s}),!0,"#345b")},children:[" ",e.jsx("span",{})]}),e.jsx("div",{className:"page-path",children:h.map((g,m)=>e.jsxs("div",{className:"path",children:[e.jsxs("div",{className:"label",onClick:()=>{const y=n.slice(1,m+2);d(y)},children:[g,e.jsx("span",{})]}),h[m+1]?e.jsx("div",{className:"icon"}):void 0]},m))}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+i,onClick:()=>{t(i?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]})]}),e.jsxs("div",{className:"center-ctn",ref:g=>{if(!g||g.dataset.init)return;g.dataset.init="true";const m=()=>{const y=document.querySelector(".dash .center .center-top");g.style.height=`calc(100% - ${y.getBoundingClientRect().height}px)`};window.addEventListener("resize",m),m()},children:[e.jsx(Be,{}),e.jsx(Oe,{}),e.jsx(Le,{}),e.jsx(Ve,{}),e.jsx(Ke,{}),e.jsx(is,{})]})]})}),o&&e.jsx("div",{className:"child-viewer",onContextMenu:g=>{g.preventDefault(),a(void 0)},children:e.jsx("div",{className:"child-viewer-ctn",style:{background:r},onClick:()=>{a(void 0)},onContextMenu:g=>{g.preventDefault(),a(void 0)},children:o})})]})}const os=o=>o,us=os(e.jsx(Re.StrictMode,{children:e.jsx(ns,{})}));export{us as AdminView};
