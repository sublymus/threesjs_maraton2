import{j as e,H as S,b as K,u as re,a as ie,g as $e,l as ee,t as je,c as ge,C as G,L as ss}from"./BindToParentScroll-BX2qpY_H.js";import{u as I,a as p,b as U,G as N,F as se,c as _e,d as Ne,e as oe,S as de,I as R,C as Be,f as Ce,A as Se,O as ze,U as Pe,g as Ye,h as ts,i as Ge}from"./ChoiseRole-CyWO6s92.js";import{c as te,r as h,R as as}from"./index-B6goMmbw.js";import{E as pe}from"./EditorTopBar-ZVnAvUwz.js";import{t as De,e as Ze}from"./emoji-BxGWBwFy.js";function Fe({blur:c,className:s}){const{pathList:i,setAbsPath:t}=I(),{user:a,store:r,disconnection:n}=p(),{T:l,setT:o}=U(),d=i[1]||"products";return e.jsxs("div",{className:"nav-bar "+(s||"min")+" "+(a?c?"blur":"":"blur"),children:[e.jsxs("div",{className:"nav-logo",children:[e.jsx("div",{className:"logo",style:{backgroundImage:`url(${`${S}${r==null?void 0:r.banners[0]}`})`}}),e.jsx("div",{className:"label",children:r==null?void 0:r.name})]}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+l,onClick:()=>{o(l?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]}),e.jsx("div",{className:"nav-link",children:e.jsxs("ul",{children:[e.jsxs("li",{className:d=="products"||d=="features"||d=="categories"||d=="catalogs"?"active":"no",onClick:()=>{t(["products"])},children:[e.jsx("span",{className:"product"}),e.jsx("label",{children:"STORE"})]}),e.jsxs("li",{className:d=="clients"||d=="collaborators"||d=="roles"?"active":"no",onClick:()=>{t(["clients"])},children:[e.jsx("span",{className:"users"}),e.jsx("label",{children:"USERS"})]}),e.jsxs("li",{className:d=="chat"?"active":"no",onClick:()=>{t(["chat"])},children:[e.jsx("span",{className:"chat"}),e.jsx("label",{children:"CHAT"})]}),e.jsxs("li",{className:d=="interface"?"active":"no",onClick:()=>{t(["interface"])},children:[e.jsx("span",{className:"interface"}),e.jsx("label",{children:"INTERFACE"})]}),e.jsxs("li",{className:d=="statistic"?"active":"no",onClick:()=>{t(["statistic"])},children:[e.jsx("span",{className:"state"}),e.jsx("label",{children:"STATISTIC"})]})]})}),e.jsxs("div",{className:"nav-profile",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${a!=null&&a.photos[0].startsWith("/")?S:""}${a==null?void 0:a.photos[0]})`}}),e.jsx("div",{className:"name",children:a==null?void 0:a.name}),e.jsx("div",{className:"logout",onClick:()=>{n()},children:"logout"})]}),e.jsx("div",{className:"logut-icon",onClick:()=>{n()}})]})}const ce=te(c=>({products:void 0,selectedProduct:void 0,async fectProductCommands({limit:s,page:i,status:t,no_status:a,user_id:r,product_id:n}){const l=p.getState().getHeaders();if(!l)return;const o={};o.user_id=!0,o.store_id=l.store.id,o.product_id=n||"",o.limit=s||25,o.page=i||1,o.user_id=r||"",o.status=t||"",o.no_status=a||"";const d=new URLSearchParams({});for(const f in o){const $=o[f];d.set(f,$)}const m=await(await fetch(`${S}/get_commands/?${d.toString()}`,{headers:l.headers})).json();if(!(!m||!m.list))return m},async setProductById(s){const i=ce.getState().products,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedProduct:t}));else if(p.getState().store){const r=await ce.getState().fetchProducts({query:{product_id:s}});c(()=>({selectedProduct:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ce.getState().fetchProducts({query:{product_id:s}});c(()=>({selectedProduct:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeProduct(s){const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${S}/delete_product/${s}`,{method:"DELETE",headers:i.headers})).json();return U.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createProduct(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0,s.is_dynamic_price=s.is_dynamic_price||!0;const t=new FormData,a=[];if(["images","model_images"].forEach(r=>{const n=s[r];if(n&&Object.keys(n).length>0){const l=[];Object.keys(n).sort((o,d)=>{var u,m;return(((u=n[o])==null?void 0:u.index)||0)-(((m=n[d])==null?void 0:m.index)||0)}).forEach(o=>{l.push(o),n[o].isLocal&&t.append(o,n[o].file)}),t.append(r,JSON.stringify(l))}else return a.push(r+" is not defined")}),["title","description","stock","category_id","index","price","is_dynamic_price"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),a.length==0){const n=await(await fetch(`${S}/create_product`,{method:"POST",body:t,headers:i.headers})).json();if(!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedProduct:n})),U.getState().fetchStoreVar()}else return a},async updateProduct(s){if(!s.product_id)return console.log("Product_id required");const i=p.getState().getHeaders();if(!i)return;const t=new FormData;let a=!1;["images","model_images"].forEach(n=>{const l=s[n];if(l&&Object.keys(l)){a=!0;const o=[];Object.keys(l).sort((d,u)=>{var m,f;return(((m=l[d])==null?void 0:m.index)||0)-(((f=l[u])==null?void 0:f.index)||0)}).forEach(d=>{o.push(d),l[d].isLocal&&t.append(d,l[d].file)}),t.append(n,JSON.stringify(o))}}),t.append("product_id",s.product_id),["title","description","stock","category_id","status","index","price","is_dynamic_price"].forEach(n=>{s[n]&&(t.append(n,s[n]),a=!0)});let r=null;if(a&&(r=await fetch(`${S}/update_product`,{method:"PUT",body:t,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("product_id",s.product_id),r=await fetch(`${S}/update_view_product`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),console.log("newProduct",r),c(()=>({selectedProduct:r})))},async fetchProducts(s){const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),s!=null&&s.query.price&&(t.price_min=s.query.price[0]),s!=null&&s.query.price&&(t.price_max=s.query.price[1]),s!=null&&s.query.stock&&(t.stock_min=s.query.stock[0]),s!=null&&s.query.stock&&(t.stock_max=s.query.stock[1]),s!=null&&s.query.product_id&&(t.product_id=s.query.product_id),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({products:n})),n},async setSelectedProduct(s){c(()=>({selectedProduct:s}))}}));function is(){const{current:c,setAbsPath:s,qs:i}=I(),{store:t}=p(),{fetchProducts:a,products:r,setSelectedProduct:n}=ce();return h.useEffect(()=>{c("products")&&t&&a()},[t]),c("products")&&e.jsx("div",{className:"product-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:r==null?void 0:r.limit,page:r==null?void 0:r.page,total:r==null?void 0:r.total,filter:{price:se([0,1e5],[0,1e4]),stock:se([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"product_list",datas:(r==null?void 0:r.list)||[],itemsMapper:{images:{getView(l,o,d,u){return N.ImageElement().getView(l,`${S}${o[0]}`,d,u)}},id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},title:N.StringElement({size_interval:[50,200]}),status:de,stock:N.StringElement(),category_id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},price:N.StringElement({size:200}),created_at:N.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),n(l[0]),i({product_id:l[0].id}).setAbsPath(["products","dash_product"])},onQuery:l=>{a(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["products","new_product"])}})})})}function Ve({placeholder:c,value:s,isCheckRequired:i,label:t,max:a,min:r,check:n,openEditor:l,prompt:o,editable:d,onChange:u}){const[m,f]=h.useState(s||""),[$,A]=h.useState(0),[y,_]=h.useState(""),[b,g]=h.useState(l||!1),[w,q]=h.useState(0),[x,P]=h.useState(0),B=h.useRef(null),L=h.useRef(null),D=h.useRef(null),[k]=h.useState({validation:E=>(console.log(E,r&&E.length<r,E.length,r),_(""),E=E.toString().trim(),r&&E.length<r?(_(`Minimum length ${r}`),!1):a&&E.length>a?(_(`Maximum length ${a}`),!1):(u==null||u(E),!0))});h.useEffect(()=>{i&&k.validation(m)},[i]);const j=()=>{if(B.current){const z=`${-10-B.current.getBoundingClientRect().height}px`;B.current.style.top=z}if(L.current){const z=`${-10-L.current.getBoundingClientRect().height}px`;L.current.style.top=z}};return e.jsxs("div",{className:"textarea-text textarea",children:[e.jsx("div",{className:"textarea-top",children:e.jsxs("div",{className:"left-side",children:[e.jsxs("div",{className:"label",children:[t," "]}),o&&e.jsx("div",{className:"textarea-info",onMouseEnter:E=>{if(E.target.className!=="textarea-info")return L.current.style.display="none";clearTimeout(w),L.current&&(L.current.style.display="block"),j()},onMouseLeave:()=>{q(setTimeout(()=>{L.current&&(L.current.style.display="none")},300))},children:e.jsx("div",{className:"promt",ref:L,children:o})}),d&&e.jsx("div",{className:"edit",style:{background:`no-repeat center/80% url(${b?"/src/res/x.png":"/src/res/pencil.png"})`},onClick:()=>{const E=!b;g(E==!1?!k.validation(m):!0),E&&setTimeout(()=>{var z;(z=D.current)==null||z.focus()}),j()},onMouseEnter:E=>{if(E.target.className!=="edit")return L.current.style.display="none";clearTimeout(x),B.current&&(B.current.style.display="block"),j()},onMouseLeave:()=>{P(setTimeout(()=>{B.current&&(B.current.style.display="none")},300))},children:e.jsx("div",{className:"promt",ref:E=>{B.current=E,j()},children:b?"Close editor":"click here to edit value"})})]})}),!b&&e.jsx("div",{className:"value",children:m}),b&&e.jsxs("div",{className:"textarea-editor",children:[e.jsx("textarea",{ref:D,spellCheck:"false",rows:5,placeholder:c,value:m,onChange:E=>{let z=E.currentTarget.value;for(;z.includes("  ");)z=z.replace("  "," ");z.length>(a||Number.MAX_VALUE)||(f(z),_(""),A(z.length))},onBlur:()=>{n=="auto"&&k.validation(m)&&setTimeout(()=>{g(!1)},0)}}),e.jsxs("div",{className:"count",children:[" ",e.jsx("div",{className:"message",children:y}),a&&`${$}/${a}`]})]})]})}function He({direction:c="",onClick:s}){return e.jsxs("div",{className:"preview-3d-model-card "+c,onClick:s,children:[e.jsx("div",{className:"image "+c,style:{backgroundImage:"url(/src/res/ert.avif)"}}),e.jsxs("div",{className:"text-side",children:[e.jsx("div",{className:"top",children:"PREVIEW 3D MODEL"}),e.jsxs("div",{className:"features",children:[3," FEATURE","S"]}),e.jsx("div",{className:"prompt",children:"Loader File is missing"})]})]})}function ns({}){return e.jsxs("div",{className:"statistic-card",children:[e.jsxs("div",{className:"text",children:[e.jsx("h1",{className:"title",children:"Product Statistic"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"title",children:[2e4.toLocaleString(),"  ₽ "]}),e.jsxs("h2",{className:"description",children:["since ",new Date(Date.now()-1e3*60*60*24*30).toDateString()]})]})]}),e.jsx(os,{})]})}const We={with:250,height:120,bars:[{value:80},{value:15},{value:25},{value:10},{value:15},{value:25},{value:15},{value:25},{value:90},{value:25},{value:30},{value:25},{value:30},{value:50},{value:100},{value:90},{value:80},{value:70},{value:60},{value:60},{value:70},{value:80}]};function os(){return e.jsx("div",{className:"bar-chart",children:e.jsx("div",{className:"bars",children:We.bars.map((c,s)=>e.jsx("div",{className:"bar",children:e.jsx("div",{className:"level",style:{height:`${c.value/100*We.height}px`,background:`linear-gradient(rgb(0, 90, 180),rgb(23, 108, 194)${((c.value<35?35:c.value)-25)*.7}% , rgb(75, 165, 255)100%)`}})},s))})})}let rs=0;function Ue({onChange:c,icon:s,ext:i,label:t,file_name:a}){const[r]=h.useState((Math.random()+rs++).toString()),[n,l]=h.useState(a||"");return e.jsxs("div",{className:"loader-img",children:[e.jsx("input",{type:"file",style:{display:"none"},accept:"application/zip",name:"img",id:r,onChange:o=>{var $;const d=($=o.target.files)==null?void 0:$[0];if(!d)return;const u=d.name.toLowerCase(),m=u.lastIndexOf("."),f=u.substring(m+1,u.length);if(i&&!i.includes(f))return console.log({_ext:f,ext:i,n:u});l(d.name),c(d)}}),e.jsxs("label",{htmlFor:r,className:"loader-img-ctn",children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon",style:{background:s?`no-repeat center/50% url(${s})`:""}})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:t??"Upload file"}),e.jsx("div",{className:"prompt",children:n&&(n.length>25?n.substring(0,10)+"..."+n.substring(n.length-10,n.length):n)||"Add new File"})]}),e.jsx("div",{className:"load-icon"})]})]})}const he=te(c=>({categories:void 0,selectedCategory:void 0,categoryProducts:void 0,async setCategoryById(s){const i=he.getState().categories,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCategory:t}));else if(p.getState().store){const r=await he.getState().fetchCategories({query:{user_id:s}});c(()=>({selectedCategory:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await he.getState().fetchCategories({query:{user_id:s}});c(()=>({selectedCategory:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCategory(s){if(!s)return;const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${S}/delete_category/${s}`,{method:"DELETE",headers:i.headers})).json();return U.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createCategory(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0;const t=new FormData,a=[];if(["label","description","catalog_id","index"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),a.length==0){const n=await(await fetch(`${S}/create_category`,{method:"POST",body:t,headers:i.headers})).json();if(console.log(n),!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedCategory:n})),U.getState().fetchStoreVar()}else return a},async fetchCategoryProducts(s){if(!(s!=null&&s.category_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.category_id=s==null?void 0:s.category_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({categoryProducts:n}))}catch(t){return console.warn(t.message)}},setSelectedCategory(s){c(()=>({selectedCategory:s}))},async updateCategory(s){const i=p.getState().getHeaders();if(!i)return;const t=new FormData;let a=!1;t.append("category_id",s.category_id),["label","index","status","catalog_id","description"].forEach(n=>{s[n]&&(t.append(n,s[n]),a=!0)});let r=null;if(a&&(r=await fetch(`${S}/update_category`,{method:"PUT",body:t,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("category_id",s.category_id),r=await fetch(`${S}/update_view_category`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),c(()=>({selectedCategory:r})))},async fetchCategories(s){const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_categories/?${a.toString()}`,{headers:i.headers})).json();return!n||!n.list?void 0:(c(()=>({categories:n})),n)}catch(t){console.warn(t.message);return}}}));function cs({onChange:c,category_id:s}){const{fetchCategories:i,categories:t}=he(),[a,r]=h.useState(),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(t==null?void 0:t.list.find(o=>o.id==s))},[t]),e.jsxs("div",{className:"choise-category",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Category"}),e.jsx("div",{className:"name",children:(a==null?void 0:a.label)||"select category"})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-category "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+((a==null?void 0:a.id)==o.id?"selected":""),onClick:()=>{r(o),c==null||c(o.id)},children:[e.jsx("div",{className:"label",children:o.label}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}const ve=te(c=>({features:void 0,selectedFeature:void 0,productsUseFeature:void 0,async setFeatureById(s){var t,a;const i=ve.getState().selectedFeature||((t=ve.getState().features)==null?void 0:t.list.find(r=>r.id==s));if(i)c(()=>({selectedFeature:i}));else{const r=(a=await ve.getState().fetchFeatures({feature_id:s},!0))==null?void 0:a.list[0];c(()=>({selectedFeature:r}))}},async removeFeature(s){const t=await(await fetch(`${S}/delete_feature/${s}`,{method:"DELETE"})).json();return console.log({json:t}),t==null?void 0:t.isDeleted},async fetchProductsUseFeature(s){c(()=>({productsUseFeature:ce.getState().products}))},setSelectedFeature(s){c(()=>({selectedFeature:s}))},async createFeature(s){U.getState().fetchStoreVar()},async updateFeature(s){},async fetchFeatures(s,i){var l,o,d;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=(o=s.query)==null?void 0:o.text),s!=null&&s.feature_id&&(t.feature_id=s.feature_id),t.store_id=(d=p.getState().store)==null?void 0:d.id;const a=new URLSearchParams({});for(const u in t){const m=t[u];a.set(u,m)}const n=await(await fetch(`${S}/get_features/?${a.toString()}`)).json();if(!(!n||!n.list))return i||c(()=>({features:n})),console.log(n),n}}));function ls({onChange:c,features:s}){const{fetchFeatures:i,features:t}=ve(),[a,r]=h.useState(s),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(s==null?void 0:s.filter(o=>t==null?void 0:t.list.find(d=>d.id==o.id)))},[t]),e.jsxs("div",{className:"choise-features",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Features"}),e.jsxs("div",{className:"name",children:[(a==null?void 0:a.length)||0," Selected"]})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-features "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+(a!=null&&a.find(d=>d.id==o.id)?"selected":""),onClick:()=>{const d=a!=null&&a.find(u=>u.id==o.id)?a.filter(u=>u.id!==o.id):[...a||[],o];r(d),c==null||c(d.map(u=>u.id))},children:[e.jsx("div",{className:"label",children:o.name}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}function ds(){var q;const{current:c,setAbsPath:s,json:i}=I(),{selectedProduct:t,setSelectedProduct:a,updateProduct:r,createProduct:n,removeProduct:l,setProductById:o,fectProductCommands:d}=ce(),[u]=h.useState(!1),[m,f]=h.useState([]),[$,A]=h.useState("");h.useEffect(()=>{},[$]),h.useEffect(()=>{i!=null&&i.product_id&&o(i==null?void 0:i.product_id)},[i]),h.useEffect(()=>{t&&d({limit:10,product_id:t.id}).then(x=>f((x==null?void 0:x.list)||[]))},[t]);const _=re().width<1e3?"wrap":"",[b]=h.useState({}),g=c("dash_product"),w=c("new_product");return(g||w)&&(!t&&g?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"product-dash",ref:K,children:[e.jsxs("div",{className:"error-panel "+($?"open":""),children:[e.jsxs("div",{className:"type",children:["ERROR ",e.jsx("span",{onClick:()=>{A("")}})]}),e.jsx("div",{className:"message",children:$})]}),e.jsx(pe,{terme:"white",deteleKey:(t==null?void 0:t.id)||"noga",mode:w?"create":"delete",title:"Product Information",onCreate:()=>{n(b).then(x=>{if(!x)return s(["products","dash_product"]);x.length&&A(x==null?void 0:x.toString())})},onDelete:()=>{t&&l(t.id).then(x=>{x&&a(void 0)})}}),e.jsxs("section",{className:"editor "+_,children:[e.jsxs("div",{className:"editor-left",children:[e.jsxs("div",{className:"editor-name",children:[g&&e.jsx(R,{isCheckRequired:u,label:"Product Id",value:(t==null?void 0:t.id)||""}),e.jsx("div",{className:"product-title",children:e.jsx(R,{editable:!0,prompt:"Product Title",isCheckRequired:u,min:3,check:"auto",max:50,label:"Title",placeholder:"Product Title",value:g&&((t==null?void 0:t.title)||""),onChange:x=>{g?t&&r({product_id:t.id,title:x}):b.title=x}})}),e.jsx("div",{className:"product-description",children:e.jsx(Ve,{editable:!0,prompt:"Product Description",isCheckRequired:u,min:3,check:"auto",max:250,label:"Description",placeholder:"Product Description",value:g&&((t==null?void 0:t.description)||""),onChange:x=>{g?t&&r({product_id:t.id,description:x}):b.description=x}})})]}),e.jsx("div",{className:"editor-price",children:e.jsx(R,{type:"number",editable:!0,prompt:"Product Price",isCheckRequired:u,min:0,check:"auto",label:"Price",placeholder:"Product Price",value:g&&((t==null?void 0:t.price)||""),onChange:x=>{g?t&&r({product_id:t.id,price:x}):b.price=x}})}),e.jsx("div",{className:"editor-stock",children:e.jsx(R,{type:"number",editable:!0,prompt:"Product Stock",isCheckRequired:u,max:1e10,check:"auto",label:"Stock",placeholder:"Product Stock",value:g&&((t==null?void 0:t.stock)||""),onChange:x=>{g?t&&r({product_id:t.id,stock:x}):b.stock=x}})}),g&&e.jsx(Be,{status:(t==null?void 0:t.status)||"PAUSE",onChange:x=>{g?t&&r({product_id:t.id,status:x}):b.status=x}}),e.jsx("div",{className:"editor-category",children:e.jsx(cs,{category_id:g&&(t==null?void 0:t.category_id),onChange:x=>{g?t&&r({product_id:t.id,category_id:x}):b.category_id=x}})}),e.jsx("div",{className:"editor-features",children:e.jsx(ls,{features:g&&((q=t==null?void 0:t.features)==null?void 0:q.list),onChange:x=>{b.features=x,console.log(b)}})})]}),e.jsxs("div",{className:"editor-right",children:[e.jsx("div",{className:"editor-images",children:e.jsx(Ce,{name:"images",images:g&&(t!=null&&t.images?t.images:[]),autosave:w,onSave:x=>{g?t&&r({product_id:t.id,images:x}):b.images=x}})}),e.jsx("div",{className:"editor-mmodel-images",children:e.jsx(Ce,{name:"model_images",images:g&&(t!=null&&t.images?t.model_images:[]),autosave:w,onSave:x=>{g?t&&r({product_id:t.id,model_images:x}):b.model_images=x}})}),g&&e.jsx("div",{className:"editor-scene-file",children:e.jsx(Ue,{file_name:t==null?void 0:t.scene_dir,ext:["zip"],label:"Upload Scene File",onChange:x=>{g?t&&r({product_id:t.id,scene_dir:x}):b.scene_dir=x}})})]})]}),g&&e.jsxs("div",{className:"product-dash-ctn",children:[e.jsxs("div",{className:"info",children:[e.jsx(Se,{}),e.jsx(ns,{})]}),e.jsx(He,{onClick:()=>{console.log("oo"),s(["products","dash_product","product_preview"])}})]}),g&&e.jsxs("div",{className:"orders",children:[e.jsxs("div",{className:"top",children:[e.jsx("h1",{className:"orders-title",children:"Recent Orders"}),e.jsx("h2",{className:"see-all",children:"SEE ALL"})]}),e.jsx("div",{className:"orders-ctn",children:m.map(x=>e.jsxs("div",{className:"order",children:[e.jsxs("div",{className:"id",children:["#",x.id.split("-")[0]]}),e.jsx("div",{className:"id",children:x.quantity}),e.jsx("div",{className:"date",children:x.updated_at.split("")}),e.jsxs("div",{className:"price",children:[x.price," ","$"]}),e.jsx("div",{className:"status "+x.status.toLocaleLowerCase(),children:x.status})]},x.id))})]})]}))}function us(){const{current:c}=I();return c("product_preview")&&e.jsx("div",{className:"product-preview"})}function hs(){return null}const ms=[{label:"products",value:"23",url:"/src/res/package.png",path:["products"]},{label:"categories",value:"15",url:"/src/res/application.png",path:["categories"]},{label:"catalogs",value:"4",url:"/src/res/catalog.png",path:["catalogs"]},{label:"features",value:"78",url:"/src/res/jigsaw.png",path:["features"]}];function Re({active:c,setActive:s}){const{storeVar:i}=U();return e.jsx("div",{className:"products-list-accessor",children:ms.map((t,a)=>e.jsxs("div",{className:"top-card "+(t.label==c?"active":""),onClick:()=>{s(t)},children:[e.jsx("h2",{className:"label",children:t.label.toUpperCase()}),e.jsx("h2",{className:"value",children:i==null?void 0:i[t.label]}),e.jsx("h2",{className:"icon",style:{backgroundImage:`url(${t.url})`}})]},a))})}function gs(){const{check:c,setAbsPath:s,current:i}=I();return e.jsx(e.Fragment,{children:c("products")&&e.jsxs("div",{className:"page-product",children:[i("products","dash_product","new_product")&&e.jsx(Re,{active:"products",setActive:t=>s(t.path)}),e.jsx(ds,{}),e.jsx(is,{}),e.jsx(us,{}),e.jsx(hs,{})]})})}const ue=te(c=>({clients:void 0,selectedClient:void 0,clientCommands:void 0,clientVisites:void 0,async setClientById(s){const i=ue.getState().clients,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedClient:t}));else if(p.getState().store){const r=await ue.getState().fetchClients({query:{user_id:s}});c(()=>({selectedClient:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ue.getState().fetchClients({query:{user_id:s}});c(()=>({selectedClient:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async fetchClientCommands(s){if(!(s!=null&&s.user_id))return;const i=await ce.getState().fectProductCommands({...s});if(console.log(i),!(i!=null&&i.list))return c(()=>({clientCommands:void 0}));c(()=>({clientCommands:i}))},async fetchClientVisites({after_date:s,before_date:i,client_id:t,product_id:a,limit:r,page:n}){const l=p.getState().getHeaders();if(!l)return;const o={};o.store_id=l.store.id,o.product_id=a||"",o.client_id=t||"",o.limit=r||25,o.page=n||1,o.after_date=s||"",o.before_date=i||"",o.from_dash=!0;const d=new URLSearchParams({});for(const f in o){const $=o[f];d.set(f,$)}const m=await(await fetch(`${S}/get_client_visited/?${d.toString()}`,{headers:l.headers})).json();!m||!m.list||c(()=>({clientVisites:m}))},async setSelectedClient(s){c(()=>({selectedClient:s}))},async fetchClients(s){const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),s!=null&&s.query.text&&(t.text=s.query.text),s!=null&&s.query.user_id&&(t.user_id=s.query.user_id),s!=null&&s.query.phone&&(t.phone=s.query.phone),t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_store_clients/?${a.toString()}`,{headers:i.headers})).json();if(console.log("clients",n),!(!n||!n.list))return c(()=>({clients:n})),n},async banClient(){}}));function ps(){const{current:c,qs:s}=I(),{clients:i,setSelectedClient:t,fetchClients:a}=ue(),{store:r}=p();return h.useEffect(()=>{c("clients")&&r&&a()},[r]),c("clients")&&e.jsx("div",{className:"client-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:se([0,1e5],[0,1e4]),stock:se([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"client_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(n,l,o,d){return N.ImageElement().getView(n,`${l[0].startsWith("/")?S:""}${l[0]}`,o,d)}},id:{getView(n,l,o,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},o.id)}},name:N.StringElement({size_interval:[50,200]}),status:{getView(n,l,o,d){return de.getView(n,"VISIBLE",o,d)}},created_at:N.DateStringElement({size:200})},onItemsSelected:(n,l)=>{l.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="")}),n.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="#00f2")}),t(n[0]),s({client_id:n[0].id}).setAbsPath(["clients","client_profile"])},onQuery:n=>{a(n)},top_height:40,canPaginate:!0})})})}function xs(){const{current:c,setAbsPath:s,json:i,qs:t}=I(),{selectedClient:a,setClientById:r,clientCommands:n,fetchClientVisites:l,fetchClientCommands:o,clientVisites:d}=ue(),[u,m]=h.useState("commands"),[f]=h.useState(!1),A=re().width<1e3?"wrap":"";return h.useEffect(()=>{i!=null&&i.client_id&&r(i==null?void 0:i.client_id)},[i]),h.useEffect(()=>{a&&o({limit:5,user_id:a.id}),a&&l({limit:5,client_id:a.id})},[a]),c("client_profile")&&(a?e.jsxs("div",{className:"client-profile",ref:K,children:[e.jsx("h1",{children:"Client Information"}),e.jsxs("section",{className:"editor "+A,children:[e.jsx("div",{className:"left-right",children:e.jsx(Ce,{name:"client_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(R,{isCheckRequired:f,label:"Client Id",value:(a==null?void 0:a.id)||""}),e.jsx(R,{prompt:"Client Name",isCheckRequired:f,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(R,{prompt:"Client Email",isCheckRequired:f,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(R,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(R,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(ze,{user:a,channel:"sessions"})]})]}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{className:"btn "+(u=="commands"?"active":""),onClick:()=>{m("commands")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Commands"})]}),e.jsxs("div",{className:"btn "+(u=="visites"?"active":""),onClick:()=>{m("visites")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Visites"})]})]}),e.jsx("h2",{className:"see-all",onClick:()=>{u=="visites"?s(["products"]):s(["command"])},children:"SEE ALL"})]}),u=="commands"&&e.jsx(N,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(n==null?void 0:n.list)||[],itemsMapper:{images:{getView(y,_,b,g){return N.ImageElement().getView(y,`${S}${_[0]}`,b,g)}},id:{getView(y,_,b,g){return e.jsxs("div",{ref:g,children:["#",_.split("-")[0]]},b.id)}},stock:N.StringElement(),price:N.StringElement({size:200}),status:de,created_at:N.DateStringElement({size:200})},onItemsSelected:()=>{}}),u=="visites"&&e.jsx(N,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(d==null?void 0:d.list)||[],itemsMapper:{images:{getView(y,_,b,g){return N.ImageElement().getView(y,`${S}${_[0]}`,b,g)}},id:{getView(y,_,b,g){return e.jsxs("div",{ref:g,children:["#",_.split("-")[0]]},b.id)}},title:N.StringElement({size:200}),visited_at:N.DateStringElement({size:200})},onItemsSelected:y=>{t({product_id:y[0].id}).setAbsPath(["products","dash_product"])}})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function vs(){const{check:c,current:s,setAbsPath:i}=I();return c("clients")&&e.jsxs("div",{className:"client-page",children:[s("clients","client_profile")&&e.jsx(Pe,{active:"clients",setActive:t=>i(t.path)}),e.jsx(ps,{}),e.jsx(xs,{})]})}const Ae="new_discussion";let ye;const Ee=[],F=te(c=>({discussion:void 0,discussions:void 0,messages:void 0,setDiscussion(s){c(()=>({discussion:s}))},async setDiscussionByOtherId({other_id:s,for_moderator:i,findOther:t}){var d,u,m;const a=p.getState().getHeaders();if(!a)return;const r=(d=F.getState().discussions)==null?void 0:d.list,n=r==null?void 0:r.find(f=>f.other.id==s&&(i?!ie(a.store.id,f):!!ie(a.store.id,f)));if(n){if(((u=F.getState().messages)==null?void 0:u.list[0].table_id)==n.id)return;const f=await Z.getState().fetchMessages(n.id,"discussions");c(()=>({discussion:n,messages:f}));return}const l=(m=await F.getState().fetchDiscussions({no_save:!0,other_id:s,for_moderator:i}))==null?void 0:m.list[0];if(console.log("exist Discussion",l,i),l){const f=await Z.getState().fetchMessages(l.id,"discussions");c(()=>({discussion:l,messages:f}));return}const o=await t(s,!!i);o&&F.getState().addDiscussion({other:o,for_moderator:i})},async openDiscussionMessages(s){const i=await Z.getState().fetchMessages(s,"discussions");c(()=>({messages:i}))},async unBlockDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/unblock_discussion/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();return console.log("unblock_discussion ",a),a!=null&&a.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(n=>n.id==a.id?{...n,...a}:n)}})),a):void 0}catch(a){console.log(a)}},async blockDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/block_discussion/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();return console.log("unblock_discussion ",a),a!=null&&a.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(n=>n.id==a.id?{...n,...a}:n)}})),a):void 0}catch(a){console.log(a)}},async deleteDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/delete_discussion/${s.id}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("deleteDiscussion ",a),a!=null&&a.deleted?(c(({discussions:r,messages:n,discussion:l})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).filter(o=>o.id!==s.id)},messages:(l==null?void 0:l.id)==s.id?void 0:n})),!0):void 0}catch(a){console.log(a)}},async createDiscussion({other_id:s,for_moderator:i}){const t=p.getState().getHeaders();if(!t)return;const a=new FormData;a.append("receiver_id",s),a.append("from_id",t.store.id),!i&&a.append("to_id",t.store.id);const r=await fetch(`${S}/create_discussion`,{headers:t.headers,body:a,method:"POST"});try{const n=await r.json();return console.log("createDiscussion",n),n!=null&&n.id?n:void 0}catch(n){console.log(n)}},async addDiscussion({other:s,for_moderator:i}){var o,d;const t=p.getState().getHeaders();if(!t||s.id==t.user.id)return;const a=(o=F.getState().discussions)==null?void 0:o.list,r=a==null?void 0:a.find(u=>u.other.id==s.id&&(i?!ie(t.store.id,u):!!ie(t.store.id,u)));if(console.log("addDiscussion",{exist:r}),r){const u=await Z.getState().fetchMessages(r.id,"discussions");return c(()=>({discussion:r,messages:u})),r}const n=(d=F.getState().discussions)==null?void 0:d.list.filter(u=>u.id.startsWith(Ae)?(u.receiver_id==s.id||u.creator_id==s.id)&&(i?!ie(void 0,u):!!ie(void 0,u)):!1);if(n!=null&&n[0]){console.log("@@@@@@@@@@@@@@@@@@@@@@@"),c(({discussions:u})=>({discussions:u&&{...u}}));return}const l={id:Ae+Date.now(),creator_id:t.user.id,receiver_id:s.id,deleted:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s,from_id:t.store.id,to_id:i?void 0:t.store.id,last_message:void 0,other_att:"creator"};return c(({discussions:u})=>({messages:{list:[],limit:25,page:1,total:0},discussion:l,discussions:u&&{...u,list:[l,...u.list]}})),console.log("NEW DISCUSSION",l),l},async fetchDiscussions({discussion_id:s,no_save:i,other_id:t}){const a=p.getState().getHeaders();if(!a)return;const r=new URLSearchParams({});r.set("from_id",a.store.id),s&&r.set("discussion_id",s),t&&r.set("other_id",t);const l=await(await fetch(`${S}/get_discussions?${r}`,{headers:a.headers})).json();if(console.log("fetch Discussions",l),!l)return;ye=c,l.list.forEach(async d=>{Ke(d)});const o=`${a.user.id}/${a.store.id}`;if(!Ee.includes(o)){Ee.push(o);const d=De.subscription(o);await d.create(),d.onMessage(async u=>{var m;if(u.new_discussion){console.log("new_discussion ==>  ",u.new_discussion),Ke(u.new_discussion);const f=u.new_discussion,$=f.receiver.id!=a.user.id?"receiver":"creator";f.other_att=$,f.other=f[$];const A=(m=F.getState().discussions)==null?void 0:m.list.filter(y=>y.id.startsWith(Ae)?!(y.other.id==f.other.id&&(y.from_id||null)==(f.from_id||null)&&(y.to_id||null)==(f.to_id||null)):!0);c(({discussions:y})=>({discussions:y&&{...y,list:[f,...A||[]]}}))}u.reload_discussion&&(console.log("reload_discussion ==>  "),F.getState().fetchDiscussions({}))})}return i||c(({discussions:d})=>({discussions:{...l,list:[...((d==null?void 0:d.list)||[]).filter(u=>u.id.startsWith("new_")),...l.list]}})),l}}));async function Ke(c){if(!p.getState().getHeaders()||Ee.includes(c.id))return;Ee.push(c.id);const i=De.subscription(c.id);await i.create(),i.onMessage(async t=>{var r,n;if(!ye)return;const a=F.getState().discussion;if(t.reload){const l=(r=F.getState().discussions)==null?void 0:r.list,o=(n=await F.getState().fetchDiscussions({discussion_id:c.id,no_save:!0}))==null?void 0:n.list;if(console.log("reload Discussion ___________ ",o==null?void 0:o.length),!(o!=null&&o[0].id))return;const d=[...(l==null?void 0:l.map(u=>u.id==c.id?o==null?void 0:o[0]:u))||[]];ye(({discussions:u})=>({discussions:u&&{...u,list:d}})),(a==null?void 0:a.id)==(o==null?void 0:o[0].id)&&ye(()=>({discussion:{...o==null?void 0:o[0]}}))}if(t.reloadMessage&&(a==null?void 0:a.id)==c.id){console.log("reload Message___________",a);const l=await Z.getState().fetchMessages(c.id,"discussions");ye(()=>({messages:l,discussion:{...c}}))}})}const fs="new_discussion",js="new_session",Z=te(c=>({async fetchEditMessage(s){const i=p.getState().getHeaders();if(!i)return;const t=new FormData;t.append("message_id",s.message_id),t.append("text",s.text);const a=await fetch(`${S}/edit_message`,{method:"PUT",headers:i.headers,body:t});try{const r=await a.json();return console.log("edit_message ",r),r!=null&&r.id?r:void 0}catch(r){console.log(r)}},async fetchDeleteMessageBoth(s){const i=p.getState().getHeaders();if(!i)return;console.log("$$$$$$$$");const t=await fetch(`${S}/delete_message/${s}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("fetchDeleteMessageBoth",a),a==null?void 0:a.deleted}catch(a){console.log(a)}},async fetchDeleteMessageMe(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/delete_message/${s}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("fetchDeleteMessageMe",a),a==null?void 0:a.deleted}catch(a){console.log(a)}},async fetchSendMessage({context:s,context_name:i,files:t,text:a}){if(!s||!s.id)return;if(s.id.startsWith(fs)){const o=await F.getState().createDiscussion({other_id:s.other.id,for_moderator:s.to_id==null});if(console.log("D"),!o||!o.id)return;s=o,F.getState().setDiscussion(o)}else if(s.id.startsWith(js)){const o=await J.getState().fetchCreateSession(s.other.id,a||"");if(console.log("S",o),!o)return;s=o,J.getState().setSession(o)}const r=p.getState().getHeaders();if(!r)return;const n=new FormData;if(!a&&!t)return;if(t)for(let o=0;o<t.length;o++){const d=t[o];n.append("files_"+o,d)}if(n.append("context_id",s.id),n.append("context_name",i),a&&n.append("text",a),t)for(let o=0;o<t.length;++o){const d=t[o];n.append("files_"+o,d)}const l=await fetch(`${S}/send_message`,{headers:r.headers,body:n,method:"POST"});try{const o=await l.json();return console.log("fetchSendMessage",o),o!=null&&o.id?o:void 0}catch(o){console.log(o)}},async fetchMessages(s,i){if(s.toLowerCase().startsWith("new_"))return;const t=p.getState().getHeaders();if(!t)return;const a=await fetch(`${S}/get_messages/?context_id=${s}&context_name=${i}`,{headers:t.headers});try{const r=await a.json();return r!=null&&r.list?r:void 0}catch{}}})),_s="new_session";let we;const ke=[],J=te(c=>({session:void 0,sessions:void 0,messages:void 0,setSession(s){c(()=>({session:s}))},async setSessionByClientId(s){setTimeout(async()=>{var a,r;const i=J.getState().sessions,t=i==null?void 0:i.find(n=>n.other.id==s);if(console.log("current Session",s,t),t){const n=await Z.getState().fetchMessages(t.id,"sessions");c(()=>({session:t,messages:n}))}else{const n=p.getState().getHeaders();if(!n)return;const o=(await(await fetch(`${S}/get_sessions?collaborator_id=${s}&store_id=${n.store.id}`,{headers:n.headers})).json())[0];if(console.log("exist Session",o),o){const d=await Z.getState().fetchMessages(o.id,"sessions");c(()=>({session:o,messages:d}))}else{const d=((a=ue.getState().clients)==null?void 0:a.list.find(u=>u.id==s))||((r=await ue.getState().fetchClients({query:{user_id:s}}))==null?void 0:r.list[0]);console.log("collabo",d),d&&J.getState().addSession(d)}}})},async openSessionMessages(s){const i=await Z.getState().fetchMessages(s,"sessions");c(()=>({messages:i}))},async openSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/open_session/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();if(console.log("open_session ",a),!(a!=null&&a.id))return}catch(a){console.log(a)}},async closeSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/close_session/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();if(console.log("close_session ",a),!(a!=null&&a.id))return}catch(a){console.log(a)}},async asReadSession(s){},async deleteSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${S}/delete_session/${s.id}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();if(console.log("deleteSession",a),!a.deleted)return;c(()=>({session:void 0})),J.getState().fetchSessions()}catch(a){console.log(a)}},async fetchCreateSession(s,i){if(!i)return;const t=p.getState().getHeaders();if(!t)return;const a=new FormData;a.append("receiver_id",s),a.append("store_id",t.store.id),a.append("title",i);const r=await fetch(`${S}/create_session`,{headers:t.headers,body:a,method:"POST"});try{const n=await r.json();return console.log("fetchCreateSession",n),n!=null&&n.id?(J.getState().fetchSessions(),c(()=>({session:n})),n):void 0}catch(n){console.log(n)}},async addSession(s){var r;const i=(r=J.getState().sessions)==null?void 0:r.find(n=>n.other.id==s.id);if(i){c(()=>({session:i}));const n=await Z.getState().fetchMessages(i.id,"sessions");return c(()=>({messages:n}))}const t=p.getState().user;if(!t)return;const a={id:_s+Date.now(),creator_id:t.id,title:"",receiver_id:s.id,deleted:"",other_att:"creator",closed:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s};c(({sessions:n})=>({messages:{list:[],limit:25,page:1,total:0},session:a,sessions:[...n||[],a]}))},async fetchSessions(s="all"){const i=p.getState().getHeaders();if(!i)return;console.log(i.store.id);const a=await(await fetch(`${S}/get_sessions?store_id=${i.store.id}&open=${s}`,{headers:i.headers})).json();if(console.log("session",a),!!Array.isArray(a)&&(we=c,a.forEach(async r=>{Qe(r)}),c(()=>({sessions:a})),!ke.includes(i.user.id))){ke.push(i.user.id);const r=De.subscription(i.user.id);await r.create(),r.onMessage(async n=>{var l;if(n.new_session){Qe(n.new_session);const o=n.new_session,d=o.receiver.id!=i.user.id?"receiver":"creator";o.other_att=d,o.other=o[d];const u=(l=J.getState().sessions)==null?void 0:l.filter(m=>m.id!=(o==null?void 0:o.id));c(()=>({sessions:[...u||[],o]}))}n.reload_session&&J.getState().fetchSessions()})}}}));async function Qe(c){const s=p.getState().getHeaders();if(!s||ke.includes(c.id))return;ke.push(c.id);const i=De.subscription(c.id);await i.create(),i.onMessage(async t=>{if(!we)return;console.log("data_session",t);const a=J.getState().session;if(t.reload){const r=J.getState().sessions,l=await(await fetch(`${S}/get_sessions?session_id=${c.id}&store_id=${s.store.id}&blocked=all`,{headers:s.headers})).json();if(console.log("reload Session ___________ ",l.length),!(l!=null&&l[0]))return;const o=[...(r==null?void 0:r.map(d=>d.id==c.id?l==null?void 0:l[0]:d))||[]];we(()=>({sessions:o})),(a==null?void 0:a.id)==(l==null?void 0:l[0].id)&&we(()=>({session:{...l==null?void 0:l[0]}}))}if(t.reloadMessage&&(a==null?void 0:a.id)==c.id){console.log("reload Message___________",a);const r=await Z.getState().fetchMessages(c.id,"sessions");we(()=>({messages:r,session:{...c}}))}})}function Ns({}){var D;const{openChild:c}=U(),{json:s,qs:i,check:t,pathList:a,setAbsPath:r}=I(),n=(D=a[3])==null?void 0:D.split("_")[1],[l,o]=h.useState(n||"opened"),{addSession:d,asReadSession:u,closeSession:m,openSession:f,deleteSession:$,fetchSessions:A,session:y,sessions:_,setSessionByClientId:b}=J(),{user:g,store:w}=p(),{fetchClients:q}=ue();if(h.useEffect(()=>{t("chat")&&!_&&w&&A()},[w]),h.useEffect(()=>{s!=null&&s.client_id&&b(s==null?void 0:s.client_id)},[s]),h.useEffect(()=>{o(n||"opened")},[a]),h.useEffect(()=>{var k;(k=y==null?void 0:y.closed)!=null&&k.includes((g==null?void 0:g.id)||"")&&o("closed")},[y]),!g)return;const x=_==null?void 0:_.filter(k=>{var j;return!((j=k.closed)!=null&&j.includes(g.id))}),P=_==null?void 0:_.filter(k=>{var j;return(j=k.closed)==null?void 0:j.includes(g.id)}),B=_==null?void 0:_.filter(k=>k.unchecked_count>0);let L=[];return l=="opened"?L=x:l=="closed"?L=P:L=B,e.jsxs("div",{className:"session-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Sessions "}),e.jsxs("div",{className:"add-new",onClick:()=>{c(e.jsx(Ye,{user:g,openChild:c,fetchUsers:q,setUser:k=>{d(k)}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{r(["chat","sessions","sessions_opened"])},children:e.jsxs("div",{className:l=="opened"?"active":"",children:["Open",((x==null?void 0:x.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{r(["chat","sessions","sessions_closed"])},children:e.jsxs("div",{className:l=="closed"?"active":"",children:["Closed ",((P==null?void 0:P.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{r(["chat","sessions","sessions_new"])},children:e.jsxs("div",{className:l=="new"?"active":"",children:["New  ",((B==null?void 0:B.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"sessions",children:L==null?void 0:L.map(k=>{var E,z;let j="";return((E=k.last_message)==null?void 0:E.user_id)==g.id&&(k[`${k.other_att}_opened_at`]?new Date(k[`${k.other_att}_opened_at`])<new Date(((z=k.last_message)==null?void 0:z.created_at)||"")?j="one":j="double":j="one"),e.jsxs("div",{className:"session "+((y==null?void 0:y.id)==k.id?"active":""),onClick:H=>{console.log(k.other,g),i({client_id:k.other.id,nav:document.querySelector(".back-close.nav").getBoundingClientRect().width==0?void 0:"min"}).setAbsPath(["chat","sessions"]);const C=H.currentTarget.querySelector(".count");C.style.display="none"},onContextMenu:H=>{H.preventDefault(),c(e.jsx(Ss,{closed:!!(P!=null&&P.includes(k)),x:H.clientX,y:H.clientY,onClose:C=>{C?(m(k),o("closed")):(f(k),o("opened"))},onAsRead:()=>{u(k)},onDelete:()=>{$(k)}}))},children:[e.jsx("div",{className:"photo",style:{background:$e(k.other.photos[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:ee(k.other.name,16)}),e.jsx("div",{className:"date",children:k.last_message&&je(k.last_message.created_at)})]}),e.jsx("i",{className:"center-ctn",children:ee(k.title,20)}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+j}),e.jsx("div",{className:"text",children:k.last_message?ee(k.last_message.text,24):"New Session"}),e.jsx("div",{className:"count",style:{display:(y==null?void 0:y.id)==k.id?"none":k.unchecked_count>0?"flex":"none"},children:k.unchecked_count})]})]})]},k.id)})})]})}function Ss({x:c,y:s,onClose:i,onAsRead:t,onDelete:a,closed:r}){const n=h.useRef(null);return h.useEffect(()=>{n.current&&ge(n.current)}),e.jsxs("div",{ref:n,className:"discussion-popu",style:{top:`${s}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>i(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Open":"Close"})]}),e.jsxs("div",{className:"delete",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}const le=te(c=>({collaborators:void 0,selectedCollaborator:void 0,async updateCollaborator(s){},async change_collaborator_role(s){var r;const i=p.getState().getHeaders();if(!i)return;s.store_id=(r=p.getState().store)==null?void 0:r.id;const t=new FormData,a=[];["store_id","new_role_id","collaborator_id"].forEach(n=>{if(s[n]!=null)t.append(n,s[n]||"");else return a.push(n+" is not defined")});{const l=await(await fetch(`${S}/change_collaborator_role`,{method:"PUT",body:t,headers:i.headers})).json();if(!l||!l.id)return a.push("Server Error, Try Later"),a}},async addCollaborator(s){console.log(s);const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;s.store_id=i.id;const a=new FormData,r=[];["store_id","role_id","email"].forEach(l=>{if(s[l]!=null)a.append(l,s[l]);else return r.push(l+" is not defined")});const n=new Headers;n.append("Authorization",`Bearer ${t.token}`);{const o=await(await fetch(`${S}/add_collaborator`,{method:"POST",body:a,headers:n})).json();if(!o||!o.id)return r.push("Server Error, Try Later"),r;c(()=>({selectedCollaborator:o})),U.getState().fetchUsersVar(),I.getState().setAbsPath(["collaborators","collaborator_profile"])}},async setSelectedCollaborator(s){c(()=>({selectedCollaborator:s}))},async setCollaboratorById(s){const i=le.getState().collaborators,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCollaborator:t}));else if(p.getState().store){const r=await le.getState().fetchCollaborators({query:{user_id:s}});c(()=>({selectedCollaborator:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await le.getState().fetchCollaborators({query:{user_id:s}});c(()=>({selectedCollaborator:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCollaborator(s){let i=p.getState().getHeaders();if(!i)return;const t=new FormData;t.append("store_id",i.store.id),t.append("collaborator_id",s);const a={method:"DELETE",headers:i.headers,body:t},n=await(await fetch(`${S}/remove_collaborator`,a)).json();U.getState().fetchUsersVar(),n.deleted&&c(()=>({selectedCollaborator:void 0}))},async fetchCollaborators(s){var l,o,d,u,m,f,$;let i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=(o=s.query)==null?void 0:o.text),(d=s==null?void 0:s.query)!=null&&d.user_id&&(t.user_id=(u=s.query)==null?void 0:u.user_id),(m=s==null?void 0:s.query)!=null&&m.phone&&(t.phone=(f=s.query)==null?void 0:f.phone),t.store_id=($=i.store)==null?void 0:$.id;const a=new URLSearchParams({});for(const A in t){const y=t[A];a.set(A,y)}const n=await(await fetch(`${S}/get_store_collaborators/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({collaborators:n})),n},async banCollaborator(s){}})),me=te(c=>({moderators:void 0,selectedModerator:void 0,moderatorCommands:void 0,moderatorVisites:void 0,async setModeratorById(s){const i=me.getState().moderators,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedModerator:t}));else{const a=await me.getState().fetchModerators({query:{user_id:s}});c(()=>({selectedModerator:a==null?void 0:a.list.find(r=>r.id==s)}))}},async setSelectedModerator(s){c(()=>({selectedModerator:s}))},async fetchModerators(s){var l,o,d;const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=s.query.text),(o=s==null?void 0:s.query)!=null&&o.user_id&&(t.user_id=s.query.user_id),(d=s==null?void 0:s.query)!=null&&d.phone&&(t.phone=s.query.phone),t.store_id=i.store.id;const a=new URLSearchParams({});for(const u in t){const m=t[u];a.set(u,m)}const n=await(await fetch(`${S}/get_moderators/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({moderators:n})),n},async banModerator(){}}));function Ie(){var k;const{discussion:c,discussions:s,fetchDiscussions:i,addDiscussion:t,blockDiscussion:a,deleteDiscussion:r,unBlockDiscussion:n,setDiscussionByOtherId:l}=F(),{check:o,json:d,pathList:u,qs:m,setAbsPath:f}=I(),$=(k=u[3])==null?void 0:k.split("_")[1],[A,y]=h.useState($||"all"),{openChild:_}=U(),{user:b,store:g}=p(),{fetchCollaborators:w}=le(),{fetchModerators:q}=me();if(h.useEffect(()=>{(d!=null&&d.collaborator_id||d!=null&&d.moderator_id)&&l({other_id:(d==null?void 0:d.collaborator_id)||(d==null?void 0:d.moderator_id),for_moderator:!!(d!=null&&d.moderator_id),async findOther(j,E){var z,H,C,T;return E?((z=me.getState().moderators)==null?void 0:z.list.find(V=>V.id==j))||((H=await me.getState().fetchModerators({query:{user_id:j}}))==null?void 0:H.list[0]):((C=le.getState().collaborators)==null?void 0:C.list.find(V=>V.id==j))||((T=await le.getState().fetchCollaborators({query:{user_id:j}}))==null?void 0:T.list[0])}}),o("chat")&&!s&&g&&i({}),y($||"all")},[d,g]),h.useEffect(()=>{y($||"all")},[u]),!b)return;const x=s==null?void 0:s.list.filter(j=>{var E;return!((E=j.blocked)!=null&&E.includes(b.id))&&!!ie((g==null?void 0:g.id)||"",j)}),P=s==null?void 0:s.list.filter(j=>{var E;return(E=j.blocked)==null?void 0:E.includes(b.id)}),B=s==null?void 0:s.list.filter(j=>{var E;return j.unchecked_count>0&&!((E=j.blocked)!=null&&E.includes(b.id))}),L=s==null?void 0:s.list.filter(j=>!ie((g==null?void 0:g.id)||"",j));let D=[];return A=="admin"?D=L:A=="new"?D=B:A=="blocked"?D=P:D=x,e.jsxs("div",{className:"discussion-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Chats "}),e.jsxs("div",{className:"add-new",onClick:()=>{_(e.jsx(Ye,{fetchUsers:w,openChild:_,user:b,setUser:(j,E)=>{console.log({discMode:E}),t({other:j,for_moderator:E=="moderators"}),E=="moderators"&&f(["chat","discussions","discussions_admin"])},selector:{list:[{name:"collaborators",fetch:w},{name:"moderators",fetch:q}]}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_all"])},children:e.jsxs("div",{className:A=="all"?"active":"",children:["All",((x==null?void 0:x.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_new"])},children:e.jsxs("div",{className:A=="new"?"active":"",children:["New ",((B==null?void 0:B.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_blocked"])},children:e.jsxs("div",{className:A=="blocked"?"active":"",children:["Blocked  ",((P==null?void 0:P.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_admin"])},children:e.jsxs("div",{className:A=="admin"?"active":"",children:["Admin  ",((L==null?void 0:L.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"discussions",children:D==null?void 0:D.map(j=>{var z;let E="";return((z=j.last_message)==null?void 0:z.user_id)==b.id&&(j[`${j.other_att}_opened_at`]?new Date(j[`${j.other_att}_opened_at`])<new Date(j.last_message.created_at)?E="one":E="double":E="one"),e.jsxs("div",{className:"discussion "+((c==null?void 0:c.id)==j.id?"active":""),onClick:H=>{j.unchecked_count=0,g&&m({[ie(g.id,j)?"collaborator_id":"moderator_id"]:j.other.id,nav:document.querySelector(".back-close.nav").getBoundingClientRect().width==0?void 0:"min"}).setAbsPath(["chat","discussions","discussions_"+(A||"_all")]);const C=H.currentTarget.querySelector(".count");C.style.display="none"},onContextMenu:H=>{H.preventDefault(),_(e.jsx(bs,{canBlock:!!ie(g==null?void 0:g.id,j),blocked:!!(P!=null&&P.includes(j)),x:H.clientX,y:H.clientY,onBlock:C=>{C?(a(j),m(d||{}).setAbsPath(["chat","discussions","discussions_blocked"])):(n(j),m(d||{}).setAbsPath(["chat","discussions","discussions_all"]))},onAsRead:()=>{},onDelete:()=>{r(j)}}))},children:[e.jsx("div",{className:"photo",style:{background:$e(j.other.photos[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:ee(j.other.name,16)}),e.jsx("div",{className:"date",children:j.last_message&&je(j.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+E}),e.jsx("div",{className:"text",children:j.last_message?ee(j.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(c==null?void 0:c.id)==j.id?"none":j.unchecked_count>0?"flex":"none"},children:j.unchecked_count})]})]})]},j.id)})})]})}function bs({x:c,y:s,onBlock:i,onAsRead:t,onDelete:a,blocked:r,canBlock:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&ge(l.current)}),e.jsxs("div",{ref:l,className:"discussion-popu",style:{top:`${s}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),n&&e.jsxs("div",{className:"block",onClick:()=>i(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function Me(){var H;const{discussion:c,messages:s}=F(),{fetchSendMessage:i,fetchDeleteMessageBoth:t,fetchDeleteMessageMe:a,fetchEditMessage:r}=Z(),{user:n}=p(),{openChild:l}=U(),{qs:o,json:d,navBack:u}=I(),[m,f]=h.useState(!1),[$,A]=h.useState(1),[y,_]=h.useState(!1),b=h.useRef(null),g=h.useRef(null),[w,q]=h.useState(null),[x]=h.useState(Date.now()+""),[P,B]=h.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),L=re(),D=()=>{if(!g.current)return;const C=g.current,T=Math.ceil(C.scrollHeight/(C.getBoundingClientRect().height||20)),V=Math.ceil(C.scrollHeight/20),Q=C.value.split(`
`).length;let X=Math.max(T,Q,V);X=X>10?10:X-1>=1?X-1:1,A(X)};h.useEffect(()=>{D()},[L]),h.useEffect(()=>{window.addEventListener("click",()=>{y&&_(!1)})},[]);const k=c==null?void 0:c.other.photos[0],j=(C,T)=>C.list[T].user_id==(n==null?void 0:n.id)?"right":"left",E=(C,T)=>C.list[T-1]&&C.list[T-1].user_id==(n==null?void 0:n.id)?"right":"left",z=(C,T)=>C.list[T+1]&&(C.list[T+1].user_id==(n==null?void 0:n.id)?"right":"left");return e.jsxs("div",{className:"discussion-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"open-nonav",onClick:()=>{u()}}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${k!=null&&k.startsWith("/")?S:""}${k})`},onClick:()=>{d!=null&&d.moderator_id?o({moderator_id:c.other.id}).setAbsPath(["moderators","moderator_profile"]):o({collaborator_id:c.other.id}).setAbsPath(["collaborators","collaborator_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:ee(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",je(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:G()})})]})]}),!c&&e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})}),c&&n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"messages",ref:C=>{b.current=C,m||(b.current&&b.current.scrollTo({top:b.current.scrollHeight}),f(!0))},onScroll:C=>{const T=C.currentTarget;clearInterval(P.lastid);const V=setTimeout(()=>{const Q={isOpen:!1,height:T.scrollHeight,bottom:T.scrollHeight-(T.scrollTop+T.getBoundingClientRect().height),top:T.scrollTop,onProcess:!1,lastid:V};Q.bottom>150&&(Q.isOpen=!0),B(Q),console.log(V)},100);P.lastid=V},children:(H=s==null?void 0:s.list)==null?void 0:H.map((C,T)=>{var be;const V=j(s,T),Q=E(s,T),X=z(s,T);let xe="";return V==Q?X&&Q==X&&(xe="mid"):X&&V==X&&(xe="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+V+" "+xe,onContextMenu:v=>{v.preventDefault(),l(e.jsx(ys,{forMe:n.id==C.user_id,x:v.clientX,y:v.clientY,onDeleteBoth:()=>{t(C.id)},onDeleteMe:()=>{a(C.id)},onEdit:()=>{l(e.jsx(ws,{x:v.clientX,y:v.clientY,text:C.text,onEdit:M=>{l(void 0),r({message_id:C.id,text:M})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:C.text&&C.text.split(" ").map((v,M)=>v.includes(`
`)?v.split(`
`).map((W,Y)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:W}),e.jsx("br",{})]},M+"_"+Y)):e.jsx("span",{style:{marginRight:"4px"},children:v},M))}),e.jsx("div",{className:"files",children:(be=C.files)==null?void 0:be.map(v=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${v.startsWith("/")?S:""}${v}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:v.length>35?ee(v,25)+v.substring(v.length-8,v.length):v})]},v))}),e.jsxs("div",{className:"info",children:[C.created_at!=C.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:je(C.created_at)})]})]})},C.id)})}),e.jsxs("div",{className:"sender",children:[P.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{b.current&&b.current.scrollTo({behavior:"smooth",top:P.height})}}),y&&e.jsx("div",{className:"emoji-list",onClick:C=>{C.preventDefault(),C.stopPropagation()},children:Ze.map(C=>e.jsx("span",{onClick:T=>{T.preventDefault(),T.stopPropagation(),g.current&&(g.current.value+=C.char)},children:C.char},C.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:x+"message_file",onChange:C=>{if(!C.currentTarget.files)return;const T=[];for(let V=0;V<C.currentTarget.files.length;V++){const Q=C.currentTarget.files[V];T.push(Q)}q(T.length>0?w?[...w,...T]:T:null)}}),e.jsx("label",{htmlFor:x+"message_file",className:"add-file",onClick:G()}),e.jsx("div",{className:"emoji-min",onClick:C=>{C.preventDefault(),C.stopPropagation(),G()(C),_(!y)}})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",children:w&&w.map(C=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{w&&q(w.filter(T=>T!==C))}}),e.jsx("div",{className:"text",children:C.name})]},C.name))}),e.jsx("textarea",{autoFocus:!0,ref:g,name:"discussion_sender",placeholder:"Type a message here..",id:"discussion_sender",style:{height:`${$*20}px`},cols:30,rows:10,onChange:C=>{D()},onKeyDown:()=>{_(!1)}})]}),e.jsx("div",{className:"right",children:e.jsx("div",{className:"send",onClick:C=>{var T;G()(C),i({context:c,context_name:"discussions",files:w,text:(T=g.current)==null?void 0:T.value}),q(null),g.current&&(g.current.value="")},children:e.jsx("div",{className:"icon"})})})]})]})]})]})}function ys({x:c,y:s,onEdit:i,onDeleteBoth:t,onDeleteMe:a,other:r,forMe:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&ge(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${c}px`},children:[n&&e.jsxs("div",{className:"edit",onClick:o=>{o.preventDefault(),o.stopPropagation(),i()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),n&&e.jsxs("div",{className:"delete-both",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function ws({x:c,y:s,onEdit:i,text:t}){const a=h.useRef(null),[r,n]=h.useState(t);return h.useEffect(()=>{a.current&&ge(a.current)}),e.jsxs("div",{ref:a,className:"message-edit-popu",style:{top:`${s}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{n(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{i(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}const Le=250,qe=c=>c.split(" ").map((s,i)=>s.includes(`
`)?s.split(`
`).map((t,a)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:t}),e.jsx("br",{})]},i+"_"+a)):e.jsx("span",{style:{marginRight:"4px"},children:s},i));function Cs(){var V,Q,X,xe,be;const{session:c,messages:s,fetchCreateSession:i}=J(),{fetchSendMessage:t,fetchDeleteMessageBoth:a,fetchDeleteMessageMe:r,fetchEditMessage:n}=Z(),{user:l}=p(),{openChild:o}=U(),{qs:d,navBack:u}=I(),[m,f]=h.useState(!1),[$,A]=h.useState(1),[y,_]=h.useState(!1),b=h.useRef(null),g=h.useRef(null),[w,q]=h.useState(""),[x,P]=h.useState(null),[B]=h.useState(Date.now()+""),[L,D]=h.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),k=re(),j=()=>{if(!g.current)return;const v=g.current,M=Math.ceil(v.scrollHeight/(v.getBoundingClientRect().height||20)),W=Math.ceil(v.scrollHeight/20),Y=v.value.split(`
`).length;let ae=Math.max(M,Y,W);ae=ae>10?10:ae-1>=1?ae-1:1,A(ae)};h.useEffect(()=>{j()},[k]),h.useEffect(()=>{window.addEventListener("click",()=>{_(!1)})},[]);const E=c==null?void 0:c.other.photos[0],z=(v,M)=>v.list[M].user_id==(l==null?void 0:l.id)?"right":"left",H=(v,M)=>v.list[M-1]&&v.list[M-1].user_id==(l==null?void 0:l.id)?"right":"left",C=(v,M)=>v.list[M+1]&&(v.list[M+1].user_id==(l==null?void 0:l.id)?"right":"left"),T=!(c!=null&&c.title);return e.jsxs("div",{className:"session-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"open-nonav",onClick:()=>{u()}}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${E!=null&&E.startsWith("/")?S:""}${E})`},onClick:()=>{d({client_id:c.other.id}).setAbsPath(["clients","client_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:ee(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",je(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:G()})})]})]}),!c&&e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})}),c&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-title",onClick:v=>{o(e.jsx(ks,{x:v.clientX,y:v.clientY,text:c.title}))},children:[e.jsx("div",{className:"ctn-title",children:e.jsx("div",{className:"text-title",children:ee(c.title,50)})}),e.jsxs("div",{className:"option",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${l.photos[0].startsWith("/")?S:""}${l.photos[0]})`}}),e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${c.other.photos[0].startsWith("/")?S:""}${c.other.photos[0]})`}}),e.jsx("div",{className:"status",onClick:G(),children:(V=c.closed)!=null&&V.includes(l.id)&&((Q=c.closed)!=null&&Q.includes(c.other.id))||(X=c.closed)!=null&&X.includes(l.id)?"Closed":((xe=c.closed)!=null&&xe.includes(c.other.id),"Open")})]})]}),T&&e.jsx("div",{className:"title",children:e.jsxs("div",{className:"ctn",children:[e.jsx("h1",{className:"label",children:"New Session Title"}),e.jsx("div",{className:"text",children:qe(w)})]})}),e.jsx("div",{className:"messages",style:{display:T?"none":""},ref:v=>{b.current=v,m||(b.current&&b.current.scrollTo({top:b.current.scrollHeight}),f(!0))},onScroll:v=>{const M=v.currentTarget;clearInterval(L.lastid);const W=setTimeout(()=>{const Y={isOpen:!1,height:M.scrollHeight,bottom:M.scrollHeight-(M.scrollTop+M.getBoundingClientRect().height),top:M.scrollTop,onProcess:!1,lastid:W};Y.bottom>150&&(Y.isOpen=!0),D(Y)},100);L.lastid=W},children:(be=s==null?void 0:s.list)==null?void 0:be.map((v,M)=>{var Oe;const W=z(s,M),Y=H(s,M),ae=C(s,M);let Te="";return W==Y?ae&&Y==ae&&(Te="mid"):ae&&W==ae&&(Te="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+W+" "+Te,onContextMenu:O=>{O.preventDefault(),o(e.jsx(Es,{forMe:l.id==v.user_id,x:O.clientX,y:O.clientY,onDeleteBoth:()=>{a(v.id)},onDeleteMe:()=>{r(v.id)},onEdit:()=>{o(e.jsx($s,{x:O.clientX,y:O.clientY,text:v.text,onEdit:es=>{o(void 0),n({message_id:v.id,text:es})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:v.text&&qe(v.text)}),e.jsx("div",{className:"files",children:(Oe=v.files)==null?void 0:Oe.map(O=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${O.startsWith("/")?S:""}${O}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:O.length>35?ee(O,25)+O.substring(O.length-8,O.length):O})]},O))}),e.jsxs("div",{className:"info",children:[v.created_at!=v.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:je(v.created_at)})]})]})},v.id)})}),e.jsxs("div",{className:"sender",children:[L.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{b.current&&b.current.scrollTo({behavior:"smooth",top:L.height})}}),y&&e.jsx("div",{className:"emoji-list",onClick:v=>{v.preventDefault(),v.stopPropagation()},children:Ze.map(v=>e.jsx("span",{onClick:M=>{M.preventDefault(),M.stopPropagation(),q(w+v.char)},children:v.char},v.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[!T&&e.jsxs(e.Fragment,{children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:B+"message_file",onChange:v=>{if(!v.currentTarget.files)return;const M=[];for(let W=0;W<v.currentTarget.files.length;W++){const Y=v.currentTarget.files[W];M.push(Y)}P(M.length>0?x?[...x,...M]:M:null)}}),e.jsx("label",{htmlFor:B+"message_file",className:"add-file",onClick:G()})]})," ",T&&e.jsxs("div",{className:"text-length",children:[w.length,T?"/"+Le:""]})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",style:{display:T?"none":""},children:x&&x.map(v=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{x&&P(x.filter(M=>M!==v))}}),e.jsx("div",{className:"text",children:v.name})]},v.name))}),e.jsx("textarea",{autoFocus:!0,ref:g,value:w,name:"session_sender",placeholder:"Type a message here..",id:"session_sender",style:{height:`${$*20}px`},cols:30,rows:10,onChange:v=>{j(),q(T&&v.currentTarget.value.length>Le?v.currentTarget.value.substring(0,Le):v.currentTarget.value)},onKeyDown:()=>{_(!1)}})]}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"emoji",onClick:v=>{v.preventDefault(),v.stopPropagation(),G()(v),_(!y)}}),e.jsx("div",{className:"send",onClick:v=>{G()(v),T?i(c.other.id,w):t({context:c,context_name:"sessions",files:x,text:w}),P(null),q("")},children:e.jsx("div",{className:"icon"})})]})]})]})]})]})}function Es({x:c,y:s,onEdit:i,onDeleteBoth:t,onDeleteMe:a,other:r,forMe:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&ge(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${c}px`},children:[n&&e.jsxs("div",{className:"edit",onClick:o=>{o.preventDefault(),o.stopPropagation(),i()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),n&&e.jsxs("div",{className:"delete-both",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function ks({x:c,y:s,text:i}){const t=h.useRef(null);return h.useEffect(()=>{t.current&&ge(t.current)}),e.jsx("p",{ref:t,className:"title-popup",style:{top:`${s}px`,left:`${c}px`},children:qe(i||"")})}function $s({x:c,y:s,onEdit:i,text:t}){const a=h.useRef(null),[r,n]=h.useState(t);return h.useEffect(()=>{a.current&&ge(a.current)}),e.jsxs("div",{ref:a,className:"message-edit-popu",style:{top:`${s}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{n(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{i(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}function Ps(){const{check:c,qs:s,pathList:i,json:t}=I(),{user:a}=p(),r={discussions:e.jsx(Ie,{}),groups:e.jsx(Ie,{}),sessions:e.jsx(Ns,{}),surveys:e.jsx(Ie,{})},n={discussions:e.jsx(Me,{}),groups:e.jsx(Me,{}),sessions:e.jsx(Cs,{}),surveys:e.jsx(Me,{})},l=(i==null?void 0:i[2])||"discussions",o=(t==null?void 0:t.nav)||"max";return c("chat")&&a&&e.jsxs("div",{className:"page-chat",children:[e.jsx("div",{className:"back-close nav",style:{display:o=="min"?"none":""},onClick:d=>{d.currentTarget==d.target&&s({...t,nav:"min"}).apply()}}),e.jsxs("div",{className:"chat-nav "+o,children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"nav-size "+o,onClick:d=>{G(.4)(d),s({...t,nav:o=="min"?"max":"min"}).apply()}}),e.jsx("div",{className:"icon discussions-icon "+(l=="discussions"?"active":""),onClick:d=>{G(.4)(d),s({nav:o}).setAbsPath(["chat","discussions"])}}),e.jsx("div",{className:"icon sessions "+(l=="sessions"?"active":""),onClick:d=>{G(.4)(d),s({nav:o}).setAbsPath(["chat","sessions"])}}),e.jsx("div",{className:"icon profile",style:{background:`no-repeat center/cover url(${a.photos[0].startsWith("/")?S:""}${a.photos[0]})`},onClick:()=>{s({nav:o}).setAbsPath(["profile"])}})]}),o=="max"&&e.jsx("div",{className:"nav-ctn",children:r[l]})]}),e.jsx("div",{className:"chat-center",children:n[l]})]})}function Ds(){return e.jsx("div",{className:"page-interface"})}function Rs(){const{current:c,setAbsPath:s,qs:i}=I(),{fetchCategories:t,categories:a,setSelectedCategory:r}=he(),{store:n}=p();return h.useEffect(()=>{c("categories")&&n&&t()},[n]),c("categories")&&e.jsx("div",{className:"category-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","label","description","catalog_id","index","status","created_at","total_products"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{index:Ne([0,100]),status:_e(["PAUSE","TRASH","NEW"],[]),total_products:se([0,1e3],[0,1e3])}},items_height:80,id:"category_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},label:N.StringElement({size_interval:[50,200]}),status:de,total_products:{getView(l,o,d,u){return N.StringElement().getView(l,o||0,d,u)}},catalog_id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},created_at:N.DateStringElement({size:500})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),r(l[0]),i({category_id:l[0].id}).setAbsPath(["categories","dash_categories"])},onQuery:l=>{t(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["categories","new_category"])}})})})}const fe=te(c=>({catalogs:void 0,selectedCatalog:void 0,catalogProducts:void 0,catalogCategories:void 0,async setCatalogById(s){const i=fe.getState().catalogs,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCatalog:t}));else if(p.getState().store){const r=await fe.getState().fetchCatalogs({query:{user_id:s}});c(()=>({selectedCatalog:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await fe.getState().fetchCatalogs({query:{user_id:s}});c(()=>({selectedCatalog:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCatalog(s){const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${S}/delete_catalog/${s}`,{method:"DELETE",headers:i.headers})).json();return U.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createCatalog(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0,s.store_id=i.store.id;const t=new FormData,a=[];if(["label","description","store_id","index"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),console.log(a,s),a.length==0){const n=await(await fetch(`${S}/create_catalog`,{method:"POST",body:t,headers:i.headers})).json();if(!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedCatalog:n})),U.getState().fetchStoreVar()}else return a},async fetchCatalogCategories(s){if(!(s!=null&&s.catalog_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.catalog_id=s.catalog_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_categories/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({catalogCategories:n}))}catch(t){return console.warn(t.message)}},async fetchCatalogProducts(s){if(!(s!=null&&s.catalog_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.catalog_id=s.catalog_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({catalogProducts:n}))}catch(t){return console.warn(t.message)}},async updateCatalog(s){if(!s.catalog_id)return;const i=p.getState().getHeaders();if(!i)return;let t=!1;const a=new FormData;a.append("catalog_id",s.catalog_id),["label","index","status","description"].forEach(n=>{s[n]&&(a.append(n,s[n]),t=!0)});let r=null;if(t&&(r=await fetch(`${S}/update_catalog`,{method:"PUT",body:a,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("catalog_id",s.catalog_id),r=await fetch(`${S}/update_view_catalog`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),c(()=>({catalogProducts:r})))},setSelectedCatalog(s){c(()=>({selectedCatalog:s}))},async fetchCatalogs(s){const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${S}/get_catalogs/?${a.toString()}`,{headers:i.headers})).json();return!n||!n.list?void 0:(c(()=>({catalogs:n})),n)}catch(t){console.warn(t.message);return}}}));function Ts({onChange:c,catalog_id:s}){const{fetchCatalogs:i,catalogs:t}=fe(),[a,r]=h.useState(),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(t==null?void 0:t.list.find(o=>o.id==s))},[t]),e.jsxs("div",{className:"choise-catalog",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Catalog"}),e.jsx("div",{className:"name",children:(a==null?void 0:a.label)||"Select Catalog"})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-catalog "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+((a==null?void 0:a.id)==o.id?"selected":""),onClick:()=>{r(o),c==null||c(o.id)},children:[e.jsx("div",{className:"label",children:o.label}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}function As(){const{current:c,setAbsPath:s,json:i}=I(),{selectedCategory:t,setSelectedCategory:a,setCategoryById:r,fetchCategoryProducts:n,categoryProducts:l,updateCategory:o,createCategory:d,removeCategory:u}=he(),[m]=h.useState({}),{setSelectedProduct:f}=ce(),[$]=h.useState(!1),y=re().width<1e3?"wrap":"";h.useEffect(()=>{t&&n({category_id:t.id})},[t]),h.useEffect(()=>{i!=null&&i.category_id&&r(i==null?void 0:i.category_id)},[i]);const _=c("dash_categories"),b=c("new_category"),g=e.jsxs(e.Fragment,{children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{status:(t==null?void 0:t.status)||"PAUSE",onChange:w=>{_?t&&o({category_id:t.id,status:w}):m.status=w}}),e.jsx("div",{className:"editor-scene-file",children:e.jsx(Ue,{file_name:t==null?void 0:t.scene_dir,ext:["zip"],label:"Upload Scene File",onChange:w=>{_?t&&o({category_id:t.id,scene_dir:w}):m.scene_dir=w}})})]}),e.jsx("div",{className:"editor-category",children:e.jsx(Ts,{catalog_id:_&&(t==null?void 0:t.catalog_id),onChange:w=>{_?t&&o({category_id:t.id,catalog_id:w}):m.catalog_id=w}})})]});return(_||b)&&(!t&&_?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"category-dash",ref:K,children:[e.jsx(pe,{terme:"white",deteleKey:(t==null?void 0:t.id)||"noga",mode:b?"create":"delete",title:"Category Information",onCreate:()=>{d(m).then(w=>{if(!w)return s(["categories","dash_categories"])})},onDelete:()=>{u(t==null?void 0:t.id).then(w=>{w&&a(void 0)})}}),e.jsxs("section",{className:"editor "+y,children:[e.jsxs("div",{className:"left-side",children:[_&&e.jsx(R,{isCheckRequired:$,label:"Category Id",value:(t==null?void 0:t.id)||""}),e.jsx("div",{className:"category-title",children:e.jsx(R,{editable:!0,prompt:"Category Label",isCheckRequired:$,min:3,check:"auto",max:50,label:"Label",placeholder:"Catalog Label",value:_&&((t==null?void 0:t.label)||""),onChange:w=>{_?o({category_id:t==null?void 0:t.id,label:w}):m.label=w}})}),e.jsx("div",{className:"category-description",children:e.jsx(Ve,{editable:!0,prompt:"Category Description",isCheckRequired:$,min:3,check:"auto",max:250,label:"Description",placeholder:"Catalog Description",value:_&&((t==null?void 0:t.description)||""),onChange:w=>{_?o({category_id:t==null?void 0:t.id,description:w}):m.description=w}})}),_&&g]}),e.jsxs("div",{className:"right-side",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(He,{onClick:()=>{},direction:"horizontal"})]}),b&&g]})]}),_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{className:"",children:"Products That Use This Category"}),e.jsx("h2",{className:"see-all",onClick:()=>{s(["products"])},children:"SEE ALL"})]}),e.jsx(N,{filter:{sortBy:"id",limit:(l==null?void 0:l.limit)||25,page:l==null?void 0:l.page,total:l==null?void 0:l.total},disableFilterBar:!0,items_height:80,id:"product-use-cattegory_list",datas:(l==null?void 0:l.list)||[],itemsMapper:{images:{getView(w,q,x,P){return N.ImageElement().getView(w,`${S}${q[0]}`,x,P)}},id:{getView(w,q,x,P){return e.jsxs("div",{ref:P,children:["#",q.split("-")[0]]},x.id)}},title:N.StringElement({size_interval:[50,200]}),status:N.StringElement({size:150}),stock:N.StringElement(),category_id:{getView(w,q,x,P){return e.jsxs("div",{ref:P,children:["#",q.split("-")[0]]},x.id)}},price:N.StringElement({size:200}),created_at:N.DateStringElement({size:200})},onItemsSelected:w=>{f(w[0]),s(["products","dash_product"])}})]})]}))}function Is(){const{check:c,setAbsPath:s,current:i}=I();return c("categories")&&e.jsxs("div",{className:"page-categories",children:[(i("categories")||i("new_category")||i("dash_categories"))&&e.jsx(Re,{active:"categories",setActive:t=>s(t.path)}),e.jsx(Rs,{}),e.jsx(As,{})]})}function Ms(){const{current:c,setAbsPath:s,qs:i}=I(),{store:t}=p(),{features:a,fetchFeatures:r,setSelectedFeature:n}=ve();return h.useEffect(()=>{c("features")&&t&&r()},[t]),c("features")&&e.jsx("div",{className:"features-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","collect_type","icon","name","created_at"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{}},items_height:80,id:"category_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},name:N.StringElement({size_interval:[50,200]}),collect_type:N.StringElement({size:150}),icon:{getView(l,o,d,u){let m=null;return d.onResize(l,f=>{m&&(m.style.width=`${Math.min(f.height,f.width)*.9}px`,m.style.height=`${Math.min(f.height,f.width)*.9}px`)}),e.jsx("div",{ref:u,children:e.jsx("div",{className:"image-element",ref:f=>m=f,style:{background:$e(o[0]||"","40%")}})},l)}},created_at:N.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),n(l[0]),i({feature_id:l[0].id}).setAbsPath(["features","dash_features"])},onQuery:l=>{console.log("query",l),r(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["features","new_feature"])}})})})}function Xe({onChange:c,list:s,canEdit:i,select:t,color:a}){const[r,n]=h.useState(t||"");return e.jsx("div",{className:"choise-status",children:e.jsx("div",{className:"ctn",children:s.map(l=>e.jsx("div",{className:"one-choise "+l.toLocaleLowerCase()+" "+(r==l?"active":""),style:{background:r==l&&a||""},onClick:()=>{i&&n(r==l?"":l),i&&(c==null||c(r==l?"":l))},children:l},l))})})}function Ls(){var b;const{current:c,setAbsPath:s,json:i}=I(),{user:t}=p(),{selectedFeature:a,createFeature:r,fetchProductsUseFeature:n,productsUseFeature:l,setSelectedFeature:o,removeFeature:d,setFeatureById:u}=ve(),[m]=h.useState({}),f=c("new_feature"),$=c("dash_features"),[A]=h.useState({url:(b=a==null?void 0:a.icon)==null?void 0:b[0]}),_=re().width<1e3?"wrap":"";return m.prduct_id=a==null?void 0:a.id,h.useEffect(()=>{a&&n(a.id)},[a]),h.useEffect(()=>{$&&(i!=null&&i.feature_id)&&t&&u(i.feature_id)},[t,i]),($||f)&&(!a&&$?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"dash-feature",ref:K,children:[e.jsx(pe,{deteleKey:(a==null?void 0:a.id)||"noga",mode:f?"create":"delete",title:"Product Information",onCreate:()=>{r(m).then(g=>{if(!g)return s(["products","dash_product"])})},onDelete:()=>{a&&d(a.id).then(g=>{g&&o(void 0)})}}),e.jsxs("section",{className:"editor "+_,children:[e.jsxs("div",{className:"left-side",children:[$&&e.jsx(R,{label:"Feature Id",value:(a==null?void 0:a.id)||""}),e.jsx(R,{editable:!0,label:"Name",value:(a==null?void 0:a.name)||""}),e.jsx("label",{htmlFor:"choise_feature_icon",className:"choise_icon",children:e.jsxs("div",{className:"ctn",children:[e.jsx("input",{type:"file",name:"choise_feature_icon",id:"choise_feature_icon",onChange:g=>{}}),e.jsx("div",{className:"icon",style:{background:$e((a==null?void 0:a.icon[0])||"")}}),e.jsxs("div",{className:"text",children:[e.jsxs("span",{className:"title",children:[a!=null&&a.icon?"Change":"Choise"," Icon"]}),e.jsx("span",{className:"url",children:ee(A.url||"",20)})]})]})}),e.jsx(R,{editable:!0,label:"Collected type",value:(a==null?void 0:a.collect_type)||""}),e.jsx(Xe,{canEdit:!0,list:["Required"],onChange:g=>{console.log(g)}}),e.jsx(R,{editable:!0,label:"Placeholder",value:(a==null?void 0:a.placeholder)||""}),e.jsx(R,{editable:!0,label:"Default",value:"TODO DEFAULT"}),e.jsx(Xe,{canEdit:!0,select:a!=null&&a.capitalize?"Capitalize":a!=null&&a.lowercase?"Lowercase":a!=null&&a.uppercase?"Uppercase":"",list:["Capitalise","Uppercase","LowerCase"],onChange:g=>{console.log(g)}}),e.jsx(R,{editable:!0,label:"Macth RegExp",value:(a==null?void 0:a.match)||""}),e.jsx(R,{editable:!0,label:"Min Length",type:"number",value:(a==null?void 0:a.min_length)||""}),e.jsx(R,{editable:!0,label:"Max Length",type:"number",value:(a==null?void 0:a.max_length)||""}),e.jsx(R,{editable:!0,label:"Min Value",type:"number",value:(a==null?void 0:a.min)||""}),e.jsx(R,{editable:!0,label:"Max Value",type:"number",value:(a==null?void 0:a.max)||""}),e.jsx(R,{editable:!0,label:"Max File Size",type:"number",value:(a==null?void 0:a.max_size)||""}),e.jsx(R,{editable:!0,label:"Files Type",value:(a==null?void 0:a.ext)||""}),e.jsx(R,{editable:!0,label:"Enumeration of possible values",value:(a==null?void 0:a.id)||""}),e.jsx("div",{className:"editor-name"})]}),e.jsx("div",{className:"right-side",children:e.jsx(Se,{})})]}),e.jsx("h1",{className:"",children:"Feature's Products"}),e.jsx(N,{filter:{sortBy:"id",limit:(l==null?void 0:l.limit)||25,page:l==null?void 0:l.page,total:l==null?void 0:l.total},disableFilterBar:!0,items_height:80,id:"product-use-Feature_list",datas:(l==null?void 0:l.list)||[],itemsMapper:{images:{getView(g,w,q,x){return N.ImageElement().getView(g,`${S}${w[0]}`,q,x)}},id:{getView(g,w,q,x){return e.jsxs("div",{ref:x,children:["#",w.split("-")[0]]},q.id)}},title:N.StringElement({size_interval:[50,200]}),status:N.StringElement({size:150}),stock:N.StringElement(),category_id:{getView(g,w,q,x){return e.jsxs("div",{ref:x,children:["#",w.split("-")[0]]},q.id)}},price:N.StringElement({size:200}),created_at:N.DateStringElement({size:200})}})]}))}function qs(){const{check:c,setAbsPath:s,current:i}=I();return c("features")&&e.jsxs("div",{className:"page-features",children:[(i("features")||i("dash_features")||i("new_feature"))&&e.jsx(Re,{active:"features",setActive:t=>s(t.path)}),e.jsx(Ms,{}),e.jsx(Ls,{})]})}function Bs(){const{current:c,setAbsPath:s,qs:i}=I(),{catalogs:t,fetchCatalogs:a,setSelectedCatalog:r}=fe(),{store:n}=p();return h.useEffect(()=>{c("catalogs")&&n&&a()},[n]),c("catalogs")&&e.jsx("div",{className:"catalog-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","label","description","index","status","created_at"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{}},items_height:80,id:"category_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},label:N.StringElement({size_interval:[50,200]}),total_product:{getView(l,o,d,u){return N.StringElement().getView(l,o||0,d,u)}},description:N.StringElement({size_interval:[50,200]}),status:de,created_at:N.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),r(l[0]),i({catalog_id:l[0].id}).setAbsPath(["catalogs","dash_catalogs"])},onQuery:l=>{a(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["catalogs","new_catalog"])}})})})}function zs(){const{json:c,current:s,setAbsPath:i}=I(),{setCatalogById:t,selectedCatalog:a,catalogCategories:r,fetchCatalogCategories:n,updateCatalog:l,catalogProducts:o,setSelectedCatalog:d,removeCatalog:u,fetchCatalogProducts:m,createCatalog:f}=fe(),{setSelectedProduct:$}=ce(),{setSelectedCategory:A}=he(),[y]=h.useState({}),{store:_}=p(),[b,g]=h.useState("products"),[w]=h.useState(!1),x=re().width<1e3?"wrap":"";h.useEffect(()=>{a&&(m({catalog_id:a.id}),n({catalog_id:a.id}))},[a]);const P=s("dash_catalogs"),B=s("new_catalog");h.useEffect(()=>{c!=null&&c.catalog_id&&t(c==null?void 0:c.catalog_id)},[c]);const L=e.jsx(e.Fragment,{children:P&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{status:(a==null?void 0:a.status)||"PAUSE",onChange:D=>{P?a&&l({catalog_id:a.id,status:D}):y.status=D}})," ",e.jsx(Ue,{file_name:P?a==null?void 0:a.scene_dir:void 0,ext:["zip"],label:"Upload Scene File",onChange:D=>{P?a&&l({catalog_id:a.id,scene_dir:D}):y.scene_dir=D}})]})});return console.log({selectedCatalog:a}),(P||B)&&(!a&&P?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"catalog-dash",ref:K,children:[e.jsx(pe,{terme:"dark",deteleKey:(a==null?void 0:a.id)||"noga",mode:B?"create":"delete",title:"Catalog Information",onCreate:()=>{f(y).then(D=>{if(!D)return i(["catalogs","dash_catalogs"])})},onDelete:()=>{a&&u(a.id).then(D=>{D&&d(void 0)})}}),e.jsxs("section",{className:"editor "+x,children:[e.jsxs("div",{className:"left-side",children:[P&&e.jsx(R,{isCheckRequired:w,label:"Catalog Id",value:(a==null?void 0:a.id)||""}),e.jsxs("div",{className:"editor-name",children:[e.jsx("div",{className:"catalog-title",children:e.jsx(R,{editable:!0,prompt:"Catalog Label",isCheckRequired:w,min:3,check:"auto",max:50,label:"Label",placeholder:"Catalog Label",value:P&&((a==null?void 0:a.label)||""),onChange:D=>{P?a&&l({catalog_id:a.id,label:D}):y.label=D}})}),e.jsx("div",{className:"Catalog-description",children:e.jsx(Ve,{editable:!0,prompt:"Catalog Description",isCheckRequired:w,min:3,check:"auto",max:250,label:"Description",placeholder:"Catalog Description",value:P&&((a==null?void 0:a.description)||""),onChange:D=>{P?a&&l({catalog_id:a.id,description:D}):y.description=D}})})]}),P&&L]}),e.jsxs("div",{className:"right-side",children:[P&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(He,{onClick:()=>{},direction:"horizontal"})]}),B&&e.jsxs(e.Fragment,{children:[e.jsx(R,{isCheckRequired:w,label:"Store Name",value:(_==null?void 0:_.name)||""}),e.jsx(R,{isCheckRequired:w,label:"Store Id",value:(_==null?void 0:_.id)||""})]})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{className:"btn "+(b=="products"?"active":""),onClick:()=>{g("products")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Products"})]}),e.jsxs("div",{className:"btn "+(b=="categories"?"active":""),onClick:()=>{g("categories")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Categories"})]})]}),e.jsx("h2",{className:"see-all",onClick:()=>{b=="products"?i(["products"]):i(["categories"])},children:"SEE ALL"})]}),b=="products"&&e.jsx(N,{filter:{sortBy:"id",limit:(o==null?void 0:o.limit)||25,page:o==null?void 0:o.page,total:o==null?void 0:o.total},disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(o==null?void 0:o.list)||[],itemsMapper:{images:{getView(D,k,j,E){return N.ImageElement().getView(D,`${S}${k[0]}`,j,E)}},id:{getView(D,k,j,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},j.id)}},title:N.StringElement({size_interval:[50,200]}),stock:N.StringElement(),category_id:{getView(D,k,j,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},j.id)}},price:N.StringElement({size:200}),status:de,created_at:N.DateStringElement({size:200})},onItemsSelected:D=>{$(D[0]),i(["products","dash_product"])}}),b=="categories"&&e.jsx(N,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(r==null?void 0:r.list)||[],itemsMapper:{id:{getView(D,k,j,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},j.id)}},label:N.StringElement({size_interval:[50,200]}),total_products:{getView(D,k,j,E){return N.StringElement().getView(D,k||0,j,E)}},catalog_id:{getView(D,k,j,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},j.id)}},status:de,created_at:N.DateStringElement({size:500})},onItemsSelected:D=>{console.log(D[0],"))))))))))))))"),A(D[0]),i(["categories","dash_categories"])}})]})]}))}function Vs(){const{check:c,setAbsPath:s,current:i}=I();return c("catalogs")&&e.jsxs("div",{className:"page-catalogs",children:[(i("catalogs")||i("new_catalog")||i("dash_catalogs"))&&e.jsx(Re,{active:"catalogs",setActive:t=>s(t.path)}),e.jsx(zs,{}),e.jsx(Bs,{})]})}function Hs(){const c=localStorage.getItem("store_name"),{getAccess:s,openAuth:i}=p();return i&&e.jsx("div",{className:"page-auth",children:e.jsxs("div",{className:"auth-ctn",children:[e.jsx("div",{className:"image"}),e.jsxs("div",{className:"form",children:[e.jsxs("h1",{className:"auth-title",children:[c==null?void 0:c.toUpperCase()," DASHBOARD"]}),e.jsxs("h5",{className:"auth-prompt",children:["Read more ?"," ",e.jsx("span",{onClick:()=>{},children:"Click here"})]}),e.jsxs("div",{className:"google",onClick:()=>{s()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Connexion"})]}),e.jsx("p",{children:"Google connexion is required to get access to sublymus Dash board service."})]})]})})}function Us(){const{current:c,qs:s}=I(),{moderators:i,setSelectedModerator:t,fetchModerators:a}=me(),{store:r}=p();return h.useEffect(()=>{c("moderators")&&r&&a()},[r]),c("moderators")&&e.jsx("div",{className:"moderator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:se([0,1e5],[0,1e4]),stock:se([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"moderator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(n,l,o,d){return N.ImageElement().getView(n,`${l[0].startsWith("/")?S:""}${l[0]}`,o,d)}},id:{getView(n,l,o,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},o.id)}},name:N.StringElement({size_interval:[50,200]}),status:{getView(n,l,o,d){return de.getView(n,"VISIBLE",o,d)}},created_at:N.DateStringElement({size:200})},onItemsSelected:(n,l)=>{l.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="")}),n.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="#00f2")}),t(n[0]),s({moderator_id:n[0].id}).setAbsPath(["moderators","moderator_profile"])},onQuery:n=>{a(n)},top_height:40,canPaginate:!0})})})}function Os(){const{current:c,json:s}=I(),{user:i}=p(),{selectedModerator:t,setModeratorById:a}=me(),{store:r}=p(),[n]=h.useState(!1),o=re().width<1e3?"wrap":"";return h.useEffect(()=>{c("moderator_profile")&&(s!=null&&s.moderator_id)&&r&&a(s.moderator_id)},[s,r]),c("moderator_profile")&&(t?e.jsxs("div",{className:"moderator-profile",ref:K,children:[e.jsx("h1",{children:"Moderator Information"}),e.jsxs("section",{className:"editor "+o,children:[e.jsx("div",{className:"left-right",children:e.jsx(Ce,{name:"moderator_profile",images:t.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(R,{isCheckRequired:n,label:"Moderator Id",value:(t==null?void 0:t.id)||""}),e.jsx(R,{prompt:"Moderator Name",isCheckRequired:n,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:t==null?void 0:t.name}),e.jsx(R,{prompt:"Moderator Email",isCheckRequired:n,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:t==null?void 0:t.email}),e.jsx(R,{label:"created At",value:t==null?void 0:t.created_at}),e.jsx(R,{label:"Join Store At",value:t==null?void 0:t.join_at}),i&&t.id!=i.id&&e.jsx(ze,{user:t,channel:"discussions_admin"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Fs(){const{check:c,current:s,setAbsPath:i}=I();return c("moderators")&&e.jsxs("div",{className:"moderator-page",children:[s("moderators","moderator_profile")&&e.jsx(Pe,{active:"moderators",setActive:t=>i(t.path)}),e.jsx(Us,{}),e.jsx(Os,{})]})}const ne=te(c=>({json_roles:void 0,roles:void 0,selectedRole:void 0,async setSelectedRole(s){c(()=>({selectedRole:s}))},async setRoleById(s){const i=ne.getState().roles,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedRole:t}));else if(p.getState().store){const r=await ne.getState().fetchRoles({role_id:s});c(()=>({selectedRole:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ne.getState().fetchRoles({role_id:s});c(()=>({selectedRole:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async newRole(s){var o;if(!s.name)return console.log("Name required");if(!s.options||s.options.length==0)return console.log("Option Is required");const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new FormData;a.append("name",s.name),a.append("store_id",i.id),(o=s.options)==null||o.forEach(d=>{a.append(d,"1")});const r=new Headers;r.append("Authorization",`Bearer ${t.token}`);const l=await(await fetch(`${S}/create_collaborator_role`,{method:"POST",body:a,headers:r})).json();!l||!l.id||(console.log("new role",l),c(()=>({selectedRole:l})),U.getState().fetchUsersVar(),I.getState().setAbsPath(["roles","edit_role"]))},async updateRole(s){var d,u;console.log("data",s);const i=ne.getState().selectedRole;if(!i)return;if(!s.name&&!s.options)return console.log("data",s);if(!p.getState().store)return;let a=p.getState().user;if(!a)return;const r=new FormData;r.append("role_id",i.id),s.name&&r.append("name",s.name),((d=s.options)==null?void 0:d.length)>0&&r.append("newOptions","ok"),(u=s.options)==null||u.forEach(m=>{r.append(m,"1")});const n=new Headers;n.append("Authorization",`Bearer ${a.token}`);const o=await(await fetch(`${S}/update_role`,{method:"PUT",body:r,headers:n})).json();!o||!o.id||c(()=>({selectedRole:o}))},async deleteRole(s){console.log(s);const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new Headers;a.append("Authorization",`Bearer ${t.token}`);const r=new FormData;r.append("store_id",i.id),r.append("role_id",s);const n={method:"DELETE",headers:a,body:r};(await(await fetch(`${S}/delete_role`,n)).json()).deleted&&c(()=>({selectedRole:void 0})),U.getState().fetchUsersVar()},async fetchRolesJson(){const i=await(await fetch(`${S}/get_roles_json`)).json();i&&c(()=>({json_roles:i}))},async fetchRoles(s={}){const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new Headers;a.append("Authorization",`Bearer ${t.token}`);const r={method:"GET",headers:a};s.store_id=i.id;const n=new URLSearchParams({});for(const d in s){const u=s[d];n.set(d,u)}const o=await(await fetch(`${S}/get_store_roles/?${n.toString()}`,r)).json();if(console.log("roles",o),!(!o||!o.list))return c(()=>({roles:o})),o}}));function Ws(){const{current:c,setAbsPath:s,qs:i}=I(),{roles:t,setSelectedRole:a,fetchRoles:r}=ne(),{store:n}=p();return h.useEffect(()=>{c("roles")&&n&&r()},[n]),c("roles")&&e.jsx("div",{className:"collaborator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{price:se([0,1e5],[0,1e4]),stock:se([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"collaborator_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},name:N.StringElement({size_interval:[50,200]}),created_at:N.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),a(l[0]),i({role_id:l[0].id}).setAbsPath(["roles","edit_role"])},onQuery:l=>{r(l)},canAddNew:!0,onNewRequired:()=>{s(["roles","create_role"])},top_height:40,canPaginate:!0})})})}function Ks(){const{selectedRole:c,setRoleById:s,updateRole:i,newRole:t,deleteRole:a,json_roles:r}=ne(),{current:n,json:l}=I(),[o]=h.useState({}),d=n("edit_role"),u=n("create_role");return h.useEffect(()=>{l!=null&&l.role_id&&s(l==null?void 0:l.role_id)},[l]),(d||u)&&(!c&&d?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"role-dash",ref:K,children:[e.jsx(pe,{title:"Role Information",mode:d?"delete":"create",deteleKey:c==null?void 0:c.id,onDelete:()=>{c&&a(c.id)},onCreate:()=>{t(o)}}),e.jsxs("section",{className:"editor",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(R,{min:3,max:25,placeholder:"Role Name",prompt:"Role Name",editable:!0,label:"Name",value:d?c==null?void 0:c.name:"",onChange:m=>{d?i({name:m}):o.name=m}}),d&&e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Id",value:c==null?void 0:c.id}),e.jsx(R,{label:"Created At",value:c==null?void 0:c.created_at}),e.jsx(R,{label:"Update At",value:c==null?void 0:c.updated_at}),e.jsx(Se,{})]})]}),e.jsx("div",{className:"right-side",children:e.jsx(ts,{role:c,json_roles:r,isNew:u,onChange:m=>{d?i({options:m}):o.options=m}})})]})]}))}function Qs(){const{check:c,current:s,setAbsPath:i}=I();return c("roles")&&e.jsxs("div",{className:"role-page",children:[s("roles","edit_role")&&e.jsx(Pe,{active:"roles",setActive:t=>i(t.path)}),e.jsx(Ws,{}),e.jsx(Ks,{})]})}function Xs(){const{current:c,setAbsPath:s,qs:i}=I(),{collaborators:t,setSelectedCollaborator:a,fetchCollaborators:r}=le(),{store:n}=p(),{roles:l}=ne();return h.useEffect(()=>{c("collaborators")&&n&&r()},[n]),c("collaborators")&&e.jsx("div",{className:"collaborator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(N,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{price:se([0,1e5],[0,1e4]),stock:se([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"collaborator_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{photos:{getView(o,d,u,m){return N.ImageElement().getView(o,`${d[0].startsWith("/")?S:""}${d[0]}`,u,m)}},id:{getView(o,d,u,m){return e.jsxs("div",{ref:m,children:["#",d.split("-")[0]]},u.id)}},name:N.StringElement({size_interval:[50,200]}),email:N.StringElement({size:200}),status:de,role_id:{getView(o,d,u,m){var f;return e.jsx("div",{ref:m,children:(f=l==null?void 0:l.list.find($=>$.id==d))==null?void 0:f.name},u.id)}},join_at:N.DateStringElement({size:150}),created_at:N.DateStringElement({size:150})},onItemsSelected:(o,d)=>{d.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="")}),o.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="#00f2")}),a(o[0]),i({collaborator_id:o[0].id}).setAbsPath(["collaborators","collaborator_profile"])},onQuery:o=>{r(o)},canAddNew:!0,onNewRequired:()=>{s(["collaborators","new_collaborator"])},top_height:40,canPaginate:!0})})})}const Js=["PAUSE","VISIBLE","NEW"];function Ys({onChange:c,status:s,canEdit:i}){const[t,a]=h.useState(s);return e.jsx("div",{className:"choise-status",children:e.jsx("div",{className:"ctn",children:Js.map(r=>e.jsx("div",{className:"use-status "+r.toLocaleLowerCase()+" "+(t==r?"active":""),onClick:()=>{i&&a(r),i&&(c==null||c(r))},children:r},r))})})}function Gs(){const{current:c,json:s}=I(),{selectedCollaborator:i,setCollaboratorById:t,removeCollaborator:a,updateCollaborator:r,change_collaborator_role:n}=le(),[l]=h.useState(!1),{roles:o,fetchRoles:d}=ne(),m=re().width<1e3?"wrap":"",{store:f,user:$}=p();return h.useEffect(()=>{s!=null&&s.collaborator_id&&t(s==null?void 0:s.collaborator_id)},[s]),h.useEffect(()=>{d({})},[$]),console.log({roles:o}),c("collaborator_profile")&&(i?e.jsxs("div",{className:"collaborator-profile",ref:K,children:[e.jsx(pe,{title:"Collaborator Information",mode:"delete",deteleKey:i.id,onDelete:()=>{console.log(i.id),a(i.id)}}),e.jsxs("section",{className:"editor "+m,children:[e.jsxs("div",{className:"left-right",children:[e.jsx(Ce,{name:"collaborator_profile",images:i.photos||[],cannotEdit:!0}),e.jsx(R,{label:"Name",value:i==null?void 0:i.name}),e.jsx(R,{label:"Email",value:i==null?void 0:i.email}),e.jsx(R,{label:"created At",value:i==null?void 0:i.created_at}),e.jsx(R,{label:"Join Store At",value:i==null?void 0:i.join_at})]}),e.jsxs("div",{className:"left-side",children:[e.jsx(R,{label:"Store Name",value:(f==null?void 0:f.name)||"pppp"}),e.jsx(R,{label:"Store Id",value:f==null?void 0:f.id}),e.jsx(R,{isCheckRequired:l,label:(i==null?void 0:i.s_type)+" Id",value:(i==null?void 0:i.id)||""}),($==null?void 0:$.id)!=i.id&&e.jsxs("div",{className:"chat-btn-ctn",children:[e.jsx(ze,{user:i,channel:"discussions"}),window.location.pathname.split("/")[3]=="admin"&&e.jsx("div",{className:"btn-chat-admin",onClick:()=>{f&&window.open(`${ss}/admin#chat/discussions={"store_id":"${f.id}","collaborator_id":"${i.id}"}`)},children:"Open as Admin"})]}),e.jsx(Ys,{status:(i==null?void 0:i.status)||"NEW",onChange:A=>{r({product_id:i.id,status:A})}}),e.jsx(Ge,{roles:(o==null?void 0:o.list)||[],canChange:()=>!0,role_id:i.role_id,onChange:A=>{n({new_role_id:A,collaborator_id:i.id})}}),e.jsx(Se,{})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Zs(){const{current:c}=I(),{addCollaborator:s}=le(),{store:i}=p(),[t]=h.useState(!1),a=re(),{roles:r,fetchRoles:n}=ne();h.useEffect(()=>{n({})},[i]);const l=a.width<1e3?"wrap":"",[o]=h.useState({});return h.useEffect(()=>{},[]),c("new_collaborator")&&e.jsxs("div",{className:"collaborator-profile",ref:K,children:[e.jsx(pe,{terme:"white",mode:"create",title:"Collaborator Information",onCreate:()=>{s(o).then(d=>{console.log(d)})}}),e.jsxs("section",{className:"editor "+l,children:[e.jsxs("div",{className:"left-right",children:[e.jsx(R,{label:"Store Name",value:i==null?void 0:i.name}),e.jsx(R,{label:"Store Id",value:i==null?void 0:i.id}),e.jsx(R,{editable:!0,prompt:"Collaborator Email",isCheckRequired:t,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:"",onChange:d=>{o.email=d}})]}),e.jsx("div",{className:"left-side",children:e.jsx(Ge,{roles:(r==null?void 0:r.list)||[],canChange:()=>!0,onChange:d=>{o.role_id=d}})})]})]})}function et(){const{check:c,current:s,setAbsPath:i}=I();return c("collaborators")&&e.jsxs("div",{className:"collaborator-page",children:[s("collaborators","collaborator_profile","new_collaborator")&&e.jsx(Pe,{active:"collaborators",setActive:t=>i(t.path)}),e.jsx(Xs,{}),e.jsx(Gs,{}),e.jsx(Zs,{})]})}const Je={store:"Store",products:"Products",categories:"Categories",features:"Features",catalogs:"Catalogs",dash_product:"Edit Product",dash_categories:"Edit Category",dash_features:"Edit Feature",dash_catalogs:"Edit Catalog",preview:"Preview",statistic:"Statistic",action:"Action",new_product:"New Product",new_category:"New Category",product_preview:"Product Preview",user:"Users",clients:"clients",collaborators:"Collaborator",client_profile:"Profile",collaborator_profile:"Profile",roles:"Roles",create_role:"New Role",edit_role:"Editor",new_collaborator:"New Collaborator",chat:"Chat",interface:"Interface",sessions:"Sessions",discussions:"Discussions",moderators:"Moderators",moderator_profile:"Moderator Profile"};function st(){const{currentChild:c,blur:s,openChild:i,fetchUsersVar:t,fetchStoreVar:a,T:r,setT:n,back_color:l}=U(),{authenticateUser:o,user:d,store:u}=p(),{pathList:m,setAbsPath:f}=I(),{fetchRolesJson:$}=ne(),A=[];return m.forEach(y=>{Je[y]&&A.push(Je[y])}),h.useEffect(()=>{o(),window.addEventListener("blur",()=>{i(void 0)})},[]),h.useEffect(()=>{u&&(a(),$(),t())},[u]),e.jsxs("div",{className:"dash "+(r?"sombre-mode-variable":""),children:[e.jsx(Fe,{blur:s}),!d&&e.jsx(Hs,{}),e.jsx("div",{className:"dash-ctn "+(d?s?"blur":"":"blur"),children:e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"center-top",children:[e.jsxs("div",{className:"nav-min",onClick:()=>{i(e.jsx(Fe,{className:"max",blur:s}),!0,"#345b")},children:[" ",e.jsx("span",{})]}),e.jsx("div",{className:"page-path",children:A.map((y,_)=>e.jsxs("div",{className:"path",children:[e.jsxs("div",{className:"label",onClick:()=>{const b=m.slice(1,_+2);f(b)},children:[y,e.jsx("span",{})]}),A[_+1]?e.jsx("div",{className:"icon"}):void 0]},_))}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+r,onClick:()=>{n(r?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]})]}),e.jsxs("div",{className:"center-ctn",ref:y=>{if(!y||y.dataset.init)return;y.dataset.init="true";const _=()=>{const b=document.querySelector(".dash .center .center-top");y.style.height=`calc(100% - ${b.getBoundingClientRect().height}px)`};window.addEventListener("resize",_),_()},children:[e.jsx(gs,{}),e.jsx(Is,{}),e.jsx(Vs,{}),e.jsx(qs,{}),e.jsx(vs,{}),e.jsx(Fs,{}),e.jsx(et,{}),e.jsx(Qs,{}),e.jsx(Ps,{}),e.jsx(Ds,{})]})]})}),c&&e.jsx("div",{className:"child-viewer",onContextMenu:y=>{y.preventDefault(),i(void 0)},children:e.jsx("div",{className:"child-viewer-ctn",style:{background:l},onClick:()=>{i(void 0)},onContextMenu:y=>{y.preventDefault(),i(void 0)},children:c})})]})}const tt=c=>c,ct=tt(e.jsx(as.StrictMode,{children:e.jsx(st,{})}));export{ct as DashView};
