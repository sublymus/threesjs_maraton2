import{j as e,H as b,b as W,u as oe,a as ae,g as ke,l as Z,t as fe,c as me,C as Y,L as es}from"./BindToParentScroll-CKHOeOrx.js";import{r as h,c as se,R as ss}from"./index-8YXOWOwm.js";import{u as M,a as p,b as H,G as S,F as ee,c as je,d as _e,e as ne,S as le,I as $,C as qe,f as we,A as Ne,O as Be,U as $e,g as Je,h as ts,i as Ye}from"./ChoiseRole-CbqTPBuj.js";import{E as ge}from"./EditorTopBar-C-QoReUz.js";import{t as Pe,e as Ge}from"./emoji-BfngIuko.js";function Oe({blur:c}){const{setAbsPath:s,pathList:i}=M(),[t,a]=h.useState(i[1]||"products"),{user:r,store:n,disconnection:l}=p();return h.useEffect(()=>{a(i[1]||"products")},[i]),e.jsxs("div",{className:"nav-bar "+(r?c?"blur":"":"blur"),children:[e.jsxs("div",{className:"nav-logo",children:[e.jsx("div",{className:"logo",style:{backgroundImage:`url(${`${b}${n==null?void 0:n.banners[0]}`})`}}),e.jsx("div",{className:"label",children:n==null?void 0:n.name})]}),e.jsx("div",{className:"nav-link",children:e.jsxs("ul",{children:[e.jsxs("li",{className:t=="products"||t=="features"||t=="categories"||t=="catalogs"?"active":"no",onClick:()=>{a("products"),s(["products"])},children:[e.jsx("span",{className:"product"}),e.jsx("label",{children:"STORE"})]}),e.jsxs("li",{className:t=="clients"||t=="collaborators"||t=="roles"?"active":"no",onClick:()=>{a("clients"),s(["clients"])},children:[e.jsx("span",{className:"users"}),e.jsx("label",{children:"USERS"})]}),e.jsxs("li",{className:t=="chat"?"active":"no",onClick:()=>{a("chat"),s(["chat"])},children:[e.jsx("span",{className:"chat"}),e.jsx("label",{children:"CHAT"})]}),e.jsxs("li",{className:t=="interface"?"active":"no",onClick:()=>{a("interface"),s(["interface"])},children:[e.jsx("span",{className:"interface"}),e.jsx("label",{children:"INTERFACE"})]}),e.jsxs("li",{className:t=="statistic"?"active":"no",onClick:()=>{a("statistic"),s(["statistic"])},children:[e.jsx("span",{className:"state"}),e.jsx("label",{children:"STATISTIC"})]})]})}),e.jsxs("div",{className:"nav-profile",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${r!=null&&r.photos[0].startsWith("/")?b:""}${r==null?void 0:r.photos[0]})`}}),e.jsx("div",{className:"name",children:r==null?void 0:r.name}),e.jsx("div",{className:"logout",onClick:()=>{l()},children:"logout"})]}),e.jsx("div",{className:"logut-icon",onClick:()=>{l()}})]})}const re=se(c=>({products:void 0,selectedProduct:void 0,async fectProductCommands({limit:s,page:i,status:t,no_status:a,user_id:r,product_id:n}){const l=p.getState().getHeaders();if(!l)return;const o={};o.user_id=!0,o.store_id=l.store.id,o.product_id=n||"",o.limit=s||25,o.page=i||1,o.user_id=r||"",o.status=t||"",o.no_status=a||"";const d=new URLSearchParams({});for(const N in o){const k=o[N];d.set(N,k)}const m=await(await fetch(`${b}/get_commands/?${d.toString()}`,{headers:l.headers})).json();if(!(!m||!m.list))return m},async setProductById(s){const i=re.getState().products,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedProduct:t}));else if(p.getState().store){const r=await re.getState().fetchProducts({query:{product_id:s}});c(()=>({selectedProduct:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await re.getState().fetchProducts({query:{product_id:s}});c(()=>({selectedProduct:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeProduct(s){const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${b}/delete_product/${s}`,{method:"DELETE",headers:i.headers})).json();return H.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createProduct(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0,s.is_dynamic_price=s.is_dynamic_price||!0;const t=new FormData,a=[];if(["images","model_images"].forEach(r=>{const n=s[r];if(n&&Object.keys(n).length>0){const l=[];Object.keys(n).sort((o,d)=>{var u,m;return(((u=n[o])==null?void 0:u.index)||0)-(((m=n[d])==null?void 0:m.index)||0)}).forEach(o=>{l.push(o),n[o].isLocal&&t.append(o,n[o].file)}),t.append(r,JSON.stringify(l))}else return a.push(r+" is not defined")}),["title","description","stock","category_id","index","price","is_dynamic_price"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),a.length==0){const n=await(await fetch(`${b}/create_product`,{method:"POST",body:t,headers:i.headers})).json();if(!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedProduct:n})),H.getState().fetchStoreVar()}else return a},async updateProduct(s){if(!s.product_id)return console.log("Product_id required");const i=p.getState().getHeaders();if(!i)return;const t=new FormData;let a=!1;["images","model_images"].forEach(n=>{const l=s[n];if(l&&Object.keys(l)){a=!0;const o=[];Object.keys(l).sort((d,u)=>{var m,N;return(((m=l[d])==null?void 0:m.index)||0)-(((N=l[u])==null?void 0:N.index)||0)}).forEach(d=>{o.push(d),l[d].isLocal&&t.append(d,l[d].file)}),t.append(n,JSON.stringify(o))}}),t.append("product_id",s.product_id),["title","description","stock","category_id","status","index","price","is_dynamic_price"].forEach(n=>{s[n]&&(t.append(n,s[n]),a=!0)});let r=null;if(a&&(r=await fetch(`${b}/update_product`,{method:"PUT",body:t,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("product_id",s.product_id),r=await fetch(`${b}/update_view_product`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),console.log("newProduct",r),c(()=>({selectedProduct:r})))},async fetchProducts(s){const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),s!=null&&s.query.price&&(t.price_min=s.query.price[0]),s!=null&&s.query.price&&(t.price_max=s.query.price[1]),s!=null&&s.query.stock&&(t.stock_min=s.query.stock[0]),s!=null&&s.query.stock&&(t.stock_max=s.query.stock[1]),s!=null&&s.query.product_id&&(t.product_id=s.query.product_id),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({products:n})),n},async setSelectedProduct(s){c(()=>({selectedProduct:s}))}}));function as(){const{current:c,setAbsPath:s,qs:i}=M(),{store:t}=p(),{fetchProducts:a,products:r,setSelectedProduct:n}=re();return h.useEffect(()=>{c("products")&&t&&a()},[t]),c("products")&&e.jsx("div",{className:"product-list",ref:W,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:r==null?void 0:r.limit,page:r==null?void 0:r.page,total:r==null?void 0:r.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:je(["PAUSE","TRASH","NEW"],[]),index:_e([0,100]),is_dynamic_price:ne(),hasScene:ne()}},items_height:80,id:"product_list",datas:(r==null?void 0:r.list)||[],itemsMapper:{images:{getView(l,o,d,u){return S.ImageElement().getView(l,`${b}${o[0]}`,d,u)}},id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},title:S.StringElement({size_interval:[50,200]}),status:le,stock:S.StringElement(),category_id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},price:S.StringElement({size:200}),created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),n(l[0]),i({product_id:l[0].id}).setAbsPath(["products","dash_product"])},onQuery:l=>{a(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["products","new_product"])}})})})}function ze({placeholder:c,value:s,isCheckRequired:i,label:t,max:a,min:r,check:n,openEditor:l,prompt:o,editable:d,onChange:u}){const[m,N]=h.useState(s||""),[k,D]=h.useState(0),[C,y]=h.useState(""),[x,j]=h.useState(l||!1),[E,A]=h.useState(0),[g,I]=h.useState(0),B=h.useRef(null),z=h.useRef(null),v=h.useRef(null),[_]=h.useState({validation:P=>(console.log(P,r&&P.length<r,P.length,r),y(""),P=P.toString().trim(),r&&P.length<r?(y(`Minimum length ${r}`),!1):a&&P.length>a?(y(`Maximum length ${a}`),!1):(u==null||u(P),!0))});h.useEffect(()=>{i&&_.validation(m)},[i]);const T=()=>{if(B.current){const L=`${-10-B.current.getBoundingClientRect().height}px`;B.current.style.top=L}if(z.current){const L=`${-10-z.current.getBoundingClientRect().height}px`;z.current.style.top=L}};return e.jsxs("div",{className:"textarea-text textarea",children:[e.jsx("div",{className:"textarea-top",children:e.jsxs("div",{className:"left-side",children:[e.jsxs("div",{className:"label",children:[t," "]}),o&&e.jsx("div",{className:"textarea-info",onMouseEnter:P=>{if(P.target.className!=="textarea-info")return z.current.style.display="none";clearTimeout(E),z.current&&(z.current.style.display="block"),T()},onMouseLeave:()=>{A(setTimeout(()=>{z.current&&(z.current.style.display="none")},300))},children:e.jsx("div",{className:"promt",ref:z,children:o})}),d&&e.jsx("div",{className:"edit",style:{background:`no-repeat center/80% url(${x?"/src/res/x.png":"/src/res/pencil.png"})`},onClick:()=>{const P=!x;j(P==!1?!_.validation(m):!0),P&&setTimeout(()=>{var L;(L=v.current)==null||L.focus()}),T()},onMouseEnter:P=>{if(P.target.className!=="edit")return z.current.style.display="none";clearTimeout(g),B.current&&(B.current.style.display="block"),T()},onMouseLeave:()=>{I(setTimeout(()=>{B.current&&(B.current.style.display="none")},300))},children:e.jsx("div",{className:"promt",ref:P=>{B.current=P,T()},children:x?"Close editor":"click here to edit value"})})]})}),!x&&e.jsx("div",{className:"value",children:m}),x&&e.jsxs("div",{className:"textarea-editor",children:[e.jsx("textarea",{ref:v,spellCheck:"false",rows:5,placeholder:c,value:m,onChange:P=>{let L=P.currentTarget.value;for(;L.includes("  ");)L=L.replace("  "," ");L.length>(a||Number.MAX_VALUE)||(N(L),y(""),D(L.length))},onBlur:()=>{n=="auto"&&_.validation(m)&&setTimeout(()=>{j(!1)},0)}}),e.jsxs("div",{className:"count",children:[" ",e.jsx("div",{className:"message",children:C}),a&&`${k}/${a}`]})]})]})}function Ve({direction:c="",onClick:s}){return e.jsxs("div",{className:"preview-3d-model-card "+c,onClick:s,children:[e.jsx("div",{className:"image "+c,style:{backgroundImage:"url(/src/res/ert.avif)"}}),e.jsxs("div",{className:"text-side",children:[e.jsx("div",{className:"top",children:"PREVIEW 3D MODEL"}),e.jsxs("div",{className:"features",children:[3," FEATURE","S"]}),e.jsx("div",{className:"prompt",children:"Loader File is missing"})]})]})}function is({}){return e.jsxs("div",{className:"statistic-card",children:[e.jsxs("div",{className:"text",children:[e.jsx("h1",{className:"title",children:"Product Statistic"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"title",children:[2e4.toLocaleString(),"  ₽ "]}),e.jsxs("h2",{className:"description",children:["since ",new Date(Date.now()-1e3*60*60*24*30).toDateString()]})]})]}),e.jsx(ns,{})]})}const Fe={with:250,height:120,bars:[{value:80},{value:15},{value:25},{value:10},{value:15},{value:25},{value:15},{value:25},{value:90},{value:25},{value:30},{value:25},{value:30},{value:50},{value:100},{value:90},{value:80},{value:70},{value:60},{value:60},{value:70},{value:80}]};function ns(){return e.jsx("div",{className:"bar-chart",children:e.jsx("div",{className:"bars",children:Fe.bars.map((c,s)=>e.jsx("div",{className:"bar",children:e.jsx("div",{className:"level",style:{height:`${c.value/100*Fe.height}px`,background:`linear-gradient(rgb(0, 90, 180),rgb(23, 108, 194)${((c.value<35?35:c.value)-25)*.7}% , rgb(75, 165, 255)100%)`}})},s))})})}let os=0;function He({onChange:c,icon:s,ext:i,label:t,file_name:a}){const[r]=h.useState((Math.random()+os++).toString()),[n,l]=h.useState(a||"");return e.jsxs("div",{className:"loader-img",children:[e.jsx("input",{type:"file",style:{display:"none"},accept:"",name:"img",id:r,onChange:o=>{var k;const d=(k=o.target.files)==null?void 0:k[0];if(!d)return;const u=d.name.toLowerCase(),m=u.lastIndexOf("."),N=u.substring(m+1,u.length);if(i&&!i.includes(N))return console.log({_ext:N,ext:i,n:u});l(d.name),c(d)}}),e.jsxs("label",{htmlFor:r,className:"loader-img-ctn",children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon",style:{background:s?`no-repeat center/50% url(${s})`:""}})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:t??"Upload file"}),e.jsx("div",{className:"prompt",children:n&&(n.length>25?n.substring(0,10)+"..."+n.substring(n.length-10,n.length):n)||"Add new File"})]}),e.jsx("div",{className:"load-icon"})]})]})}const ue=se(c=>({categories:void 0,selectedCategory:void 0,categoryProducts:void 0,async setCategoryById(s){const i=ue.getState().categories,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCategory:t}));else if(p.getState().store){const r=await ue.getState().fetchCategories({query:{user_id:s}});c(()=>({selectedCategory:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ue.getState().fetchCategories({query:{user_id:s}});c(()=>({selectedCategory:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCategory(s){if(!s)return;const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${b}/delete_category/${s}`,{method:"DELETE",headers:i.headers})).json();return H.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createCategory(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0;const t=new FormData,a=[];if(["label","description","catalog_id","index"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),a.length==0){const n=await(await fetch(`${b}/create_category`,{method:"POST",body:t,headers:i.headers})).json();if(console.log(n),!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedCategory:n})),H.getState().fetchStoreVar()}else return a},async fetchCategoryProducts(s){if(!(s!=null&&s.category_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.category_id=s==null?void 0:s.category_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({categoryProducts:n}))}catch(t){return console.warn(t.message)}},setSelectedCategory(s){c(()=>({selectedCategory:s}))},async updateCategory(s){const i=p.getState().getHeaders();if(!i)return;const t=new FormData;let a=!1;t.append("category_id",s.category_id),["label","index","status","catalog_id","description"].forEach(n=>{s[n]&&(t.append(n,s[n]),a=!0)});let r=null;if(a&&(r=await fetch(`${b}/update_category`,{method:"PUT",body:t,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("category_id",s.category_id),r=await fetch(`${b}/update_view_category`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),c(()=>({selectedCategory:r})))},async fetchCategories(s){const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_categories/?${a.toString()}`,{headers:i.headers})).json();return!n||!n.list?void 0:(c(()=>({categories:n})),n)}catch(t){console.warn(t.message);return}}}));function rs({onChange:c,category_id:s}){const{fetchCategories:i,categories:t}=ue(),[a,r]=h.useState(),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(t==null?void 0:t.list.find(o=>o.id==s))},[t]),e.jsxs("div",{className:"choise-category",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Category"}),e.jsx("div",{className:"name",children:(a==null?void 0:a.label)||"select category"})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-category "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+((a==null?void 0:a.id)==o.id?"selected":""),onClick:()=>{r(o),c==null||c(o.id)},children:[e.jsx("div",{className:"label",children:o.label}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}const xe=se(c=>({features:void 0,selectedFeature:void 0,productsUseFeature:void 0,async setFeatureById(s){var t,a;const i=xe.getState().selectedFeature||((t=xe.getState().features)==null?void 0:t.list.find(r=>r.id==s));if(i)c(()=>({selectedFeature:i}));else{const r=(a=await xe.getState().fetchFeatures({feature_id:s},!0))==null?void 0:a.list[0];c(()=>({selectedFeature:r}))}},async removeFeature(s){const t=await(await fetch(`${b}/delete_feature/${s}`,{method:"DELETE"})).json();return console.log({json:t}),t==null?void 0:t.isDeleted},async fetchProductsUseFeature(s){c(()=>({productsUseFeature:re.getState().products}))},setSelectedFeature(s){c(()=>({selectedFeature:s}))},async createFeature(s){H.getState().fetchStoreVar()},async updateFeature(s){},async fetchFeatures(s,i){var l,o,d;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=(o=s.query)==null?void 0:o.text),s!=null&&s.feature_id&&(t.feature_id=s.feature_id),t.store_id=(d=p.getState().store)==null?void 0:d.id;const a=new URLSearchParams({});for(const u in t){const m=t[u];a.set(u,m)}const n=await(await fetch(`${b}/get_features/?${a.toString()}`)).json();if(!(!n||!n.list))return i||c(()=>({features:n})),console.log(n),n}}));function cs({onChange:c,features:s}){const{fetchFeatures:i,features:t}=xe(),[a,r]=h.useState(s),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(s==null?void 0:s.filter(o=>t==null?void 0:t.list.find(d=>d.id==o.id)))},[t]),e.jsxs("div",{className:"choise-features",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Features"}),e.jsxs("div",{className:"name",children:[(a==null?void 0:a.length)||0," Selected"]})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-features "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+(a!=null&&a.find(d=>d.id==o.id)?"selected":""),onClick:()=>{const d=a!=null&&a.find(u=>u.id==o.id)?a.filter(u=>u.id!==o.id):[...a||[],o];r(d),c==null||c(d.map(u=>u.id))},children:[e.jsx("div",{className:"label",children:o.name}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}function ls(){var A;const{current:c,setAbsPath:s,json:i}=M(),{selectedProduct:t,setSelectedProduct:a,updateProduct:r,createProduct:n,removeProduct:l,setProductById:o,fectProductCommands:d}=re(),[u]=h.useState(!1),[m,N]=h.useState([]),[k,D]=h.useState("");h.useEffect(()=>{},[k]),h.useEffect(()=>{i!=null&&i.product_id&&o(i==null?void 0:i.product_id)},[i]),h.useEffect(()=>{t&&d({limit:10,product_id:t.id}).then(g=>N((g==null?void 0:g.list)||[]))},[t]);const y=oe().width<1e3?"wrap":"",[x]=h.useState({}),j=c("dash_product"),E=c("new_product");return(j||E)&&(!t&&j?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"product-dash",ref:W,children:[e.jsxs("div",{className:"error-panel "+(k?"open":""),children:[e.jsxs("div",{className:"type",children:["ERROR ",e.jsx("span",{onClick:()=>{D("")}})]}),e.jsx("div",{className:"message",children:k})]}),e.jsx(ge,{terme:"white",deteleKey:(t==null?void 0:t.id)||"noga",mode:E?"create":"delete",title:"Product Information",onCreate:()=>{n(x).then(g=>{if(!g)return s(["products","dash_product"]);g.length&&D(g==null?void 0:g.toString())})},onDelete:()=>{t&&l(t.id).then(g=>{g&&a(void 0)})}}),e.jsxs("section",{className:"editor "+y,children:[e.jsxs("div",{className:"editor-left",children:[e.jsxs("div",{className:"editor-name",children:[j&&e.jsx($,{isCheckRequired:u,label:"Product Id",value:(t==null?void 0:t.id)||""}),e.jsx("div",{className:"product-title",children:e.jsx($,{editable:!0,prompt:"Product Title",isCheckRequired:u,min:3,check:"auto",max:50,label:"Title",placeholder:"Product Title",value:j&&((t==null?void 0:t.title)||""),onChange:g=>{j?t&&r({product_id:t.id,title:g}):x.title=g}})}),e.jsx("div",{className:"product-description",children:e.jsx(ze,{editable:!0,prompt:"Product Description",isCheckRequired:u,min:3,check:"auto",max:250,label:"Description",placeholder:"Product Description",value:j&&((t==null?void 0:t.description)||""),onChange:g=>{j?t&&r({product_id:t.id,description:g}):x.description=g}})})]}),e.jsx("div",{className:"editor-price",children:e.jsx($,{type:"number",editable:!0,prompt:"Product Price",isCheckRequired:u,min:0,check:"auto",label:"Price",placeholder:"Product Price",value:j&&((t==null?void 0:t.price)||""),onChange:g=>{j?t&&r({product_id:t.id,price:g}):x.price=g}})}),e.jsx("div",{className:"editor-stock",children:e.jsx($,{type:"number",editable:!0,prompt:"Product Stock",isCheckRequired:u,max:1e10,check:"auto",label:"Stock",placeholder:"Product Stock",value:j&&((t==null?void 0:t.stock)||""),onChange:g=>{j?t&&r({product_id:t.id,stock:g}):x.stock=g}})}),j&&e.jsx(qe,{status:(t==null?void 0:t.status)||"PAUSE",onChange:g=>{j?t&&r({product_id:t.id,status:g}):x.status=g}}),e.jsx("div",{className:"editor-category",children:e.jsx(rs,{category_id:j&&(t==null?void 0:t.category_id),onChange:g=>{j?t&&r({product_id:t.id,category_id:g}):x.category_id=g}})}),e.jsx("div",{className:"editor-features",children:e.jsx(cs,{features:j&&((A=t==null?void 0:t.features)==null?void 0:A.list),onChange:g=>{x.features=g,console.log(x)}})})]}),e.jsxs("div",{className:"editor-right",children:[e.jsx("div",{className:"editor-images",children:e.jsx(we,{name:"images",images:j&&(t!=null&&t.images?t.images:[]),autosave:E,onSave:g=>{j?t&&r({product_id:t.id,images:g}):x.images=g}})}),e.jsx("div",{className:"editor-mmodel-images",children:e.jsx(we,{name:"model_images",images:j&&(t!=null&&t.images?t.model_images:[]),autosave:E,onSave:g=>{j?t&&r({product_id:t.id,model_images:g}):x.model_images=g}})}),j&&e.jsx("div",{className:"editor-scene-file",children:e.jsx(He,{file_name:t==null?void 0:t.scene_dir,ext:["zip"],label:"Upload Scene File",onChange:g=>{j?t&&r({product_id:t.id,scene_dir:g}):x.scene_dir=g}})})]})]}),j&&e.jsxs("div",{className:"product-dash-ctn",children:[e.jsxs("div",{className:"info",children:[e.jsx(Ne,{}),e.jsx(is,{})]}),e.jsx(Ve,{onClick:()=>{console.log("oo"),s(["products","dash_product","product_preview"])}})]}),j&&e.jsxs("div",{className:"orders",children:[e.jsxs("div",{className:"top",children:[e.jsx("h1",{className:"orders-title",children:"Recent Orders"}),e.jsx("h2",{className:"see-all",children:"SEE ALL"})]}),e.jsx("div",{className:"orders-ctn",children:m.map(g=>e.jsxs("div",{className:"order",children:[e.jsxs("div",{className:"id",children:["#",g.id.split("-")[0]]}),e.jsx("div",{className:"id",children:g.quantity}),e.jsx("div",{className:"date",children:g.updated_at.split("")}),e.jsxs("div",{className:"client",children:["userId: ",g.user_id.split("-")[0]]}),e.jsxs("div",{className:"price",children:[g.price," ","$"]}),e.jsx("div",{className:"status "+g.status.toLocaleLowerCase(),children:g.status})]},g.id))})]})]}))}function ds(){const{current:c}=M();return c("product_preview")&&e.jsx("div",{className:"product-preview"})}function us(){return null}const hs=[{label:"products",value:"23",url:"/src/res/package.png",path:["products"]},{label:"categories",value:"15",url:"/src/res/application.png",path:["categories"]},{label:"catalogs",value:"4",url:"/src/res/catalog.png",path:["catalogs"]},{label:"features",value:"78",url:"/src/res/jigsaw.png",path:["features"]}];function De({active:c,setActive:s}){const{storeVar:i}=H();return e.jsx("div",{className:"products-list-accessor",children:hs.map((t,a)=>e.jsxs("div",{className:"top-card "+(t.label==c?"active":""),onClick:()=>{s(t)},children:[e.jsx("h2",{className:"label",children:t.label.toUpperCase()}),e.jsx("h2",{className:"value",children:i==null?void 0:i[t.label]}),e.jsx("h2",{className:"icon",style:{backgroundImage:`url(${t.url})`}})]},a))})}function ms(){const{check:c,setAbsPath:s,current:i}=M();return e.jsx(e.Fragment,{children:c("products")&&e.jsxs("div",{className:"page-product",children:[i("products","dash_product","new_product")&&e.jsx(De,{active:"products",setActive:t=>s(t.path)}),e.jsx(ls,{}),e.jsx(as,{}),e.jsx(ds,{}),e.jsx(us,{})]})})}const de=se(c=>({clients:void 0,selectedClient:void 0,clientCommands:void 0,clientVisites:void 0,async setClientById(s){const i=de.getState().clients,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedClient:t}));else if(p.getState().store){const r=await de.getState().fetchClients({query:{user_id:s}});c(()=>({selectedClient:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await de.getState().fetchClients({query:{user_id:s}});c(()=>({selectedClient:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async fetchClientCommands(s){if(!(s!=null&&s.user_id))return;const i=await re.getState().fectProductCommands({...s});if(console.log(i),!(i!=null&&i.list))return c(()=>({clientCommands:void 0}));c(()=>({clientCommands:i}))},async fetchClientVisites({after_date:s,before_date:i,client_id:t,product_id:a,limit:r,page:n}){const l=p.getState().getHeaders();if(!l)return;const o={};o.store_id=l.store.id,o.product_id=a||"",o.client_id=t||"",o.limit=r||25,o.page=n||1,o.after_date=s||"",o.before_date=i||"",o.from_dash=!0;const d=new URLSearchParams({});for(const N in o){const k=o[N];d.set(N,k)}const m=await(await fetch(`${b}/get_client_visited/?${d.toString()}`,{headers:l.headers})).json();!m||!m.list||c(()=>({clientVisites:m}))},async setSelectedClient(s){c(()=>({selectedClient:s}))},async fetchClients(s){const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),s!=null&&s.query.text&&(t.text=s.query.text),s!=null&&s.query.user_id&&(t.user_id=s.query.user_id),s!=null&&s.query.phone&&(t.phone=s.query.phone),t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_store_clients/?${a.toString()}`,{headers:i.headers})).json();if(console.log("clients",n),!(!n||!n.list))return c(()=>({clients:n})),n},async banClient(){}}));function gs(){const{current:c,qs:s}=M(),{clients:i,setSelectedClient:t,fetchClients:a}=de(),{store:r}=p();return h.useEffect(()=>{c("clients")&&r&&a()},[r]),c("clients")&&e.jsx("div",{className:"client-list",ref:W,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:je(["PAUSE","TRASH","NEW"],[]),index:_e([0,100]),is_dynamic_price:ne(),hasScene:ne()}},items_height:80,id:"client_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(n,l,o,d){return S.ImageElement().getView(n,`${l[0].startsWith("/")?b:""}${l[0]}`,o,d)}},id:{getView(n,l,o,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},o.id)}},name:S.StringElement({size_interval:[50,200]}),status:{getView(n,l,o,d){return le.getView(n,"VISIBLE",o,d)}},created_at:S.DateStringElement({size:200})},onItemsSelected:(n,l)=>{l.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="")}),n.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="#00f2")}),t(n[0]),s({client_id:n[0].id}).setAbsPath(["clients","client_profile"])},onQuery:n=>{a(n)},top_height:40,canPaginate:!0})})})}function ps(){const{current:c,setAbsPath:s,json:i,qs:t}=M(),{selectedClient:a,setClientById:r,clientCommands:n,fetchClientVisites:l,fetchClientCommands:o,clientVisites:d}=de(),[u,m]=h.useState("commands"),[N]=h.useState(!1),D=oe().width<1e3?"wrap":"";return h.useEffect(()=>{i!=null&&i.client_id&&r(i==null?void 0:i.client_id)},[i]),h.useEffect(()=>{a&&o({limit:5,user_id:a.id}),a&&l({limit:5,client_id:a.id})},[a]),c("client_profile")&&(a?e.jsxs("div",{className:"client-profile",ref:W,children:[e.jsx("h1",{children:"Client Information"}),e.jsxs("section",{className:"editor "+D,children:[e.jsx("div",{className:"left-right",children:e.jsx(we,{name:"client_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx($,{isCheckRequired:N,label:"Client Id",value:(a==null?void 0:a.id)||""}),e.jsx($,{prompt:"Client Name",isCheckRequired:N,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx($,{prompt:"Client Email",isCheckRequired:N,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx($,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx($,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(Be,{user:a,channel:"sessions"})]})]}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{className:"btn "+(u=="commands"?"active":""),onClick:()=>{m("commands")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Commands"})]}),e.jsxs("div",{className:"btn "+(u=="visites"?"active":""),onClick:()=>{m("visites")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Visites"})]}),e.jsx("h2",{className:"see-all",onClick:()=>{u=="visites"?s(["products"]):s(["command"])},children:"SEE ALL"})]}),u=="commands"&&e.jsx(S,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(n==null?void 0:n.list)||[],itemsMapper:{images:{getView(C,y,x,j){return S.ImageElement().getView(C,`${b}${y[0]}`,x,j)}},id:{getView(C,y,x,j){return e.jsxs("div",{ref:j,children:["#",y.split("-")[0]]},x.id)}},stock:S.StringElement(),price:S.StringElement({size:200}),status:le,created_at:S.DateStringElement({size:200})},onItemsSelected:()=>{}}),u=="visites"&&e.jsx(S,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(d==null?void 0:d.list)||[],itemsMapper:{images:{getView(C,y,x,j){return S.ImageElement().getView(C,`${b}${y[0]}`,x,j)}},id:{getView(C,y,x,j){return e.jsxs("div",{ref:j,children:["#",y.split("-")[0]]},x.id)}},title:S.StringElement({size:200}),visited_at:S.DateStringElement({size:200})},onItemsSelected:C=>{t({product_id:C[0].id}).setAbsPath(["products","dash_product"])}})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function xs(){const{check:c,current:s,setAbsPath:i}=M();return c("clients")&&e.jsxs("div",{className:"client-page",children:[s("clients","client_profile")&&e.jsx($e,{active:"clients",setActive:t=>i(t.path)}),e.jsx(gs,{}),e.jsx(ps,{})]})}const Te="new_discussion";let be;const Ce=[],F=se(c=>({discussion:void 0,discussions:void 0,messages:void 0,setDiscussion(s){c(()=>({discussion:s}))},async setDiscussionByOtherId({other_id:s,for_moderator:i,findOther:t}){var d,u;const a=p.getState().getHeaders();if(!a)return;const r=(d=F.getState().discussions)==null?void 0:d.list,n=r==null?void 0:r.find(m=>m.other.id==s&&(i?!ae(a.store.id,m):!!ae(a.store.id,m)));if(n){const m=await G.getState().fetchMessages(n.id,"discussions");c(()=>({discussion:n,messages:m}));return}const l=(u=await F.getState().fetchDiscussions({no_save:!0,other_id:s,for_moderator:i}))==null?void 0:u.list[0];if(console.log("exist Discussion",l,i),l){const m=await G.getState().fetchMessages(l.id,"discussions");c(()=>({discussion:l,messages:m}));return}const o=await t(s,!!i);o&&F.getState().addDiscussion({other:o,for_moderator:i})},async openDiscussionMessages(s){const i=await G.getState().fetchMessages(s,"discussions");c(()=>({messages:i}))},async unBlockDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/unblock_discussion/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();return console.log("unblock_discussion ",a),a!=null&&a.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(n=>n.id==a.id?{...n,...a}:n)}})),a):void 0}catch(a){console.log(a)}},async blockDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/block_discussion/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();return console.log("unblock_discussion ",a),a!=null&&a.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(n=>n.id==a.id?{...n,...a}:n)}})),a):void 0}catch(a){console.log(a)}},async deleteDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/delete_discussion/${s.id}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("deleteDiscussion ",a),a!=null&&a.deleted?(c(({discussions:r,messages:n,discussion:l})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).filter(o=>o.id!==s.id)},messages:(l==null?void 0:l.id)==s.id?void 0:n})),!0):void 0}catch(a){console.log(a)}},async createDiscussion({other_id:s,for_moderator:i}){const t=p.getState().getHeaders();if(!t)return;const a=new FormData;a.append("receiver_id",s),a.append("from_id",t.store.id),!i&&a.append("to_id",t.store.id);const r=await fetch(`${b}/create_discussion`,{headers:t.headers,body:a,method:"POST"});try{const n=await r.json();return console.log("createDiscussion",n),n!=null&&n.id?n:void 0}catch(n){console.log(n)}},async addDiscussion({other:s,for_moderator:i}){var o,d;const t=p.getState().getHeaders();if(!t||s.id==t.user.id)return;const a=(o=F.getState().discussions)==null?void 0:o.list,r=a==null?void 0:a.find(u=>u.other.id==s.id&&(i?!ae(t.store.id,u):!!ae(t.store.id,u)));if(console.log("addDiscussion",{exist:r}),r){const u=await G.getState().fetchMessages(r.id,"discussions");return c(()=>({discussion:r,messages:u})),r}const n=(d=F.getState().discussions)==null?void 0:d.list.filter(u=>u.id.startsWith(Te)?(u.receiver_id==s.id||u.creator_id==s.id)&&(i?!ae(void 0,u):!!ae(void 0,u)):!1);if(n!=null&&n[0]){console.log("@@@@@@@@@@@@@@@@@@@@@@@"),c(({discussions:u})=>({discussions:u&&{...u}}));return}const l={id:Te+Date.now(),creator_id:t.user.id,receiver_id:s.id,deleted:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s,from_id:t.store.id,to_id:i?void 0:t.store.id,last_message:void 0,other_att:"creator"};return c(({discussions:u})=>({messages:{list:[],limit:25,page:1,total:0},discussion:l,discussions:u&&{...u,list:[l,...u.list]}})),console.log("NEW DISCUSSION",l),l},async fetchDiscussions({discussion_id:s,no_save:i,other_id:t}){const a=p.getState().getHeaders();if(!a)return;const r=new URLSearchParams({});r.set("from_id",a.store.id),s&&r.set("discussion_id",s),t&&r.set("other_id",t);const l=await(await fetch(`${b}/get_discussions?${r}`,{headers:a.headers})).json();if(console.log("fetch Discussions",l),!l)return;be=c,l.list.forEach(async d=>{We(d)});const o=`${a.user.id}/${a.store.id}`;if(!Ce.includes(o)){Ce.push(o);const d=Pe.subscription(o);await d.create(),d.onMessage(async u=>{var m;if(u.new_discussion){console.log("new_discussion ==>  ",u.new_discussion),We(u.new_discussion);const N=u.new_discussion,k=N.receiver.id!=a.user.id?"receiver":"creator";N.other_att=k,N.other=N[k];const D=(m=F.getState().discussions)==null?void 0:m.list.filter(C=>C.id.startsWith(Te)?!(C.other.id==N.other.id&&(C.from_id||null)==(N.from_id||null)&&(C.to_id||null)==(N.to_id||null)):!0);c(({discussions:C})=>({discussions:C&&{...C,list:[N,...D||[]]}}))}u.reload_discussion&&(console.log("reload_discussion ==>  "),F.getState().fetchDiscussions({}))})}return i||c(({discussions:d})=>({discussions:{...l,list:[...((d==null?void 0:d.list)||[]).filter(u=>u.id.startsWith("new_")),...l.list]}})),l}}));async function We(c){if(!p.getState().getHeaders()||Ce.includes(c.id))return;Ce.push(c.id);const i=Pe.subscription(c.id);await i.create(),i.onMessage(async t=>{var r,n;if(!be)return;const a=F.getState().discussion;if(t.reload){const l=(r=F.getState().discussions)==null?void 0:r.list,o=(n=await F.getState().fetchDiscussions({discussion_id:c.id,no_save:!0}))==null?void 0:n.list;if(console.log("reload Discussion ___________ ",o==null?void 0:o.length),!(o!=null&&o[0].id))return;const d=[...(l==null?void 0:l.map(u=>u.id==c.id?o==null?void 0:o[0]:u))||[]];be(({discussions:u})=>({discussions:u&&{...u,list:d}})),(a==null?void 0:a.id)==(o==null?void 0:o[0].id)&&be(()=>({discussion:{...o==null?void 0:o[0]}}))}if(t.reloadMessage&&(a==null?void 0:a.id)==c.id){console.log("reload Message___________",a);const l=await G.getState().fetchMessages(c.id,"discussions");be(()=>({messages:l,discussion:{...c}}))}})}const vs="new_discussion",fs="new_session",G=se(c=>({async fetchEditMessage(s){const i=p.getState().getHeaders();if(!i)return;const t=new FormData;t.append("message_id",s.message_id),t.append("text",s.text);const a=await fetch(`${b}/edit_message`,{method:"PUT",headers:i.headers,body:t});try{const r=await a.json();return console.log("edit_message ",r),r!=null&&r.id?r:void 0}catch(r){console.log(r)}},async fetchDeleteMessageBoth(s){const i=p.getState().getHeaders();if(!i)return;console.log("$$$$$$$$");const t=await fetch(`${b}/delete_message/${s}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("fetchDeleteMessageBoth",a),a==null?void 0:a.deleted}catch(a){console.log(a)}},async fetchDeleteMessageMe(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/delete_message/${s}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("fetchDeleteMessageMe",a),a==null?void 0:a.deleted}catch(a){console.log(a)}},async fetchSendMessage({context:s,context_name:i,files:t,text:a}){if(!s||!s.id)return;if(s.id.startsWith(vs)){const o=await F.getState().createDiscussion({other_id:s.other.id,for_moderator:s.to_id==null});if(console.log("D"),!o||!o.id)return;s=o,F.getState().setDiscussion(o)}else if(s.id.startsWith(fs)){const o=await X.getState().fetchCreateSession(s.other.id,a||"");if(console.log("S",o),!o)return;s=o,X.getState().setSession(o)}const r=p.getState().getHeaders();if(!r)return;const n=new FormData;if(!a&&!t)return;if(t)for(let o=0;o<t.length;o++){const d=t[o];n.append("files_"+o,d)}if(n.append("context_id",s.id),n.append("context_name",i),a&&n.append("text",a),t)for(let o=0;o<t.length;++o){const d=t[o];n.append("files_"+o,d)}const l=await fetch(`${b}/send_message`,{headers:r.headers,body:n,method:"POST"});try{const o=await l.json();return console.log("fetchSendMessage",o),o!=null&&o.id?o:void 0}catch(o){console.log(o)}},async fetchMessages(s,i){if(s.toLowerCase().startsWith("new_"))return;const t=p.getState().getHeaders();if(!t)return;const a=await fetch(`${b}/get_messages/?context_id=${s}&context_name=${i}`,{headers:t.headers});try{const r=await a.json();return r!=null&&r.list?r:void 0}catch{}}})),js="new_session";let ye;const Ee=[],X=se(c=>({session:void 0,sessions:void 0,messages:void 0,setSession(s){c(()=>({session:s}))},async setSessionByClientId(s){setTimeout(async()=>{var a,r;const i=X.getState().sessions,t=i==null?void 0:i.find(n=>n.other.id==s);if(console.log("current Session",s,t),t){const n=await G.getState().fetchMessages(t.id,"sessions");c(()=>({session:t,messages:n}))}else{const n=p.getState().getHeaders();if(!n)return;const o=(await(await fetch(`${b}/get_sessions?collaborator_id=${s}&store_id=${n.store.id}`,{headers:n.headers})).json())[0];if(console.log("exist Session",o),o){const d=await G.getState().fetchMessages(o.id,"sessions");c(()=>({session:o,messages:d}))}else{const d=((a=de.getState().clients)==null?void 0:a.list.find(u=>u.id==s))||((r=await de.getState().fetchClients({query:{user_id:s}}))==null?void 0:r.list[0]);console.log("collabo",d),d&&X.getState().addSession(d)}}})},async openSessionMessages(s){const i=await G.getState().fetchMessages(s,"sessions");c(()=>({messages:i}))},async openSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/open_session/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();if(console.log("open_session ",a),!(a!=null&&a.id))return}catch(a){console.log(a)}},async closeSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/close_session/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();if(console.log("close_session ",a),!(a!=null&&a.id))return}catch(a){console.log(a)}},async asReadSession(s){},async deleteSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/delete_session/${s.id}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();if(console.log("deleteSession",a),!a.deleted)return;c(()=>({session:void 0})),X.getState().fetchSessions()}catch(a){console.log(a)}},async fetchCreateSession(s,i){if(!i)return;const t=p.getState().getHeaders();if(!t)return;const a=new FormData;a.append("receiver_id",s),a.append("store_id",t.store.id),a.append("title",i);const r=await fetch(`${b}/create_session`,{headers:t.headers,body:a,method:"POST"});try{const n=await r.json();return console.log("fetchCreateSession",n),n!=null&&n.id?(X.getState().fetchSessions(),c(()=>({session:n})),n):void 0}catch(n){console.log(n)}},async addSession(s){var r;const i=(r=X.getState().sessions)==null?void 0:r.find(n=>n.other.id==s.id);if(i){c(()=>({session:i}));const n=await G.getState().fetchMessages(i.id,"sessions");return c(()=>({messages:n}))}const t=p.getState().user;if(!t)return;const a={id:js+Date.now(),creator_id:t.id,title:"",receiver_id:s.id,deleted:"",other_att:"creator",closed:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s};c(({sessions:n})=>({messages:{list:[],limit:25,page:1,total:0},session:a,sessions:[...n||[],a]}))},async fetchSessions(s="all"){const i=p.getState().getHeaders();if(!i)return;console.log(i.store.id);const a=await(await fetch(`${b}/get_sessions?store_id=${i.store.id}&open=${s}`,{headers:i.headers})).json();if(console.log("session",a),!!Array.isArray(a)&&(ye=c,a.forEach(async r=>{Ke(r)}),c(()=>({sessions:a})),!Ee.includes(i.user.id))){Ee.push(i.user.id);const r=Pe.subscription(i.user.id);await r.create(),r.onMessage(async n=>{var l;if(n.new_session){Ke(n.new_session);const o=n.new_session,d=o.receiver.id!=i.user.id?"receiver":"creator";o.other_att=d,o.other=o[d];const u=(l=X.getState().sessions)==null?void 0:l.filter(m=>m.id!=(o==null?void 0:o.id));c(()=>({sessions:[...u||[],o]}))}n.reload_session&&X.getState().fetchSessions()})}}}));async function Ke(c){const s=p.getState().getHeaders();if(!s||Ee.includes(c.id))return;Ee.push(c.id);const i=Pe.subscription(c.id);await i.create(),i.onMessage(async t=>{if(!ye)return;console.log("data_session",t);const a=X.getState().session;if(t.reload){const r=X.getState().sessions,l=await(await fetch(`${b}/get_sessions?session_id=${c.id}&store_id=${s.store.id}&blocked=all`,{headers:s.headers})).json();if(console.log("reload Session ___________ ",l.length),!(l!=null&&l[0]))return;const o=[...(r==null?void 0:r.map(d=>d.id==c.id?l==null?void 0:l[0]:d))||[]];ye(()=>({sessions:o})),(a==null?void 0:a.id)==(l==null?void 0:l[0].id)&&ye(()=>({session:{...l==null?void 0:l[0]}}))}if(t.reloadMessage&&(a==null?void 0:a.id)==c.id){console.log("reload Message___________",a);const r=await G.getState().fetchMessages(c.id,"sessions");ye(()=>({messages:r,session:{...c}}))}})}function _s({}){var z;const{openChild:c}=H(),{json:s,qs:i,pathList:t,setAbsPath:a}=M(),r=(z=t[3])==null?void 0:z.split("_")[1],[n,l]=h.useState(r||"opened"),{addSession:o,asReadSession:d,closeSession:u,openSession:m,deleteSession:N,fetchSessions:k,session:D,sessions:C,setSessionByClientId:y}=X(),{user:x,store:j}=p(),{fetchClients:E}=de();if(h.useEffect(()=>{j&&k()},[j]),h.useEffect(()=>{s!=null&&s.client_id&&y(s==null?void 0:s.client_id)},[s]),h.useEffect(()=>{l(r||"opened")},[t]),h.useEffect(()=>{var v;(v=D==null?void 0:D.closed)!=null&&v.includes((x==null?void 0:x.id)||"")&&l("closed")},[D]),!x)return;const A=C==null?void 0:C.filter(v=>{var _;return!((_=v.closed)!=null&&_.includes(x.id))}),g=C==null?void 0:C.filter(v=>{var _;return(_=v.closed)==null?void 0:_.includes(x.id)}),I=C==null?void 0:C.filter(v=>v.unchecked_count>0);let B=[];return n=="opened"?B=A:n=="closed"?B=g:B=I,e.jsxs("div",{className:"session-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Sessions "}),e.jsxs("div",{className:"add-new",onClick:()=>{c(e.jsx(Je,{user:x,openChild:c,fetchUsers:E,setUser:v=>{o(v)}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{a(["chat","sessions","sessions_opened"])},children:e.jsxs("div",{className:n=="opened"?"active":"",children:["Open",((A==null?void 0:A.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{a(["chat","sessions","sessions_closed"])},children:e.jsxs("div",{className:n=="closed"?"active":"",children:["Closed ",((g==null?void 0:g.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{a(["chat","sessions","sessions_new"])},children:e.jsxs("div",{className:n=="new"?"active":"",children:["New  ",((I==null?void 0:I.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"sessions",children:B==null?void 0:B.map(v=>{var T,P;let _="";return((T=v.last_message)==null?void 0:T.user_id)==x.id&&(v[`${v.other_att}_opened_at`]?new Date(v[`${v.other_att}_opened_at`])<new Date(((P=v.last_message)==null?void 0:P.created_at)||"")?_="one":_="double":_="one"),e.jsxs("div",{className:"session "+((D==null?void 0:D.id)==v.id?"active":""),onClick:L=>{console.log(v.other,x),i({client_id:v.other.id}).setAbsPath(["chat","sessions"]);const w=L.currentTarget.querySelector(".count");w.style.display="none"},onContextMenu:L=>{L.preventDefault(),c(e.jsx(Ns,{closed:!!(g!=null&&g.includes(v)),x:L.clientX,y:L.clientY,onClose:w=>{w?(u(v),l("closed")):(m(v),l("opened"))},onAsRead:()=>{d(v)},onDelete:()=>{N(v)}}))},children:[e.jsx("div",{className:"photo",style:{background:ke(v.other.photos[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:Z(v.other.name,16)}),e.jsx("div",{className:"date",children:v.last_message&&fe(v.last_message.created_at)})]}),e.jsx("i",{className:"center-ctn",children:Z(v.title,20)}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+_}),e.jsx("div",{className:"text",children:v.last_message?Z(v.last_message.text,24):"New Session"}),e.jsx("div",{className:"count",style:{display:(D==null?void 0:D.id)==v.id?"none":v.unchecked_count>0?"flex":"none"},children:v.unchecked_count})]})]})]},v.id)})})]})}function Ns({x:c,y:s,onClose:i,onAsRead:t,onDelete:a,closed:r}){const n=h.useRef(null);return h.useEffect(()=>{n.current&&me(n.current)}),e.jsxs("div",{ref:n,className:"discussion-popu",style:{top:`${s}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>i(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Open":"Close"})]}),e.jsxs("div",{className:"delete",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}const ce=se(c=>({collaborators:void 0,selectedCollaborator:void 0,async updateCollaborator(s){},async change_collaborator_role(s){var r;const i=p.getState().getHeaders();if(!i)return;s.store_id=(r=p.getState().store)==null?void 0:r.id;const t=new FormData,a=[];["store_id","new_role_id","collaborator_id"].forEach(n=>{if(s[n]!=null)t.append(n,s[n]||"");else return a.push(n+" is not defined")});{const l=await(await fetch(`${b}/change_collaborator_role`,{method:"PUT",body:t,headers:i.headers})).json();if(!l||!l.id)return a.push("Server Error, Try Later"),a}},async addCollaborator(s){console.log(s);const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;s.store_id=i.id;const a=new FormData,r=[];["store_id","role_id","email"].forEach(l=>{if(s[l]!=null)a.append(l,s[l]);else return r.push(l+" is not defined")});const n=new Headers;n.append("Authorization",`Bearer ${t.token}`);{const o=await(await fetch(`${b}/add_collaborator`,{method:"POST",body:a,headers:n})).json();if(!o||!o.id)return r.push("Server Error, Try Later"),r;c(()=>({selectedCollaborator:o})),H.getState().fetchUsersVar(),M.getState().setAbsPath(["collaborators","collaborator_profile"])}},async setSelectedCollaborator(s){c(()=>({selectedCollaborator:s}))},async setCollaboratorById(s){const i=ce.getState().collaborators,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCollaborator:t}));else if(p.getState().store){const r=await ce.getState().fetchCollaborators({query:{user_id:s}});c(()=>({selectedCollaborator:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ce.getState().fetchCollaborators({query:{user_id:s}});c(()=>({selectedCollaborator:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCollaborator(s){let i=p.getState().getHeaders();if(!i)return;const t=new FormData;t.append("store_id",i.store.id),t.append("collaborator_id",s);const a={method:"DELETE",headers:i.headers,body:t},n=await(await fetch(`${b}/remove_collaborator`,a)).json();H.getState().fetchUsersVar(),n.deleted&&c(()=>({selectedCollaborator:void 0}))},async fetchCollaborators(s){var l,o,d,u,m,N,k;let i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=(o=s.query)==null?void 0:o.text),(d=s==null?void 0:s.query)!=null&&d.user_id&&(t.user_id=(u=s.query)==null?void 0:u.user_id),(m=s==null?void 0:s.query)!=null&&m.phone&&(t.phone=(N=s.query)==null?void 0:N.phone),t.store_id=(k=i.store)==null?void 0:k.id;const a=new URLSearchParams({});for(const D in t){const C=t[D];a.set(D,C)}const n=await(await fetch(`${b}/get_store_collaborators/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({collaborators:n})),n},async banCollaborator(s){}})),he=se(c=>({moderators:void 0,selectedModerator:void 0,moderatorCommands:void 0,moderatorVisites:void 0,async setModeratorById(s){const i=he.getState().moderators,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedModerator:t}));else{const a=await he.getState().fetchModerators({query:{user_id:s}});c(()=>({selectedModerator:a==null?void 0:a.list.find(r=>r.id==s)}))}},async setSelectedModerator(s){c(()=>({selectedModerator:s}))},async fetchModerators(s){var l,o,d;const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=s.query.text),(o=s==null?void 0:s.query)!=null&&o.user_id&&(t.user_id=s.query.user_id),(d=s==null?void 0:s.query)!=null&&d.phone&&(t.phone=s.query.phone),t.store_id=i.store.id;const a=new URLSearchParams({});for(const u in t){const m=t[u];a.set(u,m)}const n=await(await fetch(`${b}/get_moderators/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({moderators:n})),n},async banModerator(){}}));function Ae(){var v;const{discussion:c,discussions:s,fetchDiscussions:i,addDiscussion:t,blockDiscussion:a,deleteDiscussion:r,unBlockDiscussion:n,setDiscussionByOtherId:l}=F(),{json:o,pathList:d,qs:u,setAbsPath:m}=M(),N=(v=d[3])==null?void 0:v.split("_")[1],[k,D]=h.useState(N||"all"),{openChild:C}=H(),{user:y,store:x}=p(),{fetchCollaborators:j}=ce(),{fetchModerators:E}=he();if(h.useEffect(()=>{(o!=null&&o.collaborator_id||o!=null&&o.moderator_id)&&l({other_id:(o==null?void 0:o.collaborator_id)||(o==null?void 0:o.moderator_id),for_moderator:!!(o!=null&&o.moderator_id),async findOther(_,T){var P,L,w,R;return T?((P=he.getState().moderators)==null?void 0:P.list.find(V=>V.id==_))||((L=await he.getState().fetchModerators({query:{user_id:_}}))==null?void 0:L.list[0]):((w=ce.getState().collaborators)==null?void 0:w.list.find(V=>V.id==_))||((R=await ce.getState().fetchCollaborators({query:{user_id:_}}))==null?void 0:R.list[0])}}),x&&i({}),D(N||"all")},[o,x]),h.useEffect(()=>{D(N||"all")},[d]),!y)return;const A=s==null?void 0:s.list.filter(_=>{var T;return!((T=_.blocked)!=null&&T.includes(y.id))&&!!ae((x==null?void 0:x.id)||"",_)}),g=s==null?void 0:s.list.filter(_=>{var T;return(T=_.blocked)==null?void 0:T.includes(y.id)}),I=s==null?void 0:s.list.filter(_=>_.unchecked_count>0),B=s==null?void 0:s.list.filter(_=>!ae((x==null?void 0:x.id)||"",_));let z=[];return k=="admin"?z=B:k=="new"?z=I:k=="blocked"?z=g:z=A,e.jsxs("div",{className:"discussion-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Chats "}),e.jsxs("div",{className:"add-new",onClick:()=>{C(e.jsx(Je,{fetchUsers:j,openChild:C,user:y,setUser:(_,T)=>{console.log({discMode:T}),t({other:_,for_moderator:T=="moderators"}),T=="moderators"&&m(["chat","discussions","discussions_admin"])},selector:{list:[{name:"collaborators",fetch:j},{name:"moderators",fetch:E}]}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{u(o||{}).setAbsPath(["chat","discussions","discussions_all"])},children:e.jsxs("div",{className:k=="all"?"active":"",children:["All",((A==null?void 0:A.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{u(o||{}).setAbsPath(["chat","discussions","discussions_new"])},children:e.jsxs("div",{className:k=="new"?"active":"",children:["New ",((I==null?void 0:I.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{u(o||{}).setAbsPath(["chat","discussions","discussions_blocked"])},children:e.jsxs("div",{className:k=="blocked"?"active":"",children:["Blocked  ",((g==null?void 0:g.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{u(o||{}).setAbsPath(["chat","discussions","discussions_admin"])},children:e.jsxs("div",{className:k=="admin"?"active":"",children:["Admin  ",((B==null?void 0:B.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"discussions",children:z==null?void 0:z.map(_=>{var P;let T="";return((P=_.last_message)==null?void 0:P.user_id)==y.id&&(_[`${_.other_att}_opened_at`]?new Date(_[`${_.other_att}_opened_at`])<new Date(_.last_message.created_at)?T="one":T="double":T="one"),e.jsxs("div",{className:"discussion "+((c==null?void 0:c.id)==_.id?"active":""),onClick:L=>{_.unchecked_count=0,x&&u({[ae(x.id,_)?"collaborator_id":"moderator_id"]:_.other.id}).setAbsPath(["chat","discussions","discussions_"+(k||"_all")]);const w=L.currentTarget.querySelector(".count");w.style.display="none"},onContextMenu:L=>{L.preventDefault(),C(e.jsx(Ss,{canBlock:!!ae(x==null?void 0:x.id,_),blocked:!!(g!=null&&g.includes(_)),x:L.clientX,y:L.clientY,onBlock:w=>{w?(a(_),u(o||{}).setAbsPath(["chat","discussions","discussions_blocked"])):(n(_),u(o||{}).setAbsPath(["chat","discussions","discussions_all"]))},onAsRead:()=>{},onDelete:()=>{r(_)}}))},children:[e.jsx("div",{className:"photo",style:{background:ke(_.other.photos[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:Z(_.other.name,16)}),e.jsx("div",{className:"date",children:_.last_message&&fe(_.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+T}),e.jsx("div",{className:"text",children:_.last_message?Z(_.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(c==null?void 0:c.id)==_.id?"none":_.unchecked_count>0?"flex":"none"},children:_.unchecked_count})]})]})]},_.id)})})]})}function Ss({x:c,y:s,onBlock:i,onAsRead:t,onDelete:a,blocked:r,canBlock:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&me(l.current)}),e.jsxs("div",{ref:l,className:"discussion-popu",style:{top:`${s}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),n&&e.jsxs("div",{className:"block",onClick:()=>i(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function Ie(){var L;const{discussion:c,messages:s}=F(),{fetchSendMessage:i,fetchDeleteMessageBoth:t,fetchDeleteMessageMe:a,fetchEditMessage:r}=G(),{user:n}=p(),{openChild:l}=H(),{qs:o,json:d}=M(),[u,m]=h.useState(!1),[N,k]=h.useState(1),[D,C]=h.useState(!1),y=h.useRef(null),x=h.useRef(null),[j,E]=h.useState(null),[A]=h.useState(Date.now()+""),[g,I]=h.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),B=oe(),z=()=>{if(!x.current)return;const w=x.current,R=Math.ceil(w.scrollHeight/(w.getBoundingClientRect().height||20)),V=Math.ceil(w.scrollHeight/20),K=w.value.split(`
`).length;let Q=Math.max(R,K,V);Q=Q>10?10:Q-1>=1?Q-1:1,k(Q)};h.useEffect(()=>{z()},[B]),h.useEffect(()=>{window.addEventListener("click",()=>{D&&C(!1)})},[]);const v=c==null?void 0:c.other.photos[0],_=(w,R)=>w.list[R].user_id==(n==null?void 0:n.id)?"right":"left",T=(w,R)=>w.list[R-1]&&w.list[R-1].user_id==(n==null?void 0:n.id)?"right":"left",P=(w,R)=>w.list[R+1]&&(w.list[R+1].user_id==(n==null?void 0:n.id)?"right":"left");return c?n&&e.jsxs("div",{className:"discussion-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${v!=null&&v.startsWith("/")?b:""}${v})`},onClick:()=>{d!=null&&d.moderator_id?o({moderator_id:c.other.id}).setAbsPath(["moderators","moderator_profile"]):o({collaborator_id:c.other.id}).setAbsPath(["collaborators","collaborator_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:Z(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",fe(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:Y()})})]}),e.jsx("div",{className:"messages",ref:w=>{y.current=w,u||(y.current&&y.current.scrollTo({top:y.current.scrollHeight}),m(!0))},onScroll:w=>{const R=w.currentTarget;clearInterval(g.lastid);const V=setTimeout(()=>{const K={isOpen:!1,height:R.scrollHeight,bottom:R.scrollHeight-(R.scrollTop+R.getBoundingClientRect().height),top:R.scrollTop,onProcess:!1,lastid:V};K.bottom>150&&(K.isOpen=!0),I(K),console.log(V)},100);g.lastid=V},children:(L=s==null?void 0:s.list)==null?void 0:L.map((w,R)=>{var Se;const V=_(s,R),K=T(s,R),Q=P(s,R);let pe="";return V==K?Q&&K==Q&&(pe="mid"):Q&&V==Q&&(pe="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+V+" "+pe,onContextMenu:f=>{f.preventDefault(),l(e.jsx(bs,{forMe:n.id==w.user_id,x:f.clientX,y:f.clientY,onDeleteBoth:()=>{t(w.id)},onDeleteMe:()=>{a(w.id)},onEdit:()=>{l(e.jsx(ys,{x:f.clientX,y:f.clientY,text:w.text,onEdit:q=>{l(void 0),r({message_id:w.id,text:q})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:w.text&&w.text.split(" ").map((f,q)=>f.includes(`
`)?f.split(`
`).map((O,J)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:O}),e.jsx("br",{})]},q+"_"+J)):e.jsx("span",{style:{marginRight:"4px"},children:f},q))}),e.jsx("div",{className:"files",children:(Se=w.files)==null?void 0:Se.map(f=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${f.startsWith("/")?b:""}${f}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:f.length>35?Z(f,25)+f.substring(f.length-8,f.length):f})]},f))}),e.jsxs("div",{className:"info",children:[w.created_at!=w.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:fe(w.created_at)})]})]})},w.id)})}),e.jsxs("div",{className:"sender",children:[g.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{y.current&&y.current.scrollTo({behavior:"smooth",top:g.height})}}),D&&e.jsx("div",{className:"emoji-list",onClick:w=>{w.preventDefault(),w.stopPropagation()},children:Ge.map(w=>e.jsx("span",{onClick:R=>{R.preventDefault(),R.stopPropagation(),x.current&&(x.current.value+=w.char)},children:w.char},w.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:A+"message_file",onChange:w=>{if(!w.currentTarget.files)return;const R=[];for(let V=0;V<w.currentTarget.files.length;V++){const K=w.currentTarget.files[V];R.push(K)}E(R.length>0?j?[...j,...R]:R:null)}}),e.jsx("label",{htmlFor:A+"message_file",className:"add-file",onClick:Y()}),e.jsx("div",{className:"emoji-min",onClick:w=>{w.preventDefault(),w.stopPropagation(),Y()(w),C(!D)}})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",children:j&&j.map(w=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{j&&E(j.filter(R=>R!==w))}}),e.jsx("div",{className:"text",children:w.name})]},w.name))}),e.jsx("textarea",{autoFocus:!0,ref:x,name:"discussion_sender",placeholder:"Type a message here..",id:"discussion_sender",style:{height:`${N*20}px`},cols:30,rows:10,onChange:w=>{z()},onKeyDown:()=>{C(!1)}})]}),e.jsx("div",{className:"right",children:e.jsx("div",{className:"send",onClick:w=>{var R;Y()(w),i({context:c,context_name:"discussions",files:j,text:(R=x.current)==null?void 0:R.value}),E(null),x.current&&(x.current.value="")},children:e.jsx("div",{className:"icon"})})})]})]})]}):e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})})}function bs({x:c,y:s,onEdit:i,onDeleteBoth:t,onDeleteMe:a,other:r,forMe:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&me(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${c}px`},children:[n&&e.jsxs("div",{className:"edit",onClick:o=>{o.preventDefault(),o.stopPropagation(),i()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),n&&e.jsxs("div",{className:"delete-both",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function ys({x:c,y:s,onEdit:i,text:t}){const a=h.useRef(null),[r,n]=h.useState(t);return h.useEffect(()=>{a.current&&me(a.current)}),e.jsxs("div",{ref:a,className:"message-edit-popu",style:{top:`${s}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{n(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{i(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}const Me=250,Le=c=>c.split(" ").map((s,i)=>s.includes(`
`)?s.split(`
`).map((t,a)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:t}),e.jsx("br",{})]},i+"_"+a)):e.jsx("span",{style:{marginRight:"4px"},children:s},i));function ws(){var V,K,Q,pe,Se;const{session:c,messages:s,fetchCreateSession:i}=X(),{fetchSendMessage:t,fetchDeleteMessageBoth:a,fetchDeleteMessageMe:r,fetchEditMessage:n}=G(),{user:l}=p(),{openChild:o}=H(),{qs:d}=M(),[u,m]=h.useState(!1),[N,k]=h.useState(1),[D,C]=h.useState(!1),y=h.useRef(null),x=h.useRef(null),[j,E]=h.useState(""),[A,g]=h.useState(null),[I]=h.useState(Date.now()+""),[B,z]=h.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),v=oe(),_=()=>{if(!x.current)return;const f=x.current,q=Math.ceil(f.scrollHeight/(f.getBoundingClientRect().height||20)),O=Math.ceil(f.scrollHeight/20),J=f.value.split(`
`).length;let te=Math.max(q,J,O);te=te>10?10:te-1>=1?te-1:1,k(te)};h.useEffect(()=>{_()},[v]),h.useEffect(()=>{window.addEventListener("click",()=>{C(!1)})},[]);const T=c==null?void 0:c.other.photos[0],P=(f,q)=>f.list[q].user_id==(l==null?void 0:l.id)?"right":"left",L=(f,q)=>f.list[q-1]&&f.list[q-1].user_id==(l==null?void 0:l.id)?"right":"left",w=(f,q)=>f.list[q+1]&&(f.list[q+1].user_id==(l==null?void 0:l.id)?"right":"left"),R=!(c!=null&&c.title);return c?l&&e.jsxs("div",{className:"session-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${T!=null&&T.startsWith("/")?b:""}${T})`},onClick:()=>{d({client_id:c.other.id}).setAbsPath(["clients","client_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:Z(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",fe(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:Y()})})]}),e.jsxs("div",{className:"top-title",onClick:f=>{o(e.jsx(Es,{x:f.clientX,y:f.clientY,text:c.title}))},children:[e.jsx("div",{className:"ctn-title",children:e.jsx("div",{className:"text-title",children:Z(c.title,50)})}),e.jsxs("div",{className:"option",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${l.photos[0].startsWith("/")?b:""}${l.photos[0]})`}}),e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${c.other.photos[0].startsWith("/")?b:""}${c.other.photos[0]})`}}),e.jsx("div",{className:"status",onClick:Y(),children:(V=c.closed)!=null&&V.includes(l.id)&&((K=c.closed)!=null&&K.includes(c.other.id))||(Q=c.closed)!=null&&Q.includes(l.id)?"Closed":((pe=c.closed)!=null&&pe.includes(c.other.id),"Open")})]})]}),R&&e.jsx("div",{className:"title",children:e.jsxs("div",{className:"ctn",children:[e.jsx("h1",{className:"label",children:"New Session Title"}),e.jsx("div",{className:"text",children:Le(j)})]})}),e.jsx("div",{className:"messages",style:{display:R?"none":""},ref:f=>{y.current=f,u||(y.current&&y.current.scrollTo({top:y.current.scrollHeight}),m(!0))},onScroll:f=>{const q=f.currentTarget;clearInterval(B.lastid);const O=setTimeout(()=>{const J={isOpen:!1,height:q.scrollHeight,bottom:q.scrollHeight-(q.scrollTop+q.getBoundingClientRect().height),top:q.scrollTop,onProcess:!1,lastid:O};J.bottom>150&&(J.isOpen=!0),z(J)},100);B.lastid=O},children:(Se=s==null?void 0:s.list)==null?void 0:Se.map((f,q)=>{var Ue;const O=P(s,q),J=L(s,q),te=w(s,q);let Re="";return O==J?te&&J==te&&(Re="mid"):te&&O==te&&(Re="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+O+" "+Re,onContextMenu:U=>{U.preventDefault(),o(e.jsx(Cs,{forMe:l.id==f.user_id,x:U.clientX,y:U.clientY,onDeleteBoth:()=>{a(f.id)},onDeleteMe:()=>{r(f.id)},onEdit:()=>{o(e.jsx(ks,{x:U.clientX,y:U.clientY,text:f.text,onEdit:Ze=>{o(void 0),n({message_id:f.id,text:Ze})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:f.text&&Le(f.text)}),e.jsx("div",{className:"files",children:(Ue=f.files)==null?void 0:Ue.map(U=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${U.startsWith("/")?b:""}${U}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:U.length>35?Z(U,25)+U.substring(U.length-8,U.length):U})]},U))}),e.jsxs("div",{className:"info",children:[f.created_at!=f.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:fe(f.created_at)})]})]})},f.id)})}),e.jsxs("div",{className:"sender",children:[B.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{y.current&&y.current.scrollTo({behavior:"smooth",top:B.height})}}),D&&e.jsx("div",{className:"emoji-list",onClick:f=>{f.preventDefault(),f.stopPropagation()},children:Ge.map(f=>e.jsx("span",{onClick:q=>{q.preventDefault(),q.stopPropagation(),E(j+f.char)},children:f.char},f.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[!R&&e.jsxs(e.Fragment,{children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:I+"message_file",onChange:f=>{if(!f.currentTarget.files)return;const q=[];for(let O=0;O<f.currentTarget.files.length;O++){const J=f.currentTarget.files[O];q.push(J)}g(q.length>0?A?[...A,...q]:q:null)}}),e.jsx("label",{htmlFor:I+"message_file",className:"add-file",onClick:Y()})]})," ",R&&e.jsxs("div",{className:"text-length",children:[j.length,R?"/"+Me:""]})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",style:{display:R?"none":""},children:A&&A.map(f=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{A&&g(A.filter(q=>q!==f))}}),e.jsx("div",{className:"text",children:f.name})]},f.name))}),e.jsx("textarea",{autoFocus:!0,ref:x,value:j,name:"session_sender",placeholder:"Type a message here..",id:"session_sender",style:{height:`${N*20}px`},cols:30,rows:10,onChange:f=>{_(),E(R&&f.currentTarget.value.length>Me?f.currentTarget.value.substring(0,Me):f.currentTarget.value)},onKeyDown:()=>{C(!1)}})]}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"emoji",onClick:f=>{f.preventDefault(),f.stopPropagation(),Y()(f),C(!D)}}),e.jsx("div",{className:"send",onClick:f=>{Y()(f),R?i(c.other.id,j):t({context:c,context_name:"sessions",files:A,text:j}),g(null),E("")},children:e.jsx("div",{className:"icon"})})]})]})]})]}):e.jsx("div",{className:"no-session",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})})}function Cs({x:c,y:s,onEdit:i,onDeleteBoth:t,onDeleteMe:a,other:r,forMe:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&me(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${c}px`},children:[n&&e.jsxs("div",{className:"edit",onClick:o=>{o.preventDefault(),o.stopPropagation(),i()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),n&&e.jsxs("div",{className:"delete-both",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function Es({x:c,y:s,text:i}){const t=h.useRef(null);return h.useEffect(()=>{t.current&&me(t.current)}),e.jsx("p",{ref:t,className:"title-popup",style:{top:`${s}px`,left:`${c}px`},children:Le(i||"")})}function ks({x:c,y:s,onEdit:i,text:t}){const a=h.useRef(null),[r,n]=h.useState(t);return h.useEffect(()=>{a.current&&me(a.current)}),e.jsxs("div",{ref:a,className:"message-edit-popu",style:{top:`${s}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{n(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{i(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}function $s(){const{check:c,setAbsPath:s,pathList:i}=M(),{user:t}=p(),[a,r]=h.useState((i==null?void 0:i[2])||"discussions"),[n,l]=h.useState("max");h.useEffect(()=>{r(i[2]||"discussions")},[i]);const o={discussions:e.jsx(Ae,{}),groups:e.jsx(Ae,{}),sessions:e.jsx(_s,{}),surveys:e.jsx(Ae,{})},d={discussions:e.jsx(Ie,{}),groups:e.jsx(Ie,{}),sessions:e.jsx(ws,{}),surveys:e.jsx(Ie,{})};return c("chat")&&t&&e.jsxs("div",{className:"page-chat",children:[e.jsx("div",{className:"back-close nav",style:{display:n=="min"?"none":""},onClick:u=>{u.currentTarget==u.target&&l("min")}}),e.jsxs("div",{className:"chat-nav "+n,children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"nav-size "+n,onClick:u=>{Y(.4)(u),l(n=="min"?"max":"min")}}),e.jsx("div",{className:"icon discussions-icon "+(a=="discussions"?"active":""),onClick:u=>{Y(.4)(u),s(["chat","discussions"]),r("discussions")}}),e.jsx("div",{className:"icon sessions "+(a=="sessions"?"active":""),onClick:u=>{Y(.4)(u),s(["chat","sessions"]),r("sessions")}}),e.jsx("div",{className:"icon profile",style:{background:`no-repeat center/cover url(${t.photos[0].startsWith("/")?b:""}${t.photos[0]})`},onClick:()=>{s(["profile"]),r("profile")}})]}),n=="max"&&e.jsx("div",{className:"nav-ctn",children:o[a]})]}),e.jsx("div",{className:"chat-center",children:d[a]})]})}function Ps(){return e.jsx("div",{className:"page-interface"})}function Ds(){const{current:c,setAbsPath:s,qs:i}=M(),{fetchCategories:t,categories:a,setSelectedCategory:r}=ue(),{store:n}=p();return h.useEffect(()=>{c("categories")&&n&&t()},[n]),c("categories")&&e.jsx("div",{className:"category-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","label","description","catalog_id","index","status","created_at","total_products"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{index:_e([0,100]),status:je(["PAUSE","TRASH","NEW"],[]),total_products:ee([0,1e3],[0,1e3])}},items_height:80,id:"category_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},label:S.StringElement({size_interval:[50,200]}),status:le,total_products:{getView(l,o,d,u){return S.StringElement().getView(l,o||0,d,u)}},catalog_id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},created_at:S.DateStringElement({size:500})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),r(l[0]),i({category_id:l[0].id}).setAbsPath(["categories","dash_categories"])},onQuery:l=>{t(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["categories","new_category"])}})})})}const ve=se(c=>({catalogs:void 0,selectedCatalog:void 0,catalogProducts:void 0,catalogCategories:void 0,async setCatalogById(s){const i=ve.getState().catalogs,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCatalog:t}));else if(p.getState().store){const r=await ve.getState().fetchCatalogs({query:{user_id:s}});c(()=>({selectedCatalog:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ve.getState().fetchCatalogs({query:{user_id:s}});c(()=>({selectedCatalog:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCatalog(s){const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${b}/delete_catalog/${s}`,{method:"DELETE",headers:i.headers})).json();return H.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createCatalog(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0,s.store_id=i.store.id;const t=new FormData,a=[];if(["label","description","store_id","index"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),console.log(a,s),a.length==0){const n=await(await fetch(`${b}/create_catalog`,{method:"POST",body:t,headers:i.headers})).json();if(!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedCatalog:n})),H.getState().fetchStoreVar()}else return a},async fetchCatalogCategories(s){if(!(s!=null&&s.catalog_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.catalog_id=s.catalog_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_categories/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({catalogCategories:n}))}catch(t){return console.warn(t.message)}},async fetchCatalogProducts(s){if(!(s!=null&&s.catalog_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.catalog_id=s.catalog_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({catalogProducts:n}))}catch(t){return console.warn(t.message)}},async updateCatalog(s){if(!s.catalog_id)return;const i=p.getState().getHeaders();if(!i)return;let t=!1;const a=new FormData;a.append("catalog_id",s.catalog_id),["label","index","status","description"].forEach(n=>{s[n]&&(a.append(n,s[n]),t=!0)});let r=null;if(t&&(r=await fetch(`${b}/update_catalog`,{method:"PUT",body:a,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("catalog_id",s.catalog_id),r=await fetch(`${b}/update_view_catalog`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),c(()=>({catalogProducts:r})))},setSelectedCatalog(s){c(()=>({selectedCatalog:s}))},async fetchCatalogs(s){const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_catalogs/?${a.toString()}`,{headers:i.headers})).json();return!n||!n.list?void 0:(c(()=>({catalogs:n})),n)}catch(t){console.warn(t.message);return}}}));function Rs({onChange:c,catalog_id:s}){const{fetchCatalogs:i,catalogs:t}=ve(),[a,r]=h.useState(),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(t==null?void 0:t.list.find(o=>o.id==s))},[t]),e.jsxs("div",{className:"choise-catalog",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Catalog"}),e.jsx("div",{className:"name",children:(a==null?void 0:a.label)||"Select Catalog"})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-catalog "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+((a==null?void 0:a.id)==o.id?"selected":""),onClick:()=>{r(o),c==null||c(o.id)},children:[e.jsx("div",{className:"label",children:o.label}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}function Ts(){const{current:c,setAbsPath:s,json:i}=M(),{selectedCategory:t,setSelectedCategory:a,setCategoryById:r,fetchCategoryProducts:n,categoryProducts:l,updateCategory:o,createCategory:d,removeCategory:u}=ue(),[m]=h.useState({}),{setSelectedProduct:N}=re(),[k]=h.useState(!1),C=oe().width<1e3?"wrap":"";h.useEffect(()=>{t&&n({category_id:t.id})},[t]),h.useEffect(()=>{i!=null&&i.category_id&&r(i==null?void 0:i.category_id)},[i]);const y=c("dash_categories"),x=c("new_category"),j=e.jsxs(e.Fragment,{children:[y&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{status:(t==null?void 0:t.status)||"PAUSE",onChange:E=>{y?t&&o({category_id:t.id,status:E}):m.status=E}}),e.jsx("div",{className:"editor-scene-file",children:e.jsx(He,{file_name:t==null?void 0:t.scene_dir,ext:["zip"],label:"Upload Scene File",onChange:E=>{y?t&&o({category_id:t.id,scene_dir:E}):m.scene_dir=E}})})]}),e.jsx("div",{className:"editor-category",children:e.jsx(Rs,{catalog_id:y&&(t==null?void 0:t.catalog_id),onChange:E=>{y?t&&o({category_id:t.id,catalog_id:E}):m.catalog_id=E}})})]});return(y||x)&&(!t&&y?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"category-dash",ref:W,children:[e.jsx(ge,{terme:"white",deteleKey:(t==null?void 0:t.id)||"noga",mode:x?"create":"delete",title:"Category Information",onCreate:()=>{d(m).then(E=>{if(!E)return s(["categories","dash_categories"])})},onDelete:()=>{u(t==null?void 0:t.id).then(E=>{E&&a(void 0)})}}),e.jsxs("section",{className:"editor "+C,children:[e.jsxs("div",{className:"left-side",children:[y&&e.jsx($,{isCheckRequired:k,label:"Category Id",value:(t==null?void 0:t.id)||""}),e.jsx("div",{className:"category-title",children:e.jsx($,{editable:!0,prompt:"Category Label",isCheckRequired:k,min:3,check:"auto",max:50,label:"Label",placeholder:"Catalog Label",value:y&&((t==null?void 0:t.label)||""),onChange:E=>{y?o({category_id:t==null?void 0:t.id,label:E}):m.label=E}})}),e.jsx("div",{className:"category-description",children:e.jsx(ze,{editable:!0,prompt:"Category Description",isCheckRequired:k,min:3,check:"auto",max:250,label:"Description",placeholder:"Catalog Description",value:y&&((t==null?void 0:t.description)||""),onChange:E=>{y?o({category_id:t==null?void 0:t.id,description:E}):m.description=E}})}),y&&j]}),e.jsxs("div",{className:"right-side",children:[y&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),e.jsx(Ve,{onClick:()=>{},direction:"horizontal"})]}),x&&j]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{className:"",children:"Products That Use This Category"}),e.jsx("h2",{className:"see-all",onClick:()=>{s(["products"])},children:"SEE ALL"})]}),e.jsx(S,{filter:{sortBy:"id",limit:(l==null?void 0:l.limit)||25,page:l==null?void 0:l.page,total:l==null?void 0:l.total},disableFilterBar:!0,items_height:80,id:"product-use-cattegory_list",datas:(l==null?void 0:l.list)||[],itemsMapper:{images:{getView(E,A,g,I){return S.ImageElement().getView(E,`${b}${A[0]}`,g,I)}},id:{getView(E,A,g,I){return e.jsxs("div",{ref:I,children:["#",A.split("-")[0]]},g.id)}},title:S.StringElement({size_interval:[50,200]}),status:S.StringElement({size:150}),stock:S.StringElement(),category_id:{getView(E,A,g,I){return e.jsxs("div",{ref:I,children:["#",A.split("-")[0]]},g.id)}},price:S.StringElement({size:200}),created_at:S.DateStringElement({size:200})},onItemsSelected:E=>{N(E[0]),s(["products","dash_product"])}})]})]}))}function As(){const{check:c,setAbsPath:s,current:i}=M();return c("categories")&&e.jsxs("div",{className:"page-categories",children:[(i("categories")||i("new_category")||i("dash_categories"))&&e.jsx(De,{active:"categories",setActive:t=>s(t.path)}),e.jsx(Ds,{}),e.jsx(Ts,{})]})}function Is(){const{current:c,setAbsPath:s,qs:i}=M(),{store:t}=p(),{features:a,fetchFeatures:r,setSelectedFeature:n}=xe();return h.useEffect(()=>{c("features")&&t&&r()},[t]),c("features")&&e.jsx("div",{className:"features-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","collect_type","icon","name","created_at"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{}},items_height:80,id:"category_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},name:S.StringElement({size_interval:[50,200]}),collect_type:S.StringElement({size:150}),icon:{getView(l,o,d,u){let m=null;return d.onResize(l,N=>{m&&(m.style.width=`${Math.min(N.height,N.width)*.9}px`,m.style.height=`${Math.min(N.height,N.width)*.9}px`)}),e.jsx("div",{ref:u,children:e.jsx("div",{className:"image-element",ref:N=>m=N,style:{background:ke(o[0]||"","40%")}})},l)}},created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),n(l[0]),i({feature_id:l[0].id}).setAbsPath(["features","dash_features"])},onQuery:l=>{console.log("query",l),r(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["features","new_feature"])}})})})}function Qe({onChange:c,list:s,canEdit:i,select:t,color:a}){const[r,n]=h.useState(t||"");return e.jsx("div",{className:"choise-status",children:e.jsx("div",{className:"ctn",children:s.map(l=>e.jsx("div",{className:"one-choise "+l.toLocaleLowerCase()+" "+(r==l?"active":""),style:{background:r==l&&a||""},onClick:()=>{i&&n(r==l?"":l),i&&(c==null||c(r==l?"":l))},children:l},l))})})}function Ms(){var x;const{current:c,setAbsPath:s,json:i}=M(),{user:t}=p(),{selectedFeature:a,createFeature:r,fetchProductsUseFeature:n,productsUseFeature:l,setSelectedFeature:o,removeFeature:d,setFeatureById:u}=xe(),[m]=h.useState({}),N=c("new_feature"),k=c("dash_features"),[D]=h.useState({url:(x=a==null?void 0:a.icon)==null?void 0:x[0]}),y=oe().width<1e3?"wrap":"";return m.prduct_id=a==null?void 0:a.id,h.useEffect(()=>{a&&n(a.id)},[a]),h.useEffect(()=>{k&&(i!=null&&i.feature_id)&&t&&u(i.feature_id)},[t,i]),(k||N)&&(!a&&k?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"dash-feature",ref:W,children:[e.jsx(ge,{deteleKey:(a==null?void 0:a.id)||"noga",mode:N?"create":"delete",title:"Product Information",onCreate:()=>{r(m).then(j=>{if(!j)return s(["products","dash_product"])})},onDelete:()=>{a&&d(a.id).then(j=>{j&&o(void 0)})}}),e.jsxs("section",{className:"editor "+y,children:[e.jsxs("div",{className:"left-side",children:[k&&e.jsx($,{label:"Feature Id",value:(a==null?void 0:a.id)||""}),e.jsx($,{editable:!0,label:"Name",value:(a==null?void 0:a.name)||""}),e.jsx("label",{htmlFor:"choise_feature_icon",className:"choise_icon",children:e.jsxs("div",{className:"ctn",children:[e.jsx("input",{type:"file",name:"choise_feature_icon",id:"choise_feature_icon",onChange:j=>{}}),e.jsx("div",{className:"icon",style:{background:ke((a==null?void 0:a.icon[0])||"")}}),e.jsxs("div",{className:"text",children:[e.jsxs("span",{className:"title",children:[a!=null&&a.icon?"Change":"Choise"," Icon"]}),e.jsx("span",{className:"url",children:Z(D.url||"",20)})]})]})}),e.jsx($,{editable:!0,label:"Collected type",value:(a==null?void 0:a.collect_type)||""}),e.jsx(Qe,{canEdit:!0,list:["Required"],onChange:j=>{console.log(j)}}),e.jsx($,{editable:!0,label:"Placeholder",value:(a==null?void 0:a.placeholder)||""}),e.jsx($,{editable:!0,label:"Default",value:"TODO DEFAULT"}),e.jsx(Qe,{canEdit:!0,select:a!=null&&a.capitalize?"Capitalize":a!=null&&a.lowercase?"Lowercase":a!=null&&a.uppercase?"Uppercase":"",list:["Capitalise","Uppercase","LowerCase"],onChange:j=>{console.log(j)}}),e.jsx($,{editable:!0,label:"Macth RegExp",value:(a==null?void 0:a.match)||""}),e.jsx($,{editable:!0,label:"Min Length",type:"number",value:(a==null?void 0:a.min_length)||""}),e.jsx($,{editable:!0,label:"Max Length",type:"number",value:(a==null?void 0:a.max_length)||""}),e.jsx($,{editable:!0,label:"Min Value",type:"number",value:(a==null?void 0:a.min)||""}),e.jsx($,{editable:!0,label:"Max Value",type:"number",value:(a==null?void 0:a.max)||""}),e.jsx($,{editable:!0,label:"Max File Size",type:"number",value:(a==null?void 0:a.max_size)||""}),e.jsx($,{editable:!0,label:"Files Type",value:(a==null?void 0:a.ext)||""}),e.jsx($,{editable:!0,label:"Enumeration of possible values",value:(a==null?void 0:a.id)||""}),e.jsx("div",{className:"editor-name"})]}),e.jsx("div",{className:"right-side",children:e.jsx(Ne,{})})]}),e.jsx("h1",{className:"",children:"Feature's Products"}),e.jsx(S,{filter:{sortBy:"id",limit:(l==null?void 0:l.limit)||25,page:l==null?void 0:l.page,total:l==null?void 0:l.total},disableFilterBar:!0,items_height:80,id:"product-use-Feature_list",datas:(l==null?void 0:l.list)||[],itemsMapper:{images:{getView(j,E,A,g){return S.ImageElement().getView(j,`${b}${E[0]}`,A,g)}},id:{getView(j,E,A,g){return e.jsxs("div",{ref:g,children:["#",E.split("-")[0]]},A.id)}},title:S.StringElement({size_interval:[50,200]}),status:S.StringElement({size:150}),stock:S.StringElement(),category_id:{getView(j,E,A,g){return e.jsxs("div",{ref:g,children:["#",E.split("-")[0]]},A.id)}},price:S.StringElement({size:200}),created_at:S.DateStringElement({size:200})}})]}))}function Ls(){const{check:c,setAbsPath:s,current:i}=M();return c("features")&&e.jsxs("div",{className:"page-features",children:[(i("features")||i("dash_features")||i("new_feature"))&&e.jsx(De,{active:"features",setActive:t=>s(t.path)}),e.jsx(Is,{}),e.jsx(Ms,{})]})}function qs(){const{current:c,setAbsPath:s,qs:i}=M(),{catalogs:t,fetchCatalogs:a,setSelectedCatalog:r}=ve(),{store:n}=p();return h.useEffect(()=>{c("catalogs")&&n&&a()},[n]),c("catalogs")&&e.jsx("div",{className:"catalog-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","label","description","index","status","created_at"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{}},items_height:80,id:"category_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},label:S.StringElement({size_interval:[50,200]}),total_product:{getView(l,o,d,u){return S.StringElement().getView(l,o||0,d,u)}},description:S.StringElement({size_interval:[50,200]}),status:le,created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),r(l[0]),i({catalog_id:l[0].id}).setAbsPath(["catalogs","dash_catalogs"])},onQuery:l=>{a(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["catalogs","new_catalog"])}})})})}function Bs(){const{json:c,current:s,setAbsPath:i}=M(),{setCatalogById:t,selectedCatalog:a,catalogCategories:r,fetchCatalogCategories:n,updateCatalog:l,catalogProducts:o,setSelectedCatalog:d,removeCatalog:u,fetchCatalogProducts:m,createCatalog:N}=ve(),{setSelectedProduct:k}=re(),{setSelectedCategory:D}=ue(),[C]=h.useState({}),{store:y}=p(),[x,j]=h.useState("products"),[E]=h.useState(!1),g=oe().width<1e3?"wrap":"";h.useEffect(()=>{a&&(m({catalog_id:a.id}),n({catalog_id:a.id}))},[a]);const I=s("dash_catalogs"),B=s("new_catalog");h.useEffect(()=>{c!=null&&c.catalog_id&&t(c==null?void 0:c.catalog_id)},[c]);const z=e.jsx(e.Fragment,{children:I&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{status:(a==null?void 0:a.status)||"PAUSE",onChange:v=>{I?a&&l({catalog_id:a.id,status:v}):C.status=v}})," ",e.jsx(He,{file_name:I?a==null?void 0:a.scene_dir:void 0,ext:["zip"],label:"Upload Scene File",onChange:v=>{I?a&&l({catalog_id:a.id,scene_dir:v}):C.scene_dir=v}})]})});return console.log({selectedCatalog:a}),(I||B)&&(!a&&I?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"catalog-dash",ref:W,children:[e.jsx(ge,{terme:"dark",deteleKey:(a==null?void 0:a.id)||"noga",mode:B?"create":"delete",title:"Catalog Information",onCreate:()=>{N(C).then(v=>{if(!v)return i(["catalogs","dash_catalogs"])})},onDelete:()=>{a&&u(a.id).then(v=>{v&&d(void 0)})}}),e.jsxs("section",{className:"editor "+g,children:[e.jsxs("div",{className:"left-side",children:[I&&e.jsx($,{isCheckRequired:E,label:"Catalog Id",value:(a==null?void 0:a.id)||""}),e.jsxs("div",{className:"editor-name",children:[e.jsx("div",{className:"catalog-title",children:e.jsx($,{editable:!0,prompt:"Catalog Label",isCheckRequired:E,min:3,check:"auto",max:50,label:"Label",placeholder:"Catalog Label",value:I&&((a==null?void 0:a.label)||""),onChange:v=>{I?a&&l({catalog_id:a.id,label:v}):C.label=v}})}),e.jsx("div",{className:"Catalog-description",children:e.jsx(ze,{editable:!0,prompt:"Catalog Description",isCheckRequired:E,min:3,check:"auto",max:250,label:"Description",placeholder:"Catalog Description",value:I&&((a==null?void 0:a.description)||""),onChange:v=>{I?a&&l({catalog_id:a.id,description:v}):C.description=v}})})]}),I&&z]}),e.jsxs("div",{className:"right-side",children:[I&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),e.jsx(Ve,{onClick:()=>{},direction:"horizontal"})]}),B&&e.jsxs(e.Fragment,{children:[e.jsx($,{isCheckRequired:E,label:"Store Name",value:(y==null?void 0:y.name)||""}),e.jsx($,{isCheckRequired:E,label:"Store Id",value:(y==null?void 0:y.id)||""})]})]})]}),I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{className:"btn "+(x=="products"?"active":""),onClick:()=>{j("products")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Products"})]}),e.jsxs("div",{className:"btn "+(x=="categories"?"active":""),onClick:()=>{j("categories")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Categories"})]}),e.jsx("h2",{className:"see-all",onClick:()=>{x=="products"?i(["products"]):i(["categories"])},children:"SEE ALL"})]}),x=="products"&&e.jsx(S,{filter:{sortBy:"id",limit:(o==null?void 0:o.limit)||25,page:o==null?void 0:o.page,total:o==null?void 0:o.total},disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(o==null?void 0:o.list)||[],itemsMapper:{images:{getView(v,_,T,P){return S.ImageElement().getView(v,`${b}${_[0]}`,T,P)}},id:{getView(v,_,T,P){return e.jsxs("div",{ref:P,children:["#",_.split("-")[0]]},T.id)}},title:S.StringElement({size_interval:[50,200]}),stock:S.StringElement(),category_id:{getView(v,_,T,P){return e.jsxs("div",{ref:P,children:["#",_.split("-")[0]]},T.id)}},price:S.StringElement({size:200}),status:le,created_at:S.DateStringElement({size:200})},onItemsSelected:v=>{k(v[0]),i(["products","dash_product"])}}),x=="categories"&&e.jsx(S,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(r==null?void 0:r.list)||[],itemsMapper:{id:{getView(v,_,T,P){return e.jsxs("div",{ref:P,children:["#",_.split("-")[0]]},T.id)}},label:S.StringElement({size_interval:[50,200]}),total_products:{getView(v,_,T,P){return S.StringElement().getView(v,_||0,T,P)}},catalog_id:{getView(v,_,T,P){return e.jsxs("div",{ref:P,children:["#",_.split("-")[0]]},T.id)}},status:le,created_at:S.DateStringElement({size:500})},onItemsSelected:v=>{console.log(v[0],"))))))))))))))"),D(v[0]),i(["categories","dash_categories"])}})]})]}))}function zs(){const{check:c,setAbsPath:s,current:i}=M();return c("catalogs")&&e.jsxs("div",{className:"page-catalogs",children:[(i("catalogs")||i("new_catalog")||i("dash_catalogs"))&&e.jsx(De,{active:"catalogs",setActive:t=>s(t.path)}),e.jsx(Bs,{}),e.jsx(qs,{})]})}function Vs(){const c=localStorage.getItem("store_name"),{getAccess:s,openAuth:i}=p();return i&&e.jsx("div",{className:"page-auth",children:e.jsxs("div",{className:"auth-ctn",children:[e.jsx("div",{className:"image"}),e.jsxs("div",{className:"form",children:[e.jsxs("h1",{className:"auth-title",children:[c==null?void 0:c.toUpperCase()," DASHBOARD"]}),e.jsxs("h5",{className:"auth-prompt",children:["Read more ?"," ",e.jsx("span",{onClick:()=>{},children:"Click here"})]}),e.jsxs("div",{className:"google",onClick:()=>{s()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Connexion"})]}),e.jsx("p",{children:"Google connexion is required to get access to sublymus Dash board service."})]})]})})}function Hs(){const{current:c,qs:s}=M(),{moderators:i,setSelectedModerator:t,fetchModerators:a}=he(),{store:r}=p();return h.useEffect(()=>{c("moderators")&&r&&a()},[r]),c("moderators")&&e.jsx("div",{className:"moderator-list",ref:W,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:je(["PAUSE","TRASH","NEW"],[]),index:_e([0,100]),is_dynamic_price:ne(),hasScene:ne()}},items_height:80,id:"moderator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(n,l,o,d){return S.ImageElement().getView(n,`${l[0].startsWith("/")?b:""}${l[0]}`,o,d)}},id:{getView(n,l,o,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},o.id)}},name:S.StringElement({size_interval:[50,200]}),status:{getView(n,l,o,d){return le.getView(n,"VISIBLE",o,d)}},created_at:S.DateStringElement({size:200})},onItemsSelected:(n,l)=>{l.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="")}),n.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="#00f2")}),t(n[0]),s({moderator_id:n[0].id}).setAbsPath(["moderators","moderator_profile"])},onQuery:n=>{a(n)},top_height:40,canPaginate:!0})})})}function Us(){const{current:c,json:s}=M(),{user:i}=p(),{selectedModerator:t,setModeratorById:a}=he(),{store:r}=p(),[n]=h.useState(!1),o=oe().width<1e3?"wrap":"";return h.useEffect(()=>{c("moderator_profile")&&(s!=null&&s.moderator_id)&&r&&a(s.moderator_id)},[s,r]),c("moderator_profile")&&(t?e.jsxs("div",{className:"moderator-profile",ref:W,children:[e.jsx("h1",{children:"Moderator Information"}),e.jsxs("section",{className:"editor "+o,children:[e.jsx("div",{className:"left-right",children:e.jsx(we,{name:"moderator_profile",images:t.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx($,{isCheckRequired:n,label:"Moderator Id",value:(t==null?void 0:t.id)||""}),e.jsx($,{prompt:"Moderator Name",isCheckRequired:n,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:t==null?void 0:t.name}),e.jsx($,{prompt:"Moderator Email",isCheckRequired:n,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:t==null?void 0:t.email}),e.jsx($,{label:"created At",value:t==null?void 0:t.created_at}),e.jsx($,{label:"Join Store At",value:t==null?void 0:t.join_at}),i&&t.id!=i.id&&e.jsx(Be,{user:t,channel:"discussions_admin"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Os(){const{check:c,current:s,setAbsPath:i}=M();return c("moderators")&&e.jsxs("div",{className:"moderator-page",children:[s("moderators","moderator_profile")&&e.jsx($e,{active:"moderators",setActive:t=>i(t.path)}),e.jsx(Hs,{}),e.jsx(Us,{})]})}const ie=se(c=>({json_roles:void 0,roles:void 0,selectedRole:void 0,async setSelectedRole(s){c(()=>({selectedRole:s}))},async setRoleById(s){const i=ie.getState().roles,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedRole:t}));else if(p.getState().store){const r=await ie.getState().fetchRoles({role_id:s});c(()=>({selectedRole:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ie.getState().fetchRoles({role_id:s});c(()=>({selectedRole:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async newRole(s){var o;if(!s.name)return console.log("Name required");if(!s.options||s.options.length==0)return console.log("Option Is required");const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new FormData;a.append("name",s.name),a.append("store_id",i.id),(o=s.options)==null||o.forEach(d=>{a.append(d,"1")});const r=new Headers;r.append("Authorization",`Bearer ${t.token}`);const l=await(await fetch(`${b}/create_collaborator_role`,{method:"POST",body:a,headers:r})).json();!l||!l.id||(console.log("new role",l),c(()=>({selectedRole:l})),H.getState().fetchUsersVar(),M.getState().setAbsPath(["roles","edit_role"]))},async updateRole(s){var d,u;console.log("data",s);const i=ie.getState().selectedRole;if(!i)return;if(!s.name&&!s.options)return console.log("data",s);if(!p.getState().store)return;let a=p.getState().user;if(!a)return;const r=new FormData;r.append("role_id",i.id),s.name&&r.append("name",s.name),((d=s.options)==null?void 0:d.length)>0&&r.append("newOptions","ok"),(u=s.options)==null||u.forEach(m=>{r.append(m,"1")});const n=new Headers;n.append("Authorization",`Bearer ${a.token}`);const o=await(await fetch(`${b}/update_role`,{method:"PUT",body:r,headers:n})).json();!o||!o.id||c(()=>({selectedRole:o}))},async deleteRole(s){console.log(s);const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new Headers;a.append("Authorization",`Bearer ${t.token}`);const r=new FormData;r.append("store_id",i.id),r.append("role_id",s);const n={method:"DELETE",headers:a,body:r};(await(await fetch(`${b}/delete_role`,n)).json()).deleted&&c(()=>({selectedRole:void 0})),H.getState().fetchUsersVar()},async fetchRolesJson(){const i=await(await fetch(`${b}/get_roles_json`)).json();i&&c(()=>({json_roles:i}))},async fetchRoles(s={}){const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new Headers;a.append("Authorization",`Bearer ${t.token}`);const r={method:"GET",headers:a};s.store_id=i.id;const n=new URLSearchParams({});for(const d in s){const u=s[d];n.set(d,u)}const o=await(await fetch(`${b}/get_store_roles/?${n.toString()}`,r)).json();if(console.log("roles",o),!(!o||!o.list))return c(()=>({roles:o})),o}}));function Fs(){const{current:c,setAbsPath:s,qs:i}=M(),{roles:t,setSelectedRole:a,fetchRoles:r}=ie(),{store:n}=p();return h.useEffect(()=>{c("roles")&&n&&r()},[n]),c("roles")&&e.jsx("div",{className:"collaborator-list",ref:W,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:je(["PAUSE","TRASH","NEW"],[]),index:_e([0,100]),is_dynamic_price:ne(),hasScene:ne()}},items_height:80,id:"collaborator_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},name:S.StringElement({size_interval:[50,200]}),created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),a(l[0]),i({role_id:l[0].id}).setAbsPath(["roles","edit_role"])},onQuery:l=>{r(l)},canAddNew:!0,onNewRequired:()=>{s(["roles","create_role"])},top_height:40,canPaginate:!0})})})}function Ws(){const{selectedRole:c,setRoleById:s,updateRole:i,newRole:t,deleteRole:a,json_roles:r}=ie(),{current:n,json:l}=M(),[o]=h.useState({}),d=n("edit_role"),u=n("create_role");return h.useEffect(()=>{l!=null&&l.role_id&&s(l==null?void 0:l.role_id)},[l]),(d||u)&&(!c&&d?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"role-dash",ref:W,children:[e.jsx(ge,{title:"Role Information",mode:d?"delete":"create",deteleKey:c==null?void 0:c.id,onDelete:()=>{c&&a(c.id)},onCreate:()=>{t(o)}}),e.jsxs("section",{className:"editor",children:[e.jsxs("div",{className:"left-side",children:[e.jsx($,{min:3,max:25,placeholder:"Role Name",prompt:"Role Name",editable:!0,label:"Name",value:d?c==null?void 0:c.name:"",onChange:m=>{d?i({name:m}):o.name=m}}),d&&e.jsxs(e.Fragment,{children:[e.jsx($,{label:"Id",value:c==null?void 0:c.id}),e.jsx($,{label:"Created At",value:c==null?void 0:c.created_at}),e.jsx($,{label:"Update At",value:c==null?void 0:c.updated_at}),e.jsx(Ne,{})]})]}),e.jsx("div",{className:"right-side",children:e.jsx(ts,{role:c,json_roles:r,isNew:u,onChange:m=>{d?i({options:m}):o.options=m}})})]})]}))}function Ks(){const{check:c,current:s,setAbsPath:i}=M();return c("roles")&&e.jsxs("div",{className:"role-page",children:[s("roles","edit_role")&&e.jsx($e,{active:"roles",setActive:t=>i(t.path)}),e.jsx(Fs,{}),e.jsx(Ws,{})]})}function Qs(){const{current:c,setAbsPath:s,qs:i}=M(),{collaborators:t,setSelectedCollaborator:a,fetchCollaborators:r}=ce(),{store:n}=p(),{roles:l}=ie();return h.useEffect(()=>{c("collaborators")&&n&&r()},[n]),c("collaborators")&&e.jsx("div",{className:"collaborator-list",ref:W,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:je(["PAUSE","TRASH","NEW"],[]),index:_e([0,100]),is_dynamic_price:ne(),hasScene:ne()}},items_height:80,id:"collaborator_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{photos:{getView(o,d,u,m){return S.ImageElement().getView(o,`${d[0].startsWith("/")?b:""}${d[0]}`,u,m)}},id:{getView(o,d,u,m){return e.jsxs("div",{ref:m,children:["#",d.split("-")[0]]},u.id)}},name:S.StringElement({size_interval:[50,200]}),email:S.StringElement({size:200}),status:le,role_id:{getView(o,d,u,m){var N;return e.jsx("div",{ref:m,children:(N=l==null?void 0:l.list.find(k=>k.id==d))==null?void 0:N.name},u.id)}},join_at:S.DateStringElement({size:150}),created_at:S.DateStringElement({size:150})},onItemsSelected:(o,d)=>{d.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="")}),o.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="#00f2")}),a(o[0]),i({collaborator_id:o[0].id}).setAbsPath(["collaborators","collaborator_profile"])},onQuery:o=>{r(o)},canAddNew:!0,onNewRequired:()=>{s(["collaborators","new_collaborator"])},top_height:40,canPaginate:!0})})})}const Xs=["PAUSE","VISIBLE","NEW"];function Js({onChange:c,status:s,canEdit:i}){const[t,a]=h.useState(s);return e.jsx("div",{className:"choise-status",children:e.jsx("div",{className:"ctn",children:Xs.map(r=>e.jsx("div",{className:"use-status "+r.toLocaleLowerCase()+" "+(t==r?"active":""),onClick:()=>{i&&a(r),i&&(c==null||c(r))},children:r},r))})})}function Ys(){const{current:c,json:s}=M(),{selectedCollaborator:i,setCollaboratorById:t,removeCollaborator:a,updateCollaborator:r,change_collaborator_role:n}=ce(),[l]=h.useState(!1),{roles:o,fetchRoles:d}=ie(),m=oe().width<1e3?"wrap":"",{store:N,user:k}=p();return h.useEffect(()=>{s!=null&&s.collaborator_id&&t(s==null?void 0:s.collaborator_id)},[s]),h.useEffect(()=>{d({})},[k]),console.log({roles:o}),c("collaborator_profile")&&(i?e.jsxs("div",{className:"collaborator-profile",ref:W,children:[e.jsx(ge,{title:"Collaborator Information",mode:"delete",deteleKey:i.id,onDelete:()=>{console.log(i.id),a(i.id)}}),e.jsxs("section",{className:"editor "+m,children:[e.jsxs("div",{className:"left-right",children:[e.jsx(we,{name:"collaborator_profile",images:i.photos||[],cannotEdit:!0}),e.jsx($,{label:"Name",value:i==null?void 0:i.name}),e.jsx($,{label:"Email",value:i==null?void 0:i.email}),e.jsx($,{label:"created At",value:i==null?void 0:i.created_at}),e.jsx($,{label:"Join Store At",value:i==null?void 0:i.join_at})]}),e.jsxs("div",{className:"left-side",children:[e.jsx($,{label:"Store Name",value:(N==null?void 0:N.name)||"pppp"}),e.jsx($,{label:"Store Id",value:N==null?void 0:N.id}),e.jsx($,{isCheckRequired:l,label:(i==null?void 0:i.s_type)+" Id",value:(i==null?void 0:i.id)||""}),(k==null?void 0:k.id)!=i.id&&e.jsxs("div",{className:"chat-btn-ctn",children:[e.jsx(Be,{user:i,channel:"discussions"}),window.location.pathname.split("/")[3]=="admin"&&e.jsx("div",{className:"btn-chat-admin",onClick:()=>{N&&window.open(`${es}/admin#chat/discussions={"store_id":"${N.id}","collaborator_id":"${i.id}"}`)},children:"Open as Admin"})]}),e.jsx(Js,{status:(i==null?void 0:i.status)||"NEW",onChange:D=>{r({product_id:i.id,status:D})}}),e.jsx(Ye,{roles:(o==null?void 0:o.list)||[],canChange:()=>!0,role_id:i.role_id,onChange:D=>{n({new_role_id:D,collaborator_id:i.id})}}),e.jsx(Ne,{})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Gs(){const{current:c}=M(),{addCollaborator:s}=ce(),{store:i}=p(),[t]=h.useState(!1),a=oe(),{roles:r,fetchRoles:n}=ie();h.useEffect(()=>{n({})},[i]);const l=a.width<1e3?"wrap":"",[o]=h.useState({});return h.useEffect(()=>{},[]),c("new_collaborator")&&e.jsxs("div",{className:"collaborator-profile",ref:W,children:[e.jsx(ge,{terme:"white",mode:"create",title:"Collaborator Information",onCreate:()=>{s(o).then(d=>{console.log(d)})}}),e.jsxs("section",{className:"editor "+l,children:[e.jsxs("div",{className:"left-right",children:[e.jsx($,{label:"Store Name",value:i==null?void 0:i.name}),e.jsx($,{label:"Store Id",value:i==null?void 0:i.id}),e.jsx($,{editable:!0,prompt:"Collaborator Email",isCheckRequired:t,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:"",onChange:d=>{o.email=d}})]}),e.jsx("div",{className:"left-side",children:e.jsx(Ye,{roles:(r==null?void 0:r.list)||[],canChange:()=>!0,onChange:d=>{o.role_id=d}})})]})]})}function Zs(){const{check:c,current:s,setAbsPath:i}=M();return c("collaborators")&&e.jsxs("div",{className:"collaborator-page",children:[s("collaborators","collaborator_profile","new_collaborator")&&e.jsx($e,{active:"collaborators",setActive:t=>i(t.path)}),e.jsx(Qs,{}),e.jsx(Ys,{}),e.jsx(Gs,{})]})}const Xe={store:"Store",products:"Products",categories:"Categories",features:"Features",catalogs:"Catalogs",dash_product:"Edit Product",dash_categories:"Edit Category",dash_features:"Edit Feature",dash_catalogs:"Edit Catalog",preview:"Preview",statistic:"Statistic",action:"Action",new_product:"New Product",new_category:"New Category",product_preview:"Product Preview",user:"Users",clients:"clients",collaborators:"Collaborator",client_profile:"Profile",collaborator_profile:"Profile",roles:"Roles",create_role:"New Role",edit_role:"Editor",new_collaborator:"New Collaborator",chat:"Chat",interface:"Interface",sessions:"Sessions",discussions:"Discussions"};function et(){const{currentChild:c,blur:s,openChild:i,fetchUsersVar:t,fetchStoreVar:a,T:r,setT:n,back_color:l}=H(),{authenticateUser:o,user:d,store:u}=p(),{pathList:m,setAbsPath:N}=M(),{fetchRolesJson:k}=ie(),D=[];return m.forEach(C=>{Xe[C]&&D.push(Xe[C])}),h.useEffect(()=>{o(),window.addEventListener("blur",()=>{i(void 0)})},[]),h.useEffect(()=>{u&&(a(),k(),t())},[u]),e.jsxs("div",{className:"dash "+(r?"sombre-mode-variable":""),children:[e.jsx(Oe,{blur:s}),!d&&e.jsx(Vs,{}),e.jsx("div",{className:"dash-ctn "+(d?s?"blur":"":"blur"),children:e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"center-top",children:[e.jsx("div",{className:"page-path",children:D.map((C,y)=>e.jsxs("div",{className:"path",children:[e.jsxs("div",{className:"label",onClick:()=>{const x=m.slice(1,y+2);N(x)},children:[C,e.jsx("span",{})]}),D[y+1]?e.jsx("div",{className:"icon"}):void 0]},y))}),e.jsxs("div",{className:"top-right",children:[e.jsxs("div",{className:"dark-mode "+r,onClick:()=>{n(r?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]}),e.jsxs("div",{className:"nav-min",onClick:()=>{i(e.jsx(Oe,{blur:s}),void 0,"#345")},children:[" ",e.jsx("span",{})]})]})]}),e.jsxs("div",{className:"center-ctn",children:[e.jsx(ms,{}),e.jsx(As,{}),e.jsx(zs,{}),e.jsx(Ls,{}),e.jsx(xs,{}),e.jsx(Os,{}),e.jsx(Zs,{}),e.jsx(Ks,{}),e.jsx($s,{}),e.jsx(Ps,{})]})]})}),c&&e.jsx("div",{className:"child-viewer",onContextMenu:C=>{C.preventDefault(),i(void 0)},children:e.jsx("div",{className:"child-viewer-ctn",style:{background:l},onClick:()=>{i(void 0)},onContextMenu:C=>{C.preventDefault(),i(void 0)},children:c})})]})}const st=c=>c,rt=st(e.jsx(ss.StrictMode,{children:e.jsx(et,{})}));export{rt as DashView};
