import{j as s,c as p}from"./BindToParentScroll-wq_hAQJI.js";import{r as v,H as d}from"./index-BEcpemk-.js";let N=0;function S(){return Date.now()+"_"+Number(++N+Math.trunc(Math.random()*9e9+1e6)).toString(36)}function g({mode:a,title:c,onCreate:e,onDelete:r,deteleKey:n,terme:t}){const[u,i]=v.useState(""),[o,l]=v.useState(!1),f=v.useRef(null);return s.jsxs("div",{className:"editor-top-bar",children:[s.jsx("h1",{className:"page-title",children:c}),a=="create"&&s.jsx("div",{className:"btn-ctn",children:s.jsxs("div",{className:"create",onClick:()=>{e==null||e()},children:[s.jsx("div",{className:"icon"}),s.jsx("div",{className:"label",children:"Create New"})]})}),a=="delete"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"btn-ctn",children:[o&&s.jsxs("div",{className:"cancel "+(t||""),style:{filter:t=="dark"?"#9995":""},onClick:()=>{l(!1)},children:[s.jsx("div",{className:"icon cancel",style:{filter:t=="dark"?"invert()":""}}),s.jsx("div",{className:"label",children:"Cancel"})]}),s.jsxs("div",{className:"delete "+(t||""),onClick:()=>{o?u.trim()==n&&(r==null||r()):(()=>{var h;l(!0),(h=f.current)==null||h.focus()})()},children:[s.jsx("div",{className:"icon "+(a=="delete"?o?"confirm":"delete":"lol")}),s.jsx("div",{className:"label",children:o?"Confirm":"Detele"})]})]}),o&&s.jsx("input",{ref:f,placeholder:"Id Is Required ",type:"text",onChange:h=>{i(h.currentTarget.value)}})]})]})}const m=p((a,c)=>({user:void 0,store:void 0,userStore:void 0,openAuth:!1,async updateUser({name:e,photos:r,id:n}){const t=new FormData;if(e&&t.append("name",e),r!=null&&r[0])t.append("photos_0",r[0]);else return;t.append("id",n),t.append("photos",'["photos_0"]');const i=await(await fetch(`${d}/edit_me`,{method:"POST",body:t})).json();i.id&&(a(()=>({user:{...i,photos:i.photos.map(o=>`${d}${o}`)}})),localStorage.setItem("user",JSON.stringify(i)))},async disconnection(){const e=m.getState().getHeaders();if(!e)return;const r={method:"GET",headers:e.headers};await fetch(`${d}/disconnection`,r),localStorage.removeItem("user"),localStorage.removeItem("store_name"),a(()=>({user:void 0,store:void 0,userStore:void 0,openAuth:!0}))},async getAccess(){window.open(`${d}/google_connexion`,void 0,"popup");const e=setInterval(()=>{const r=localStorage.getItem("user"),n=r&&JSON.parse(r);n&&(console.log("getAccess",{token:n.token}),c().authenticateUser(),clearInterval(e),m.getState().authenticateUser())},100)},async authenticateUser(){let e=localStorage.getItem("user");const r=localStorage.getItem("store_name")||window.location.pathname.split("/")[1];if(e){const n=JSON.parse(e),t=new Headers;t.append("Authorization",`Bearer ${n.token}`);const u={method:"GET",headers:t};try{let i;if(a(()=>({user:void 0,userStore:void 0,store:void 0,openAuth:!0})),i=await(await fetch(`${d}/can_manage_store/${r}`,u)).json(),!(i!=null&&i.user))return;const l={...n,...i.user};a(()=>({user:l,userStore:i.userStore,store:i.store,openAuth:!1})),localStorage.setItem("user",JSON.stringify(l))}catch{return}}else a(()=>({user:void 0,userStore:void 0,store:void 0,openAuth:!0}))},getHeaders(){const e=m.getState().store;if(!e)return;let r=m.getState().user;if(!r)return;const n=new Headers;return n.append("Authorization",`Bearer ${r.token}`),{headers:n,user:r,store:e}}}));function k({setPage:a,limit:c,page:e,total:r}){c=Number(c),e=Number(e),r=Number(r);const n=Math.ceil(r/c),t=[];return e>3&&t.push(s.jsx("div",{className:"page",onClick:()=>{a(1)},children:"1"},"a")),e-4>0&&t.push(s.jsx("div",{className:"page",children:"..."},"b")),e-2>0&&t.push(s.jsx("div",{className:"page",onClick:()=>{a(e-2)},children:e-2},"c")),e-1>0&&t.push(s.jsx("div",{className:"page",onClick:()=>{a(e-1)},children:e-1},"d")),t.push(s.jsx("div",{className:"page active",children:e},"e")),e+1<n&&t.push(s.jsx("div",{className:"page",onClick:()=>{a(e+1)},children:e+1},"f")),e+2<n&&t.push(s.jsx("div",{className:"page",onClick:()=>{a(e+2)},children:e+2},"g")),e+4<=n&&t.push(s.jsx("div",{className:"page",children:"..."},"h")),e<n&&t.push(s.jsx("div",{className:"page",onClick:()=>{a(n)},children:n},"i")),s.jsxs("div",{className:"list-paging",children:[s.jsx("div",{className:"change",onClick:()=>{e-1>=1&&a(e-1)},children:"Prev"}),t,s.jsx("div",{className:"change",onClick:()=>{e+1<=n&&a(e+1)},children:"Next"})]})}export{g as E,k as L,S as g,m as u};
