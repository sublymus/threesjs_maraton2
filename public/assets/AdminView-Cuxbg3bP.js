import{H as _,u as ie,j as e,g as L,b as G,a as H,l as z,t as de,c as ue,C as W}from"./BindToParentScroll-CP6wuI5f.js";import{c as q,S as Ee,r as g,R as $e}from"./index-B4BEfoRO.js";import{E as xe}from"./EditorTopBar-1d4Txd6-.js";import{G as D,F as ee,c as pe,d as ge,e as se,S as fe,f as Se,I as T,O as be,U as je,i as Pe,A as Ae,h as Re,g as ye}from"./ChoiseRole-D1qqOSCp.js";import{t as we,e as Ie}from"./emoji-DIhb70hV.js";const Te={"/":{stores:{store_info:{}},roles:{edit_role:{},create_role:{}},users:{user_profile:{}},chat:{discussions:{discussions_all:{},discussions_new:{},discussions_blocked:{}},services:{services_stores:{},services_all:{},services_new:{},services_blocked:{}},surveys:{}},interfaces:{},statistic:{},moderators:{moderator_profile:{},new_moderator:{}}}},ce=q(o=>({T:localStorage.getItem("theme"),back_color:"",blur:!1,setT(t){t&&localStorage.setItem("theme",t),o(()=>({T:t}))},currentChild:void 0,openChild(t,a,i){o(()=>({currentChild:t,blur:a,back_color:t&&i||""}))}})),$=new Ee(Te,["/","chat"]).getStore(),j=q(o=>({user:void 0,userStore:void 0,async updateUser({name:t,photos:a,id:i}){const s=new FormData;if(t&&s.append("name",t),a!=null&&a[0])s.append("photos_0",a[0]);else return;s.append("id",i),s.append("photos",'["photos_0"]');const c=await(await fetch(`${_}/edit_me`,{method:"POST",body:s})).json();c.id&&(o(()=>({user:{...c,photos:c.photos.map(l=>`${_}${l}`)}})),localStorage.setItem("user",JSON.stringify(c)))},async disconnection(){const t=j.getState().getHeaders();if(!t)return;const a={method:"GET",headers:t.headers};await fetch(`${_}/disconnection`,a),localStorage.removeItem("user"),localStorage.removeItem("store_name"),o(()=>({user:void 0,store:void 0,userStore:void 0,openAuth:!0}))},async getAccess(){window.open(`${_}/google_connexion`,void 0,"popup");const t=setInterval(()=>{const a=localStorage.getItem("user"),i=a&&JSON.parse(a);i&&(console.log("getAccess",{token:i.token}),o(()=>({user:i})),clearInterval(t),j.getState().authenticateUser())},100)},async authenticateUser(){let t=localStorage.getItem("user");if(t){const a=JSON.parse(t),i=new Headers;i.append("Authorization",`Bearer ${a.token}`);const s={method:"GET",headers:i},r=await fetch(`${_}/can_manage_sublymus`,s);let c;const l=()=>{localStorage.removeItem("user"),localStorage.removeItem("store"),o(()=>({user:void 0,userStore:void 0,store:void 0,openAuth:!0}))};try{if(c=await r.json(),!c.user)return l()}catch{return l()}const n={...a,...c.user};o(()=>({user:n,userStore:c.userStore,store:c.store,openAuth:!1})),localStorage.setItem("user",JSON.stringify(n))}else localStorage.removeItem("user"),localStorage.removeItem("store"),o(()=>({user:void 0,userStore:void 0,store:void 0,openAuth:!0}))},getHeaders(){let t=j.getState().user;if(!t)return;const a=new Headers;return a.append("Authorization",`Bearer ${t.token}`),{headers:a,user:t}}})),te=q(o=>({stores:void 0,store:void 0,setStore(t){o(()=>({store:t}))},async setStoreById(t){var i,s;const a=(i=te.getState().stores)==null?void 0:i.list.find(r=>r.id==t);if(a)return o(()=>({store:a}));{const r=(s=await te.getState().fetchStores({text:"#"+t},!0))==null?void 0:s.list[0];if(r)return o(()=>({store:r}))}},async fetchStores(t,a){const i=j.getState().getHeaders(),s=new URLSearchParams({});for(const l in t){const n=t[l];s.set(l,n)}const c=await(await fetch(`${_}/get_stores/?${s}`,{headers:i==null?void 0:i.headers})).json();if(c!=null&&c.list)return a||o(()=>({stores:c})),c}}));function Me(){var P;const{current:o,setAbsPath:t,navBack:a,json:i}=$(),{store:s,setStoreById:r}=te(),{openChild:c}=ce(),{user:l}=j(),[n,h]=g.useState(s||{}),[d,p]=g.useState(s?{url:(o("store_info")||"")&&`${s.logo[0]}`}:null),[f,m]=g.useState(s?{url:(o("store_info")||"")&&`${(P=s.banners)==null?void 0:P[0]}`}:null),b=ie().width<1050?"wrap":"";g.useEffect(()=>{setTimeout(()=>{var S;s&&o("store_info")&&(h(s),m({url:`${s.banners[0]}`}),p({url:`${(S=s.logo)==null?void 0:S[0]}`}))}),s||(h({}),p(null),m(null))},[s]);const w=o("store_info");g.useEffect(()=>{o("store_info")&&(i!=null&&i.store_id)&&l&&r(i.store_id)},[i,l]);const E=s;return w&&!s?e.jsx("div",{className:"store-select-btn",onClick:()=>{t(["stores"])},children:"Select Store Before Edition"}):o("store_info")&&e.jsxs("div",{className:"store-info",children:[s&&e.jsxs("div",{className:"editor-top",children:[e.jsx("div",{className:"nav-back",onClick:()=>a()}),e.jsx(xe,{terme:"dark",deteleKey:s.id,mode:"delete",onDelete:()=>{console.log("DELETE REQUIRED")},onCreate:()=>{},title:"Store Information"}),e.jsxs("div",{className:"open-opt",children:[e.jsx("div",{className:"btn-dash btn demo",onClick:()=>{localStorage.setItem("store",JSON.stringify(s)),window.open(`${location.host}/demo/${s.name}`,void 0)},children:"Open Demo Store"}),e.jsx("div",{className:"btn-dash btn",onClick:()=>{localStorage.setItem("store",JSON.stringify(s)),window.open(`${location.host}/${s==null?void 0:s.name}/dash/admin`,void 0)},children:"Open Dashboard"})]})]}),e.jsxs("div",{className:"center-content "+b,children:[e.jsx("div",{className:"center-left",children:e.jsxs("div",{className:"store "+(s?"anim":"void"),children:[e.jsx("div",{className:"banner "+(f!=null&&f.url?"":"void"),style:f!=null&&f.url?{background:L((f==null?void 0:f.url)||"")}:{},onClick:()=>{},children:e.jsxs("div",{className:"more",children:[e.jsx("div",{className:"logo "+(d!=null&&d.url?"":"void"),style:d!=null&&d.url?{background:L((d==null?void 0:d.url)||"")}:{},onClick:S=>{S.currentTarget==S.target&&d!=null&&d.url&&c(e.jsx("div",{className:"big-img",onClick:()=>c(void 0,!1),children:e.jsx("div",{className:"img",style:{background:L((d==null?void 0:d.url)||"")}})}),!0,"#3455")}}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"name",children:n.name}),e.jsx("div",{className:"owner-email",children:n.store_email}),e.jsx("div",{className:"id",children:n.id&&`#${n.id.split("-")[0]}`})]})]})}),e.jsxs("div",{className:"btm",children:[e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"stat",children:[e.jsxs("div",{className:"products",children:[e.jsx("div",{className:"value",children:s?42:0}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"clients",children:[e.jsx("div",{className:"value",children:s?205:0}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"collaborators",children:[e.jsx("div",{className:"value",children:s?9:0}),e.jsx("div",{className:"icon"})]})]}),e.jsxs("div",{className:"other",children:[e.jsx("div",{className:"site",children:n.website}),e.jsx("div",{className:"phone",children:n.phone})]})]}),s&&e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"open-store",onClick:()=>{localStorage.setItem("store",JSON.stringify(E)),window.open(`${location.host}/${n.name}`,void 0)},children:"STORE"}),e.jsx("div",{className:"open-dash",onClick:()=>{localStorage.setItem("store",JSON.stringify(E)),window.open(`${location.host}/${n.name}/dash/admin`)},children:"DASH"})]})]})]})}),e.jsxs("div",{className:"center-right",children:[w&&e.jsxs("div",{className:"id",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"id",style:{opacity:"0.5"},children:"Id"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"id",value:n.id||"",style:{opacity:"0.5"},placeholder:"Name",onChange:()=>""})]}),e.jsxs("div",{className:"name",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"name",children:"Name"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"name",value:n.name||"",placeholder:"Name",onChange:S=>{h({...n,name:S.currentTarget.value})}})]}),e.jsxs("div",{className:"phone",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"phone",children:"Phone"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"phone",value:n.phone||"",placeholder:"Phone",onChange:S=>{h({...n,phone:S.currentTarget.value})}})]}),e.jsxs("div",{className:"store_email",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"store_email",children:"Store Email"}),e.jsx("input",{type:"email",id:(s==null?void 0:s.id)+"store_email",value:n.store_email||"",placeholder:"Store email",onChange:S=>{h({...n,store_email:S.currentTarget.value})}})]}),e.jsxs("div",{className:"website",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"website",children:"Web Site"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"website",value:n.website||"",placeholder:"Web Site",onChange:S=>{h({...n,website:S.currentTarget.value})}})]}),e.jsxs("div",{className:"desciption",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"desciption",children:"Description"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"description",value:n.description||"",placeholder:"Description",onChange:S=>{h({...n,description:S.currentTarget.value})}})]}),e.jsxs("div",{className:"address",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"address",children:"Address"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"address",value:"",placeholder:"Address",onChange:()=>{h({...n})}})]})]})]}),e.jsx("div",{className:"bottom-bar"})]})}const X={name:"Sublymus",logo:["/src/res/img/img3.svg"]};function Ue({blur:o}){const{setAbsPath:t,pathList:a}=$(),[i,s]=g.useState(a[1]||"products"),{user:r,disconnection:c}=j(),l=ie();let n=l.width>=1300?"large":"small";const h=n=="large";return n+=l.width<1180?" option ":"",g.useEffect(()=>{s(a[1]||"products")},[a]),e.jsxs("div",{className:"nav-bar "+n+" "+(r?o?"blur":"":"blur"),children:[e.jsxs("div",{className:"nav-logo",children:[e.jsx("div",{className:"logo",style:{backgroundImage:`url(${`${X==null?void 0:X.logo[0]}`})`}}),h&&e.jsx("div",{className:"label",children:X==null?void 0:X.name})]}),e.jsx("div",{className:"nav-link",children:e.jsxs("ul",{children:[e.jsxs("li",{className:n+" "+(i=="stores"?"active":"no"),onClick:()=>{s("stores"),t(["stores"])},children:[e.jsx("span",{className:"stores"}),h&&"STORE"]}),e.jsxs("li",{className:n+" "+(i=="users"||i=="moderators"||i=="roles"?"active":"no"),onClick:()=>{s("users"),t(["users"])},children:[e.jsx("span",{className:"users"}),h&&"USERS"]}),e.jsxs("li",{className:n+" "+(i=="chat"?"active":"no"),onClick:()=>{s("chat"),t(["chat"])},children:[e.jsx("span",{className:"chat"}),h&&"CHAT"]}),e.jsxs("li",{className:n+" "+(i=="interfaces"?"active":"no"),onClick:()=>{s("interfaces"),t(["interfaces"])},children:[e.jsx("span",{className:"interface"}),h&&"INTERFACE"]}),e.jsxs("li",{className:n+" "+(i=="statistic"?"active":"no"),onClick:()=>{s("statistic"),t(["statistic"])},children:[e.jsx("span",{className:"state"}),h&&"STATISTIC"]})]})}),h?e.jsxs("div",{className:"nav-profile",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${r!=null&&r.photos[0].startsWith("/")?_:""}${r==null?void 0:r.photos[0]})`}}),e.jsx("div",{className:"name",children:r==null?void 0:r.name}),e.jsx("div",{className:"logout",onClick:()=>{c()},children:"logout"})]}):e.jsx("div",{className:"logut-icon",onClick:()=>{c()}})]})}function Oe(){const{current:o,qs:t,pathList:a}=$(),{user:i}=j(),{stores:s,fetchStores:r,setStore:c}=te();return g.useEffect(()=>{i&&o("stores")&&r({text:""})},[i,a]),o("stores")&&e.jsxs("div",{className:"stores-page",children:[e.jsx("div",{className:"sreach-stores",children:e.jsxs("div",{className:"ctn",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search by #id, name, email",name:"sreach-stores",id:"sreach-stores",onChange:l=>{r({text:l.currentTarget.value})}})]})}),e.jsx("div",{className:"stores",children:s==null?void 0:s.list.map(l=>e.jsxs("div",{className:"store",children:[e.jsx("div",{className:"banner",style:{background:L(l.banners[0])},onClick:()=>{c(l),t({store_id:l.id}).setAbsPath(["stores","store_info"])},children:e.jsxs("div",{className:"more",children:[e.jsx("div",{className:"logo",style:{background:L(l.logo[0])}}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"name",children:l.name}),e.jsx("div",{className:"owner-email",children:l.store_email}),e.jsxs("div",{className:"id",children:["#",l.id.split("-")[0]]})]})]})}),e.jsxs("div",{className:"btm",children:[e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"stat",children:[e.jsxs("div",{className:"products",children:[e.jsx("div",{className:"value",children:"42"}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"clients",children:[e.jsx("div",{className:"value",children:"205"}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"collaborators",children:[e.jsx("div",{className:"value",children:"9"}),e.jsx("div",{className:"icon"})]})]}),e.jsxs("div",{className:"other",children:[e.jsx("div",{className:"site",children:l.website}),e.jsx("div",{className:"phone",children:l.phone})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"open-store",onClick:()=>{localStorage.setItem("store",JSON.stringify(l)),window.open(`${location.host}/${l.name}`)},children:"STORE"}),e.jsx("div",{className:"open-dash",onClick:()=>{localStorage.setItem("store",JSON.stringify(l)),window.open(`${location.host}/${l.name}/dash`)},children:"DASH"})]})]})]},l.id))})]})}function Be(){const{getAccess:o}=j();return e.jsx("div",{className:"page-auth",children:e.jsxs("div",{className:"auth-ctn",children:[e.jsx("div",{className:"image"}),e.jsxs("div",{className:"form",children:[e.jsx("h1",{className:"auth-title",children:"SUBLYMUS DASHBOARD"}),e.jsxs("h5",{className:"auth-prompt",children:["Read more ?"," ",e.jsx("span",{onClick:()=>{},children:"Click here"})]}),e.jsxs("div",{className:"google",onClick:()=>{o()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Connexion"})]}),e.jsx("p",{children:"Google connexion is required to get access to sublymus Dash board service."})]})]})})}const ae=q(o=>({users:void 0,selectedUser:void 0,async setUserById(t){const a=ae.getState().users,i=a==null?void 0:a.list.find(s=>s.id==t);if(i)o(()=>({selectedUser:i}));else{const s=await ae.getState().fetchUsers({query:{user_id:t}});o(()=>({selectedUser:s==null?void 0:s.list.find(r=>r.id==t)}))}},async setSelectedUser(t){o(()=>({selectedUser:t}))},async fetchUsers(t){var l,n,h;const a=j.getState().getHeaders();if(!a)return;const i={};t!=null&&t.page&&(i.page=Number(t.page)),t!=null&&t.limit&&(i.limit=Number(t.limit)),t!=null&&t.order_by&&(i.order_by=t.order_by),(l=t==null?void 0:t.query)!=null&&l.text&&(i.text=t.query.text),(n=t==null?void 0:t.query)!=null&&n.user_id&&(i.user_id=t.query.user_id),(h=t==null?void 0:t.query)!=null&&h.phone&&(i.phone=t.query.phone);const s=new URLSearchParams({});for(const d in i){const p=i[d];s.set(d,p)}const c=await(await fetch(`${_}/get_users/?${s.toString()}`,{headers:a.headers})).json();if(console.log("users",c),!(!c||!c.list))return o(()=>({users:c})),c},async banUser(){}}));function He(){const{current:o,qs:t}=$(),{users:a,setSelectedUser:i,fetchUsers:s}=ae(),{user:r}=j();return g.useEffect(()=>{o("users")&&s()},[r]),o("users")&&e.jsx("div",{className:"user-list",ref:G,children:e.jsx("div",{className:"list-ctn",children:e.jsx(D,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:pe(["PAUSE","TRASH","NEW"],[]),index:ge([0,100]),is_dynamic_price:se(),hasScene:se()}},items_height:80,id:"user_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{photos:{getView(c,l,n,h){return D.ImageElement().getView(c,`${l[0].startsWith("/")?_:""}${l[0]}`,n,h)}},id:{getView(c,l,n,h){return e.jsxs("div",{ref:h,children:["#",l.split("-")[0]]},n.id)}},name:D.StringElement({size_interval:[50,200]}),status:{getView(c,l,n,h){return fe.getView(c,"VISIBLE",n,h)}},created_at:D.DateStringElement({size:200})},onItemsSelected:(c,l)=>{l.forEach(n=>{n.$itemRef&&(n.$itemRef.style.background="")}),c.forEach(n=>{n.$itemRef&&(n.$itemRef.style.background="#00f2")}),i(c[0]),t({user_id:c[0].id}).setAbsPath(["users","user_profile"])},onQuery:c=>{s(c)},top_height:40,canPaginate:!0})})})}function qe(){const{current:o,json:t}=$(),{selectedUser:a,setUserById:i}=ae(),{user:s}=j(),[r]=g.useState(!1),l=ie().width<1e3?"wrap":"";return g.useEffect(()=>{o("user_profile")&&(t!=null&&t.user_id)&&s&&i(t==null?void 0:t.user_id)},[t,s]),o("user_profile")&&(a?e.jsxs("div",{className:"user-profile",ref:G,children:[e.jsx("h1",{children:"User Information"}),e.jsxs("section",{className:"editor "+l,children:[e.jsx("div",{className:"left-right",children:e.jsx(Se,{name:"user_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(T,{isCheckRequired:r,label:"User Id",value:(a==null?void 0:a.id)||""}),e.jsx(T,{prompt:"User Name",isCheckRequired:r,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(T,{prompt:"User Email",isCheckRequired:r,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(T,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(T,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(be,{user:a,channel:"sessions"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Fe(){const{check:o,current:t,setAbsPath:a}=$();return o("users")&&e.jsxs("div",{className:"user-page",children:[t("users","user_profile")&&e.jsx(je,{collabo:!1,active:"users",setActive:i=>a(i.path)}),e.jsx(He,{}),e.jsx(qe,{})]})}const J=q(o=>({moderators:void 0,selectedModerator:void 0,async change_moderator_role(t){const a=j.getState().getHeaders();if(!a)return;const i=new FormData;i.append("new_role_id",t.new_role_id),i.append("moderator_id",t.moderator_id);const r=await(await fetch(`${_}/change_moderator_role`,{method:"PUT",body:i,headers:a.headers})).json();!r||r.id},async addModerator(t){console.log(t);let a=j.getState().getHeaders();if(!a)return;const i=new FormData;if(!t.email||!t.role_id)return;i.append("email",t.email),i.append("role_id",t.role_id);const r=await(await fetch(`${_}/add_moderator`,{method:"POST",body:i,headers:a.headers})).json();if(!(!r||!r.id))return o(()=>({moderators:r})),r},async setModeratorById(t){const a=J.getState().moderators,i=a==null?void 0:a.list.find(s=>s.id==t);if(i)o(()=>({selectedModerator:i}));else{const s=await J.getState().fetchModerators({query:{user_id:t}});o(()=>({selectedModerator:s==null?void 0:s.list.find(r=>r.id==t)}))}},async setSelectedModerator(t){o(()=>({selectedModerator:t}))},async fetchModerators(t){var l,n,h,d,p,f;const a=j.getState().getHeaders();if(!a)return;const i={};t!=null&&t.page&&(i.page=Number(t.page)),t!=null&&t.limit&&(i.limit=Number(t.limit)),t!=null&&t.sortBy&&(i.order_by=t.sortBy),(l=t==null?void 0:t.query)!=null&&l.text&&(i.text=(n=t.query)==null?void 0:n.text),(h=t==null?void 0:t.query)!=null&&h.user_id&&(i.user_id=(d=t.query)==null?void 0:d.user_id),(p=t==null?void 0:t.query)!=null&&p.phone&&(i.phone=(f=t.query)==null?void 0:f.phone);const s=new URLSearchParams({});for(const m in i){const R=i[m];s.set(m,R)}console.log(t,i);const c=await(await fetch(`${_}/get_moderators/?${s.toString()}`,{headers:a.headers})).json();if(console.log("moderators",c),!(!c||!c.list))return o(()=>({moderators:c})),c},async banModerator(){}}));function ze(){const{current:o,qs:t,setAbsPath:a}=$(),{moderators:i,setSelectedModerator:s,fetchModerators:r}=J(),{user:c}=j();return g.useEffect(()=>{o("moderators")&&r()},[c]),o("moderators")&&e.jsx("div",{className:"moderator-list",ref:G,children:e.jsx("div",{className:"list-ctn",children:e.jsx(D,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:pe(["PAUSE","TRASH","NEW"],[]),index:ge([0,100]),is_dynamic_price:se(),hasScene:se()}},items_height:80,id:"moderator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(l,n,h,d){return D.ImageElement().getView(l,`${n[0].startsWith("/")?_:""}${n[0]}`,h,d)}},id:{getView(l,n,h,d){return e.jsxs("div",{ref:d,children:["#",n.split("-")[0]]},h.id)}},name:D.StringElement({size_interval:[50,200]}),status:{getView(l,n,h,d){return fe.getView(l,"VISIBLE",h,d)}},created_at:D.DateStringElement({size:200})},onItemsSelected:(l,n)=>{n.forEach(h=>{h.$itemRef&&(h.$itemRef.style.background="")}),l.forEach(h=>{h.$itemRef&&(h.$itemRef.style.background="#00f2")}),s(l[0]),t({moderator_id:l[0].id}).setAbsPath(["moderators","moderator_profile"])},onQuery:l=>{console.log(l),r(l)},canAddNew:!0,onNewRequired:()=>{a(["moderators","new_moderator"])},top_height:40,canPaginate:!0})})})}function Le(){const{current:o,json:t}=$(),{selectedModerator:a,setModeratorById:i}=J(),[s,r]=g.useState("commands"),{user:c}=j(),[l]=g.useState(!1),h=ie().width<1e3?"wrap":"";return g.useEffect(()=>{o("moderator_profile")&&(t!=null&&t.moderator_id)&&i(t==null?void 0:t.moderator_id)},[t,c]),o("moderator_profile")&&(a?e.jsxs("div",{className:"moderator-profile",ref:G,children:[e.jsx("h1",{children:"Moderator Information"}),e.jsxs("section",{className:"editor "+h,children:[e.jsx("div",{className:"left-right",children:e.jsx(Se,{name:"moderator_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(T,{isCheckRequired:l,label:"Moderator Id",value:(a==null?void 0:a.id)||""}),e.jsx(T,{prompt:"Moderator Name",isCheckRequired:l,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(T,{prompt:"Moderator Email",isCheckRequired:l,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(T,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(T,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(be,{user:a,channel:"sessions"})]})]}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{className:"btn "+(s=="commands"?"active":""),onClick:()=>{r("commands")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Commands"})]}),e.jsxs("div",{className:"btn "+(s=="visites"?"active":""),onClick:()=>{r("visites")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Visites"})]}),e.jsx("h2",{className:"see-all",onClick:()=>{},children:"SEE ALL"})]}),s=="commands"&&e.jsx(D,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:[],itemsMapper:{images:{getView(d,p,f,m){return D.ImageElement().getView(d,`${_}${p[0]}`,f,m)}},id:{getView(d,p,f,m){return e.jsxs("div",{ref:m,children:["#",p.split("-")[0]]},f.id)}},stock:D.StringElement(),price:D.StringElement({size:200}),status:fe,created_at:D.DateStringElement({size:200})},onItemsSelected:()=>{}}),s=="visites"&&e.jsx(D,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:[],itemsMapper:{images:{getView(d,p,f,m){return D.ImageElement().getView(d,`${_}${p[0]}`,f,m)}},id:{getView(d,p,f,m){return e.jsxs("div",{ref:m,children:["#",p.split("-")[0]]},f.id)}},title:D.StringElement({size:200}),visited_at:D.DateStringElement({size:200})},onItemsSelected:d=>{}})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}const Z=q(o=>({json_roles:void 0,roles:void 0,selectedRole:void 0,async setSelectedRole(t){o(()=>({selectedRole:t}))},async setRoleById(t){const a=Z.getState().roles,i=a==null?void 0:a.list.find(s=>s.id==t);if(i)o(()=>({selectedRole:i}));else{const s=await Z.getState().fetchRoles({role_id:t});o(()=>({selectedRole:s==null?void 0:s.list.find(r=>r.id==t)}))}},async newRole(t){var c;if(!t.name)return console.log("Name required");if(!t.options||t.options.length==0)return;const a=j.getState().getHeaders();if(!a)return;const i=new FormData;i.append("name",t.name),(c=t.options)==null||c.forEach(l=>{i.append(l,"1")});const r=await(await fetch(`${_}/create_moderator_role`,{method:"POST",body:i,headers:a.headers})).json();!r||!r.id||(console.log("new role",r),o(()=>({selectedRole:r})),$.getState().setAbsPath(["roles","edit_role"]))},async updateRole(t){var l,n;const a=j.getState().getHeaders();if(!a)return;const i=Z.getState().selectedRole;if(!i)return;if(!t.name&&!t.options)return console.log("data",t);const s=new FormData;s.append("role_id",i.id),t.name&&s.append("name",t.name),((l=t.options)==null?void 0:l.length)>0&&s.append("newOptions","ok"),(n=t.options)==null||n.forEach(h=>{s.append(h,"1")});const c=await(await fetch(`${_}/update_role`,{method:"PUT",body:s,headers:a.headers})).json();!c||!c.id||o(()=>({selectedRole:c}))},async deleteRole(t){console.log(t);let a=j.getState().user;if(!a)return;const i=new Headers;i.append("Authorization",`Bearer ${a.token}`);const s=new FormData;s.append("role_id",t);const r={method:"DELETE",headers:i,body:s};(await(await fetch(`${_}/delete_role`,r)).json()).deleted&&o(()=>({selectedRole:void 0}))},async fetchRolesJson(){const a=await(await fetch(`${_}/get_roles_json/?type=moderator`)).json();a&&o(()=>({json_roles:a}))},async fetchRoles(t={}){let a=j.getState().getHeaders();if(!a)return;const i={method:"GET",headers:a.headers},s=new URLSearchParams({});t.type="moderator";for(const l in t){const n=t[l];s.set(l,n)}const c=await(await fetch(`${_}/get_store_roles/?${s.toString()}`,i)).json();if(console.log("roles",c),!(!c||!c.list))return o(()=>({roles:c})),c}}));function Ve(){const{current:o,setAbsPath:t}=$(),{addModerator:a,setSelectedModerator:i}=J(),{roles:s,fetchRoles:r}=Z(),{user:c}=j(),n=ie().width<1e3?"wrap":"",[h]=g.useState({});return g.useEffect(()=>{r()},[c]),o("new_moderator")&&e.jsxs("div",{className:"moderator-profile",ref:G,children:[e.jsx(xe,{terme:"white",mode:"create",title:"Collaborator Information",onCreate:()=>{a({email:h.email,role_id:h.role_id}).then(d=>{d!=null&&d.id&&(i(d),t(["moderators","moderator_profile"]))})}}),e.jsxs("section",{className:"editor "+n,children:[e.jsx("div",{className:"left-right",children:e.jsx(T,{editable:!0,prompt:"Collaborator Email",min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:"",onChange:d=>{h.email=d}})}),e.jsx("div",{className:"left-side",children:e.jsx(Pe,{roles:(s==null?void 0:s.list)||[],onChange:d=>{h.role_id=d},canChange:()=>!0})})]})]})}function We(){const{check:o,current:t,setAbsPath:a}=$();return o("moderators")&&e.jsxs("div",{className:"moderator-page",children:[t("moderators","moderator_profile")&&e.jsx(je,{collabo:!1,active:"moderators",setActive:i=>a(i.path)}),e.jsx(ze,{}),e.jsx(Le,{}),e.jsx(Ve,{})]})}function Je(){const{current:o,setAbsPath:t,qs:a}=$(),{roles:i,setSelectedRole:s,fetchRoles:r}=Z(),{user:c}=j();return g.useEffect(()=>{o("roles")&&c&&r()},[c]),o("roles")&&e.jsx("div",{className:"collaborator-list",ref:G,children:e.jsx("div",{className:"list-ctn",children:e.jsx(D,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:ee([0,1e5],[0,1e4]),stock:ee([0,1e4],[0,1e4]),status:pe(["PAUSE","TRASH","NEW"],[]),index:ge([0,100]),is_dynamic_price:se(),hasScene:se()}},items_height:80,id:"collaborator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{id:{getView(l,n,h,d){return e.jsxs("div",{ref:d,children:["#",n.split("-")[0]]},h.id)}},name:D.StringElement({size_interval:[50,200]}),created_at:D.DateStringElement({size:200})},onItemsSelected:(l,n)=>{n.forEach(h=>{h.$itemRef&&(h.$itemRef.style.background="")}),l.forEach(h=>{h.$itemRef&&(h.$itemRef.style.background="#00f2")}),s(l[0]),a({role_id:l[0].id}).setAbsPath(["roles","edit_role"])},onQuery:l=>{r(l)},canAddNew:!0,onNewRequired:()=>{t(["roles","create_role"])},top_height:40,canPaginate:!0})})})}function Ge(){const{selectedRole:o,setRoleById:t,updateRole:a,newRole:i,deleteRole:s,fetchRolesJson:r,json_roles:c}=Z(),{current:l,json:n}=$(),{user:h}=j(),[d]=g.useState({}),p=l("edit_role"),f=l("create_role");return g.useEffect(()=>{(p||f)&&(n!=null&&n.role_id)&&h&&t(n==null?void 0:n.role_id)},[n,h]),g.useEffect(()=>{(p||f)&&r()},[n]),(p||f)&&(!o&&p?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"role-dash",ref:G,children:[e.jsx(xe,{title:"Role Information",mode:p?"delete":"create",deteleKey:o==null?void 0:o.id,onDelete:()=>{o&&s(o.id)},onCreate:()=>{i(d)}}),e.jsxs("section",{className:"editor",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(T,{min:3,max:25,placeholder:"Role Name",prompt:"Role Name",editable:!0,label:"Name",value:p?o==null?void 0:o.name:"",onChange:m=>{p?a({name:m}):d.name=m}}),p&&e.jsxs(e.Fragment,{children:[e.jsx(T,{label:"Id",value:o==null?void 0:o.id}),e.jsx(T,{label:"Created At",value:o==null?void 0:o.created_at}),e.jsx(T,{label:"Update At",value:o==null?void 0:o.updated_at}),e.jsx(Ae,{})]})]}),e.jsx("div",{className:"right-side",children:e.jsx(Re,{json_roles:c,role:o,isNew:f,onChange:m=>{p?a({options:m}):d.options=m}})})]})]}))}function Ye(){const{check:o,current:t,setAbsPath:a}=$();return o("roles")&&e.jsxs("div",{className:"role-page",children:[t("roles","edit_role")&&e.jsx(je,{collabo:!1,active:"roles",setActive:i=>a(i.path)}),e.jsx(Je,{}),e.jsx(Ge,{})]})}const Qe="new_discussion",Xe="new_distore",K=q(o=>({async fetchEditMessage(t){const a=j.getState().getHeaders();if(!a)return;const i=new FormData;i.append("message_id",t.message_id),i.append("text",t.text);const s=await fetch(`${_}/edit_message`,{method:"PUT",headers:a.headers,body:i});try{const r=await s.json();return console.log("edit_message ",r),r!=null&&r.id?r:void 0}catch(r){console.log(r)}},async fetchDeleteMessageBoth(t){const a=j.getState().getHeaders();if(!a)return;console.log("$$$$$$$$");const i=await fetch(`${_}/delete_message/${t}`,{method:"DELETE",headers:a.headers});try{const s=await i.json();return console.log("fetchDeleteMessageBoth",s),s==null?void 0:s.deleted}catch(s){console.log(s)}},async fetchDeleteMessageMe(t){const a=j.getState().getHeaders();if(!a)return;const i=await fetch(`${_}/delete_message/${t}`,{method:"DELETE",headers:a.headers});try{const s=await i.json();return console.log("fetchDeleteMessageMe",s),s==null?void 0:s.deleted}catch(s){console.log(s)}},async fetchSendMessage({context:t,context_name:a,files:i,text:s}){if(!t||!t.id)return;if(t.id.startsWith(Qe)){const n=await A.getState().createDiscussion({other_id:t.other.id,store_id:t.to_id});if(console.log("D"),!n||!n.id)return;t=n,A.getState().setDiscussion(n)}else t.id.startsWith(Xe);const r=j.getState().getHeaders();if(!r)return;const c=new FormData;if(!s&&!i)return;if(i)for(let n=0;n<i.length;n++){const h=i[n];c.append("files_"+n,h)}if(c.append("context_id",t.id),c.append("context_name",a),s&&c.append("text",s),i)for(let n=0;n<i.length;++n){const h=i[n];c.append("files_"+n,h)}const l=await fetch(`${_}/send_message`,{headers:r.headers,body:c,method:"POST"});try{const n=await l.json();return console.log("fetchSendMessage",n),n!=null&&n.id?n:void 0}catch(n){console.log(n)}},async fetchMessages(t,a){if(t.toLowerCase().startsWith("new_"))return;const i=j.getState().getHeaders();if(!i)return;const s=await fetch(`${_}/get_messages/?context_id=${t}&context_name=${a}`,{headers:i.headers});try{const r=await s.json();return r!=null&&r.list?r:void 0}catch{}}})),me="new_discussion";let oe;const he=[],A=q(o=>({discussion:void 0,discussions:void 0,messages:void 0,setDiscussion(t){o(()=>({discussion:t}))},async setDiscussionByOtherId({other_id:t,store_id:a,findOther:i},s){var p,f;const r=s||o,c=j.getState().getHeaders();if(!c||t==c.user.id)return;const l=(p=A.getState().discussions)==null?void 0:p.list,n=l==null?void 0:l.find(m=>m.other.id==t&&(a?!!H(void 0,m):!H(void 0,m)));if(n){const m=await K.getState().fetchMessages(n.id,"discussions");r(()=>({discussion:n,messages:m}));return}const h=(f=await A.getState().fetchDiscussions({no_save:!0,other_id:t,store_id:a}))==null?void 0:f.list[0];if(h){const m=await K.getState().fetchMessages(h.id,"discussions");r(()=>({discussion:h,messages:m}));return}const d=await i(t,a);d&&A.getState().addDiscussion({other:d,store_id:a})},async openDiscussionMessages(t){const a=await K.getState().fetchMessages(t,"discussions");o(()=>({messages:a}))},async unBlockDiscussion(t){const a=j.getState().getHeaders();if(!a)return;const i=await fetch(`${_}/unblock_discussion/${t.id}`,{method:"PUT",headers:a.headers});try{const s=await i.json();return console.log("unblock_discussion ",s),s!=null&&s.id?(o(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(c=>c.id==s.id?{...c,...s}:c)}})),s):void 0}catch(s){console.log(s)}},async blockDiscussion(t){const a=j.getState().getHeaders();if(!a)return;const i=await fetch(`${_}/block_discussion/${t.id}`,{method:"PUT",headers:a.headers});try{const s=await i.json();return console.log("unblock_discussion ",s),s!=null&&s.id?(o(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(c=>c.id==s.id?{...c,...s}:c)}})),s):void 0}catch(s){console.log(s)}},async deleteDiscussion(t){const a=j.getState().getHeaders();if(!a)return;const i=await fetch(`${_}/delete_discussion/${t.id}`,{method:"DELETE",headers:a.headers});try{const s=await i.json();return console.log("deleteDiscussion ",s),s!=null&&s.deleted?(o(({discussions:r,messages:c,discussion:l})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).filter(n=>n.id!==t.id)},messages:(l==null?void 0:l.id)==t.id?void 0:c})),!0):void 0}catch(s){console.log(s)}},async createDiscussion({other_id:t,store_id:a}){const i=j.getState().getHeaders();if(!i)return;const s=new FormData;s.append("receiver_id",t),a&&s.append("to_id",a);const r=await fetch(`${_}/create_discussion`,{headers:i.headers,body:s,method:"POST"});try{const c=await r.json();return console.log("createDiscussion",c),c!=null&&c.id?c:void 0}catch(c){console.log(c)}},async addDiscussion({other:t,store_id:a}){var n,h;const i=j.getState().getHeaders();if(!i||t.id==i.user.id)return;const s=(n=A.getState().discussions)==null?void 0:n.list,r=s==null?void 0:s.find(d=>d.other.id==t.id&&(a?!H(void 0,d):!!H(void 0,d)));if(console.log("addDiscussion",{exist:r}),r){const d=await K.getState().fetchMessages(r.id,"discussions");return o(()=>({discussion:r,messages:d})),r}const c=(h=A.getState().discussions)==null?void 0:h.list.filter(d=>d.id.startsWith(me)?(d.receiver_id==t.id||d.creator_id==t.id)&&H(void 0,d)===(a||null):!1);if(c!=null&&c[0]){o(({discussions:d})=>({discussions:d&&{...d}}));return}const l={id:me+Date.now(),creator_id:i.user.id,receiver_id:t.id,deleted:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:t,from_id:void 0,to_id:a,last_message:void 0,other_att:"creator"};return o(({discussions:d})=>({messages:{list:[],limit:25,page:1,total:0},discussion:l,discussions:d&&{...d,list:[l,...d.list]}})),console.log("NEW DISCUSSION",l),l},async fetchDiscussions({discussion_id:t,no_save:a,other_id:i,store_id:s}){const r=j.getState().getHeaders();if(!r)return;const c=new URLSearchParams({});s&&(c.set("to_id",s),c.set("add_store","true")),t&&c.set("discussion_id",t),i&&c.set("other_id",i);const n=await(await fetch(`${_}/get_discussions?${c}`,{headers:r.headers})).json();if(console.log("fetch Discussions",n),!n)return;oe=o,n.list.forEach(async d=>{Ne(d)});const h=`${r.user.id}/`;if(!he.includes(h)){he.push(h);const d=we.subscription(h);await d.create(),d.onMessage(async p=>{var f;if(p.new_discussion){console.log("new_discussion ==>  ",p.new_discussion),Ne(p.new_discussion);const m=p.new_discussion,R=m.receiver.id!=r.user.id?"receiver":"creator";m.other_att=R,m.other=m[R];const b=(f=A.getState().discussions)==null?void 0:f.list.filter(w=>w.id.startsWith(me)?!(w.other.id==m.other.id&&(w.from_id||null)==(m.from_id||null)&&(w.to_id||null)==(m.to_id||null)):!0);o(({discussions:w})=>({discussions:w&&{...w,list:[m,...b||[]]}}))}p.reload_discussion&&(console.log("reload_discussion ==>  "),A.getState().fetchDiscussions({}))})}return a||o(({discussions:d})=>({discussions:{...n,list:[...((d==null?void 0:d.list)||[]).filter(p=>p.id.startsWith("new_")),...n.list]}})),n}}));async function Ne(o){if(!j.getState().getHeaders()||he.includes(o.id))return;he.push(o.id);const a=we.subscription(o.id);await a.create(),a.onMessage(async i=>{var r,c;if(!oe)return;const s=A.getState().discussion;if(i.reload){const l=(r=A.getState().discussions)==null?void 0:r.list,n=(c=await A.getState().fetchDiscussions({discussion_id:o.id,no_save:!0}))==null?void 0:c.list;if(console.log("reload Discussion ___________ ",n==null?void 0:n.length),!(n!=null&&n[0].id))return;const h=[...(l==null?void 0:l.map(d=>d.id==o.id?n==null?void 0:n[0]:d))||[]];oe(({discussions:d})=>({discussions:d&&{...d,list:h}})),(s==null?void 0:s.id)==(n==null?void 0:n[0].id)&&oe(()=>({discussion:{...n==null?void 0:n[0]}}))}if(i.reloadMessage&&(s==null?void 0:s.id)==o.id){console.log("reload Message___________",s);const l=await K.getState().fetchMessages(o.id,"discussions");oe(()=>({messages:l,discussion:{...o}}))}})}function ve(){var I;const{discussion:o,discussions:t,fetchDiscussions:a,addDiscussion:i,blockDiscussion:s,deleteDiscussion:r,unBlockDiscussion:c,setDiscussionByOtherId:l}=A(),{json:n,pathList:h,qs:d}=$(),p=(I=h[3])==null?void 0:I.split("_")[1],[f,m]=g.useState(p||"all"),{openChild:R}=ce(),{user:b}=j(),{fetchUsers:w}=ae(),{fetchModerators:E}=J();if(g.useEffect(()=>{b&&(n!=null&&n.collaborator_id||n!=null&&n.moderator_id)&&l({async findOther(x){var C;return(C=await w({query:{user_id:x}}))==null?void 0:C.list[0]},other_id:(n==null?void 0:n.collaborator_id)||(n==null?void 0:n.moderator_id),store_id:n==null?void 0:n.store_id}),m(p||"all"),b&&a({store_id:null})},[n,b]),g.useEffect(()=>{m(p||"all")},[h]),!b)return;const P=t==null?void 0:t.list.filter(x=>{var C;return!((C=x.blocked)!=null&&C.includes(b.id))}),S=t==null?void 0:t.list.filter(x=>{var C;return(C=x.blocked)==null?void 0:C.includes(b.id)}),y=P==null?void 0:P.filter(x=>x.unchecked_count>0);let B=[];f=="all"?B=P:f=="new"?B=y:B=S;let ne=0;y==null||y.forEach(x=>{ne+=x.unchecked_count});let O=0;return y==null||y.forEach(x=>{O+=x.unchecked_count}),e.jsxs("div",{className:"discussion-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Chats "}),e.jsxs("div",{className:"add-new",onClick:()=>{R(e.jsx(ye,{user:b,openChild:R,fetchUsers:E,setUser:x=>{i({other:x})}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{d(n||{}).setAbsPath(["chat","discussions","discussions_all"])},children:e.jsxs("div",{className:f=="all"?"active":"",children:["All",((P==null?void 0:P.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{d(n||{}).setAbsPath(["chat","discussions","discussions_new"])},children:e.jsxs("div",{className:f=="new"?"active":"",children:["New ",((y==null?void 0:y.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{d(n||{}).setAbsPath(["chat","discussions","discussions_blocked"])},children:e.jsxs("div",{className:f=="blocked"?"active":"",children:["Blocked  ",((S==null?void 0:S.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"discussions",children:B==null?void 0:B.map(x=>{var Y,V,v;let C="";return((Y=x.last_message)==null?void 0:Y.user_id)==b.id&&(x[`${x.other_att}_opened_at`]?new Date(x[`${x.other_att}_opened_at`])<new Date(x.last_message.created_at)?C="one":C="double":C="one"),e.jsxs("div",{className:"discussion "+((o==null?void 0:o.id)==x.id?"active":""),onClick:u=>{x.unchecked_count=0,d({store_id:H(void 0,x),[H(void 0,x)?"collaborator_id":"moderator_id"]:x.other.id}).setAbsPath(["chat","discussions","discussions_"+(f||"_all")]);const N=u.currentTarget.querySelector(".count");N.style.display="none"},onContextMenu:u=>{u.preventDefault(),R(e.jsx(Ke,{blocked:!!(S!=null&&S.includes(x)),x:u.clientX,y:u.clientY,onBlock:N=>{N?(s(x),d(n||{}).setAbsPath(["chat","discussions","discussions_blocked"])):(c(x),d(n||{}).setAbsPath(["chat","discussions","discussions_all"]))},onAsRead:()=>{},onDelete:()=>{r(x)}}))},children:[e.jsx("div",{className:"photo",style:{background:L((v=(V=x.other)==null?void 0:V.photos)==null?void 0:v[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:z(x.other.name,16)}),e.jsx("div",{className:"date",children:x.last_message&&de(x.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+C}),e.jsx("div",{className:"text",children:x.last_message?z(x.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(o==null?void 0:o.id)==x.id?"none":x.unchecked_count>0?"flex":"none"},children:x.unchecked_count})]}),x.store&&e.jsx("div",{className:"store-name",children:x.store.name})]})]},x.id)})})]})}function Ke({x:o,y:t,onBlock:a,onAsRead:i,onDelete:s,blocked:r}){const c=g.useRef(null);return g.useEffect(()=>{c.current&&ue(c.current)}),e.jsxs("div",{ref:c,className:"discussion-popu",style:{top:`${t}px`,left:`${o}px`},children:[e.jsxs("div",{className:"as-read",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>a(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:s,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function le(){var V;const{discussion:o,messages:t}=A(),{fetchSendMessage:a,fetchDeleteMessageBoth:i,fetchDeleteMessageMe:s,fetchEditMessage:r}=K(),{user:c}=j(),{openChild:l}=ce(),{qs:n}=$(),[h,d]=g.useState(!1),[p,f]=g.useState(1),[m,R]=g.useState(!1),b=g.useRef(null),w=g.useRef(null),[E,P]=g.useState(null),[S]=g.useState(Date.now()+""),[y,B]=g.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),ne=ie(),O=()=>{if(!w.current)return;const v=w.current,u=Math.ceil(v.scrollHeight/(v.getBoundingClientRect().height||20)),N=Math.ceil(v.scrollHeight/20),M=v.value.split(`
`).length;let U=Math.max(u,M,N);U=U>10?10:U-1>=1?U-1:1,f(U)};g.useEffect(()=>{O()},[ne]),g.useEffect(()=>{window.addEventListener("click",()=>{m&&R(!1)})},[]);const I=o==null?void 0:o.other.photos[0],x=(v,u)=>v.list[u].user_id==(c==null?void 0:c.id)?"right":"left",C=(v,u)=>v.list[u-1]&&v.list[u-1].user_id==(c==null?void 0:c.id)?"right":"left",Y=(v,u)=>v.list[u+1]&&(v.list[u+1].user_id==(c==null?void 0:c.id)?"right":"left");return o?c&&e.jsxs("div",{className:"discussion-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${I!=null&&I.startsWith("/")?_:""}${I})`},onClick:()=>{n({collaborator_id:o.other.id}).setAbsPath(["moderators","moderator_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:z(o.other.name,50)}),o[`${o.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",de(o[`${o.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:W()})})]}),e.jsx("div",{className:"messages",ref:v=>{b.current=v,h||(b.current&&b.current.scrollTo({top:b.current.scrollHeight}),d(!0))},onScroll:v=>{const u=v.currentTarget;clearInterval(y.lastid);const N=setTimeout(()=>{const M={isOpen:!1,height:u.scrollHeight,bottom:u.scrollHeight-(u.scrollTop+u.getBoundingClientRect().height),top:u.scrollTop,onProcess:!1,lastid:N};M.bottom>150&&(M.isOpen=!0),B(M),console.log(N)},100);y.lastid=N},children:(V=t==null?void 0:t.list)==null?void 0:V.map((v,u)=>{var F;const N=x(t,u),M=C(t,u),U=Y(t,u);let Q="";return N==M?U&&M==U&&(Q="mid"):U&&N==U&&(Q="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+N+" "+Q,onContextMenu:k=>{k.preventDefault(),l(e.jsx(Ze,{forMe:c.id==v.user_id,x:k.clientX,y:k.clientY,onDeleteBoth:()=>{i(v.id)},onDeleteMe:()=>{s(v.id)},onEdit:()=>{l(e.jsx(es,{x:k.clientX,y:k.clientY,text:v.text,onEdit:re=>{l(void 0),r({message_id:v.id,text:re})}}),!0)},other:o.other}))},children:[e.jsx("div",{className:"text",children:v.text&&v.text.split(" ").map((k,re)=>k.includes(`
`)?k.split(`
`).map((Ce,De)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:Ce}),e.jsx("br",{})]},re+"_"+De)):e.jsx("span",{style:{marginRight:"4px"},children:k},re))}),e.jsx("div",{className:"files",children:(F=v.files)==null?void 0:F.map(k=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${k.startsWith("/")?_:""}${k}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:k.length>35?z(k,25)+k.substring(k.length-8,k.length):k})]},k))}),e.jsxs("div",{className:"info",children:[v.created_at!=v.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:de(v.created_at)})]})]})},v.id)})}),e.jsxs("div",{className:"sender",children:[y.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{b.current&&b.current.scrollTo({behavior:"smooth",top:y.height})}}),m&&e.jsx("div",{className:"emoji-list",onClick:v=>{v.preventDefault(),v.stopPropagation()},children:Ie.map(v=>e.jsx("span",{onClick:u=>{u.preventDefault(),u.stopPropagation(),w.current&&(w.current.value+=v.char)},children:v.char},v.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:S+"message_file",onChange:v=>{if(!v.currentTarget.files)return;const u=[];for(let N=0;N<v.currentTarget.files.length;N++){const M=v.currentTarget.files[N];u.push(M)}P(u.length>0?E?[...E,...u]:u:null)}}),e.jsx("label",{htmlFor:S+"message_file",className:"add-file",onClick:W()})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",children:E&&E.map(v=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{E&&P(E.filter(u=>u!==v))}}),e.jsx("div",{className:"text",children:v.name})]},v.name))}),e.jsx("textarea",{autoFocus:!0,ref:w,name:"discussion_sender",placeholder:"Type a message here..",id:"discussion_sender",style:{height:`${p*20}px`},cols:30,rows:10,onChange:v=>{O()},onKeyDown:()=>{R(!1)}})]}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"emoji",onClick:v=>{v.preventDefault(),v.stopPropagation(),W()(v),R(!m)}}),e.jsx("div",{className:"send",onClick:v=>{var u;W()(v),a({context:o,context_name:"discussions",files:E,text:(u=w.current)==null?void 0:u.value}),P(null),w.current&&(w.current.value="")},children:e.jsx("div",{className:"icon"})})]})]})]})]}):e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})})}function Ze({x:o,y:t,onEdit:a,onDeleteBoth:i,onDeleteMe:s,other:r,forMe:c}){const l=g.useRef(null);return g.useEffect(()=>{l.current&&ue(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${t}px`,left:`${o}px`},children:[c&&e.jsxs("div",{className:"edit",onClick:n=>{n.preventDefault(),n.stopPropagation(),a()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:s,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),c&&e.jsxs("div",{className:"delete-both",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function es({x:o,y:t,onEdit:a,text:i}){const s=g.useRef(null),[r,c]=g.useState(i);return g.useEffect(()=>{s.current&&ue(s.current)}),e.jsxs("div",{ref:s,className:"message-edit-popu",style:{top:`${t}px`,left:`${o}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{c(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{a(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}const ke=q(o=>({serviceStore:void 0,serviceStores:void 0,serviceDiscussions:void 0,serviceDiscussion:void 0,async fetchServiceDiscussions(t){const a=await A.getState().fetchDiscussions({...t,no_save:!0});return o(()=>({serviceDiscussions:a})),a},async fetchServiceStores(t){const a=await te.getState().fetchStores(t,!0);return o(()=>({serviceStores:a})),a},async setServiceStore(t){o(()=>({serviceStore:t}))},async setServiceDiscussionById(t){A.getState().setDiscussionByOtherId(t,o)},async setServiceStoreById(t){var i;const a=(i=ke.getState().serviceStores)==null?void 0:i.list.find(s=>s.id==t);if(a)o(()=>({serviceStore:a}));else{const s=await te.getState().fetchStores({text:`#${t}`},!0);o(()=>({serviceStore:s==null?void 0:s.list[0]}))}}}));function ss(){var v;const{addDiscussion:o,blockDiscussion:t,deleteDiscussion:a,unBlockDiscussion:i}=A(),{serviceStore:s,serviceStores:r,setServiceStoreById:c,fetchServiceStores:l,serviceDiscussions:n,serviceDiscussion:h,setServiceDiscussionById:d,fetchServiceDiscussions:p}=ke(),{check:f,json:m,pathList:R,qs:b}=$(),w=(v=R[3])==null?void 0:v.split("_")[1],[E,P]=g.useState(w||"all"),{openChild:S}=ce(),{user:y}=j(),{fetchUsers:B}=ae(),{fetchModerators:ne}=J();if(g.useEffect(()=>{y&&(m!=null&&m.collaborator_id||m!=null&&m.moderator_id)?(console.log({json:m}),d({async findOther(u){var N;return(N=await B({query:{user_id:u}}))==null?void 0:N.list[0]},other_id:(m==null?void 0:m.collaborator_id)||(m==null?void 0:m.moderator_id),store_id:m==null?void 0:m.store_id})):m&&y&&f("services")&&m.store_id&&c(m.store_id),P(w||"all")},[m,y]),g.useEffect(()=>{P(w||"all")},[R]),g.useEffect(()=>{y&&f("services")&&l({})},[y]),g.useEffect(()=>{s&&p({store_id:s.id})},[s]),!y)return;const O=n==null?void 0:n.list.filter(u=>{var N;return!((N=u.blocked)!=null&&N.includes(y.id))}),I=n==null?void 0:n.list.filter(u=>{var N;return(N=u.blocked)==null?void 0:N.includes(y.id)}),x=O==null?void 0:O.filter(u=>u.unchecked_count>0);let C=[];E=="all"?C=O:E=="new"?C=x:C=I;let Y=0;x==null||x.forEach(u=>{Y+=u.unchecked_count});let V=0;return x==null||x.forEach(u=>{V+=u.unchecked_count}),e.jsxs("div",{className:"service-nav",children:[e.jsxs("div",{className:"title",children:[e.jsxs("div",{className:"label",children:[(s==null?void 0:s.name)||"Services"," "]}),s&&e.jsxs("div",{className:"add-new",onClick:()=>{S(e.jsx(ye,{user:y,openChild:S,fetchUsers:ne,setUser:u=>{o({other:u})}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),!s&&e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{b(m||{}).setAbsPath(["chat","services","services_all"])},children:e.jsxs("div",{className:E=="all"?"active":"",children:["All",((O==null?void 0:O.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{b(m||{}).setAbsPath(["chat","services","services_new"])},children:e.jsxs("div",{className:E=="new"?"active":"",children:["New ",((x==null?void 0:x.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{b(m||{}).setAbsPath(["chat","services","services_blocked"])},children:e.jsxs("div",{className:E=="blocked"?"active":"",children:["Blocked  ",((I==null?void 0:I.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"service-stores",children:r==null?void 0:r.list.map(u=>{var N;return e.jsxs("div",{className:"store "+((s==null?void 0:s.id)==u.id?"active":""),onClick:()=>{b({store_id:u.id}).setAbsPath(["chat","services","services_all"])},children:[e.jsx("div",{className:"logo",style:{background:L((N=u.logo)==null?void 0:N[0])}}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"top-ctn",children:e.jsx("div",{className:"name",children:z(u.name,16)})}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"email",children:z(u.store_email,24)}),e.jsx("div",{className:"count",style:{display:"flex"},children:"5"})]})]})]})})}),e.jsx("div",{className:"services",children:C==null?void 0:C.map(u=>{var M,U,Q;let N="";return((M=u.last_message)==null?void 0:M.user_id)==y.id&&(u[`${u.other_att}_opened_at`]?new Date(u[`${u.other_att}_opened_at`])<new Date(u.last_message.created_at)?N="one":N="double":N="one"),e.jsxs("div",{className:"service "+((h==null?void 0:h.id)==u.id?"active":""),onClick:F=>{u.unchecked_count=0,b({store_id:H(void 0,u),[H(void 0,u)?"collaborator_id":"moderator_id"]:u.other.id}).setAbsPath(["chat","services","services_"+(E||"_all")]);const k=F.currentTarget.querySelector(".count");k.style.display="none"},onContextMenu:F=>{F.preventDefault(),S(e.jsx(ts,{blocked:!!(I!=null&&I.includes(u)),x:F.clientX,y:F.clientY,onBlock:k=>{k?(t(u),b(m||{}).setAbsPath(["chat","services","services_blocked"])):(i(u),b(m||{}).setAbsPath(["chat","services","services_all"]))},onAsRead:()=>{},onDelete:()=>{a(u)}}))},children:[e.jsx("div",{className:"photo",style:{background:L((Q=(U=u.other)==null?void 0:U.photos)==null?void 0:Q[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:z(u.other.name,16)}),e.jsx("div",{className:"date",children:u.last_message&&de(u.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+N}),e.jsx("div",{className:"text",children:u.last_message?z(u.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(h==null?void 0:h.id)==u.id?"none":u.unchecked_count>0?"flex":"none"},children:u.unchecked_count})]})]})]},u.id)})})]})}function ts({x:o,y:t,onBlock:a,onAsRead:i,onDelete:s,blocked:r}){const c=g.useRef(null);return g.useEffect(()=>{c.current&&ue(c.current)}),e.jsxs("div",{ref:c,className:"service-popu",style:{top:`${t}px`,left:`${o}px`},children:[e.jsxs("div",{className:"as-read",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>a(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:s,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function as(){const{check:o,setAbsPath:t,pathList:a}=$(),{user:i}=j(),[s,r]=g.useState((a==null?void 0:a[2])||"discussions"),[c,l]=g.useState("max");g.useEffect(()=>{r(a[2]||"discussions")},[a]);const n={discussions:e.jsx(ve,{}),groups:e.jsx(ve,{}),services:e.jsx(ss,{}),surveys:e.jsx(ve,{})},h={discussions:e.jsx(le,{}),groups:e.jsx(le,{}),services:e.jsx(le,{}),surveys:e.jsx(le,{})};return o("chat")&&i&&e.jsxs("div",{className:"page-chat",children:[e.jsx("div",{className:"back-close nav",style:{display:c=="min"?"none":""},onClick:d=>{d.currentTarget==d.target&&l("min")}}),e.jsxs("div",{className:"chat-nav "+c,children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"nav-size "+c,onClick:d=>{W(.4)(d),l(c=="min"?"max":"min")}}),e.jsx("div",{className:"icon discussions-icon "+(s=="discussions"?"active":""),onClick:d=>{W(.4)(d),t(["chat","discussions"]),r("discussions")}}),e.jsx("div",{className:"icon services "+(s=="services"?"active":""),onClick:d=>{W(.4)(d),t(["chat","services"]),r("services")}}),e.jsx("div",{className:"icon profile",style:{background:`no-repeat center/cover url(${i.photos[0].startsWith("/")?_:""}${i.photos[0]})`},onClick:()=>{}})]}),c=="max"&&e.jsx("div",{className:"nav-ctn",children:n[s]})]}),e.jsx("div",{className:"chat-center",children:h[s]})]})}const _e={stores:"Stores",store_info:"Store Info",roles:"Roles",edit_role:"Edit Role",create_role:"Create Role",users:"Users",user_profile:"User Profile",chat:"Chat",discussions:"Discussions",groups:"Groups",surveys:"Surveys",interface:"Interfaces",statistic:"Statistic",action:"Action"};function is(){const{currentChild:o,blur:t,openChild:a,T:i,setT:s,back_color:r}=ce(),{authenticateUser:c,user:l}=j(),{pathList:n,setAbsPath:h}=$(),d=[];return n.forEach(p=>{_e[p]&&d.push(_e[p])}),g.useEffect(()=>{c(),window.addEventListener("blur",()=>{a(void 0)})},[]),e.jsxs("div",{className:"admin "+(i?"sombre-mode-variable":""),children:[e.jsx(Ue,{blur:t}),!l&&e.jsx(Be,{}),e.jsx("div",{className:"admin-ctn "+(l?t?"blur":"":"blur"),children:e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"center-top",children:[e.jsx("div",{className:"page-path",children:d.map((p,f)=>e.jsxs("div",{className:"path",children:[e.jsxs("div",{className:"label",onClick:()=>{const m=n.slice(1,f+2);h(m)},children:[p,e.jsx("span",{})]}),d[f+1]?e.jsx("div",{className:"icon"}):void 0]},f))}),e.jsxs("div",{className:"top-right",children:[e.jsxs("div",{className:"dark-mode "+i,onClick:()=>{s(i?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]})]}),e.jsxs("div",{className:"center-ctn",children:[e.jsx(Oe,{}),e.jsx(Me,{}),e.jsx(Fe,{}),e.jsx(We,{}),e.jsx(Ye,{}),e.jsx(as,{})]})]})}),o&&e.jsx("div",{className:"child-viewer",onContextMenu:p=>{p.preventDefault(),a(void 0)},children:e.jsx("div",{className:"child-viewer-ctn",style:{background:r},onClick:()=>{a(void 0)},onContextMenu:p=>{p.preventDefault(),a(void 0)},children:o})})]})}const ns=o=>o,hs=ns(e.jsx($e.StrictMode,{children:e.jsx(is,{})}));export{hs as AdminView};
