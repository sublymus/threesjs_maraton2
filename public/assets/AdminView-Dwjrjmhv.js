import{c as Y,u as oe,j as e,g as V,d as K,e as L,t as be,l as W,f as he,h as me,C as J}from"./Transmit-XJ9IEhFN.js";import{H as b,r as p,L as Z,R as Pe}from"./index-CO-a83Cg.js";import{i as f,j as P,k as re,G as q,F as te,b as ge,c as fe,d as ae,S as ye,e as we,I as T,O as ke,U as je,h as Re,A as Ae,g as Me,f as Ce,N as Ne}from"./NavBar-BbkCcP8U.js";import{E as ve}from"./ListPaging-V11Q1Msr.js";import{e as Te}from"./emoji-ce0Jjmmu.js";const ie=Y(c=>({stores:void 0,store:void 0,setStore(t){c(()=>({store:t}))},async setStoreById(t){var i,s;const a=(i=ie.getState().stores)==null?void 0:i.list.find(r=>r.id==t);if(a)return c(()=>({store:a}));{const r=(s=await ie.getState().fetchStores({text:"#"+t},!0))==null?void 0:s.list[0];if(r)return c(()=>({store:r}))}},async fetchStores(t,a){const i=f.getState().getHeaders(),s=new URLSearchParams({});for(const l in t){const n=t[l];s.set(l,n)}const o=await(await fetch(`${b}/get_stores/?${s}`,{headers:i==null?void 0:i.headers})).json();if(o!=null&&o.list)return a||c(()=>({stores:o})),o}}));function Ie(){var M;const{current:c,setAbsPath:t,navBack:a,json:i}=P(),{store:s,setStoreById:r}=ie(),{openChild:o}=re(),{user:l}=f(),[n,u]=p.useState(s||{}),[h,j]=p.useState(s?{url:(c("store_info")||"")&&`${s.logo[0]}`}:null),[g,m]=p.useState(s?{url:(c("store_info")||"")&&`${(M=s.banners)==null?void 0:M[0]}`}:null),C=oe().width<1050?"wrap":"";p.useEffect(()=>{setTimeout(()=>{var _;s&&c("store_info")&&(u(s),m({url:`${s.banners[0]}`}),j({url:`${(_=s.logo)==null?void 0:_[0]}`}))}),s||(u({}),j(null),m(null))},[s]);const N=c("store_info");p.useEffect(()=>{c("store_info")&&(i!=null&&i.store_id)&&l&&r(i.store_id)},[i,l]);const w=s;return N&&!s?e.jsx("div",{className:"store-select-btn",onClick:()=>{t(["stores"])},children:"Select Store Before Edition"}):c("store_info")&&e.jsxs("div",{className:"store-info",children:[s&&e.jsxs("div",{className:"editor-top",children:[e.jsx("div",{className:"nav-back",onClick:()=>a()}),e.jsx(ve,{terme:"dark",deteleKey:s.id,mode:"delete",onDelete:()=>{console.log("DELETE REQUIRED")},onCreate:()=>{},title:"Store Information"}),e.jsxs("div",{className:"open-opt",children:[e.jsx("div",{className:"btn-dash btn demo",onClick:()=>{localStorage.setItem("store",JSON.stringify(s)),window.open(`${Z}/demo/${s.name}`,void 0)},children:"Open Demo Store"}),e.jsx("div",{className:"btn-dash btn",onClick:()=>{localStorage.setItem("store",JSON.stringify(s)),window.open(`${Z}/${s==null?void 0:s.name}/dash/admin`,void 0)},children:"Open Dashboard"})]})]}),e.jsxs("div",{className:"center-content "+C,children:[e.jsx("div",{className:"center-left",children:e.jsxs("div",{className:"store "+(s?"anim":"void"),children:[e.jsx("div",{className:"banner "+(g!=null&&g.url?"":"void"),style:g!=null&&g.url?{background:V((g==null?void 0:g.url)||"")}:{},onClick:()=>{},children:e.jsxs("div",{className:"more",children:[e.jsx("div",{className:"logo "+(h!=null&&h.url?"":"void"),style:h!=null&&h.url?{background:V((h==null?void 0:h.url)||"")}:{},onClick:_=>{_.currentTarget==_.target&&h!=null&&h.url&&o(e.jsx("div",{className:"big-img",onClick:()=>o(void 0,!1),children:e.jsx("div",{className:"img",style:{background:V((h==null?void 0:h.url)||"")}})}),!0,"#3455")}}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"name",children:n.name}),e.jsx("div",{className:"owner-email",children:n.store_email}),e.jsx("div",{className:"id",children:n.id&&`#${n.id.split("-")[0]}`})]})]})}),e.jsxs("div",{className:"btm",children:[e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"stat",children:[e.jsxs("div",{className:"products",children:[e.jsx("div",{className:"value",children:s?42:0}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"clients",children:[e.jsx("div",{className:"value",children:s?205:0}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"collaborators",children:[e.jsx("div",{className:"value",children:s?9:0}),e.jsx("div",{className:"icon"})]})]}),e.jsxs("div",{className:"other",children:[e.jsx("div",{className:"site",children:n.website}),e.jsx("div",{className:"phone",children:n.phone})]})]}),s&&e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"open-store",onClick:()=>{localStorage.setItem("store",JSON.stringify(w)),window.open(`${Z}/${n.name}`,void 0)},children:"STORE"}),e.jsx("div",{className:"open-dash",onClick:()=>{localStorage.setItem("store",JSON.stringify(w)),window.open(`${Z}/${n.name}/dash/admin`)},children:"DASH"})]})]})]})}),e.jsxs("div",{className:"center-right",children:[N&&e.jsxs("div",{className:"id",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"id",style:{opacity:"0.5"},children:"Id"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"id",value:n.id||"",style:{opacity:"0.5"},placeholder:"Name",onChange:()=>""})]}),e.jsxs("div",{className:"name",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"name",children:"Name"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"name",value:n.name||"",placeholder:"Name",onChange:_=>{u({...n,name:_.currentTarget.value})}})]}),e.jsxs("div",{className:"phone",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"phone",children:"Phone"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"phone",value:n.phone||"",placeholder:"Phone",onChange:_=>{u({...n,phone:_.currentTarget.value})}})]}),e.jsxs("div",{className:"store_email",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"store_email",children:"Store Email"}),e.jsx("input",{type:"email",id:(s==null?void 0:s.id)+"store_email",value:n.store_email||"",placeholder:"Store email",onChange:_=>{u({...n,store_email:_.currentTarget.value})}})]}),e.jsxs("div",{className:"website",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"website",children:"Web Site"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"website",value:n.website||"",placeholder:"Web Site",onChange:_=>{u({...n,website:_.currentTarget.value})}})]}),e.jsxs("div",{className:"desciption",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"desciption",children:"Description"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"description",value:n.description||"",placeholder:"Description",onChange:_=>{u({...n,description:_.currentTarget.value})}})]}),e.jsxs("div",{className:"address",children:[e.jsx("label",{htmlFor:(s==null?void 0:s.id)+"address",children:"Address"}),e.jsx("input",{type:"text",id:(s==null?void 0:s.id)+"address",value:"",placeholder:"Address",onChange:()=>{u({...n})}})]})]})]}),e.jsx("div",{className:"bottom-bar"})]})}function Ue(){const{current:c,qs:t,pathList:a}=P(),{user:i}=f(),{stores:s,fetchStores:r,setStore:o}=ie();return p.useEffect(()=>{i&&c("stores")&&r({text:""})},[i,a]),c("stores")&&e.jsxs("div",{className:"stores-page",children:[e.jsx("div",{className:"sreach-stores",children:e.jsxs("div",{className:"ctn",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search by #id, name, email",name:"sreach-stores",id:"sreach-stores",onChange:l=>{r({text:l.currentTarget.value})}})]})}),e.jsx("div",{className:"stores",children:s==null?void 0:s.list.map(l=>e.jsxs("div",{className:"store",children:[e.jsx("div",{className:"banner",style:{background:V(l.banners[0])},onClick:()=>{o(l),t({store_id:l.id}).setAbsPath(["stores","store_info"])},children:e.jsxs("div",{className:"more",children:[e.jsx("div",{className:"logo",style:{background:V(l.logo[0])}}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"name",children:l.name}),e.jsx("div",{className:"owner-email",children:l.store_email}),e.jsxs("div",{className:"id",children:["#",l.id.split("-")[0]]})]})]})}),e.jsxs("div",{className:"btm",children:[e.jsxs("div",{className:"info",children:[e.jsxs("div",{className:"stat",children:[e.jsxs("div",{className:"products",children:[e.jsx("div",{className:"value",children:"42"}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"clients",children:[e.jsx("div",{className:"value",children:"205"}),e.jsx("div",{className:"icon"})]}),e.jsxs("div",{className:"collaborators",children:[e.jsx("div",{className:"value",children:"9"}),e.jsx("div",{className:"icon"})]})]}),e.jsxs("div",{className:"other",children:[e.jsx("div",{className:"site",children:l.website}),e.jsx("div",{className:"phone",children:l.phone})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"open-store",onClick:()=>{localStorage.setItem("store",JSON.stringify(l)),window.open(`${Z}/${l.name}`)},children:"STORE"}),e.jsx("div",{className:"open-dash",onClick:()=>{localStorage.setItem("store",JSON.stringify(l)),window.open(`${Z}/${l.name}/dash`)},children:"DASH"})]})]})]},l.id))})]})}function Be(){const{getAccess:c}=f();return e.jsx("div",{className:"page-auth",children:e.jsxs("div",{className:"auth-ctn",children:[e.jsx("div",{className:"image"}),e.jsxs("div",{className:"form",children:[e.jsx("h1",{className:"auth-title",children:"SUBLYMUS DASHBOARD"}),e.jsxs("h5",{className:"auth-prompt",children:["Read more ?"," ",e.jsx("span",{onClick:()=>{},children:"Click here"})]}),e.jsxs("div",{className:"google",onClick:()=>{c()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Connexion"})]}),e.jsx("p",{children:"Google connexion is required to get access to sublymus Dash board service."})]})]})})}const ne=Y(c=>({users:void 0,selectedUser:void 0,async setUserById(t){const a=ne.getState().users,i=a==null?void 0:a.list.find(s=>s.id==t);if(i)c(()=>({selectedUser:i}));else{const s=await ne.getState().fetchUsers({query:{user_id:t}});c(()=>({selectedUser:s==null?void 0:s.list.find(r=>r.id==t)}))}},async setSelectedUser(t){c(()=>({selectedUser:t}))},async fetchUsers(t){var l,n,u;const a=f.getState().getHeaders();if(!a)return;const i={};t!=null&&t.page&&(i.page=Number(t.page)),t!=null&&t.limit&&(i.limit=Number(t.limit)),t!=null&&t.order_by&&(i.order_by=t.order_by),(l=t==null?void 0:t.query)!=null&&l.text&&(i.text=t.query.text),(n=t==null?void 0:t.query)!=null&&n.user_id&&(i.user_id=t.query.user_id),(u=t==null?void 0:t.query)!=null&&u.phone&&(i.phone=t.query.phone);const s=new URLSearchParams({});for(const h in i){const j=i[h];s.set(h,j)}const o=await(await fetch(`${b}/get_users/?${s.toString()}`,{headers:a.headers})).json();if(console.log("users",o),!(!o||!o.list))return c(()=>({users:o})),o},async banUser(){}}));function Oe(){const{current:c,qs:t}=P(),{users:a,setSelectedUser:i,fetchUsers:s}=ne(),{user:r}=f();return p.useEffect(()=>{c("users")&&s()},[r]),c("users")&&e.jsx("div",{className:"user-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(q,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:ge(["PAUSE","TRASH","NEW"],[]),index:fe([0,100]),is_dynamic_price:ae(),hasScene:ae()}},items_height:80,id:"user_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{photos:{getView(o,l,n,u){return q.ImageElement().getView(o,`${l[0].startsWith("/")?b:""}${l[0]}`,n,u)}},id:{getView(o,l,n,u){return e.jsxs("div",{ref:u,children:["#",l.split("-")[0]]},n.id)}},name:q.StringElement({size_interval:[50,200]}),status:{getView(o,l,n,u){return ye.getView(o,"VISIBLE",n,u)}},created_at:q.DateStringElement({size:200})},onItemsSelected:(o,l)=>{l.forEach(n=>{n.$itemRef&&(n.$itemRef.style.background="")}),o.forEach(n=>{n.$itemRef&&(n.$itemRef.style.background="#00f2")}),i(o[0]),t({user_id:o[0].id}).setAbsPath(["users","user_profile"])},onQuery:o=>{s(o)},top_height:40,canPaginate:!0})})})}function qe(){const{current:c,json:t}=P(),{selectedUser:a,setUserById:i}=ne(),{user:s}=f(),[r]=p.useState(!1),l=oe().width<1e3?"wrap":"";return p.useEffect(()=>{c("user_profile")&&(t!=null&&t.user_id)&&s&&i(t==null?void 0:t.user_id)},[t,s]),c("user_profile")&&(a?e.jsxs("div",{className:"user-profile",ref:K,children:[e.jsx("h1",{children:"User Information"}),e.jsxs("section",{className:"editor "+l,children:[e.jsx("div",{className:"left-right",children:e.jsx(we,{name:"user_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(T,{isCheckRequired:r,label:"User Id",value:(a==null?void 0:a.id)||""}),e.jsx(T,{prompt:"User Name",isCheckRequired:r,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(T,{prompt:"User Email",isCheckRequired:r,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(T,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(T,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(ke,{user:a,channel:"sessions"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function He(){const{check:c,current:t,setAbsPath:a}=P();return c("users")&&e.jsxs("div",{className:"user-page",children:[t("users","user_profile")&&e.jsx(je,{collabo:!1,active:"users",setActive:i=>a(i.path)}),e.jsx(Oe,{}),e.jsx(qe,{})]})}const G=Y(c=>({moderators:void 0,selectedModerator:void 0,async change_moderator_role(t){const a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("new_role_id",t.new_role_id),i.append("moderator_id",t.moderator_id);const r=await(await fetch(`${b}/change_moderator_role`,{method:"PUT",body:i,headers:a.headers})).json();!r||r.id},async addModerator(t){console.log(t);let a=f.getState().getHeaders();if(!a)return;const i=new FormData;if(!t.email||!t.role_id)return;i.append("email",t.email),i.append("role_id",t.role_id);const r=await(await fetch(`${b}/add_moderator`,{method:"POST",body:i,headers:a.headers})).json();if(!(!r||!r.id))return c(()=>({moderators:r})),r},async removeModerator(t){let a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("moderator_id",t);const s={method:"DELETE",headers:a.headers,body:i};(await(await fetch(`${b}/remove_moderator`,s)).json()).deleted&&c(()=>({selectedModerator:void 0}))},async setModeratorById(t){const a=G.getState().moderators,i=a==null?void 0:a.list.find(s=>s.id==t);if(i)c(()=>({selectedModerator:i}));else{const s=await G.getState().fetchModerators({query:{user_id:t}});c(()=>({selectedModerator:s==null?void 0:s.list.find(r=>r.id==t)}))}},async setSelectedModerator(t){c(()=>({selectedModerator:t}))},async fetchModerators(t){var l,n,u,h,j,g;const a=f.getState().getHeaders();if(!a)return;const i={};t!=null&&t.page&&(i.page=Number(t.page)),t!=null&&t.limit&&(i.limit=Number(t.limit)),t!=null&&t.sortBy&&(i.order_by=t.sortBy),(l=t==null?void 0:t.query)!=null&&l.text&&(i.text=(n=t.query)==null?void 0:n.text),(u=t==null?void 0:t.query)!=null&&u.user_id&&(i.user_id=(h=t.query)==null?void 0:h.user_id),(j=t==null?void 0:t.query)!=null&&j.phone&&(i.phone=(g=t.query)==null?void 0:g.phone);const s=new URLSearchParams({});for(const m in i){const S=i[m];s.set(m,S)}console.log(t,i);const o=await(await fetch(`${b}/get_moderators/?${s.toString()}`,{headers:a.headers})).json();if(console.log("moderators",o),!(!o||!o.list))return c(()=>({moderators:o})),o},async banModerator(){}}));function Fe(){const{current:c,qs:t,setAbsPath:a}=P(),{moderators:i,setSelectedModerator:s,fetchModerators:r}=G(),{user:o}=f();return p.useEffect(()=>{c("moderators")&&r()},[o]),c("moderators")&&e.jsx("div",{className:"moderator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(q,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:ge(["PAUSE","TRASH","NEW"],[]),index:fe([0,100]),is_dynamic_price:ae(),hasScene:ae()}},items_height:80,id:"moderator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(l,n,u,h){return q.ImageElement().getView(l,`${n[0].startsWith("/")?b:""}${n[0]}`,u,h)}},id:{getView(l,n,u,h){return e.jsxs("div",{ref:h,children:["#",n.split("-")[0]]},u.id)}},name:q.StringElement({size_interval:[50,200]}),status:{getView(l,n,u,h){return ye.getView(l,"VISIBLE",u,h)}},created_at:q.DateStringElement({size:200})},onItemsSelected:(l,n)=>{n.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="")}),l.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="#00f2")}),s(l[0]),t({moderator_id:l[0].id}).setAbsPath(["moderators","moderator_profile"])},onQuery:l=>{console.log(l),r(l)},canAddNew:!0,onNewRequired:()=>{a(["moderators","new_moderator"])},top_height:40,canPaginate:!0})})})}function Le(){const{current:c,json:t}=P(),{selectedModerator:a,setModeratorById:i,removeModerator:s}=G(),{user:r}=f(),[o]=p.useState(!1),n=oe().width<1e3?"wrap":"";return p.useEffect(()=>{c("moderator_profile")&&(t!=null&&t.moderator_id)&&i(t==null?void 0:t.moderator_id)},[t,r]),c("moderator_profile")&&(a?e.jsxs("div",{className:"moderator-profile",ref:K,children:[e.jsx(ve,{title:"Moderator Information",mode:"delete",deteleKey:a.id,onDelete:()=>{s(a.id)}}),e.jsxs("section",{className:"editor "+n,children:[e.jsx("div",{className:"left-right",children:e.jsx(we,{name:"moderator_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(T,{isCheckRequired:o,label:"Moderator Id",value:(a==null?void 0:a.id)||""}),e.jsx(T,{prompt:"Moderator Name",isCheckRequired:o,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(T,{prompt:"Moderator Email",isCheckRequired:o,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(T,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(T,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(ke,{user:a,channel:"sessions"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}const se=Y(c=>({json_roles:void 0,roles:void 0,selectedRole:void 0,async setSelectedRole(t){c(()=>({selectedRole:t}))},async setRoleById(t){const a=se.getState().roles,i=a==null?void 0:a.list.find(s=>s.id==t);if(i)c(()=>({selectedRole:i}));else{const s=await se.getState().fetchRoles({role_id:t});c(()=>({selectedRole:s==null?void 0:s.list.find(r=>r.id==t)}))}},async newRole(t){var o;if(!t.name)return console.log("Name required");if(!t.options||t.options.length==0)return;const a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("name",t.name),(o=t.options)==null||o.forEach(l=>{i.append(l,"1")});const r=await(await fetch(`${b}/create_moderator_role`,{method:"POST",body:i,headers:a.headers})).json();!r||!r.id||(console.log("new role",r),c(()=>({selectedRole:r})),P.getState().setAbsPath(["roles","edit_role"]))},async updateRole(t){var l,n;const a=f.getState().getHeaders();if(!a)return;const i=se.getState().selectedRole;if(!i)return;if(!t.name&&!t.options)return console.log("data",t);const s=new FormData;s.append("role_id",i.id),t.name&&s.append("name",t.name),((l=t.options)==null?void 0:l.length)>0&&s.append("newOptions","ok"),(n=t.options)==null||n.forEach(u=>{s.append(u,"1")});const o=await(await fetch(`${b}/update_role`,{method:"PUT",body:s,headers:a.headers})).json();!o||!o.id||c(()=>({selectedRole:o}))},async deleteRole(t){console.log(t);let a=f.getState().user;if(!a)return;const i=new Headers;i.append("Authorization",`Bearer ${a.token}`);const s=new FormData;s.append("role_id",t);const r={method:"DELETE",headers:i,body:s};(await(await fetch(`${b}/delete_role`,r)).json()).deleted&&c(()=>({selectedRole:void 0}))},async fetchRolesJson(){const a=await(await fetch(`${b}/get_roles_json/?type=moderator`)).json();a&&c(()=>({json_roles:a}))},async fetchRoles(t={}){let a=f.getState().getHeaders();if(!a)return;const i={method:"GET",headers:a.headers},s=new URLSearchParams({});t.type="moderator";for(const l in t){const n=t[l];s.set(l,n)}const o=await(await fetch(`${b}/get_store_roles/?${s.toString()}`,i)).json();if(!(!o||!o.list))return c(()=>({roles:o})),o}}));function ze(){const{current:c,setAbsPath:t}=P(),{addModerator:a,setSelectedModerator:i}=G(),{roles:s,fetchRoles:r}=se(),{user:o}=f(),n=oe().width<1e3?"wrap":"",[u]=p.useState({});return p.useEffect(()=>{r()},[o]),c("new_moderator")&&e.jsxs("div",{className:"moderator-profile",ref:K,children:[e.jsx(ve,{terme:"white",mode:"create",title:"Collaborator Information",onCreate:()=>{a({email:u.email,role_id:u.role_id}).then(h=>{h!=null&&h.id&&(i(h),t(["moderators","moderator_profile"]))})}}),e.jsxs("section",{className:"editor "+n,children:[e.jsx("div",{className:"left-right",children:e.jsx(T,{editable:!0,prompt:"Collaborator Email",min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:"",onChange:h=>{u.email=h}})}),e.jsx("div",{className:"left-side",children:e.jsx(Re,{roles:(s==null?void 0:s.list)||[],onChange:h=>{u.role_id=h},canChange:()=>!0})})]})]})}function We(){const{check:c,current:t,setAbsPath:a}=P();return c("moderators")&&e.jsxs("div",{className:"moderator-page",children:[t("moderators","moderator_profile")&&e.jsx(je,{collabo:!1,active:"moderators",setActive:i=>a(i.path)}),e.jsx(Fe,{}),e.jsx(Le,{}),e.jsx(ze,{})]})}function Ve(){const{current:c,setAbsPath:t,qs:a}=P(),{roles:i,setSelectedRole:s,fetchRoles:r}=se(),{user:o}=f();return p.useEffect(()=>{c("roles")&&o&&r()},[o]),c("roles")&&e.jsx("div",{className:"collaborator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(q,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:ge(["PAUSE","TRASH","NEW"],[]),index:fe([0,100]),is_dynamic_price:ae(),hasScene:ae()}},items_height:80,id:"collaborator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{id:{getView(l,n,u,h){return e.jsxs("div",{ref:h,children:["#",n.split("-")[0]]},u.id)}},name:q.StringElement({size_interval:[50,200]}),created_at:q.DateStringElement({size:200})},onItemsSelected:(l,n)=>{n.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="")}),l.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="#00f2")}),s(l[0]),a({role_id:l[0].id}).setAbsPath(["roles","edit_role"])},onQuery:l=>{r(l)},canAddNew:!0,onNewRequired:()=>{t(["roles","create_role"])},top_height:40,canPaginate:!0})})})}function Je(){const{selectedRole:c,setRoleById:t,updateRole:a,newRole:i,deleteRole:s,fetchRolesJson:r,json_roles:o}=se(),{current:l,json:n}=P(),{user:u}=f(),[h]=p.useState({}),j=l("edit_role"),g=l("create_role");return p.useEffect(()=>{(j||g)&&(n!=null&&n.role_id)&&u&&t(n==null?void 0:n.role_id)},[n,u]),p.useEffect(()=>{(j||g)&&r()},[n]),(j||g)&&(!c&&j?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"role-dash",ref:K,children:[e.jsx(ve,{title:"Role Information",mode:j?"delete":"create",deteleKey:c==null?void 0:c.id,onDelete:()=>{c&&s(c.id)},onCreate:()=>{i(h)}}),e.jsxs("section",{className:"editor",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(T,{min:3,max:25,placeholder:"Role Name",prompt:"Role Name",editable:!0,label:"Name",value:j?c==null?void 0:c.name:"",onChange:m=>{j?a({name:m}):h.name=m}}),j&&e.jsxs(e.Fragment,{children:[e.jsx(T,{label:"Id",value:c==null?void 0:c.id}),e.jsx(T,{label:"Created At",value:c==null?void 0:c.created_at}),e.jsx(T,{label:"Update At",value:c==null?void 0:c.updated_at}),e.jsx(Ae,{})]})]}),e.jsx("div",{className:"right-side",children:e.jsx(Me,{json_roles:o,role:c,isNew:g,onChange:m=>{j?a({options:m}):h.options=m}})})]})]}))}function Ge(){const{check:c,current:t,setAbsPath:a}=P();return c("roles")&&e.jsxs("div",{className:"role-page",children:[t("roles","edit_role")&&e.jsx(je,{collabo:!1,active:"roles",setActive:i=>a(i.path)}),e.jsx(Ve,{}),e.jsx(Je,{})]})}const Ye="new_discussion",Ke="new_distore",ee=Y(c=>({async fetchEditMessage(t){const a=f.getState().getHeaders();if(!a)return;const i=new FormData;i.append("message_id",t.message_id),i.append("text",t.text);const s=await fetch(`${b}/edit_message`,{method:"PUT",headers:a.headers,body:i});try{const r=await s.json();return console.log("edit_message ",r),r!=null&&r.id?r:void 0}catch(r){console.log(r)}},async fetchDeleteMessageBoth(t){const a=f.getState().getHeaders();if(!a)return;console.log("$$$$$$$$");const i=await fetch(`${b}/delete_message/${t}`,{method:"DELETE",headers:a.headers});try{const s=await i.json();return console.log("fetchDeleteMessageBoth",s),s==null?void 0:s.deleted}catch(s){console.log(s)}},async fetchDeleteMessageMe(t){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${b}/delete_message/${t}`,{method:"DELETE",headers:a.headers});try{const s=await i.json();return console.log("fetchDeleteMessageMe",s),s==null?void 0:s.deleted}catch(s){console.log(s)}},async fetchSendMessage({context:t,context_name:a,files:i,text:s}){if(!t||!t.id)return;if(t.id.startsWith(Ye)){const n=await $.getState().createDiscussion({other_id:t.other.id,store_id:t.to_id});if(console.log("D"),!n||!n.id)return;t=n,$.getState().setDiscussion(n)}else t.id.startsWith(Ke);const r=f.getState().getHeaders();if(!r)return;const o=new FormData;if(!s&&!i)return;if(i)for(let n=0;n<i.length;n++){const u=i[n];o.append("files_"+n,u)}if(o.append("context_id",t.id),o.append("context_name",a),s&&o.append("text",s),i)for(let n=0;n<i.length;++n){const u=i[n];o.append("files_"+n,u)}const l=await fetch(`${b}/send_message`,{headers:r.headers,body:o,method:"POST"});try{const n=await l.json();return console.log("fetchSendMessage",n),n!=null&&n.id?n:void 0}catch(n){console.log(n)}},async fetchMessages(t,a){if(t.toLowerCase().startsWith("new_"))return;const i=f.getState().getHeaders();if(!i)return;const s=await fetch(`${b}/get_messages/?context_id=${t}&context_name=${a}`,{headers:i.headers});try{const r=await s.json();return r!=null&&r.list?r:void 0}catch{}}})),xe="new_discussion";let ce;const ue=[],$=Y(c=>({discussion:void 0,discussions:void 0,messages:void 0,setDiscussion(t){c(()=>({discussion:t}))},async setDiscussionByOtherId({other_id:t,store_id:a,findOther:i},s){var j,g,m;const r=s||c,o=f.getState().getHeaders();if(!o||t==o.user.id)return;const l=(j=$.getState().discussions)==null?void 0:j.list,n=l==null?void 0:l.find(S=>S.other.id==t&&(a?!!L(void 0,S):!L(void 0,S)));if(n){if(((g=$.getState().messages)==null?void 0:g.list[0].table_id)==n.id)return;const S=await ee.getState().fetchMessages(n.id,"discussions");r(()=>({discussion:n,messages:S}));return}const u=(m=await $.getState().fetchDiscussions({no_save:!0,other_id:t,store_id:a}))==null?void 0:m.list[0];if(u){const S=await ee.getState().fetchMessages(u.id,"discussions");r(()=>({discussion:u,messages:S}));return}const h=await i(t,a);h&&$.getState().addDiscussion({other:h,store_id:a})},async openDiscussionMessages(t){const a=await ee.getState().fetchMessages(t,"discussions");c(()=>({messages:a}))},async unBlockDiscussion(t){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${b}/unblock_discussion/${t.id}`,{method:"PUT",headers:a.headers});try{const s=await i.json();return console.log("unblock_discussion ",s),s!=null&&s.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(o=>o.id==s.id?{...o,...s}:o)}})),s):void 0}catch(s){console.log(s)}},async blockDiscussion(t){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${b}/block_discussion/${t.id}`,{method:"PUT",headers:a.headers});try{const s=await i.json();return console.log("unblock_discussion ",s),s!=null&&s.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(o=>o.id==s.id?{...o,...s}:o)}})),s):void 0}catch(s){console.log(s)}},async deleteDiscussion(t){const a=f.getState().getHeaders();if(!a)return;const i=await fetch(`${b}/delete_discussion/${t.id}`,{method:"DELETE",headers:a.headers});try{const s=await i.json();return console.log("deleteDiscussion ",s),s!=null&&s.deleted?(c(({discussions:r,messages:o,discussion:l})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).filter(n=>n.id!==t.id)},messages:(l==null?void 0:l.id)==t.id?void 0:o})),!0):void 0}catch(s){console.log(s)}},async createDiscussion({other_id:t,store_id:a}){const i=f.getState().getHeaders();if(!i)return;const s=new FormData;s.append("receiver_id",t),a&&s.append("to_id",a);const r=await fetch(`${b}/create_discussion`,{headers:i.headers,body:s,method:"POST"});try{const o=await r.json();return console.log("createDiscussion",o),o!=null&&o.id?o:void 0}catch(o){console.log(o)}},async addDiscussion({other:t,store_id:a}){var n,u;const i=f.getState().getHeaders();if(!i||t.id==i.user.id)return;const s=(n=$.getState().discussions)==null?void 0:n.list,r=s==null?void 0:s.find(h=>h.other.id==t.id&&(a?!L(void 0,h):!!L(void 0,h)));if(console.log("addDiscussion",{exist:r}),r){const h=await ee.getState().fetchMessages(r.id,"discussions");return c(()=>({discussion:r,messages:h})),r}const o=(u=$.getState().discussions)==null?void 0:u.list.filter(h=>h.id.startsWith(xe)?(h.receiver_id==t.id||h.creator_id==t.id)&&L(void 0,h)===(a||null):!1);if(o!=null&&o[0]){c(({discussions:h})=>({discussions:h&&{...h}}));return}const l={id:xe+Date.now(),creator_id:i.user.id,receiver_id:t.id,deleted:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:t,from_id:void 0,to_id:a,last_message:void 0,other_att:"creator"};return c(({discussions:h})=>({messages:{list:[],limit:25,page:1,total:0},discussion:l,discussions:h&&{...h,list:[l,...h.list]}})),console.log("NEW DISCUSSION",l),l},async fetchDiscussions({discussion_id:t,no_save:a,other_id:i,store_id:s}){const r=f.getState().getHeaders();if(!r)return;const o=new URLSearchParams({});s&&(o.set("to_id",s),o.set("add_store","true")),t&&o.set("discussion_id",t),i&&o.set("other_id",i);const n=await(await fetch(`${b}/get_discussions?${o}`,{headers:r.headers})).json();if(console.log("fetch Discussions",n),!n)return;ce=c,n.list.forEach(async h=>{_e(h)});const u=`${r.user.id}/`;if(!ue.includes(u)){ue.push(u);const h=be.subscription(u);await h.create(),h.onMessage(async j=>{var g;if(j.new_discussion){console.log("new_discussion ==>  ",j.new_discussion),_e(j.new_discussion);const m=j.new_discussion,S=m.receiver.id!=r.user.id?"receiver":"creator";m.other_att=S,m.other=m[S];const C=(g=$.getState().discussions)==null?void 0:g.list.filter(N=>N.id.startsWith(xe)?!(N.other.id==m.other.id&&(N.from_id||null)==(m.from_id||null)&&(N.to_id||null)==(m.to_id||null)):!0);c(({discussions:N})=>({discussions:N&&{...N,list:[m,...C||[]]}}))}j.reload_discussion&&(console.log("reload_discussion ==>  "),$.getState().fetchDiscussions({}))})}return a||c(({discussions:h})=>({discussions:{...n,list:[...((h==null?void 0:h.list)||[]).filter(j=>j.id.startsWith("new_")),...n.list]}})),n}}));async function _e(c){if(!f.getState().getHeaders()||ue.includes(c.id))return;ue.push(c.id);const a=be.subscription(c.id);await a.create(),a.onMessage(async i=>{var r,o;if(!ce)return;const s=$.getState().discussion;if(i.reload){const l=(r=$.getState().discussions)==null?void 0:r.list,n=(o=await $.getState().fetchDiscussions({discussion_id:c.id,no_save:!0}))==null?void 0:o.list;if(console.log("reload Discussion ___________ ",n==null?void 0:n.length),!(n!=null&&n[0].id))return;const u=[...(l==null?void 0:l.map(h=>h.id==c.id?n==null?void 0:n[0]:h))||[]];ce(({discussions:h})=>({discussions:h&&{...h,list:u}})),(s==null?void 0:s.id)==(n==null?void 0:n[0].id)&&ce(()=>({discussion:{...n==null?void 0:n[0]}}))}if(i.reloadMessage&&(s==null?void 0:s.id)==c.id){console.log("reload Message___________",s);const l=await ee.getState().fetchMessages(c.id,"discussions");ce(()=>({messages:l,discussion:{...c}}))}})}function pe(){var E;const{discussion:c,discussions:t,fetchDiscussions:a,addDiscussion:i,blockDiscussion:s,deleteDiscussion:r,unBlockDiscussion:o,setDiscussionByOtherId:l}=$(),{json:n,pathList:u,qs:h,check:j}=P(),g=(E=u[3])==null?void 0:E.split("_")[1],[m,S]=p.useState(g||"all"),{openChild:C}=re(),{user:N}=f(),{fetchUsers:w}=ne(),{fetchModerators:M}=G();if(p.useEffect(()=>{N&&(n!=null&&n.collaborator_id||n!=null&&n.moderator_id)&&l({async findOther(x){var A;return(A=await w({query:{user_id:x}}))==null?void 0:A.list[0]},other_id:(n==null?void 0:n.collaborator_id)||(n==null?void 0:n.moderator_id),store_id:n==null?void 0:n.store_id}),S(g||"all")},[n,N]),p.useEffect(()=>{j("chat")&&!t&&N&&a({store_id:null})},[N]),p.useEffect(()=>{S(g||"all")},[u]),!N)return;const _=t==null?void 0:t.list.filter(x=>{var A;return!((A=x.blocked)!=null&&A.includes(N.id))}),y=t==null?void 0:t.list.filter(x=>{var A;return(A=x.blocked)==null?void 0:A.includes(N.id)}),R=_==null?void 0:_.filter(x=>x.unchecked_count>0);let H=[];m=="all"?H=_:m=="new"?H=R:H=y;let O=0;R==null||R.forEach(x=>{O+=x.unchecked_count});let B=0;return R==null||R.forEach(x=>{B+=x.unchecked_count}),e.jsxs("div",{className:"discussion-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Chats "}),e.jsxs("div",{className:"add-new",onClick:()=>{C(e.jsx(Ce,{user:N,openChild:C,fetchUsers:M,setUser:x=>{i({other:x})}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{h(n||{}).setAbsPath(["chat","discussions","discussions_all"])},children:e.jsxs("div",{className:m=="all"?"active":"",children:["All",((_==null?void 0:_.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{h(n||{}).setAbsPath(["chat","discussions","discussions_new"])},children:e.jsxs("div",{className:m=="new"?"active":"",children:["New ",((R==null?void 0:R.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{h(n||{}).setAbsPath(["chat","discussions","discussions_blocked"])},children:e.jsxs("div",{className:m=="blocked"?"active":"",children:["Blocked  ",((y==null?void 0:y.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"discussions",children:H==null?void 0:H.map(x=>{var Q,z,d;let A="";return((Q=x.last_message)==null?void 0:Q.user_id)==N.id&&(x[`${x.other_att}_opened_at`]?new Date(x[`${x.other_att}_opened_at`])<new Date(x.last_message.created_at)?A="one":A="double":A="one"),e.jsxs("div",{className:"discussion "+((c==null?void 0:c.id)==x.id?"active":""),onClick:v=>{x.unchecked_count=0,h({store_id:L(void 0,x),[L(void 0,x)?"collaborator_id":"moderator_id"]:x.other.id,nav:document.querySelector(".back-close.nav").getBoundingClientRect().width==0?void 0:"min"}).setAbsPath(["chat","discussions","discussions_"+(m||"_all")]);const k=v.currentTarget.querySelector(".count");k.style.display="none"},onContextMenu:v=>{v.preventDefault(),C(e.jsx(Qe,{blocked:!!(y!=null&&y.includes(x)),x:v.clientX,y:v.clientY,onBlock:k=>{k?(s(x),h(n||{}).setAbsPath(["chat","discussions","discussions_blocked"])):(o(x),h(n||{}).setAbsPath(["chat","discussions","discussions_all"]))},onAsRead:()=>{},onDelete:()=>{r(x)}}))},children:[e.jsx("div",{className:"photo",style:{background:V((d=(z=x.other)==null?void 0:z.photos)==null?void 0:d[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:W(x.other.name,16)}),e.jsx("div",{className:"date",children:x.last_message&&he(x.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+A}),e.jsx("div",{className:"text",children:x.last_message?W(x.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(c==null?void 0:c.id)==x.id?"none":x.unchecked_count>0?"flex":"none"},children:x.unchecked_count})]}),x.store&&e.jsx("div",{className:"store-name",children:x.store.name})]})]},x.id)})})]})}function Qe({x:c,y:t,onBlock:a,onAsRead:i,onDelete:s,blocked:r}){const o=p.useRef(null);return p.useEffect(()=>{o.current&&me(o.current)}),e.jsxs("div",{ref:o,className:"discussion-popu",style:{top:`${t}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>a(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:s,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function de(){var z;const{discussion:c,messages:t}=$(),{fetchSendMessage:a,fetchDeleteMessageBoth:i,fetchDeleteMessageMe:s,fetchEditMessage:r}=ee(),{user:o}=f(),{openChild:l}=re(),{qs:n,navBack:u}=P(),[h,j]=p.useState(!1),[g,m]=p.useState(1),[S,C]=p.useState(!1),N=p.useRef(null),w=p.useRef(null),[M,_]=p.useState(null),[y]=p.useState(Date.now()+""),[R,H]=p.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),O=oe(),B=()=>{if(!w.current)return;const d=w.current,v=Math.ceil(d.scrollHeight/(d.getBoundingClientRect().height||20)),k=Math.ceil(d.scrollHeight/20),I=d.value.split(`
`).length;let U=Math.max(v,I,k);U=U>10?10:U-1>=1?U-1:1,m(U)};p.useEffect(()=>{B()},[O]),p.useEffect(()=>{window.addEventListener("click",()=>{S&&C(!1)})},[]);const E=c==null?void 0:c.other.photos[0],x=(d,v)=>d.list[v].user_id==(o==null?void 0:o.id)?"right":"left",A=(d,v)=>d.list[v-1]&&d.list[v-1].user_id==(o==null?void 0:o.id)?"right":"left",Q=(d,v)=>d.list[v+1]&&(d.list[v+1].user_id==(o==null?void 0:o.id)?"right":"left");return e.jsxs("div",{className:"discussion-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"open-nonav",onClick:()=>{u()}}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${E!=null&&E.startsWith("/")?b:""}${E})`},onClick:()=>{n({collaborator_id:c.other.id}).setAbsPath(["moderators","moderator_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:W(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",he(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:J()})})]})]}),!c&&e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})}),c&&o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"messages",ref:d=>{N.current=d,h||(N.current&&N.current.scrollTo({top:N.current.scrollHeight}),j(!0))},onScroll:d=>{const v=d.currentTarget;clearInterval(R.lastid);const k=setTimeout(()=>{const I={isOpen:!1,height:v.scrollHeight,bottom:v.scrollHeight-(v.scrollTop+v.getBoundingClientRect().height),top:v.scrollTop,onProcess:!1,lastid:k};I.bottom>150&&(I.isOpen=!0),H(I),console.log(k)},100);R.lastid=k},children:(z=t==null?void 0:t.list)==null?void 0:z.map((d,v)=>{var X;const k=x(t,v),I=A(t,v),U=Q(t,v);let F="";return k==I?U&&I==U&&(F="mid"):U&&k==U&&(F="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+k+" "+F,onContextMenu:D=>{D.preventDefault(),l(e.jsx(Xe,{forMe:o.id==d.user_id,x:D.clientX,y:D.clientY,onDeleteBoth:()=>{i(d.id)},onDeleteMe:()=>{s(d.id)},onEdit:()=>{l(e.jsx(Ze,{x:D.clientX,y:D.clientY,text:d.text,onEdit:le=>{l(void 0),r({message_id:d.id,text:le})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:d.text&&d.text.split(" ").map((D,le)=>D.includes(`
`)?D.split(`
`).map((Ee,$e)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:Ee}),e.jsx("br",{})]},le+"_"+$e)):e.jsx("span",{style:{marginRight:"4px"},children:D},le))}),e.jsx("div",{className:"files",children:(X=d.files)==null?void 0:X.map(D=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${D.startsWith("/")?b:""}${D}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:D.length>35?W(D,25)+D.substring(D.length-8,D.length):D})]},D))}),e.jsxs("div",{className:"info",children:[d.created_at!=d.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:he(d.created_at)})]})]})},d.id)})}),e.jsxs("div",{className:"sender",children:[R.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{N.current&&N.current.scrollTo({behavior:"smooth",top:R.height})}}),S&&e.jsx("div",{className:"emoji-list",onClick:d=>{d.preventDefault(),d.stopPropagation()},children:Te.map(d=>e.jsx("span",{onClick:v=>{v.preventDefault(),v.stopPropagation(),w.current&&(w.current.value+=d.char)},children:d.char},d.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:y+"message_file",onChange:d=>{if(!d.currentTarget.files)return;const v=[];for(let k=0;k<d.currentTarget.files.length;k++){const I=d.currentTarget.files[k];v.push(I)}_(v.length>0?M?[...M,...v]:v:null)}}),e.jsx("label",{htmlFor:y+"message_file",className:"add-file",onClick:J()}),e.jsx("div",{className:"emoji-min",onClick:d=>{d.preventDefault(),d.stopPropagation(),J()(d),C(!S)}})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",children:M&&M.map(d=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{M&&_(M.filter(v=>v!==d))}}),e.jsx("div",{className:"text",children:d.name})]},d.name))}),e.jsx("textarea",{autoFocus:!0,ref:w,name:"discussion_sender",placeholder:"Type a message here..",id:"discussion_sender",style:{height:`${g*20}px`},cols:30,rows:10,onChange:d=>{B()},onKeyDown:()=>{C(!1)}})]}),e.jsx("div",{className:"right",children:e.jsx("div",{className:"send",onClick:d=>{var v;J()(d),a({context:c,context_name:"discussions",files:M,text:(v=w.current)==null?void 0:v.value}),_(null),w.current&&(w.current.value="")},children:e.jsx("div",{className:"icon"})})})]})]})]})]})}function Xe({x:c,y:t,onEdit:a,onDeleteBoth:i,onDeleteMe:s,other:r,forMe:o}){const l=p.useRef(null);return p.useEffect(()=>{l.current&&me(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${t}px`,left:`${c}px`},children:[o&&e.jsxs("div",{className:"edit",onClick:n=>{n.preventDefault(),n.stopPropagation(),a()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:s,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),o&&e.jsxs("div",{className:"delete-both",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function Ze({x:c,y:t,onEdit:a,text:i}){const s=p.useRef(null),[r,o]=p.useState(i);return p.useEffect(()=>{s.current&&me(s.current)}),e.jsxs("div",{ref:s,className:"message-edit-popu",style:{top:`${t}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{o(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{a(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}const De=Y(c=>({serviceStore:void 0,serviceStores:void 0,serviceDiscussions:void 0,serviceDiscussion:void 0,async fetchServiceDiscussions(t){const a=await $.getState().fetchDiscussions({...t,no_save:!0});return c(()=>({serviceDiscussions:a})),a},async fetchServiceStores(t){const a=await ie.getState().fetchStores(t,!0);return c(()=>({serviceStores:a})),a},async setServiceStore(t){c(()=>({serviceStore:t}))},async setServiceDiscussionById(t){$.getState().setDiscussionByOtherId(t,c)},async setServiceStoreById(t){var i;const a=(i=De.getState().serviceStores)==null?void 0:i.list.find(s=>s.id==t);if(a)c(()=>({serviceStore:a}));else{const s=await ie.getState().fetchStores({text:`#${t}`},!0);c(()=>({serviceStore:s==null?void 0:s.list[0]}))}}}));function es(){var z;const{addDiscussion:c,blockDiscussion:t,deleteDiscussion:a,unBlockDiscussion:i}=$(),{serviceStore:s,serviceStores:r,setServiceStoreById:o,fetchServiceStores:l,serviceDiscussions:n,serviceDiscussion:u,setServiceDiscussionById:h,fetchServiceDiscussions:j}=De(),{check:g,json:m,pathList:S,qs:C}=P(),N=(z=S[3])==null?void 0:z.split("_")[1],[w,M]=p.useState(N||"all"),{openChild:_}=re(),{user:y}=f(),{fetchUsers:R}=ne(),{fetchModerators:H}=G();if(p.useEffect(()=>{y&&(m!=null&&m.collaborator_id||m!=null&&m.moderator_id)?(console.log({json:m}),h({async findOther(d){var v;return(v=await R({query:{user_id:d}}))==null?void 0:v.list[0]},other_id:(m==null?void 0:m.collaborator_id)||(m==null?void 0:m.moderator_id),store_id:m==null?void 0:m.store_id})):m&&y&&g("services")&&m.store_id&&o(m.store_id),M(N||"all")},[m,y]),p.useEffect(()=>{M(N||"all")},[S]),p.useEffect(()=>{y&&g("services")&&l({})},[y]),p.useEffect(()=>{g("services")&&s&&j({store_id:s.id})},[s]),!y)return;const O=n==null?void 0:n.list.filter(d=>{var v;return!((v=d.blocked)!=null&&v.includes(y.id))}),B=n==null?void 0:n.list.filter(d=>{var v;return(v=d.blocked)==null?void 0:v.includes(y.id)}),E=O==null?void 0:O.filter(d=>d.unchecked_count>0);let x=[];w=="all"?x=O:w=="new"?x=E:x=B;let A=0;E==null||E.forEach(d=>{A+=d.unchecked_count});let Q=0;return E==null||E.forEach(d=>{Q+=d.unchecked_count}),e.jsxs("div",{className:"service-nav",children:[e.jsxs("div",{className:"title",children:[e.jsxs("div",{className:"label",children:[(s==null?void 0:s.name)||"Services"," "]}),s&&e.jsxs("div",{className:"add-new",onClick:()=>{_(e.jsx(Ce,{user:y,openChild:_,fetchUsers:H,setUser:d=>{c({other:d})}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),!s&&e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{C(m||{}).setAbsPath(["chat","services","services_all"])},children:e.jsxs("div",{className:w=="all"?"active":"",children:["All",((O==null?void 0:O.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{C(m||{}).setAbsPath(["chat","services","services_new"])},children:e.jsxs("div",{className:w=="new"?"active":"",children:["New ",((E==null?void 0:E.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{C(m||{}).setAbsPath(["chat","services","services_blocked"])},children:e.jsxs("div",{className:w=="blocked"?"active":"",children:["Blocked  ",((B==null?void 0:B.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"service-stores",children:r==null?void 0:r.list.map(d=>{var v;return e.jsxs("div",{className:"store "+((s==null?void 0:s.id)==d.id?"active":""),onClick:()=>{C({store_id:d.id}).setAbsPath(["chat","services","services_all"])},children:[e.jsx("div",{className:"logo",style:{background:V((v=d.logo)==null?void 0:v[0])}}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"top-ctn",children:e.jsx("div",{className:"name",children:W(d.name,16)})}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"email",children:W(d.store_email,24)}),e.jsx("div",{className:"count",style:{display:"flex"},children:"5"})]})]})]})})}),e.jsx("div",{className:"services",children:x==null?void 0:x.map(d=>{var k,I,U;let v="";return((k=d.last_message)==null?void 0:k.user_id)==y.id&&(d[`${d.other_att}_opened_at`]?new Date(d[`${d.other_att}_opened_at`])<new Date(d.last_message.created_at)?v="one":v="double":v="one"),e.jsxs("div",{className:"service "+((u==null?void 0:u.id)==d.id?"active":""),onClick:F=>{d.unchecked_count=0,C({store_id:L(void 0,d),[L(void 0,d)?"collaborator_id":"moderator_id"]:d.other.id}).setAbsPath(["chat","services","services_"+(w||"_all")]);const X=F.currentTarget.querySelector(".count");X.style.display="none"},onContextMenu:F=>{F.preventDefault(),_(e.jsx(ss,{blocked:!!(B!=null&&B.includes(d)),x:F.clientX,y:F.clientY,onBlock:X=>{X?(t(d),C(m||{}).setAbsPath(["chat","services","services_blocked"])):(i(d),C(m||{}).setAbsPath(["chat","services","services_all"]))},onAsRead:()=>{},onDelete:()=>{a(d)}}))},children:[e.jsx("div",{className:"photo",style:{background:V((U=(I=d.other)==null?void 0:I.photos)==null?void 0:U[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:W(d.other.name,16)}),e.jsx("div",{className:"date",children:d.last_message&&he(d.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+v}),e.jsx("div",{className:"text",children:d.last_message?W(d.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(u==null?void 0:u.id)==d.id?"none":d.unchecked_count>0?"flex":"none"},children:d.unchecked_count})]})]})]},d.id)})})]})}function ss({x:c,y:t,onBlock:a,onAsRead:i,onDelete:s,blocked:r}){const o=p.useRef(null);return p.useEffect(()=>{o.current&&me(o.current)}),e.jsxs("div",{ref:o,className:"service-popu",style:{top:`${t}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:i,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>a(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:s,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function ts(){const{check:c,qs:t,json:a,pathList:i}=P(),{user:s}=f(),r={discussions:e.jsx(pe,{}),groups:e.jsx(pe,{}),services:e.jsx(es,{}),surveys:e.jsx(pe,{})},o={discussions:e.jsx(de,{}),groups:e.jsx(de,{}),services:e.jsx(de,{}),surveys:e.jsx(de,{})},l=(i==null?void 0:i[2])||"discussions",n=(a==null?void 0:a.nav)||"max";return c("chat")&&s&&e.jsxs("div",{className:"page-chat",children:[e.jsx("div",{className:"back-close nav",style:{display:n=="min"?"none":""},onClick:u=>{u.currentTarget==u.target&&t({...a,nav:"min"}).apply()}}),e.jsxs("div",{className:"chat-nav "+n,children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"nav-size "+n,onClick:u=>{J(.4)(u),t({...a,nav:n=="min"?"max":"min"}).apply()}}),e.jsx("div",{className:"icon discussions-icon "+(l=="discussions"?"active":""),onClick:u=>{J(.4)(u),t({nav:n}).setAbsPath(["chat","discussions"])}}),e.jsx("div",{className:"icon services "+(l=="services"?"active":""),onClick:u=>{J(.4)(u),t({nav:n}).setAbsPath(["chat","services"])}}),e.jsx("div",{className:"icon profile",style:{background:`no-repeat center/cover url(${s.photos[0].startsWith("/")?b:""}${s.photos[0]})`},onClick:()=>{}})]}),n=="max"&&e.jsx("div",{className:"nav-ctn",children:r[l]})]}),e.jsx("div",{className:"chat-center",children:o[l]})]})}const Se={stores:"Stores",store_info:"Store Info",roles:"Roles",edit_role:"Edit Role",create_role:"Create Role",users:"Users",user_profile:"User Profile",chat:"Chat",discussions:"Discussions",groups:"Groups",surveys:"Surveys",interface:"Interfaces",statistic:"Statistic",action:"Action",moderators:"Moderators",moderator_profile:"Moderator Profile"};function as(){const{currentChild:c,blur:t,openChild:a,T:i,setT:s,back_color:r}=re(),{authenticateUser:o,user:l}=f(),{pathList:n,setAbsPath:u}=P(),h=[],j=p.useRef(null);return p.useEffect(()=>{a(void 0)},[n]),n.forEach(g=>{Se[g]&&h.push(Se[g])}),p.useEffect(()=>{o(),window.addEventListener("blur",()=>{a(void 0)})},[]),e.jsxs("div",{className:"dash "+(i?"sombre-mode-variable":""),ref:j,children:[e.jsx(Ne,{blur:t}),!l&&e.jsx(Be,{}),e.jsx("div",{className:"dash-ctn "+(l?t?"blur":"":"blur"),children:e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"center-top",children:[e.jsxs("div",{className:"nav-min",onClick:()=>{a(e.jsx(Ne,{className:"max",blur:t}),!0,"#345b")},children:[" ",e.jsx("span",{})]}),e.jsx("div",{className:"page-path",children:h.map((g,m)=>e.jsxs("div",{className:"path",children:[e.jsxs("div",{className:"label",onClick:()=>{const S=n.slice(1,m+2);u(S)},children:[g,e.jsx("span",{})]}),h[m+1]?e.jsx("div",{className:"icon"}):void 0]},m))}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+i,onClick:()=>{s(i?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]})]}),e.jsxs("div",{className:"center-ctn",ref:g=>{if(!g||g.dataset.init)return;g.dataset.init="true";const m=()=>{const S=document.querySelector(".dash .center .center-top");g.style.height=`calc(100% - ${S.getBoundingClientRect().height}px)`};window.addEventListener("resize",m),m()},children:[e.jsx(Ue,{}),e.jsx(Ie,{}),e.jsx(He,{}),e.jsx(We,{}),e.jsx(Ge,{}),e.jsx(ts,{})]})]})}),c&&e.jsx("div",{className:"child-viewer",onContextMenu:g=>{g.preventDefault(),a(void 0)},children:e.jsx("div",{className:"child-viewer-ctn",style:{background:r},onClick:()=>{a(void 0)},onContextMenu:g=>{g.preventDefault(),a(void 0)},children:c})})]})}const is=c=>c,ds=is(e.jsx(Pe.StrictMode,{children:e.jsx(as,{})}));export{ds as AdminView};
