class y{constructor(t,s,i){this.set(t,s,i)}toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`}set(t,s,i){this.r=this.clamp(t),this.g=this.clamp(s),this.b=this.clamp(i)}hueRotate(t=0){t=t/180*Math.PI;const s=Math.sin(t),i=Math.cos(t);this.multiply([.213+i*.787-s*.213,.715-i*.715-s*.715,.072-i*.072+s*.928,.213-i*.213+s*.143,.715+i*.285+s*.14,.072-i*.072-s*.283,.213-i*.213-s*.787,.715-i*.715+s*.715,.072+i*.928+s*.072])}grayscale(t=1){this.multiply([.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)])}sepia(t=1){this.multiply([.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)])}saturate(t=1){this.multiply([.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t])}multiply(t){const s=this.clamp(this.r*t[0]+this.g*t[1]+this.b*t[2]),i=this.clamp(this.r*t[3]+this.g*t[4]+this.b*t[5]),r=this.clamp(this.r*t[6]+this.g*t[7]+this.b*t[8]);this.r=s,this.g=i,this.b=r}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-(.5*t)+.5)}linear(t=1,s=0){this.r=this.clamp(this.r*t+s*255),this.g=this.clamp(this.g*t+s*255),this.b=this.clamp(this.b*t+s*255)}invert(t=1){this.r=this.clamp((t+this.r/255*(1-2*t))*255),this.g=this.clamp((t+this.g/255*(1-2*t))*255),this.b=this.clamp((t+this.b/255*(1-2*t))*255)}hsl(){const t=this.r/255,s=this.g/255,i=this.b/255,r=Math.max(t,s,i),h=Math.min(t,s,i);let e,f,b=(r+h)/2;if(r===h)e=f=0;else{const l=r-h;switch(f=b>.5?l/(2-r-h):l/(r+h),r){case t:e=(s-i)/l+(s<i?6:0);break;case s:e=(i-t)/l+2;break;case i:e=(t-s)/l+4;break}e/=6}return{h:e*100,s:f*100,l:b*100}}clamp(t){return t>255?t=255:t<0&&(t=0),t}}class k{constructor(t,s){this.target=t,this.targetHSL=t.hsl(),this.reusedColor=new y(0,0,0)}solve(){const t=this.solveNarrow(this.solveWide());return{values:t.values,loss:t.loss,filter:this.css(t.values)}}solveWide(){const i=[60,180,18e3,600,1.2,1.2];let r={loss:1/0};for(let h=0;r.loss>25&&h<3;h++){const e=[50,20,3750,50,100,100],f=this.spsa(5,i,15,e,1e3);f.loss<r.loss&&(r=f)}return r}solveNarrow(t){const s=t.loss,i=2,r=s+1,h=[.25*r,.25*r,r,.25*r,.2*r,.2*r];return this.spsa(s,h,i,t.values,500)}spsa(t,s,i,r,h){const f=.16666666666666666;let b=null,l=1/0;const p=new Array(6),m=new Array(6),M=new Array(6);for(let o=0;o<h;o++){const g=i/Math.pow(o+1,f);for(let n=0;n<6;n++)p[n]=Math.random()>.5?1:-1,m[n]=r[n]+g*p[n],M[n]=r[n]-g*p[n];const a=this.loss(m)-this.loss(M);for(let n=0;n<6;n++){const A=a/(2*g)*p[n],S=s[n]/Math.pow(t+o+1,1);r[n]=$(r[n]-S*A,n)}const w=this.loss(r);w<l&&(b=r.slice(0),l=w)}return{values:b,loss:l};function $(o,g){let a=100;return g===2?a=7500:(g===4||g===5)&&(a=200),g===3?o>a?o%=a:o<0&&(o=a+o%a):o<0?o=0:o>a&&(o=a),o}}loss(t){const s=this.reusedColor;s.set(0,0,0),s.invert(t[0]/100),s.sepia(t[1]/100),s.saturate(t[2]/100),s.hueRotate(t[3]*3.6),s.brightness(t[4]/100),s.contrast(t[5]/100);const i=s.hsl();return Math.abs(s.r-this.target.r)+Math.abs(s.g-this.target.g)+Math.abs(s.b-this.target.b)+Math.abs(i.h-this.targetHSL.h)+Math.abs(i.s-this.targetHSL.s)+Math.abs(i.l-this.targetHSL.l)}css(t){function s(i,r=1){return Math.round(t[i]*r)}return`invert(${s(0)}%) sepia(${s(1)}%) saturate(${s(2)}%) hue-rotate(${s(3,3.6)}deg) brightness(${s(4)}%) contrast(${s(5)}%)`}}function I(c){const t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;c=c.replace(t,(i,r,h,e)=>r+r+h+h+e+e);const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]:null}const d={},L=c=>{if(d[c])return d[c];const t=I(c);if(t.length!==3){alert("Invalid format!");return}const s=new y(t[0],t[1],t[2]),r=new k(s).solve(),h={color:s,result:r};return d[c]=h,h};function u(c,t){let s=!1;t={...t},delete t.product_id;for(const i in t)c[i]!=t[i]&&(s=!0,c[i]=t[i]);return s}export{u as S,L as t};
