import{a as j,S as v,j as s,g as m,u as _,h as N}from"./Transmit-qTd8py2p.js";import{H as u,r as f,L as $}from"./index-BqiaLFvQ.js";const k="BDwYyNLBYIyNOBFX3M27uTAUXLrUxgHVyBJPjxJj3aQR7ghxC_MetHpzgTspdk4e4Iq9E0LCzeAtbCPOcdclxCk";async function z(r){const e=new Headers;e.append("Authorization",`Bearer ${r.user.token}`),console.log("....remove Notif Context");const t=await fetch(`${u}/add_notif_context/?context_id=${r.context_id}`,{headers:e,method:"POST"});try{return await t.json()}catch{}}async function E(r){const e=new Headers;e.append("Authorization",`Bearer ${r.user.token}`),console.log("....add Notif Context");const t=new FormData;t.append("context_id",r.context_id),t.append("context_name",r.context_name);const o=await fetch(`${u}/add_notif_context`,{headers:e,method:"POST",body:t});try{return await o.json()}catch{}}async function O(r){const e=new Headers;e.append("Authorization",`Bearer ${r.user.token}`),console.log("....get Browsers");const t=new FormData;r.user_browser_id&&t.append("user_browser_id",r.user_browser_id),r.target&&t.append("target",r.target);const o=await fetch(`${u}/disable_notifications`,{headers:e,method:"PUT",body:t});try{return await o.json()}catch{}}async function C(){console.log("Registering service worker...");const r=await navigator.serviceWorker.register("/worker.js",{scope:"/"});return console.log("Service Worker Registered..."),console.log("Registering Push..."),await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:H(k)})}async function B(r){if(console.log("....=>"),(await navigator.permissions.query({name:"notifications"})).state=="granted"){const t=new FormData;t.append("notification_data",JSON.stringify(await C()));const o=new Headers;o.append("Authorization",`Bearer ${r.token}`),console.log("....Send notif data"),fetch(`${u}/set_notification_data/`,{method:"PUT",body:t,headers:o})}else console.log("....notif permission required")}function H(r){const e="=".repeat((4-r.length%4)%4),t=(r+e).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(t),n=new Uint8Array(o.length);for(let d=0;d<o.length;++d)n[d]=o.charCodeAt(d);return n}const P={"/":{home:{},store_list:{},new_store:{},edit_store:{},about:{},pricing:{},tutorial:{product_tuto:{},command_tuto:{},users_tuto:{},interface_tuto:{},statistic_tuto:{}},forum:{subject:{},new_subject:{}}}},p=j(r=>({owner:void 0,stores:void 0,selectedStore:void 0,currentChild:void 0,back_color:"",blur:!1,async exist(e){return(await(await fetch(`${u}/check_store/?store_name=${e}`)).json()).exist==!0},async setStoreById(e){var o,n;const t=(o=p.getState().stores)==null?void 0:o.list.find(d=>d.id==e);if(t)return r(()=>({selectedStore:t}));{const d=(n=await p.getState().fetchStores({text:"#"+e}))==null?void 0:n.list[0];if(d)return r(()=>({selectedStore:d}))}},async fetchStores(e){const t=p.getState().owner;if(!t)return;e.only_owner&&(e.owner_id=t.id),console.log({filter:e});const o=new URLSearchParams({});for(const i in e){const l=e[i];o.set(i,l)}const n=new Headers;n.append("Authorization",`Bearer ${t.token}`);const a=await(await fetch(`${u}/get_stores/?${o}`,{headers:n})).json();if(a!=null&&a.list)return r(()=>({stores:a})),a},openChild(e,t,o){r(()=>({currentChild:e,blur:t,back_color:e&&o||""}))},async deleteStore(e){const t=p.getState().owner;if(!t)return!1;const o=new Headers;o.append("Authorization",`Bearer ${t.token}`);const n={method:"DELETE",headers:o},d=await fetch(`${u}/delete_store/${e}`,n);try{const a=await d.json();return p.getState().fetchStores({}),a==null?void 0:a.deleted}catch{return!1}},setSelectedStore(e){r(()=>({selectedStore:e}))},async disconnection(){const e=p.getState().owner;if(e){const t=new Headers;t.append("Authorization",`Bearer ${e.token}`);const o={method:"GET",headers:t};await fetch(`${u}/disconnection`,o)}localStorage.removeItem("user"),r(()=>({owner:void 0,stores:void 0,selectedStore:void 0}))},async tryToken(){const e=localStorage.getItem("user");if(!e)return;const t=JSON.parse(e),o=new Headers;o.append("Authorization",`Bearer ${t.token}`);const n={method:"GET",headers:o};let a=await(await fetch(`${u}/me`,n)).json();if(!(a!=null&&a.id))return localStorage.removeItem("user");p.getState().fetchStores({}),a={token:t.token,...a},r(()=>({owner:a})),localStorage.setItem("user",JSON.stringify(a))},async editStore(e){const t=p.getState().owner;if(!t)return;const o=new Headers;o.append("Authorization",`Bearer ${t.token}`);const n=new FormData;Object.keys(e).forEach((i,l)=>{console.log("data",l,i,e[i]),i=="banners"||i=="banner"?e.banners instanceof Blob?(n.append("banners",JSON.stringify(["banners_0"])),n.append("banners_0",e.banner)):e.banners&&n.append("banners",JSON.stringify([e.banner])):i=="logo"?e[i]instanceof Blob?(n.append(i,JSON.stringify(["logo_0"])),n.append("logo_0",e[i])):e[i].url&&n.append(i,JSON.stringify([e[i]])):n.append(i,e[i])});const d={method:"PUT",body:n,headers:o},a=await fetch(`${u}/update_store`,d);try{const i=await a.json();return p.getState().fetchStores({}),i}catch(i){console.log(i.message);return}},async createStore(e){try{const t=p.getState().owner;if(!t)return;const o=new Headers;o.append("Authorization",`Bearer ${t.token}`),o.append("sublymus_id","Sublymus_id00");const n=new FormData;console.log(e),Object.keys(e).forEach(l=>{l=="logo"&&(n.append(l,JSON.stringify(["logo_0"])),n.append("logo_0",e[l])),l=="banners"||l=="banner"?(n.append("banners",JSON.stringify(["banners_0"])),n.append("banners_0",e.banner)):n.append(l,e[l])});const d={method:"POST",body:n,headers:o};return await(await fetch(`${u}/create_store`,d)).json()}catch(t){return t}},async createOwner(){window.open(`${u}/google_connexion`,void 0,"popup");const e=setInterval(()=>{const t=localStorage.getItem("user"),o=t&&JSON.parse(t);o&&(r(()=>({owner:o})),clearInterval(e),B(o),p.getState().fetchStores({}))},100)}})),S=new v(P,["/","home"]).getStore(),w=[{u:"home",n:"Home",i:"/src/res/application.png"},{u:"tutorial",n:"Tutorial",i:"/src/res/catalog.png"},{u:"pricing",n:"Pricing",i:"/src/res/shopping-cart.png"},{u:"forum",n:"Forum",i:"/src/res/chat.png"}];function J(){const{setAbsPath:r}=S();return s.jsxs("footer",{className:"footer",children:[s.jsx("ul",{className:"links",children:w.map((e,t)=>s.jsxs("li",{style:{pointerEvents:"initial"},onClick:()=>r([e.u]),children:[s.jsx("span",{style:{background:m(e.i,"60%")}}),e.n]},t))}),s.jsxs("div",{className:"more-info",children:[s.jsxs("div",{children:[" ",s.jsx("p",{children:"Site to create your own customizable store online. "}),s.jsx("a",{href:"/#tutorial",children:" Learn how"}),"."]}),s.jsx("div",{children:s.jsx("p",{children:"Sublymus Â© 2024"})}),s.jsxs("div",{children:[s.jsx("a",{href:"/#about",children:"Terms of Service"})," - ",s.jsx("a",{href:"/#about",children:"Privacy Policy"})]}),s.jsxs("div",{children:[s.jsx("p",{children:"Need help?"})," ",s.jsx("a",{href:"/#contact",children:"Contact Us"})]})]})]})}function L(){var y;const{setAbsPath:r,pathList:e}=S(),[t,o]=f.useState(e[1]||"home"),[n,d]=f.useState(!1),[a,i]=f.useState(!1),{owner:l,createOwner:x}=p(),b=_(),g=c=>{r([c]),o(c)};return f.useEffect(()=>{o(e[1]||"home")},[e]),f.useEffect(()=>{window.addEventListener("click",()=>{const c=document.querySelector(".top-bar .more-navs ul");(c==null?void 0:c.className)==""&&i(!1)})},[]),s.jsx("div",{className:"top-bar",ref:N(80,".web"),children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"back-top"}),s.jsxs("div",{className:"top-bar-ctn",children:[s.jsxs("div",{className:"left",children:[s.jsx("div",{className:"options",onClick:()=>{}}),s.jsx("a",{href:`${$}/web#home`,className:"logo-ctn",onClick:()=>{g("home")},children:s.jsx("div",{className:"icon"})})]}),s.jsx("ul",{className:"top-bar-center",children:w.map((c,h)=>h*200<b.width-400?s.jsxs("li",{className:t==c.u?"active":"",onClick:()=>g(c.u),children:[s.jsx("span",{style:{background:m(c.i,"60%")}}),c.n]},h):null)}),s.jsxs("div",{className:"right",children:[s.jsx("div",{className:"ctn-icon",onClick:c=>{c.preventDefault(),c.stopPropagation(),i(!a)},children:s.jsx("div",{className:"icon"})}),l?s.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${(y=l==null?void 0:l.photos[0])!=null&&y.startsWith("/")?u:""}${l==null?void 0:l.photos}),#bbb`},onClick:()=>O({user:l,target:"all"}).then(c=>{console.log(c)})}):s.jsx("div",{className:"login",onClick:()=>x(),children:"Se connecter"})]})]}),s.jsx("div",{className:"more-navs",onClick:c=>{c.preventDefault(),c.stopPropagation()},children:s.jsxs("ul",{className:a?"":"close",children:[w.map((c,h)=>h*200>=b.width-400?s.jsxs("li",{className:t==c.u?"active":"",onClick:()=>g(c.u),children:[s.jsx("span",{style:{background:m(c.i,"60%")}}),c.n]},h):null),s.jsxs("li",{className:t=="mode-lite"?"active":"",onClick:()=>{d(!n)},children:[s.jsx("span",{style:{background:m("/src/res/mark.png","70%")}}),n?"Lite mode off":"Lite mode on"]})]})})]})})}export{J as F,L as T,p as a,E as b,z as c,C as r,B as s,S as u};
