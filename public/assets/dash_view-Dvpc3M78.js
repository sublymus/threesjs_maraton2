import{j as e,c as ae,d as K,u as re,e as ie,g as Pe,l as se,t as je,f as ge,C as G}from"./BindToParentScroll-5zV6hgEO.js";import{u as I,a as U,G as S,F as te,b as _e,c as Ne,d as oe,S as de,I as R,C as qe,e as Ce,A as Se,O as Be,U as De,f as Ge,g as ts,h as Ze}from"./ChoiseRole-CXAizW7f.js";import{H as b,r as h,L as as,R as is}from"./index-6ew6H68Z.js";import{u as p,E as pe}from"./ListPaging-CwZCbqqV.js";import{t as Re}from"./Transmit-D7Zyxckh.js";import{e as es}from"./emoji-ce0Jjmmu.js";function ns(){const c=localStorage.getItem("store_name"),{getAccess:s,openAuth:i}=p();return i&&e.jsx("div",{className:"page-auth",children:e.jsxs("div",{className:"auth-ctn",children:[e.jsx("div",{className:"image"}),e.jsxs("div",{className:"form",children:[e.jsxs("h1",{className:"auth-title",children:[c==null?void 0:c.toUpperCase()," DASHBOARD"]}),e.jsxs("h5",{className:"auth-prompt",children:["Read more ?"," ",e.jsx("span",{onClick:()=>{},children:"Click here"})]}),e.jsxs("div",{className:"google",onClick:()=>{s()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Connexion"})]}),e.jsx("p",{children:"Google connexion is required to get access to sublymus Dash board service."})]})]})})}function We({blur:c,className:s}){const{pathList:i,setAbsPath:t}=I(),{user:a,store:r,disconnection:n}=p(),{T:l,setT:o}=U(),d=i[1]||"products";return e.jsxs("div",{className:"nav-bar "+(s||"min")+" "+(a?c?"blur":"":"blur"),children:[e.jsxs("div",{className:"nav-logo",children:[e.jsx("div",{className:"logo",style:{backgroundImage:`url(${`${b}${r==null?void 0:r.banners[0]}`})`}}),e.jsx("div",{className:"label",children:r==null?void 0:r.name})]}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+l,onClick:()=>{o(l?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]}),e.jsx("div",{className:"nav-link",children:e.jsxs("ul",{children:[e.jsxs("li",{className:d=="products"||d=="features"||d=="categories"||d=="catalogs"?"active":"no",onClick:()=>{t(["products"])},children:[e.jsx("span",{className:"product"}),e.jsx("label",{children:"STORE"})]}),e.jsxs("li",{className:d=="clients"||d=="collaborators"||d=="roles"?"active":"no",onClick:()=>{t(["clients"])},children:[e.jsx("span",{className:"users"}),e.jsx("label",{children:"USERS"})]}),e.jsxs("li",{className:d=="chat"?"active":"no",onClick:()=>{t(["chat"])},children:[e.jsx("span",{className:"chat"}),e.jsx("label",{children:"CHAT"})]})]})}),e.jsxs("div",{className:"nav-profile",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${a!=null&&a.photos[0].startsWith("/")?b:""}${a==null?void 0:a.photos[0]})`}}),e.jsx("div",{className:"name",children:a==null?void 0:a.name}),e.jsx("div",{className:"logout",onClick:()=>{n()},children:"logout"})]}),e.jsx("div",{className:"logut-icon",onClick:()=>{n()}})]})}const ce=ae(c=>({products:void 0,selectedProduct:void 0,async fectProductCommands({limit:s,page:i,status:t,no_status:a,user_id:r,product_id:n}){const l=p.getState().getHeaders();if(!l)return;const o={};o.user_id=!0,o.store_id=l.store.id,o.product_id=n||"",o.limit=s||25,o.page=i||1,o.user_id=r||"",o.status=t||"",o.no_status=a||"";const d=new URLSearchParams({});for(const v in o){const $=o[v];d.set(v,$)}const m=await(await fetch(`${b}/get_commands/?${d.toString()}`,{headers:l.headers})).json();if(!(!m||!m.list))return m},async setProductById(s){const i=ce.getState().products,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedProduct:t}));else if(p.getState().store){const r=await ce.getState().fetchProducts({query:{product_id:s}});c(()=>({selectedProduct:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ce.getState().fetchProducts({query:{product_id:s}});c(()=>({selectedProduct:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeProduct(s){const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${b}/delete_product/${s}`,{method:"DELETE",headers:i.headers})).json();return U.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createProduct(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0,s.is_dynamic_price=s.is_dynamic_price||!0;const t=new FormData,a=[];if(["images","model_images"].forEach(r=>{const n=s[r];if(n&&Object.keys(n).length>0){const l=[];Object.keys(n).sort((o,d)=>{var u,m;return(((u=n[o])==null?void 0:u.index)||0)-(((m=n[d])==null?void 0:m.index)||0)}).forEach(o=>{l.push(o),n[o].isLocal&&t.append(o,n[o].file)}),t.append(r,JSON.stringify(l))}else return a.push(r+" is not defined")}),["title","description","stock","category_id","index","price","is_dynamic_price"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),a.length==0){const n=await(await fetch(`${b}/create_product`,{method:"POST",body:t,headers:i.headers})).json();if(!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedProduct:n})),U.getState().fetchStoreVar()}else return a},async updateProduct(s){if(!s.product_id)return console.log("Product_id required");const i=p.getState().getHeaders();if(!i)return;const t=new FormData;let a=!1;["images","model_images"].forEach(n=>{const l=s[n];if(l&&Object.keys(l)){a=!0;const o=[];Object.keys(l).sort((d,u)=>{var m,v;return(((m=l[d])==null?void 0:m.index)||0)-(((v=l[u])==null?void 0:v.index)||0)}).forEach(d=>{o.push(d),l[d].isLocal&&t.append(d,l[d].file)}),t.append(n,JSON.stringify(o))}}),t.append("product_id",s.product_id),["title","description","stock","category_id","status","index","price","is_dynamic_price"].forEach(n=>{s[n]&&(t.append(n,s[n]),a=!0)});let r=null;if(a&&(r=await fetch(`${b}/update_product`,{method:"PUT",body:t,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("product_id",s.product_id),r=await fetch(`${b}/update_view_product`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),console.log("newProduct",r),c(()=>({selectedProduct:r})))},async fetchProducts(s){const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),s!=null&&s.query.price&&(t.price_min=s.query.price[0]),s!=null&&s.query.price&&(t.price_max=s.query.price[1]),s!=null&&s.query.stock&&(t.stock_min=s.query.stock[0]),s!=null&&s.query.stock&&(t.stock_max=s.query.stock[1]),s!=null&&s.query.product_id&&(t.product_id=s.query.product_id),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({products:n})),n},async setSelectedProduct(s){c(()=>({selectedProduct:s}))}}));function os(){const{current:c,setAbsPath:s,qs:i}=I(),{store:t}=p(),{fetchProducts:a,products:r,setSelectedProduct:n}=ce();return h.useEffect(()=>{c("products")&&t&&a()},[t]),c("products")&&e.jsx("div",{className:"product-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:r==null?void 0:r.limit,page:r==null?void 0:r.page,total:r==null?void 0:r.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"product_list",datas:(r==null?void 0:r.list)||[],itemsMapper:{images:{getView(l,o,d,u){return S.ImageElement().getView(l,`${b}${o[0]}`,d,u)}},id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},title:S.StringElement({size_interval:[50,200]}),status:de,stock:S.StringElement(),category_id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},price:S.StringElement({size:200}),created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),n(l[0]),i({product_id:l[0].id}).setAbsPath(["products","dash_product"])},onQuery:l=>{a(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["products","new_product"])}})})})}function ze({placeholder:c,value:s,isCheckRequired:i,label:t,max:a,min:r,check:n,openEditor:l,prompt:o,editable:d,onChange:u}){const[m,v]=h.useState(s||""),[$,T]=h.useState(0),[y,_]=h.useState(""),[N,g]=h.useState(l||!1),[C,q]=h.useState(0),[x,P]=h.useState(0),B=h.useRef(null),L=h.useRef(null),D=h.useRef(null),[k]=h.useState({validation:E=>(console.log(E,r&&E.length<r,E.length,r),_(""),E=E.toString().trim(),r&&E.length<r?(_(`Minimum length ${r}`),!1):a&&E.length>a?(_(`Maximum length ${a}`),!1):(u==null||u(E),!0))});h.useEffect(()=>{i&&k.validation(m)},[i]);const f=()=>{if(B.current){const z=`${-10-B.current.getBoundingClientRect().height}px`;B.current.style.top=z}if(L.current){const z=`${-10-L.current.getBoundingClientRect().height}px`;L.current.style.top=z}};return e.jsxs("div",{className:"textarea-text textarea",children:[e.jsx("div",{className:"textarea-top",children:e.jsxs("div",{className:"left-side",children:[e.jsxs("div",{className:"label",children:[t," "]}),o&&e.jsx("div",{className:"textarea-info",onMouseEnter:E=>{if(E.target.className!=="textarea-info")return L.current.style.display="none";clearTimeout(C),L.current&&(L.current.style.display="block"),f()},onMouseLeave:()=>{q(setTimeout(()=>{L.current&&(L.current.style.display="none")},300))},children:e.jsx("div",{className:"promt",ref:L,children:o})}),d&&e.jsx("div",{className:"edit",style:{background:`no-repeat center/80% url(${N?"/src/res/x.png":"/src/res/pencil.png"})`},onClick:()=>{const E=!N;g(E==!1?!k.validation(m):!0),E&&setTimeout(()=>{var z;(z=D.current)==null||z.focus()}),f()},onMouseEnter:E=>{if(E.target.className!=="edit")return L.current.style.display="none";clearTimeout(x),B.current&&(B.current.style.display="block"),f()},onMouseLeave:()=>{P(setTimeout(()=>{B.current&&(B.current.style.display="none")},300))},children:e.jsx("div",{className:"promt",ref:E=>{B.current=E,f()},children:N?"Close editor":"click here to edit value"})})]})}),!N&&e.jsx("div",{className:"value",children:m}),N&&e.jsxs("div",{className:"textarea-editor",children:[e.jsx("textarea",{ref:D,spellCheck:"false",rows:5,placeholder:c,value:m,onChange:E=>{let z=E.currentTarget.value;for(;z.includes("  ");)z=z.replace("  "," ");z.length>(a||Number.MAX_VALUE)||(v(z),_(""),T(z.length))},onBlur:()=>{n=="auto"&&k.validation(m)&&setTimeout(()=>{g(!1)},0)}}),e.jsxs("div",{className:"count",children:[" ",e.jsx("div",{className:"message",children:y}),a&&`${$}/${a}`]})]})]})}function Ve({direction:c="",onClick:s}){return e.jsxs("div",{className:"preview-3d-model-card "+c,onClick:s,children:[e.jsx("div",{className:"image "+c,style:{backgroundImage:"url(/src/res/ert.avif)"}}),e.jsxs("div",{className:"text-side",children:[e.jsx("div",{className:"top",children:"PREVIEW 3D MODEL"}),e.jsxs("div",{className:"features",children:[3," FEATURE","S"]}),e.jsx("div",{className:"prompt",children:"Loader File is missing"})]})]})}function rs({}){return e.jsxs("div",{className:"statistic-card",children:[e.jsxs("div",{className:"text",children:[e.jsx("h1",{className:"title",children:"Product Statistic"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"title",children:[2e4.toLocaleString(),"  ₽ "]}),e.jsxs("h2",{className:"description",children:["since ",new Date(Date.now()-1e3*60*60*24*30).toDateString()]})]})]}),e.jsx(cs,{})]})}const Ke={with:250,height:120,bars:[{value:80},{value:15},{value:25},{value:10},{value:15},{value:25},{value:15},{value:25},{value:90},{value:25},{value:30},{value:25},{value:30},{value:50},{value:100},{value:90},{value:80},{value:70},{value:60},{value:60},{value:70},{value:80}]};function cs(){return e.jsx("div",{className:"bar-chart",children:e.jsx("div",{className:"bars",children:Ke.bars.map((c,s)=>e.jsx("div",{className:"bar",children:e.jsx("div",{className:"level",style:{height:`${c.value/100*Ke.height}px`,background:`linear-gradient(rgb(0, 90, 180),rgb(23, 108, 194)${((c.value<35?35:c.value)-25)*.7}% , rgb(75, 165, 255)100%)`}})},s))})})}let ls=0;function He({onChange:c,icon:s,ext:i,label:t,file_name:a}){const[r]=h.useState((Math.random()+ls++).toString()),[n,l]=h.useState(a||"");return e.jsxs("div",{className:"loader-img",children:[e.jsx("input",{type:"file",style:{display:"none"},accept:"application/zip",name:"img",id:r,onChange:o=>{var $;const d=($=o.target.files)==null?void 0:$[0];if(!d)return;const u=d.name.toLowerCase(),m=u.lastIndexOf("."),v=u.substring(m+1,u.length);if(i&&!i.includes(v))return console.log({_ext:v,ext:i,n:u});l(d.name),c(d)}}),e.jsxs("label",{htmlFor:r,className:"loader-img-ctn",children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon",style:{background:s?`no-repeat center/50% url(${s})`:""}})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:t??"Upload file"}),e.jsx("div",{className:"prompt",children:n&&(n.length>25?n.substring(0,10)+"..."+n.substring(n.length-10,n.length):n)||"Add new File"})]}),e.jsx("div",{className:"load-icon"})]})]})}const he=ae(c=>({categories:void 0,selectedCategory:void 0,categoryProducts:void 0,async setCategoryById(s){const i=he.getState().categories,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCategory:t}));else if(p.getState().store){const r=await he.getState().fetchCategories({query:{user_id:s}});c(()=>({selectedCategory:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await he.getState().fetchCategories({query:{user_id:s}});c(()=>({selectedCategory:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCategory(s){if(!s)return;const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${b}/delete_category/${s}`,{method:"DELETE",headers:i.headers})).json();return U.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createCategory(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0;const t=new FormData,a=[];if(["label","description","catalog_id","index"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),a.length==0){const n=await(await fetch(`${b}/create_category`,{method:"POST",body:t,headers:i.headers})).json();if(console.log(n),!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedCategory:n})),U.getState().fetchStoreVar()}else return a},async fetchCategoryProducts(s){if(!(s!=null&&s.category_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.category_id=s==null?void 0:s.category_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({categoryProducts:n}))}catch(t){return console.warn(t.message)}},setSelectedCategory(s){c(()=>({selectedCategory:s}))},async updateCategory(s){const i=p.getState().getHeaders();if(!i)return;const t=new FormData;let a=!1;t.append("category_id",s.category_id),["label","index","status","catalog_id","description"].forEach(n=>{s[n]&&(t.append(n,s[n]),a=!0)});let r=null;if(a&&(r=await fetch(`${b}/update_category`,{method:"PUT",body:t,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("category_id",s.category_id),r=await fetch(`${b}/update_view_category`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),c(()=>({selectedCategory:r})))},async fetchCategories(s){const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_categories/?${a.toString()}`,{headers:i.headers})).json();return!n||!n.list?void 0:(c(()=>({categories:n})),n)}catch(t){console.warn(t.message);return}}}));function ds({onChange:c,category_id:s}){const{fetchCategories:i,categories:t}=he(),[a,r]=h.useState(),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(t==null?void 0:t.list.find(o=>o.id==s))},[t]),e.jsxs("div",{className:"choise-category",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Category"}),e.jsx("div",{className:"name",children:(a==null?void 0:a.label)||"select category"})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-category "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+((a==null?void 0:a.id)==o.id?"selected":""),onClick:()=>{r(o),c==null||c(o.id)},children:[e.jsx("div",{className:"label",children:o.label}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}const ve=ae(c=>({features:void 0,selectedFeature:void 0,productsUseFeature:void 0,async setFeatureById(s){var t,a;const i=ve.getState().selectedFeature||((t=ve.getState().features)==null?void 0:t.list.find(r=>r.id==s));if(i)c(()=>({selectedFeature:i}));else{const r=(a=await ve.getState().fetchFeatures({feature_id:s},!0))==null?void 0:a.list[0];c(()=>({selectedFeature:r}))}},async removeFeature(s){const t=await(await fetch(`${b}/delete_feature/${s}`,{method:"DELETE"})).json();return console.log({json:t}),t==null?void 0:t.isDeleted},async fetchProductsUseFeature(s){c(()=>({productsUseFeature:ce.getState().products}))},setSelectedFeature(s){c(()=>({selectedFeature:s}))},async createFeature(s){U.getState().fetchStoreVar()},async updateFeature(s){},async fetchFeatures(s,i){var l,o,d;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=(o=s.query)==null?void 0:o.text),s!=null&&s.feature_id&&(t.feature_id=s.feature_id),t.store_id=(d=p.getState().store)==null?void 0:d.id;const a=new URLSearchParams({});for(const u in t){const m=t[u];a.set(u,m)}const n=await(await fetch(`${b}/get_features/?${a.toString()}`)).json();if(!(!n||!n.list))return i||c(()=>({features:n})),console.log(n),n}}));function us({onChange:c,features:s}){const{fetchFeatures:i,features:t}=ve(),[a,r]=h.useState(s),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(s==null?void 0:s.filter(o=>t==null?void 0:t.list.find(d=>d.id==o.id)))},[t]),e.jsxs("div",{className:"choise-features",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Features"}),e.jsxs("div",{className:"name",children:[(a==null?void 0:a.length)||0," Selected"]})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-features "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+(a!=null&&a.find(d=>d.id==o.id)?"selected":""),onClick:()=>{const d=a!=null&&a.find(u=>u.id==o.id)?a.filter(u=>u.id!==o.id):[...a||[],o];r(d),c==null||c(d.map(u=>u.id))},children:[e.jsx("div",{className:"label",children:o.name}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}function hs(){var q;const{current:c,setAbsPath:s,json:i}=I(),{selectedProduct:t,setSelectedProduct:a,updateProduct:r,createProduct:n,removeProduct:l,setProductById:o,fectProductCommands:d}=ce(),[u]=h.useState(!1),[m,v]=h.useState([]),[$,T]=h.useState("");h.useEffect(()=>{i!=null&&i.product_id&&o(i==null?void 0:i.product_id)},[i]),h.useEffect(()=>{t&&d({limit:10,product_id:t.id}).then(x=>v((x==null?void 0:x.list)||[]))},[t]);const _=re().width<1e3?"wrap":"",[N]=h.useState({}),g=c("dash_product"),C=c("new_product");return(g||C)&&(!t&&g?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"product-dash",ref:K,children:[e.jsxs("div",{className:"error-panel "+($?"open":""),children:[e.jsxs("div",{className:"type",children:["ERROR ",e.jsx("span",{onClick:()=>{T("")}})]}),e.jsx("div",{className:"message",children:$})]}),e.jsx(pe,{terme:"white",deteleKey:(t==null?void 0:t.id)||"noga",mode:C?"create":"delete",title:"Product Information",onCreate:()=>{n(N).then(x=>{if(!x)return s(["products","dash_product"]);x.length&&T(x==null?void 0:x.toString())})},onDelete:()=>{t&&l(t.id).then(x=>{x&&a(void 0)})}}),e.jsxs("section",{className:"editor "+_,children:[e.jsxs("div",{className:"editor-left",children:[e.jsxs("div",{className:"editor-name",children:[g&&e.jsx(R,{isCheckRequired:u,label:"Product Id",value:(t==null?void 0:t.id)||""}),e.jsx("div",{className:"product-title",children:e.jsx(R,{editable:!0,prompt:"Product Title",isCheckRequired:u,min:3,check:"auto",max:50,label:"Title",placeholder:"Product Title",value:g&&((t==null?void 0:t.title)||""),onChange:x=>{g?t&&r({product_id:t.id,title:x}):N.title=x}})}),e.jsx("div",{className:"product-description",children:e.jsx(ze,{editable:!0,prompt:"Product Description",isCheckRequired:u,min:3,check:"auto",max:250,label:"Description",placeholder:"Product Description",value:g&&((t==null?void 0:t.description)||""),onChange:x=>{g?t&&r({product_id:t.id,description:x}):N.description=x}})})]}),e.jsx("div",{className:"editor-price",children:e.jsx(R,{type:"number",editable:!0,prompt:"Product Price",isCheckRequired:u,min:0,check:"auto",label:"Price",placeholder:"Product Price",value:g&&((t==null?void 0:t.price)||""),onChange:x=>{g?t&&r({product_id:t.id,price:x}):N.price=x}})}),e.jsx("div",{className:"editor-stock",children:e.jsx(R,{type:"number",editable:!0,prompt:"Product Stock",isCheckRequired:u,max:1e10,check:"auto",label:"Stock",placeholder:"Product Stock",value:g&&((t==null?void 0:t.stock)||""),onChange:x=>{g?t&&r({product_id:t.id,stock:x}):N.stock=x}})}),g&&e.jsx(qe,{status:(t==null?void 0:t.status)||"PAUSE",onChange:x=>{g?t&&r({product_id:t.id,status:x}):N.status=x}}),e.jsx("div",{className:"editor-category",children:e.jsx(ds,{category_id:g&&(t==null?void 0:t.category_id),onChange:x=>{g?t&&r({product_id:t.id,category_id:x}):N.category_id=x}})}),e.jsx("div",{className:"editor-features",children:e.jsx(us,{features:g&&((q=t==null?void 0:t.features)==null?void 0:q.list),onChange:x=>{N.features=x,console.log(N)}})})]}),e.jsxs("div",{className:"editor-right",children:[e.jsx("div",{className:"editor-images",children:e.jsx(Ce,{name:"images",images:g&&(t!=null&&t.images?t.images:[]),autosave:C,onSave:x=>{g?t&&r({product_id:t.id,images:x}):N.images=x}})}),e.jsx("div",{className:"editor-mmodel-images",children:e.jsx(Ce,{name:"model_images",images:g&&(t!=null&&t.images?t.model_images:[]),autosave:C,onSave:x=>{g?t&&r({product_id:t.id,model_images:x}):N.model_images=x}})}),g&&e.jsx("div",{className:"editor-scene-file",children:e.jsx(He,{file_name:t==null?void 0:t.scene_dir,ext:["zip"],label:"Upload Scene File",onChange:x=>{g?t&&r({product_id:t.id,scene_dir:x}):N.scene_dir=x}})})]})]}),g&&e.jsxs("div",{className:"product-dash-ctn",children:[e.jsxs("div",{className:"info",children:[e.jsx(Se,{}),e.jsx(rs,{})]}),e.jsx(Ve,{onClick:()=>{console.log("oo"),s(["products","dash_product","product_preview"])}})]}),g&&e.jsxs("div",{className:"orders",children:[e.jsxs("div",{className:"top",children:[e.jsx("h1",{className:"orders-title",children:"Recent Orders"}),e.jsx("h2",{className:"see-all",children:"SEE ALL"})]}),e.jsx("div",{className:"orders-ctn",children:m.map(x=>e.jsxs("div",{className:"order",children:[e.jsxs("div",{className:"id",children:["#",x.id.split("-")[0]]}),e.jsx("div",{className:"id",children:x.quantity}),e.jsx("div",{className:"date",children:x.updated_at.split("")}),e.jsxs("div",{className:"price",children:[x.price," ","$"]}),e.jsx("div",{className:"status "+x.status.toLocaleLowerCase(),children:x.status})]},x.id))})]})]}))}function ms(){const{current:c}=I();return c("product_preview")&&e.jsx("div",{className:"product-preview"})}function gs(){return null}const ps=[{label:"products",value:"23",url:"/src/res/package.png",path:["products"]},{label:"categories",value:"15",url:"/src/res/application.png",path:["categories"]},{label:"features",value:"78",url:"/src/res/jigsaw.png",path:["features"]}];function Ae({active:c,setActive:s}){const{storeVar:i}=U();return e.jsx("div",{className:"products-list-accessor",children:ps.map((t,a)=>e.jsxs("div",{className:"top-card "+(t.label==c?"active":""),onClick:()=>{s(t)},children:[e.jsx("h2",{className:"label",children:t.label.toUpperCase()}),e.jsx("h2",{className:"value",children:i==null?void 0:i[t.label]}),e.jsx("h2",{className:"icon",style:{backgroundImage:`url(${t.url})`}})]},a))})}function xs(){const{check:c,setAbsPath:s,current:i}=I();return e.jsx(e.Fragment,{children:c("products")&&e.jsxs("div",{className:"page-product",children:[i("products","dash_product","new_product")&&e.jsx(Ae,{active:"products",setActive:t=>s(t.path)}),e.jsx(hs,{}),e.jsx(os,{}),e.jsx(ms,{}),e.jsx(gs,{})]})})}const ue=ae(c=>({clients:void 0,selectedClient:void 0,clientCommands:void 0,clientVisites:void 0,async setClientById(s){const i=ue.getState().clients,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedClient:t}));else if(p.getState().store){const r=await ue.getState().fetchClients({query:{user_id:s}});c(()=>({selectedClient:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ue.getState().fetchClients({query:{user_id:s}});c(()=>({selectedClient:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async fetchClientCommands(s){if(!(s!=null&&s.user_id))return;const i=await ce.getState().fectProductCommands({...s});if(console.log(i),!(i!=null&&i.list))return c(()=>({clientCommands:void 0}));c(()=>({clientCommands:i}))},async fetchClientVisites({after_date:s,before_date:i,client_id:t,product_id:a,limit:r,page:n}){const l=p.getState().getHeaders();if(!l)return;const o={};o.store_id=l.store.id,o.product_id=a||"",o.client_id=t||"",o.limit=r||25,o.page=n||1,o.after_date=s||"",o.before_date=i||"",o.from_dash=!0;const d=new URLSearchParams({});for(const v in o){const $=o[v];d.set(v,$)}const m=await(await fetch(`${b}/get_client_visited/?${d.toString()}`,{headers:l.headers})).json();!m||!m.list||c(()=>({clientVisites:m}))},async setSelectedClient(s){c(()=>({selectedClient:s}))},async fetchClients(s){const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),s!=null&&s.query.text&&(t.text=s.query.text),s!=null&&s.query.user_id&&(t.user_id=s.query.user_id),s!=null&&s.query.phone&&(t.phone=s.query.phone),t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_store_clients/?${a.toString()}`,{headers:i.headers})).json();if(console.log("clients",n),!(!n||!n.list))return c(()=>({clients:n})),n},async banClient(){}}));function vs(){const{current:c,qs:s}=I(),{clients:i,setSelectedClient:t,fetchClients:a}=ue(),{store:r}=p();return h.useEffect(()=>{c("clients")&&r&&a()},[r]),c("clients")&&e.jsx("div",{className:"client-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"client_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(n,l,o,d){return S.ImageElement().getView(n,`${l[0].startsWith("/")?b:""}${l[0]}`,o,d)}},id:{getView(n,l,o,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},o.id)}},name:S.StringElement({size_interval:[50,200]}),status:{getView(n,l,o,d){return de.getView(n,"VISIBLE",o,d)}},created_at:S.DateStringElement({size:200})},onItemsSelected:(n,l)=>{l.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="")}),n.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="#00f2")}),t(n[0]),s({client_id:n[0].id}).setAbsPath(["clients","client_profile"])},onQuery:n=>{a(n)},top_height:40,canPaginate:!0})})})}function fs(){const{current:c,setAbsPath:s,json:i,qs:t}=I(),{selectedClient:a,setClientById:r,clientCommands:n,fetchClientVisites:l,fetchClientCommands:o,clientVisites:d}=ue(),[u,m]=h.useState("commands"),[v]=h.useState(!1),T=re().width<1e3?"wrap":"";return h.useEffect(()=>{i!=null&&i.client_id&&r(i==null?void 0:i.client_id)},[i]),h.useEffect(()=>{a&&o({limit:5,user_id:a.id}),a&&l({limit:5,client_id:a.id})},[a]),c("client_profile")&&(a?e.jsxs("div",{className:"client-profile",ref:K,children:[e.jsx("h1",{children:"Client Information"}),e.jsxs("section",{className:"editor "+T,children:[e.jsx("div",{className:"left-right",children:e.jsx(Ce,{name:"client_profile",images:a.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(R,{isCheckRequired:v,label:"Client Id",value:(a==null?void 0:a.id)||""}),e.jsx(R,{prompt:"Client Name",isCheckRequired:v,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:a==null?void 0:a.name}),e.jsx(R,{prompt:"Client Email",isCheckRequired:v,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:a==null?void 0:a.email}),e.jsx(R,{label:"created At",value:a==null?void 0:a.created_at}),e.jsx(R,{label:"Join Store At",value:a==null?void 0:a.join_at}),e.jsx(Be,{user:a,channel:"sessions"})]})]}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{className:"btn "+(u=="commands"?"active":""),onClick:()=>{m("commands")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Commands"})]}),e.jsxs("div",{className:"btn "+(u=="visites"?"active":""),onClick:()=>{m("visites")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Visites"})]})]}),e.jsx("h2",{className:"see-all",onClick:()=>{u=="visites"?s(["products"]):s(["command"])},children:"SEE ALL"})]}),u=="commands"&&e.jsx(S,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(n==null?void 0:n.list)||[],itemsMapper:{images:{getView(y,_,N,g){return S.ImageElement().getView(y,`${b}${_[0]}`,N,g)}},id:{getView(y,_,N,g){return e.jsxs("div",{ref:g,children:["#",_.split("-")[0]]},N.id)}},stock:S.StringElement(),price:S.StringElement({size:200}),status:de,created_at:S.DateStringElement({size:200})},onItemsSelected:()=>{}}),u=="visites"&&e.jsx(S,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(d==null?void 0:d.list)||[],itemsMapper:{images:{getView(y,_,N,g){return S.ImageElement().getView(y,`${b}${_[0]}`,N,g)}},id:{getView(y,_,N,g){return e.jsxs("div",{ref:g,children:["#",_.split("-")[0]]},N.id)}},title:S.StringElement({size:200}),visited_at:S.DateStringElement({size:200})},onItemsSelected:y=>{t({product_id:y[0].id}).setAbsPath(["products","dash_product"])}})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function js(){const{check:c,current:s,setAbsPath:i}=I();return c("clients")&&e.jsxs("div",{className:"client-page",children:[s("clients","client_profile")&&e.jsx(De,{active:"clients",setActive:t=>i(t.path)}),e.jsx(vs,{}),e.jsx(fs,{})]})}const Ie="new_discussion";let ye;const ke=[],W=ae(c=>({discussion:void 0,discussions:void 0,messages:void 0,setDiscussion(s){c(()=>({discussion:s}))},async setDiscussionByOtherId({other_id:s,for_moderator:i,findOther:t}){var d,u,m;const a=p.getState().getHeaders();if(!a)return;const r=(d=W.getState().discussions)==null?void 0:d.list,n=r==null?void 0:r.find(v=>v.other.id==s&&(i?!ie(a.store.id,v):!!ie(a.store.id,v)));if(n){if(((u=W.getState().messages)==null?void 0:u.list[0].table_id)==n.id)return;const v=await Z.getState().fetchMessages(n.id,"discussions");c(()=>({discussion:n,messages:v}));return}const l=(m=await W.getState().fetchDiscussions({no_save:!0,other_id:s,for_moderator:i}))==null?void 0:m.list[0];if(console.log("exist Discussion",l,i),l){const v=await Z.getState().fetchMessages(l.id,"discussions");c(()=>({discussion:l,messages:v}));return}const o=await t(s,!!i);o&&W.getState().addDiscussion({other:o,for_moderator:i})},async openDiscussionMessages(s){const i=await Z.getState().fetchMessages(s,"discussions");c(()=>({messages:i}))},async unBlockDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/unblock_discussion/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();return console.log("unblock_discussion ",a),a!=null&&a.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(n=>n.id==a.id?{...n,...a}:n)}})),a):void 0}catch(a){console.log(a)}},async blockDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/block_discussion/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();return console.log("unblock_discussion ",a),a!=null&&a.id?(c(({discussions:r})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).map(n=>n.id==a.id?{...n,...a}:n)}})),a):void 0}catch(a){console.log(a)}},async deleteDiscussion(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/delete_discussion/${s.id}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("deleteDiscussion ",a),a!=null&&a.deleted?(c(({discussions:r,messages:n,discussion:l})=>({discussions:r&&{...r,list:((r==null?void 0:r.list)||[]).filter(o=>o.id!==s.id)},messages:(l==null?void 0:l.id)==s.id?void 0:n})),!0):void 0}catch(a){console.log(a)}},async createDiscussion({other_id:s,for_moderator:i}){const t=p.getState().getHeaders();if(!t)return;const a=new FormData;a.append("receiver_id",s),a.append("from_id",t.store.id),!i&&a.append("to_id",t.store.id);const r=await fetch(`${b}/create_discussion`,{headers:t.headers,body:a,method:"POST"});try{const n=await r.json();return console.log("createDiscussion",n),n!=null&&n.id?n:void 0}catch(n){console.log(n)}},async addDiscussion({other:s,for_moderator:i}){var o,d;const t=p.getState().getHeaders();if(!t||s.id==t.user.id)return;const a=(o=W.getState().discussions)==null?void 0:o.list,r=a==null?void 0:a.find(u=>u.other.id==s.id&&(i?!ie(t.store.id,u):!!ie(t.store.id,u)));if(console.log("addDiscussion",{exist:r}),r){const u=await Z.getState().fetchMessages(r.id,"discussions");return c(()=>({discussion:r,messages:u})),r}const n=(d=W.getState().discussions)==null?void 0:d.list.filter(u=>u.id.startsWith(Ie)?(u.receiver_id==s.id||u.creator_id==s.id)&&(i?!ie(void 0,u):!!ie(void 0,u)):!1);if(n!=null&&n[0]){console.log("@@@@@@@@@@@@@@@@@@@@@@@"),c(({discussions:u})=>({discussions:u&&{...u}}));return}const l={id:Ie+Date.now(),creator_id:t.user.id,receiver_id:s.id,deleted:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s,from_id:t.store.id,to_id:i?void 0:t.store.id,last_message:void 0,other_att:"creator"};return c(({discussions:u})=>({messages:{list:[],limit:25,page:1,total:0},discussion:l,discussions:u&&{...u,list:[l,...u.list]}})),console.log("NEW DISCUSSION",l),l},async fetchDiscussions({discussion_id:s,no_save:i,other_id:t}){const a=p.getState().getHeaders();if(!a)return;const r=new URLSearchParams({});r.set("from_id",a.store.id),s&&r.set("discussion_id",s),t&&r.set("other_id",t);const l=await(await fetch(`${b}/get_discussions?${r}`,{headers:a.headers})).json();if(console.log("fetch Discussions",l),!l)return;ye=c,l.list.forEach(async d=>{Qe(d)});const o=`${a.user.id}/${a.store.id}`;if(!ke.includes(o)){ke.push(o);const d=Re.subscription(o);await d.create(),d.onMessage(async u=>{var m;if(u.new_discussion){console.log("new_discussion ==>  ",u.new_discussion),Qe(u.new_discussion);const v=u.new_discussion,$=v.receiver.id!=a.user.id?"receiver":"creator";v.other_att=$,v.other=v[$];const T=(m=W.getState().discussions)==null?void 0:m.list.filter(y=>y.id.startsWith(Ie)?!(y.other.id==v.other.id&&(y.from_id||null)==(v.from_id||null)&&(y.to_id||null)==(v.to_id||null)):!0);c(({discussions:y})=>({discussions:y&&{...y,list:[v,...T||[]]}}))}u.reload_discussion&&(console.log("reload_discussion ==>  "),W.getState().fetchDiscussions({}))})}return i||c(({discussions:d})=>({discussions:{...l,list:[...((d==null?void 0:d.list)||[]).filter(u=>u.id.startsWith("new_")),...l.list]}})),l}}));async function Qe(c){if(!p.getState().getHeaders()||ke.includes(c.id))return;ke.push(c.id);const i=Re.subscription(c.id);await i.create(),i.onMessage(async t=>{var r,n;if(!ye)return;const a=W.getState().discussion;if(t.reload){const l=(r=W.getState().discussions)==null?void 0:r.list,o=(n=await W.getState().fetchDiscussions({discussion_id:c.id,no_save:!0}))==null?void 0:n.list;if(console.log("reload Discussion ___________ ",o==null?void 0:o.length),!(o!=null&&o[0].id))return;const d=[...(l==null?void 0:l.map(u=>u.id==c.id?o==null?void 0:o[0]:u))||[]];ye(({discussions:u})=>({discussions:u&&{...u,list:d}})),(a==null?void 0:a.id)==(o==null?void 0:o[0].id)&&ye(()=>({discussion:{...o==null?void 0:o[0]}}))}if(t.reloadMessage&&(a==null?void 0:a.id)==c.id){console.log("reload Message___________",a);const l=await Z.getState().fetchMessages(c.id,"discussions");ye(()=>({messages:l,discussion:{...c}}))}})}const _s="new_discussion",Ns="new_session",Z=ae(c=>({async fetchEditMessage(s){const i=p.getState().getHeaders();if(!i)return;const t=new FormData;t.append("message_id",s.message_id),t.append("text",s.text);const a=await fetch(`${b}/edit_message`,{method:"PUT",headers:i.headers,body:t});try{const r=await a.json();return console.log("edit_message ",r),r!=null&&r.id?r:void 0}catch(r){console.log(r)}},async fetchDeleteMessageBoth(s){const i=p.getState().getHeaders();if(!i)return;console.log("$$$$$$$$");const t=await fetch(`${b}/delete_message/${s}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("fetchDeleteMessageBoth",a),a==null?void 0:a.deleted}catch(a){console.log(a)}},async fetchDeleteMessageMe(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/delete_message/${s}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();return console.log("fetchDeleteMessageMe",a),a==null?void 0:a.deleted}catch(a){console.log(a)}},async fetchSendMessage({context:s,context_name:i,files:t,text:a}){if(!s||!s.id)return;if(s.id.startsWith(_s)){const o=await W.getState().createDiscussion({other_id:s.other.id,for_moderator:s.to_id==null});if(console.log("D"),!o||!o.id)return;s=o,W.getState().setDiscussion(o)}else if(s.id.startsWith(Ns)){const o=await Y.getState().fetchCreateSession(s.other.id,a||"");if(console.log("S",o),!o)return;s=o,Y.getState().setSession(o)}const r=p.getState().getHeaders();if(!r)return;const n=new FormData;if(!a&&!t)return;if(t)for(let o=0;o<t.length;o++){const d=t[o];n.append("files_"+o,d)}if(n.append("context_id",s.id),n.append("context_name",i),a&&n.append("text",a),t)for(let o=0;o<t.length;++o){const d=t[o];n.append("files_"+o,d)}const l=await fetch(`${b}/send_message`,{headers:r.headers,body:n,method:"POST"});try{const o=await l.json();return console.log("fetchSendMessage",o),o!=null&&o.id?o:void 0}catch(o){console.log(o)}},async fetchMessages(s,i){if(s.toLowerCase().startsWith("new_"))return;const t=p.getState().getHeaders();if(!t)return;const a=await fetch(`${b}/get_messages/?context_id=${s}&context_name=${i}`,{headers:t.headers});try{const r=await a.json();return r!=null&&r.list?{...r,list:r.list.reverse()}:void 0}catch{}}})),Ss="new_session";let we;const $e=[],Y=ae(c=>({session:void 0,sessions:void 0,messages:void 0,setSession(s){c(()=>({session:s}))},async setSessionByClientId(s){setTimeout(async()=>{var a,r;const i=Y.getState().sessions,t=i==null?void 0:i.find(n=>n.other.id==s);if(console.log("current Session",s,t),t){const n=await Z.getState().fetchMessages(t.id,"sessions");c(()=>({session:t,messages:n}))}else{const n=p.getState().getHeaders();if(!n)return;const o=(await(await fetch(`${b}/get_sessions?collaborator_id=${s}&store_id=${n.store.id}`,{headers:n.headers})).json())[0];if(console.log("exist Session",o),o){const d=await Z.getState().fetchMessages(o.id,"sessions");c(()=>({session:o,messages:d}))}else{const d=((a=ue.getState().clients)==null?void 0:a.list.find(u=>u.id==s))||((r=await ue.getState().fetchClients({query:{user_id:s}}))==null?void 0:r.list[0]);console.log("collabo",d),d&&Y.getState().addSession(d)}}})},async openSessionMessages(s){const i=await Z.getState().fetchMessages(s,"sessions");c(()=>({messages:i}))},async openSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/open_session/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();if(console.log("open_session ",a),!(a!=null&&a.id))return}catch(a){console.log(a)}},async closeSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/close_session/${s.id}`,{method:"PUT",headers:i.headers});try{const a=await t.json();if(console.log("close_session ",a),!(a!=null&&a.id))return}catch(a){console.log(a)}},async asReadSession(s){},async deleteSession(s){const i=p.getState().getHeaders();if(!i)return;const t=await fetch(`${b}/delete_session/${s.id}`,{method:"DELETE",headers:i.headers});try{const a=await t.json();if(console.log("deleteSession",a),!a.deleted)return;c(()=>({session:void 0})),Y.getState().fetchSessions()}catch(a){console.log(a)}},async fetchCreateSession(s,i){if(!i)return;const t=p.getState().getHeaders();if(!t)return;const a=new FormData;a.append("receiver_id",s),a.append("store_id",t.store.id),a.append("title",i);const r=await fetch(`${b}/create_session`,{headers:t.headers,body:a,method:"POST"});try{const n=await r.json();return console.log("fetchCreateSession",n),n!=null&&n.id?(Y.getState().fetchSessions(),c(()=>({session:n})),n):void 0}catch(n){console.log(n)}},async addSession(s){var r;const i=(r=Y.getState().sessions)==null?void 0:r.find(n=>n.other.id==s.id);if(i){c(()=>({session:i}));const n=await Z.getState().fetchMessages(i.id,"sessions");return c(()=>({messages:n}))}const t=p.getState().user;if(!t)return;const a={id:Ss+Date.now(),creator_id:t.id,title:"",receiver_id:s.id,deleted:"",other_att:"creator",closed:"",blocked:"",unchecked_count:0,creator_opened_at:"2024-05-09 12:30:15",receiver_opened_at:"",created_at:"",updated_at:"2024-05-09 13:46:04",other:s};c(({sessions:n})=>({messages:{list:[],limit:25,page:1,total:0},session:a,sessions:[...n||[],a]}))},async fetchSessions(s="all"){const i=p.getState().getHeaders();if(!i)return;console.log(i.store.id);const a=await(await fetch(`${b}/get_sessions?store_id=${i.store.id}&open=${s}`,{headers:i.headers})).json();if(console.log("session",a),!!Array.isArray(a)&&(we=c,a.forEach(async r=>{Xe(r)}),c(()=>({sessions:a})),!$e.includes(i.user.id))){$e.push(i.user.id);const r=Re.subscription(i.user.id);await r.create(),r.onMessage(async n=>{var l;if(n.new_session){Xe(n.new_session);const o=n.new_session,d=o.receiver.id!=i.user.id?"receiver":"creator";o.other_att=d,o.other=o[d];const u=(l=Y.getState().sessions)==null?void 0:l.filter(m=>m.id!=(o==null?void 0:o.id));c(()=>({sessions:[...u||[],o]}))}n.reload_session&&Y.getState().fetchSessions()})}}}));async function Xe(c){const s=p.getState().getHeaders();if(!s||$e.includes(c.id))return;$e.push(c.id);const i=Re.subscription(c.id);await i.create(),i.onMessage(async t=>{if(!we)return;console.log("data_session",t);const a=Y.getState().session;if(t.reload){const r=Y.getState().sessions,l=await(await fetch(`${b}/get_sessions?session_id=${c.id}&store_id=${s.store.id}&blocked=all`,{headers:s.headers})).json();if(console.log("reload Session ___________ ",l.length),!(l!=null&&l[0]))return;const o=[...(r==null?void 0:r.map(d=>d.id==c.id?l==null?void 0:l[0]:d))||[]];we(()=>({sessions:o})),(a==null?void 0:a.id)==(l==null?void 0:l[0].id)&&we(()=>({session:{...l==null?void 0:l[0]}}))}if(t.reloadMessage&&(a==null?void 0:a.id)==c.id){console.log("reload Message___________",a);const r=await Z.getState().fetchMessages(c.id,"sessions");we(()=>({messages:r,session:{...c}}))}})}function bs({}){var D;const{openChild:c}=U(),{json:s,qs:i,check:t,pathList:a,setAbsPath:r}=I(),n=(D=a[3])==null?void 0:D.split("_")[1],[l,o]=h.useState(n||"opened"),{addSession:d,asReadSession:u,closeSession:m,openSession:v,deleteSession:$,fetchSessions:T,session:y,sessions:_,setSessionByClientId:N}=Y(),{user:g,store:C}=p(),{fetchClients:q}=ue();if(h.useEffect(()=>{t("chat")&&!_&&C&&T()},[C]),h.useEffect(()=>{s!=null&&s.client_id&&N(s==null?void 0:s.client_id)},[s]),h.useEffect(()=>{o(n||"opened")},[a]),h.useEffect(()=>{var k;(k=y==null?void 0:y.closed)!=null&&k.includes((g==null?void 0:g.id)||"")&&o("closed")},[y]),!g)return;const x=_==null?void 0:_.filter(k=>{var f;return!((f=k.closed)!=null&&f.includes(g.id))}),P=_==null?void 0:_.filter(k=>{var f;return(f=k.closed)==null?void 0:f.includes(g.id)}),B=_==null?void 0:_.filter(k=>k.unchecked_count>0);let L=[];return l=="opened"?L=x:l=="closed"?L=P:L=B,e.jsxs("div",{className:"session-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Sessions "}),e.jsxs("div",{className:"add-new",onClick:()=>{c(e.jsx(Ge,{user:g,openChild:c,fetchUsers:q,setUser:k=>{d(k)}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{r(["chat","sessions","sessions_opened"])},children:e.jsxs("div",{className:l=="opened"?"active":"",children:["Open",((x==null?void 0:x.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{r(["chat","sessions","sessions_closed"])},children:e.jsxs("div",{className:l=="closed"?"active":"",children:["Closed ",((P==null?void 0:P.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{r(["chat","sessions","sessions_new"])},children:e.jsxs("div",{className:l=="new"?"active":"",children:["New  ",((B==null?void 0:B.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"sessions",children:L==null?void 0:L.map(k=>{var E,z;let f="";return((E=k.last_message)==null?void 0:E.user_id)==g.id&&(k[`${k.other_att}_opened_at`]?new Date(k[`${k.other_att}_opened_at`])<new Date(((z=k.last_message)==null?void 0:z.created_at)||"")?f="one":f="double":f="one"),e.jsxs("div",{className:"session "+((y==null?void 0:y.id)==k.id?"active":""),onClick:H=>{console.log(k.other,g),i({client_id:k.other.id,nav:document.querySelector(".back-close.nav").getBoundingClientRect().width==0?void 0:"min"}).setAbsPath(["chat","sessions"]);const w=H.currentTarget.querySelector(".count");w.style.display="none"},onContextMenu:H=>{H.preventDefault(),c(e.jsx(ys,{closed:!!(P!=null&&P.includes(k)),x:H.clientX,y:H.clientY,onClose:w=>{w?(m(k),o("closed")):(v(k),o("opened"))},onAsRead:()=>{u(k)},onDelete:()=>{$(k)}}))},children:[e.jsx("div",{className:"photo",style:{background:Pe(k.other.photos[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:se(k.other.name,16)}),e.jsx("div",{className:"date",children:k.last_message&&je(k.last_message.created_at)})]}),e.jsx("i",{className:"center-ctn",children:se(k.title,20)}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+f}),e.jsx("div",{className:"text",children:k.last_message?se(k.last_message.text,24):"New Session"}),e.jsx("div",{className:"count",style:{display:(y==null?void 0:y.id)==k.id?"none":k.unchecked_count>0?"flex":"none"},children:k.unchecked_count})]})]})]},k.id)})})]})}function ys({x:c,y:s,onClose:i,onAsRead:t,onDelete:a,closed:r}){const n=h.useRef(null);return h.useEffect(()=>{n.current&&ge(n.current)}),e.jsxs("div",{ref:n,className:"discussion-popu",style:{top:`${s}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),e.jsxs("div",{className:"block",onClick:()=>i(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Open":"Close"})]}),e.jsxs("div",{className:"delete",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}const le=ae(c=>({collaborators:void 0,selectedCollaborator:void 0,async updateCollaborator(s){},async change_collaborator_role(s){var r;const i=p.getState().getHeaders();if(!i)return;s.store_id=(r=p.getState().store)==null?void 0:r.id;const t=new FormData,a=[];["store_id","new_role_id","collaborator_id"].forEach(n=>{if(s[n]!=null)t.append(n,s[n]||"");else return a.push(n+" is not defined")});{const l=await(await fetch(`${b}/change_collaborator_role`,{method:"PUT",body:t,headers:i.headers})).json();if(!l||!l.id)return a.push("Server Error, Try Later"),a}},async addCollaborator(s){console.log(s);const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;s.store_id=i.id;const a=new FormData,r=[];["store_id","role_id","email"].forEach(l=>{if(s[l]!=null)a.append(l,s[l]);else return r.push(l+" is not defined")});const n=new Headers;n.append("Authorization",`Bearer ${t.token}`);{const o=await(await fetch(`${b}/add_collaborator`,{method:"POST",body:a,headers:n})).json();if(!o||!o.id)return r.push("Server Error, Try Later"),r;c(()=>({selectedCollaborator:o})),U.getState().fetchUsersVar(),I.getState().setAbsPath(["collaborators","collaborator_profile"])}},async setSelectedCollaborator(s){c(()=>({selectedCollaborator:s}))},async setCollaboratorById(s){const i=le.getState().collaborators,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCollaborator:t}));else if(p.getState().store){const r=await le.getState().fetchCollaborators({query:{user_id:s}});c(()=>({selectedCollaborator:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await le.getState().fetchCollaborators({query:{user_id:s}});c(()=>({selectedCollaborator:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCollaborator(s){let i=p.getState().getHeaders();if(!i)return;const t=new FormData;t.append("store_id",i.store.id),t.append("collaborator_id",s);const a={method:"DELETE",headers:i.headers,body:t},n=await(await fetch(`${b}/remove_collaborator`,a)).json();U.getState().fetchUsersVar(),n.deleted&&c(()=>({selectedCollaborator:void 0}))},async fetchCollaborators(s){var l,o,d,u,m,v,$;let i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=(o=s.query)==null?void 0:o.text),(d=s==null?void 0:s.query)!=null&&d.user_id&&(t.user_id=(u=s.query)==null?void 0:u.user_id),(m=s==null?void 0:s.query)!=null&&m.phone&&(t.phone=(v=s.query)==null?void 0:v.phone),t.store_id=($=i.store)==null?void 0:$.id;const a=new URLSearchParams({});for(const T in t){const y=t[T];a.set(T,y)}const n=await(await fetch(`${b}/get_store_collaborators/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({collaborators:n})),n},async banCollaborator(s){}})),me=ae(c=>({moderators:void 0,selectedModerator:void 0,moderatorCommands:void 0,moderatorVisites:void 0,async setModeratorById(s){const i=me.getState().moderators,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedModerator:t}));else{const a=await me.getState().fetchModerators({query:{user_id:s}});c(()=>({selectedModerator:a==null?void 0:a.list.find(r=>r.id==s)}))}},async setSelectedModerator(s){c(()=>({selectedModerator:s}))},async fetchModerators(s){var l,o,d;const i=p.getState().getHeaders();if(!i)return;const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.order_by&&(t.order_by=s.order_by),(l=s==null?void 0:s.query)!=null&&l.text&&(t.text=s.query.text),(o=s==null?void 0:s.query)!=null&&o.user_id&&(t.user_id=s.query.user_id),(d=s==null?void 0:s.query)!=null&&d.phone&&(t.phone=s.query.phone),t.store_id=i.store.id;const a=new URLSearchParams({});for(const u in t){const m=t[u];a.set(u,m)}const n=await(await fetch(`${b}/get_moderators/?${a.toString()}`,{headers:i.headers})).json();if(!(!n||!n.list))return c(()=>({moderators:n})),n},async banModerator(){}}));function Me(){var k;const{discussion:c,discussions:s,fetchDiscussions:i,addDiscussion:t,blockDiscussion:a,deleteDiscussion:r,unBlockDiscussion:n,setDiscussionByOtherId:l}=W(),{check:o,json:d,pathList:u,qs:m,setAbsPath:v}=I(),$=(k=u[3])==null?void 0:k.split("_")[1],[T,y]=h.useState($||"all"),{openChild:_}=U(),{user:N,store:g}=p(),{fetchCollaborators:C}=le(),{fetchModerators:q}=me();if(h.useEffect(()=>{(d!=null&&d.collaborator_id||d!=null&&d.moderator_id)&&l({other_id:(d==null?void 0:d.collaborator_id)||(d==null?void 0:d.moderator_id),for_moderator:!!(d!=null&&d.moderator_id),async findOther(f,E){var z,H,w,A;return E?((z=me.getState().moderators)==null?void 0:z.list.find(V=>V.id==f))||((H=await me.getState().fetchModerators({query:{user_id:f}}))==null?void 0:H.list[0]):((w=le.getState().collaborators)==null?void 0:w.list.find(V=>V.id==f))||((A=await le.getState().fetchCollaborators({query:{user_id:f}}))==null?void 0:A.list[0])}}),o("chat")&&!s&&g&&i({}),y($||"all")},[d,g]),h.useEffect(()=>{y($||"all")},[u]),!N)return;const x=s==null?void 0:s.list.filter(f=>{var E;return!((E=f.blocked)!=null&&E.includes(N.id))&&!!ie((g==null?void 0:g.id)||"",f)}),P=s==null?void 0:s.list.filter(f=>{var E;return(E=f.blocked)==null?void 0:E.includes(N.id)}),B=s==null?void 0:s.list.filter(f=>{var E;return f.unchecked_count>0&&!((E=f.blocked)!=null&&E.includes(N.id))}),L=s==null?void 0:s.list.filter(f=>!ie((g==null?void 0:g.id)||"",f));let D=[];return T=="admin"?D=L:T=="new"?D=B:T=="blocked"?D=P:D=x,e.jsxs("div",{className:"discussion-nav",children:[e.jsxs("div",{className:"title",children:[e.jsx("div",{className:"label",children:"Chats "}),e.jsxs("div",{className:"add-new",onClick:()=>{_(e.jsx(Ge,{fetchUsers:C,openChild:_,user:N,setUser:(f,E)=>{console.log({discMode:E}),t({other:f,for_moderator:E=="moderators"}),E=="moderators"&&v(["chat","discussions","discussions_admin"])},selector:{list:[{name:"collaborators",fetch:C},{name:"moderators",fetch:q}]}}),!0,"#0002")},children:[" ",e.jsx("span",{})]})]}),e.jsxs("div",{className:"options",children:[e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_all"])},children:e.jsxs("div",{className:T=="all"?"active":"",children:["All",((x==null?void 0:x.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_new"])},children:e.jsxs("div",{className:T=="new"?"active":"",children:["New ",((B==null?void 0:B.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_blocked"])},children:e.jsxs("div",{className:T=="blocked"?"active":"",children:["Blocked  ",((P==null?void 0:P.length)||0)>0?e.jsx("span",{}):void 0]})}),e.jsx("div",{className:"option",onClick:()=>{m(d||{}).setAbsPath(["chat","discussions","discussions_admin"])},children:e.jsxs("div",{className:T=="admin"?"active":"",children:["Admin  ",((L==null?void 0:L.length)||0)>0?e.jsx("span",{}):void 0]})})]}),e.jsx("div",{className:"search",children:e.jsxs("div",{className:"input",children:[e.jsx("div",{className:"icon"}),e.jsx("input",{type:"text",placeholder:"Search"})]})}),e.jsx("div",{className:"discussions",children:D==null?void 0:D.map(f=>{var z;let E="";return((z=f.last_message)==null?void 0:z.user_id)==N.id&&(f[`${f.other_att}_opened_at`]?new Date(f[`${f.other_att}_opened_at`])<new Date(f.last_message.created_at)?E="one":E="double":E="one"),e.jsxs("div",{className:"discussion "+((c==null?void 0:c.id)==f.id?"active":""),onClick:H=>{f.unchecked_count=0,g&&m({[ie(g.id,f)?"collaborator_id":"moderator_id"]:f.other.id,nav:document.querySelector(".back-close.nav").getBoundingClientRect().width==0?void 0:"min"}).setAbsPath(["chat","discussions","discussions_"+(T||"_all")]);const w=H.currentTarget.querySelector(".count");w.style.display="none"},onContextMenu:H=>{H.preventDefault(),_(e.jsx(ws,{canBlock:!!ie(g==null?void 0:g.id,f),blocked:!!(P!=null&&P.includes(f)),x:H.clientX,y:H.clientY,onBlock:w=>{w?(a(f),m(d||{}).setAbsPath(["chat","discussions","discussions_blocked"])):(n(f),m(d||{}).setAbsPath(["chat","discussions","discussions_all"]))},onAsRead:()=>{},onDelete:()=>{r(f)}}))},children:[e.jsx("div",{className:"photo",style:{background:Pe(f.other.photos[0])}}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"top-ctn",children:[e.jsx("div",{className:"name",children:se(f.other.name,16)}),e.jsx("div",{className:"date",children:f.last_message&&je(f.last_message.created_at)})]}),e.jsxs("div",{className:"btm",children:[e.jsx("div",{className:"checked "+E}),e.jsx("div",{className:"text",children:f.last_message?se(f.last_message.text,24):"New Discussion"}),e.jsx("div",{className:"count",style:{display:(c==null?void 0:c.id)==f.id?"none":f.unchecked_count>0?"flex":"none"},children:f.unchecked_count})]})]})]},f.id)})})]})}function ws({x:c,y:s,onBlock:i,onAsRead:t,onDelete:a,blocked:r,canBlock:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&ge(l.current)}),e.jsxs("div",{ref:l,className:"discussion-popu",style:{top:`${s}px`,left:`${c}px`},children:[e.jsxs("div",{className:"as-read",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Mark as read"})]}),n&&e.jsxs("div",{className:"block",onClick:()=>i(!r),children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:r?"Unblock":"Bolck"})]}),e.jsxs("div",{className:"delete",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete chat"})]})]})}function Le(){var H;const{discussion:c,messages:s}=W(),{fetchSendMessage:i,fetchDeleteMessageBoth:t,fetchDeleteMessageMe:a,fetchEditMessage:r}=Z(),{user:n}=p(),{openChild:l}=U(),{qs:o,json:d,navBack:u}=I(),[m,v]=h.useState(!1),[$,T]=h.useState(1),[y,_]=h.useState(!1),N=h.useRef(null),g=h.useRef(null),[C,q]=h.useState(null),[x]=h.useState(Date.now()+""),[P,B]=h.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),L=re(),D=()=>{if(!g.current)return;const w=g.current,A=Math.ceil(w.scrollHeight/(w.getBoundingClientRect().height||20)),V=Math.ceil(w.scrollHeight/20),Q=w.value.split(`
`).length;let X=Math.max(A,Q,V);X=X>10?10:X-1>=1?X-1:1,T(X)};h.useEffect(()=>{D()},[L]),h.useEffect(()=>{window.addEventListener("click",()=>{y&&_(!1)})},[]),h.useEffect(()=>{N.current&&(N.current.scrollTop=N.current.scrollHeight)},[s]);const k=c==null?void 0:c.other.photos[0],f=(w,A)=>w.list[A].user_id==(n==null?void 0:n.id)?"right":"left",E=(w,A)=>w.list[A-1]&&w.list[A-1].user_id==(n==null?void 0:n.id)?"right":"left",z=(w,A)=>w.list[A+1]&&(w.list[A+1].user_id==(n==null?void 0:n.id)?"right":"left");return e.jsxs("div",{className:"discussion-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"open-nonav",onClick:()=>{u()}}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${k!=null&&k.startsWith("/")?b:""}${k})`},onClick:()=>{d!=null&&d.moderator_id?o({moderator_id:c.other.id}).setAbsPath(["moderators","moderator_profile"]):o({collaborator_id:c.other.id}).setAbsPath(["collaborators","collaborator_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:se(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",je(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:G()})})]})]}),!c&&e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})}),c&&n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"messages",ref:w=>{N.current=w,m||(N.current&&N.current.scrollTo({top:N.current.scrollHeight}),v(!0))},onScroll:w=>{const A=w.currentTarget;clearInterval(P.lastid);const V=setTimeout(()=>{const Q={isOpen:!1,height:A.scrollHeight,bottom:A.scrollHeight-(A.scrollTop+A.getBoundingClientRect().height),top:A.scrollTop,onProcess:!1,lastid:V};Q.bottom>150&&(Q.isOpen=!0),B(Q),console.log(V)},100);P.lastid=V},children:(H=s==null?void 0:s.list)==null?void 0:H.map((w,A)=>{var be;const V=f(s,A),Q=E(s,A),X=z(s,A);let xe="";return V==Q?X&&Q==X&&(xe="mid"):X&&V==X&&(xe="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+V+" "+xe,onContextMenu:j=>{j.preventDefault(),l(e.jsx(Cs,{forMe:n.id==w.user_id,x:j.clientX,y:j.clientY,onDeleteBoth:()=>{t(w.id)},onDeleteMe:()=>{a(w.id)},onEdit:()=>{l(e.jsx(Es,{x:j.clientX,y:j.clientY,text:w.text,onEdit:M=>{l(void 0),r({message_id:w.id,text:M})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:w.text&&w.text.split(" ").map((j,M)=>j.split(`
`).map((F,J)=>F?e.jsx("span",{style:{marginRight:"4px"},children:F},M+"+"+J):e.jsx("div",{style:{width:"100%",height:"1em"}},M+"~"+J)))}),e.jsx("div",{className:"files",children:(be=w.files)==null?void 0:be.map(j=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${j.startsWith("/")?b:""}${j}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:j.length>35?se(j,25)+j.substring(j.length-8,j.length):j})]},j))}),e.jsxs("div",{className:"info",children:[w.created_at!=w.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:je(w.created_at)})]})]})},w.id)})}),e.jsxs("div",{className:"sender",children:[P.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{N.current&&N.current.scrollTo({behavior:"smooth",top:P.height})}}),y&&e.jsx("div",{className:"emoji-list",onClick:w=>{w.preventDefault(),w.stopPropagation()},children:es.map(w=>e.jsx("span",{onClick:A=>{A.preventDefault(),A.stopPropagation(),g.current&&(g.current.value+=w.char)},children:w.char},w.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:x+"message_file",onChange:w=>{if(!w.currentTarget.files)return;const A=[];for(let V=0;V<w.currentTarget.files.length;V++){const Q=w.currentTarget.files[V];A.push(Q)}q(A.length>0?C?[...C,...A]:A:null)}}),e.jsx("label",{htmlFor:x+"message_file",className:"add-file",onClick:G()}),e.jsx("div",{className:"emoji-min",onClick:w=>{w.preventDefault(),w.stopPropagation(),G()(w),_(!y)}})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",children:C&&C.map(w=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{C&&q(C.filter(A=>A!==w))}}),e.jsx("div",{className:"text",children:w.name})]},w.name))}),e.jsx("textarea",{autoFocus:!0,ref:g,name:"discussion_sender",placeholder:"Type a message here..",id:"discussion_sender",style:{height:`${$*20}px`},cols:30,rows:10,onChange:w=>{D()},onKeyDown:()=>{_(!1)}})]}),e.jsx("div",{className:"right",children:e.jsx("div",{className:"send",onClick:w=>{var A;G()(w),i({context:c,context_name:"discussions",files:C,text:(A=g.current)==null?void 0:A.value}),q(null),g.current&&(g.current.value="")},children:e.jsx("div",{className:"icon"})})})]})]})]})]})}function Cs({x:c,y:s,onEdit:i,onDeleteBoth:t,onDeleteMe:a,other:r,forMe:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&ge(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${c}px`},children:[n&&e.jsxs("div",{className:"edit",onClick:o=>{o.preventDefault(),o.stopPropagation(),i()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),n&&e.jsxs("div",{className:"delete-both",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function Es({x:c,y:s,onEdit:i,text:t}){const a=h.useRef(null),[r,n]=h.useState(t);return h.useEffect(()=>{a.current&&ge(a.current)}),e.jsxs("div",{ref:a,className:"message-edit-popu",style:{top:`${s}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{n(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{i(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}const ks=250,ss=c=>c.split(" ").map((s,i)=>s.includes(`
`)?s.split(`
`).map((t,a)=>e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"4px"},children:t}),e.jsx("br",{})]},i+"_"+a)):e.jsx("span",{style:{marginRight:"4px"},children:s},i));function $s(){var V,Q,X,xe,be;const{session:c,messages:s,fetchCreateSession:i}=Y(),{fetchSendMessage:t,fetchDeleteMessageBoth:a,fetchDeleteMessageMe:r,fetchEditMessage:n}=Z(),{user:l}=p(),{openChild:o}=U(),{qs:d,navBack:u}=I(),[m,v]=h.useState(!1),[$,T]=h.useState(1),[y,_]=h.useState(!1),N=h.useRef(null),g=h.useRef(null),[C,q]=h.useState(""),[x,P]=h.useState(null),[B]=h.useState(Date.now()+""),[L,D]=h.useState({top:0,bottom:0,height:0,isOpen:!1,lastid:0}),k=re(),f=()=>{if(!g.current)return;const j=g.current,M=Math.ceil(j.scrollHeight/(j.getBoundingClientRect().height||20)),F=Math.ceil(j.scrollHeight/20),J=j.value.split(`
`).length;let ee=Math.max(M,J,F);ee=ee>10?10:ee-1>=1?ee-1:1,T(ee),console.log(ee)};h.useEffect(()=>{f()},[k]),h.useEffect(()=>{window.addEventListener("click",()=>{_(!1)})},[]);const E=c==null?void 0:c.other.photos[0],z=(j,M)=>j.list[M].user_id==(l==null?void 0:l.id)?"right":"left",H=(j,M)=>j.list[M-1]&&j.list[M-1].user_id==(l==null?void 0:l.id)?"right":"left",w=(j,M)=>j.list[M+1]&&(j.list[M+1].user_id==(l==null?void 0:l.id)?"right":"left"),A=!(c!=null&&c.title);return e.jsxs("div",{className:"session-center",children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"open-nonav",onClick:()=>{u()}}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile",style:{background:`no-repeat center/cover url(${E!=null&&E.startsWith("/")?b:""}${E})`},onClick:()=>{d({client_id:c.other.id}).setAbsPath(["clients","client_profile"])}}),e.jsxs("div",{className:"ctn-name",children:[e.jsx("div",{className:"name",children:se(c.other.name,50)}),c[`${c.other_att}_opened_at`]&&e.jsxs("div",{className:"last-time",children:["Last seen ",je(c[`${c.other_att}_opened_at`])]})]}),e.jsx("div",{className:"option",children:e.jsx("div",{className:"more",onClick:G()})})]})]}),!c&&e.jsx("div",{className:"no-discussion",children:e.jsx("div",{className:"label",children:"Select a chat to start messaging"})}),c&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-title",onClick:j=>{o(e.jsx(Ds,{x:j.clientX,y:j.clientY,text:c.title}))},children:[e.jsx("div",{className:"ctn-title",children:e.jsx("div",{className:"text-title",children:se(c.title,50)})}),e.jsxs("div",{className:"option",children:[e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${l.photos[0].startsWith("/")?b:""}${l.photos[0]})`}}),e.jsx("div",{className:"img",style:{background:`no-repeat center/cover url(${c.other.photos[0].startsWith("/")?b:""}${c.other.photos[0]})`}}),e.jsx("div",{className:"status",onClick:G(),children:(V=c.closed)!=null&&V.includes(l.id)&&((Q=c.closed)!=null&&Q.includes(c.other.id))||(X=c.closed)!=null&&X.includes(l.id)?"Closed":((xe=c.closed)!=null&&xe.includes(c.other.id),"Open")})]})]}),A&&e.jsx("div",{className:"title",children:e.jsxs("div",{className:"ctn",children:[e.jsx("h1",{className:"label",children:"New Session Title"}),e.jsx("div",{className:"text",children:ss(C)})]})}),e.jsx("div",{className:"messages",style:{display:A?"none":""},ref:j=>{N.current=j,m||(N.current&&N.current.scrollTo({top:N.current.scrollHeight}),v(!0))},onScroll:j=>{const M=j.currentTarget;clearInterval(L.lastid);const F=setTimeout(()=>{const J={isOpen:!1,height:M.scrollHeight,bottom:M.scrollHeight-(M.scrollTop+M.getBoundingClientRect().height),top:M.scrollTop,onProcess:!1,lastid:F};J.bottom>150&&(J.isOpen=!0),D(J)},100);L.lastid=F},children:(be=s==null?void 0:s.list)==null?void 0:be.map((j,M)=>{var Ue;const F=z(s,M),J=H(s,M),ee=w(s,M);let Te="";return F==J?ee&&J==ee&&(Te="mid"):ee&&F==ee&&(Te="start"),e.jsx("div",{className:"message",children:e.jsxs("div",{className:"ctn "+F+" "+Te,onContextMenu:O=>{O.preventDefault(),o(e.jsx(Ps,{forMe:l.id==j.user_id,x:O.clientX,y:O.clientY,onDeleteBoth:()=>{a(j.id)},onDeleteMe:()=>{r(j.id)},onEdit:()=>{o(e.jsx(Rs,{x:O.clientX,y:O.clientY,text:j.text,onEdit:Ee=>{o(void 0),n({message_id:j.id,text:Ee})}}),!0)},other:c.other}))},children:[e.jsx("div",{className:"text",children:j.text&&j.text.split(" ").map((O,Ee)=>O.split(`
`).map((Oe,Fe)=>Oe?e.jsx("span",{style:{marginRight:"4px"},children:Oe},Ee+"+"+Fe):e.jsx("div",{style:{width:"100%",height:"1em"}},Ee+"~"+Fe)))}),e.jsx("div",{className:"files",children:(Ue=j.files)==null?void 0:Ue.map(O=>e.jsxs("div",{className:"message-file",onClick:()=>{window.open(`${O.startsWith("/")?b:""}${O}`,void 0)},children:[e.jsx("div",{className:"save"}),e.jsx("div",{className:"lable",children:O.length>35?se(O,25)+O.substring(O.length-8,O.length):O})]},O))}),e.jsxs("div",{className:"info",children:[j.created_at!=j.updated_at&&e.jsx("div",{className:"edited"}),e.jsx("div",{className:"date",children:je(j.created_at)})]})]})},j.id)})}),e.jsxs("div",{className:"sender",children:[L.isOpen&&e.jsx("div",{className:"down-btn",onClick:()=>{N.current&&N.current.scrollTo({behavior:"smooth",top:L.height})}}),y&&e.jsx("div",{className:"emoji-list",onClick:j=>{j.preventDefault(),j.stopPropagation()},children:es.map(j=>e.jsx("span",{onClick:M=>{M.preventDefault(),M.stopPropagation(),q(C+j.char)},children:j.char},j.char))}),e.jsxs("div",{className:"ctn",children:[e.jsxs("div",{className:"left",children:[!A&&e.jsxs(e.Fragment,{children:[e.jsx("input",{multiple:!0,type:"file",style:{display:"none"},name:"message_file",id:B+"message_file",onChange:j=>{if(!j.currentTarget.files)return;const M=[];for(let F=0;F<j.currentTarget.files.length;F++){const J=j.currentTarget.files[F];M.push(J)}P(M.length>0?x?[...x,...M]:M:null)}}),e.jsx("label",{htmlFor:B+"message_file",className:"add-file",onClick:G()}),e.jsx("div",{className:"emoji-min",onClick:j=>{j.preventDefault(),j.stopPropagation(),G()(j),_(!y)}})]})," ",A&&e.jsxs("div",{className:"text-length",children:[C.length,A?"/"+ks:""]})]}),e.jsxs("div",{className:"sender_center",children:[e.jsx("div",{className:"files",style:{display:A?"none":""},children:x&&x.map(j=>e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"remove",onClick:()=>{x&&P(x.filter(M=>M!==j))}}),e.jsx("div",{className:"text",children:j.name})]},j.name))}),e.jsx("textarea",{autoFocus:!0,ref:g,name:"session_sender",placeholder:"Type a message here..",id:"session_sender",style:{height:`${$*20}px`},cols:30,rows:10,onChange:j=>{f()},onKeyDown:()=>{_(!1)}})]}),e.jsx("div",{className:"right",children:e.jsx("div",{className:"send",onClick:j=>{G()(j),A?i(c.other.id,C):t({context:c,context_name:"sessions",files:x,text:C}),P(null),q("")},children:e.jsx("div",{className:"icon"})})})]})]})]})]})}function Ps({x:c,y:s,onEdit:i,onDeleteBoth:t,onDeleteMe:a,other:r,forMe:n}){const l=h.useRef(null);return h.useEffect(()=>{l.current&&ge(l.current)}),e.jsxs("div",{ref:l,className:"message-popu",style:{top:`${s}px`,left:`${c}px`},children:[n&&e.jsxs("div",{className:"edit",onClick:o=>{o.preventDefault(),o.stopPropagation(),i()},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Edit message"})]}),e.jsxs("div",{className:"delete-me",onClick:a,children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Delete for me"})]}),n&&e.jsxs("div",{className:"delete-both",onClick:t,children:[e.jsx("div",{className:"icon"}),e.jsxs("div",{className:"label",children:["Delete also for ",r.name," "]})]})]})}function Ds({x:c,y:s,text:i}){const t=h.useRef(null);return h.useEffect(()=>{t.current&&ge(t.current)}),e.jsx("p",{ref:t,className:"title-popup",style:{top:`${s}px`,left:`${c}px`},children:ss(i||"")})}function Rs({x:c,y:s,onEdit:i,text:t}){const a=h.useRef(null),[r,n]=h.useState(t);return h.useEffect(()=>{a.current&&ge(a.current)}),e.jsxs("div",{ref:a,className:"message-edit-popu",style:{top:`${s}px`,left:`${c}px`},onClick:l=>{l.stopPropagation(),l.preventDefault()},children:[e.jsx("div",{className:"title",children:"Edit message"}),e.jsxs("div",{className:"input",children:[e.jsx("textarea",{value:r,onChange:l=>{n(l.currentTarget.value)}}),e.jsx("div",{className:"save",onClick:()=>{i(r)},children:e.jsxs("div",{className:"save-ctn",children:[e.jsx("div",{className:"label",children:"Save"}),e.jsx("div",{className:"icon"})]})})]})]})}function As(){const{check:c,qs:s,pathList:i,json:t}=I(),{user:a}=p(),r={discussions:e.jsx(Me,{}),groups:e.jsx(Me,{}),sessions:e.jsx(bs,{}),surveys:e.jsx(Me,{})},n={discussions:e.jsx(Le,{}),groups:e.jsx(Le,{}),sessions:e.jsx($s,{}),surveys:e.jsx(Le,{})},l=(i==null?void 0:i[2])||"discussions",o=(t==null?void 0:t.nav)||"max";return c("chat")&&a&&e.jsxs("div",{className:"page-chat",children:[e.jsx("div",{className:"back-close nav",style:{display:o=="min"?"none":""},onClick:d=>{d.currentTarget==d.target&&s({...t,nav:"min"}).apply()}}),e.jsxs("div",{className:"chat-nav "+o,children:[e.jsxs("div",{className:"top",children:[e.jsx("div",{className:"nav-size "+o,onClick:d=>{G(.4)(d),s({...t,nav:o=="min"?"max":"min"}).apply()}}),e.jsx("div",{className:"icon discussions-icon "+(l=="discussions"?"active":""),onClick:d=>{G(.4)(d),s({nav:o}).setAbsPath(["chat","discussions"])}}),e.jsx("div",{className:"icon sessions "+(l=="sessions"?"active":""),onClick:d=>{G(.4)(d),s({nav:o}).setAbsPath(["chat","sessions"])}}),e.jsx("div",{className:"icon profile",style:{background:`no-repeat center/cover url(${a.photos[0].startsWith("/")?b:""}${a.photos[0]})`},onClick:()=>{s({nav:o}).setAbsPath(["profile"])}})]}),o=="max"&&e.jsx("div",{className:"nav-ctn",children:r[l]})]}),e.jsx("div",{className:"chat-center",children:n[l]})]})}function Ts(){return e.jsx("div",{className:"page-interface"})}function Is(){const{current:c,setAbsPath:s,qs:i}=I(),{fetchCategories:t,categories:a,setSelectedCategory:r}=he(),{store:n}=p();return h.useEffect(()=>{c("categories")&&n&&t()},[n]),c("categories")&&e.jsx("div",{className:"category-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","label","description","catalog_id","index","status","created_at","total_products"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{index:Ne([0,100]),status:_e(["PAUSE","TRASH","NEW"],[]),total_products:te([0,1e3],[0,1e3])}},items_height:80,id:"category_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},label:S.StringElement({size_interval:[50,200]}),status:de,total_products:{getView(l,o,d,u){return S.StringElement().getView(l,o||0,d,u)}},catalog_id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},created_at:S.DateStringElement({size:500})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),r(l[0]),i({category_id:l[0].id}).setAbsPath(["categories","dash_categories"])},onQuery:l=>{t(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["categories","new_category"])}})})})}const fe=ae(c=>({catalogs:void 0,selectedCatalog:void 0,catalogProducts:void 0,catalogCategories:void 0,async setCatalogById(s){const i=fe.getState().catalogs,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedCatalog:t}));else if(p.getState().store){const r=await fe.getState().fetchCatalogs({query:{user_id:s}});c(()=>({selectedCatalog:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await fe.getState().fetchCatalogs({query:{user_id:s}});c(()=>({selectedCatalog:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async removeCatalog(s){const i=p.getState().getHeaders();if(!i)return;const a=await(await fetch(`${b}/delete_catalog/${s}`,{method:"DELETE",headers:i.headers})).json();return U.getState().fetchStoreVar(),a==null?void 0:a.isDeleted},async createCatalog(s){const i=p.getState().getHeaders();if(!i)return;s.index=s.index||0,s.store_id=i.store.id;const t=new FormData,a=[];if(["label","description","store_id","index"].forEach(r=>{if(s[r]!=null)t.append(r,s[r]);else return a.push(r+" is not defined")}),console.log(a,s),a.length==0){const n=await(await fetch(`${b}/create_catalog`,{method:"POST",body:t,headers:i.headers})).json();if(!n||!n.id)return a.push("Server Error, Try Later"),a;c(()=>({selectedCatalog:n})),U.getState().fetchStoreVar()}else return a},async fetchCatalogCategories(s){if(!(s!=null&&s.catalog_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.catalog_id=s.catalog_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_categories/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({catalogCategories:n}))}catch(t){return console.warn(t.message)}},async fetchCatalogProducts(s){if(!(s!=null&&s.catalog_id))return;const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),t.catalog_id=s.catalog_id,t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_products/?${a.toString()}`,{headers:i.headers})).json();if(!n||!n.list)return;c(()=>({catalogProducts:n}))}catch(t){return console.warn(t.message)}},async updateCatalog(s){if(!s.catalog_id)return;const i=p.getState().getHeaders();if(!i)return;let t=!1;const a=new FormData;a.append("catalog_id",s.catalog_id),["label","index","status","description"].forEach(n=>{s[n]&&(a.append(n,s[n]),t=!0)});let r=null;if(t&&(r=await fetch(`${b}/update_catalog`,{method:"PUT",body:a,headers:i.headers})),s.scene_dir){const n=new FormData;n.append("scene_dir",s.scene_dir),n.append("catalog_id",s.catalog_id),r=await fetch(`${b}/update_view_catalog`,{method:"PUT",body:n,headers:i.headers})}r&&(r=await r.json(),c(()=>({catalogProducts:r})))},setSelectedCatalog(s){c(()=>({selectedCatalog:s}))},async fetchCatalogs(s){const i=p.getState().getHeaders();if(i)try{const t={};s!=null&&s.page&&(t.page=Number(s.page)),s!=null&&s.limit&&(t.limit=Number(s.limit)),s!=null&&s.sortBy&&(t.order_by=s.sortBy),s!=null&&s.query.text&&(t.text=s.query.text),t.all_status=!0,t.store_id=i.store.id;const a=new URLSearchParams({});for(const l in t){const o=t[l];a.set(l,o)}const n=await(await fetch(`${b}/get_catalogs/?${a.toString()}`,{headers:i.headers})).json();return!n||!n.list?void 0:(c(()=>({catalogs:n})),n)}catch(t){console.warn(t.message);return}}}));function Ms({onChange:c,catalog_id:s}){const{fetchCatalogs:i,catalogs:t}=fe(),[a,r]=h.useState(),[n,l]=h.useState("");return h.useEffect(()=>{i()},[]),h.useEffect(()=>{r(t==null?void 0:t.list.find(o=>o.id==s))},[t]),e.jsxs("div",{className:"choise-catalog",children:[e.jsxs("div",{className:"choise-ctn",onClick:()=>{l(n?"":"open")},children:[e.jsx("div",{className:"back",children:e.jsx("div",{className:"icon"})}),e.jsxs("div",{className:"text",children:[e.jsx("div",{className:"label",children:"Catalog"}),e.jsx("div",{className:"name",children:(a==null?void 0:a.label)||"Select Catalog"})]}),e.jsx("div",{className:"choise-icon",style:{transform:n?"rotate(180deg)":""}})]}),e.jsx("div",{className:"list-catalog "+n,style:{height:n?`${45*((t==null?void 0:t.list.length)||0)}px`:"0px"},children:t==null?void 0:t.list.map(o=>e.jsxs("div",{className:"item "+((a==null?void 0:a.id)==o.id?"selected":""),onClick:()=>{r(o),c==null||c(o.id)},children:[e.jsx("div",{className:"label",children:o.label}),e.jsxs("div",{className:"id",children:["#",o.id.split("-")[0]]})]},o.id))})]})}function Ls(){const{current:c,setAbsPath:s,json:i}=I(),{selectedCategory:t,setSelectedCategory:a,setCategoryById:r,fetchCategoryProducts:n,categoryProducts:l,updateCategory:o,createCategory:d,removeCategory:u}=he(),[m]=h.useState({}),{setSelectedProduct:v}=ce(),[$]=h.useState(!1),y=re().width<1e3?"wrap":"";h.useEffect(()=>{t&&n({category_id:t.id})},[t]),h.useEffect(()=>{i!=null&&i.category_id&&r(i==null?void 0:i.category_id)},[i]);const _=c("dash_categories"),N=c("new_category"),g=e.jsxs(e.Fragment,{children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{status:(t==null?void 0:t.status)||"PAUSE",onChange:C=>{_?t&&o({category_id:t.id,status:C}):m.status=C}}),e.jsx("div",{className:"editor-scene-file",children:e.jsx(He,{file_name:t==null?void 0:t.scene_dir,ext:["zip"],label:"Upload Scene File",onChange:C=>{_?t&&o({category_id:t.id,scene_dir:C}):m.scene_dir=C}})})]}),e.jsx("div",{className:"editor-category",children:e.jsx(Ms,{catalog_id:_&&(t==null?void 0:t.catalog_id),onChange:C=>{_?t&&o({category_id:t.id,catalog_id:C}):m.catalog_id=C}})})]});return(_||N)&&(!t&&_?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"category-dash",ref:K,children:[e.jsx(pe,{terme:"white",deteleKey:(t==null?void 0:t.id)||"noga",mode:N?"create":"delete",title:"Category Information",onCreate:()=>{d(m).then(C=>{if(!C)return s(["categories","dash_categories"])})},onDelete:()=>{u(t==null?void 0:t.id).then(C=>{C&&a(void 0)})}}),e.jsxs("section",{className:"editor "+y,children:[e.jsxs("div",{className:"left-side",children:[_&&e.jsx(R,{isCheckRequired:$,label:"Category Id",value:(t==null?void 0:t.id)||""}),e.jsx("div",{className:"category-title",children:e.jsx(R,{editable:!0,prompt:"Category Label",isCheckRequired:$,min:3,check:"auto",max:50,label:"Label",placeholder:"Catalog Label",value:_&&((t==null?void 0:t.label)||""),onChange:C=>{_?o({category_id:t==null?void 0:t.id,label:C}):m.label=C}})}),e.jsx("div",{className:"category-description",children:e.jsx(ze,{editable:!0,prompt:"Category Description",isCheckRequired:$,min:3,check:"auto",max:250,label:"Description",placeholder:"Catalog Description",value:_&&((t==null?void 0:t.description)||""),onChange:C=>{_?o({category_id:t==null?void 0:t.id,description:C}):m.description=C}})}),_&&g]}),e.jsxs("div",{className:"right-side",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(Ve,{onClick:()=>{},direction:"horizontal"})]}),N&&g]})]}),_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{className:"",children:"Products That Use This Category"}),e.jsx("h2",{className:"see-all",onClick:()=>{s(["products"])},children:"SEE ALL"})]}),e.jsx(S,{filter:{sortBy:"id",limit:(l==null?void 0:l.limit)||25,page:l==null?void 0:l.page,total:l==null?void 0:l.total},disableFilterBar:!0,items_height:80,id:"product-use-cattegory_list",datas:(l==null?void 0:l.list)||[],itemsMapper:{images:{getView(C,q,x,P){return S.ImageElement().getView(C,`${b}${q[0]}`,x,P)}},id:{getView(C,q,x,P){return e.jsxs("div",{ref:P,children:["#",q.split("-")[0]]},x.id)}},title:S.StringElement({size_interval:[50,200]}),status:S.StringElement({size:150}),stock:S.StringElement(),category_id:{getView(C,q,x,P){return e.jsxs("div",{ref:P,children:["#",q.split("-")[0]]},x.id)}},price:S.StringElement({size:200}),created_at:S.DateStringElement({size:200})},onItemsSelected:C=>{v(C[0]),s(["products","dash_product"])}})]})]}))}function qs(){const{check:c,setAbsPath:s,current:i}=I();return c("categories")&&e.jsxs("div",{className:"page-categories",children:[(i("categories")||i("new_category")||i("dash_categories"))&&e.jsx(Ae,{active:"categories",setActive:t=>s(t.path)}),e.jsx(Is,{}),e.jsx(Ls,{})]})}function Bs(){const{current:c,setAbsPath:s,qs:i}=I(),{store:t}=p(),{features:a,fetchFeatures:r,setSelectedFeature:n}=ve();return h.useEffect(()=>{c("features")&&t&&r()},[t]),c("features")&&e.jsx("div",{className:"features-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","collect_type","icon","name","created_at"],limit:a==null?void 0:a.limit,page:a==null?void 0:a.page,total:a==null?void 0:a.total,filter:{}},items_height:80,id:"category_list",datas:(a==null?void 0:a.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},name:S.StringElement({size_interval:[50,200]}),collect_type:S.StringElement({size:150}),icon:{getView(l,o,d,u){let m=null;return d.onResize(l,v=>{m&&(m.style.width=`${Math.min(v.height,v.width)*.9}px`,m.style.height=`${Math.min(v.height,v.width)*.9}px`)}),e.jsx("div",{ref:u,children:e.jsx("div",{className:"image-element",ref:v=>m=v,style:{background:Pe(o[0]||"","40%")}})},l)}},created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),n(l[0]),i({feature_id:l[0].id}).setAbsPath(["features","dash_features"])},onQuery:l=>{console.log("query",l),r(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["features","new_feature"])}})})})}function Je({onChange:c,list:s,canEdit:i,select:t,color:a}){const[r,n]=h.useState(t||"");return e.jsx("div",{className:"choise-status",children:e.jsx("div",{className:"ctn",children:s.map(l=>e.jsx("div",{className:"one-choise "+l.toLocaleLowerCase()+" "+(r==l?"active":""),style:{background:r==l&&a||""},onClick:()=>{i&&n(r==l?"":l),i&&(c==null||c(r==l?"":l))},children:l},l))})})}function zs(){var N;const{current:c,setAbsPath:s,json:i}=I(),{user:t}=p(),{selectedFeature:a,createFeature:r,fetchProductsUseFeature:n,productsUseFeature:l,setSelectedFeature:o,removeFeature:d,setFeatureById:u}=ve(),[m]=h.useState({}),v=c("new_feature"),$=c("dash_features"),[T]=h.useState({url:(N=a==null?void 0:a.icon)==null?void 0:N[0]}),_=re().width<1e3?"wrap":"";return m.prduct_id=a==null?void 0:a.id,h.useEffect(()=>{a&&n(a.id)},[a]),h.useEffect(()=>{$&&(i!=null&&i.feature_id)&&t&&u(i.feature_id)},[t,i]),($||v)&&(!a&&$?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"dash-feature",ref:K,children:[e.jsx(pe,{deteleKey:(a==null?void 0:a.id)||"noga",mode:v?"create":"delete",title:"Product Information",onCreate:()=>{r(m).then(g=>{if(!g)return s(["products","dash_product"])})},onDelete:()=>{a&&d(a.id).then(g=>{g&&o(void 0)})}}),e.jsxs("section",{className:"editor "+_,children:[e.jsxs("div",{className:"left-side",children:[$&&e.jsx(R,{label:"Feature Id",value:(a==null?void 0:a.id)||""}),e.jsx(R,{editable:!0,label:"Name",value:(a==null?void 0:a.name)||""}),e.jsx("label",{htmlFor:"choise_feature_icon",className:"choise_icon",children:e.jsxs("div",{className:"ctn",children:[e.jsx("input",{type:"file",name:"choise_feature_icon",id:"choise_feature_icon",onChange:g=>{}}),e.jsx("div",{className:"icon",style:{background:Pe((a==null?void 0:a.icon[0])||"")}}),e.jsxs("div",{className:"text",children:[e.jsxs("span",{className:"title",children:[a!=null&&a.icon?"Change":"Choise"," Icon"]}),e.jsx("span",{className:"url",children:se(T.url||"",20)})]})]})}),e.jsx(R,{editable:!0,label:"Collected type",value:(a==null?void 0:a.collect_type)||""}),e.jsx(Je,{canEdit:!0,list:["Required"],onChange:g=>{console.log(g)}}),e.jsx(R,{editable:!0,label:"Placeholder",value:(a==null?void 0:a.placeholder)||""}),e.jsx(R,{editable:!0,label:"Default",value:"TODO DEFAULT"}),e.jsx(Je,{canEdit:!0,select:a!=null&&a.capitalize?"Capitalize":a!=null&&a.lowercase?"Lowercase":a!=null&&a.uppercase?"Uppercase":"",list:["Capitalise","Uppercase","LowerCase"],onChange:g=>{console.log(g)}}),e.jsx(R,{editable:!0,label:"Macth RegExp",value:(a==null?void 0:a.match)||""}),e.jsx(R,{editable:!0,label:"Min Length",type:"number",value:(a==null?void 0:a.min_length)||""}),e.jsx(R,{editable:!0,label:"Max Length",type:"number",value:(a==null?void 0:a.max_length)||""}),e.jsx(R,{editable:!0,label:"Min Value",type:"number",value:(a==null?void 0:a.min)||""}),e.jsx(R,{editable:!0,label:"Max Value",type:"number",value:(a==null?void 0:a.max)||""}),e.jsx(R,{editable:!0,label:"Max File Size",type:"number",value:(a==null?void 0:a.max_size)||""}),e.jsx(R,{editable:!0,label:"Files Type",value:(a==null?void 0:a.ext)||""}),e.jsx(R,{editable:!0,label:"Enumeration of possible values",value:(a==null?void 0:a.id)||""}),e.jsx("div",{className:"editor-name"})]}),e.jsx("div",{className:"right-side",children:e.jsx(Se,{})})]}),e.jsx("h1",{className:"",children:"Feature's Products"}),e.jsx(S,{filter:{sortBy:"id",limit:(l==null?void 0:l.limit)||25,page:l==null?void 0:l.page,total:l==null?void 0:l.total},disableFilterBar:!0,items_height:80,id:"product-use-Feature_list",datas:(l==null?void 0:l.list)||[],itemsMapper:{images:{getView(g,C,q,x){return S.ImageElement().getView(g,`${b}${C[0]}`,q,x)}},id:{getView(g,C,q,x){return e.jsxs("div",{ref:x,children:["#",C.split("-")[0]]},q.id)}},title:S.StringElement({size_interval:[50,200]}),status:S.StringElement({size:150}),stock:S.StringElement(),category_id:{getView(g,C,q,x){return e.jsxs("div",{ref:x,children:["#",C.split("-")[0]]},q.id)}},price:S.StringElement({size:200}),created_at:S.DateStringElement({size:200})}})]}))}function Vs(){const{check:c,setAbsPath:s,current:i}=I();return c("features")&&e.jsxs("div",{className:"page-features",children:[(i("features")||i("dash_features")||i("new_feature"))&&e.jsx(Ae,{active:"features",setActive:t=>s(t.path)}),e.jsx(Bs,{}),e.jsx(zs,{})]})}function Hs(){const{current:c,setAbsPath:s,qs:i}=I(),{catalogs:t,fetchCatalogs:a,setSelectedCatalog:r}=fe(),{store:n}=p();return h.useEffect(()=>{c("catalogs")&&n&&a()},[n]),c("catalogs")&&e.jsx("div",{className:"catalog-list",children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","label","description","index","status","created_at"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{}},items_height:80,id:"category_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},label:S.StringElement({size_interval:[50,200]}),total_product:{getView(l,o,d,u){return S.StringElement().getView(l,o||0,d,u)}},description:S.StringElement({size_interval:[50,200]}),status:de,created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),r(l[0]),i({catalog_id:l[0].id}).setAbsPath(["catalogs","dash_catalogs"])},onQuery:l=>{a(l)},top_height:40,canAddNew:!0,canPaginate:!0,onNewRequired:()=>{s(["catalogs","new_catalog"])}})})})}function Us(){const{json:c,current:s,setAbsPath:i}=I(),{setCatalogById:t,selectedCatalog:a,catalogCategories:r,fetchCatalogCategories:n,updateCatalog:l,catalogProducts:o,setSelectedCatalog:d,removeCatalog:u,fetchCatalogProducts:m,createCatalog:v}=fe(),{setSelectedProduct:$}=ce(),{setSelectedCategory:T}=he(),[y]=h.useState({}),{store:_}=p(),[N,g]=h.useState("products"),[C]=h.useState(!1),x=re().width<1e3?"wrap":"";h.useEffect(()=>{a&&(m({catalog_id:a.id}),n({catalog_id:a.id}))},[a]);const P=s("dash_catalogs"),B=s("new_catalog");h.useEffect(()=>{c!=null&&c.catalog_id&&t(c==null?void 0:c.catalog_id)},[c]);const L=e.jsx(e.Fragment,{children:P&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{status:(a==null?void 0:a.status)||"PAUSE",onChange:D=>{P?a&&l({catalog_id:a.id,status:D}):y.status=D}})," ",e.jsx(He,{file_name:P?a==null?void 0:a.scene_dir:void 0,ext:["zip"],label:"Upload Scene File",onChange:D=>{P?a&&l({catalog_id:a.id,scene_dir:D}):y.scene_dir=D}})]})});return console.log({selectedCatalog:a}),(P||B)&&(!a&&P?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"catalog-dash",ref:K,children:[e.jsx(pe,{terme:"dark",deteleKey:(a==null?void 0:a.id)||"noga",mode:B?"create":"delete",title:"Catalog Information",onCreate:()=>{v(y).then(D=>{if(!D)return i(["catalogs","dash_catalogs"])})},onDelete:()=>{a&&u(a.id).then(D=>{D&&d(void 0)})}}),e.jsxs("section",{className:"editor "+x,children:[e.jsxs("div",{className:"left-side",children:[P&&e.jsx(R,{isCheckRequired:C,label:"Catalog Id",value:(a==null?void 0:a.id)||""}),e.jsxs("div",{className:"editor-name",children:[e.jsx("div",{className:"catalog-title",children:e.jsx(R,{editable:!0,prompt:"Catalog Label",isCheckRequired:C,min:3,check:"auto",max:50,label:"Label",placeholder:"Catalog Label",value:P&&((a==null?void 0:a.label)||""),onChange:D=>{P?a&&l({catalog_id:a.id,label:D}):y.label=D}})}),e.jsx("div",{className:"Catalog-description",children:e.jsx(ze,{editable:!0,prompt:"Catalog Description",isCheckRequired:C,min:3,check:"auto",max:250,label:"Description",placeholder:"Catalog Description",value:P&&((a==null?void 0:a.description)||""),onChange:D=>{P?a&&l({catalog_id:a.id,description:D}):y.description=D}})})]}),P&&L]}),e.jsxs("div",{className:"right-side",children:[P&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(Ve,{onClick:()=>{},direction:"horizontal"})]}),B&&e.jsxs(e.Fragment,{children:[e.jsx(R,{isCheckRequired:C,label:"Store Name",value:(_==null?void 0:_.name)||""}),e.jsx(R,{isCheckRequired:C,label:"Store Id",value:(_==null?void 0:_.id)||""})]})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"btm-list",children:[e.jsx("h1",{children:"Products That Use This Catalog"}),e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{className:"btn "+(N=="products"?"active":""),onClick:()=>{g("products")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Products"})]}),e.jsxs("div",{className:"btn "+(N=="categories"?"active":""),onClick:()=>{g("categories")},children:[e.jsx("div",{className:"icon"}),e.jsx("div",{className:"label",children:"Categories"})]})]}),e.jsx("h2",{className:"see-all",onClick:()=>{N=="products"?i(["products"]):i(["categories"])},children:"SEE ALL"})]}),N=="products"&&e.jsx(S,{filter:{sortBy:"id",limit:(o==null?void 0:o.limit)||25,page:o==null?void 0:o.page,total:o==null?void 0:o.total},disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(o==null?void 0:o.list)||[],itemsMapper:{images:{getView(D,k,f,E){return S.ImageElement().getView(D,`${b}${k[0]}`,f,E)}},id:{getView(D,k,f,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},f.id)}},title:S.StringElement({size_interval:[50,200]}),stock:S.StringElement(),category_id:{getView(D,k,f,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},f.id)}},price:S.StringElement({size:200}),status:de,created_at:S.DateStringElement({size:200})},onItemsSelected:D=>{$(D[0]),i(["products","dash_product"])}}),N=="categories"&&e.jsx(S,{disableFilterBar:!0,items_height:80,id:"product-use-catalog_list",datas:(r==null?void 0:r.list)||[],itemsMapper:{id:{getView(D,k,f,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},f.id)}},label:S.StringElement({size_interval:[50,200]}),total_products:{getView(D,k,f,E){return S.StringElement().getView(D,k||0,f,E)}},catalog_id:{getView(D,k,f,E){return e.jsxs("div",{ref:E,children:["#",k.split("-")[0]]},f.id)}},status:de,created_at:S.DateStringElement({size:500})},onItemsSelected:D=>{console.log(D[0],"))))))))))))))"),T(D[0]),i(["categories","dash_categories"])}})]})]}))}function Os(){const{check:c,setAbsPath:s,current:i}=I();return c("catalogs")&&e.jsxs("div",{className:"page-catalogs",children:[(i("catalogs")||i("new_catalog")||i("dash_catalogs"))&&e.jsx(Ae,{active:"categories",setActive:t=>s(t.path)}),e.jsx(Us,{}),e.jsx(Hs,{})]})}function Fs(){const{current:c,qs:s}=I(),{moderators:i,setSelectedModerator:t,fetchModerators:a}=me(),{store:r}=p();return h.useEffect(()=>{c("moderators")&&r&&a()},[r]),c("moderators")&&e.jsx("div",{className:"moderator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:i==null?void 0:i.limit,page:i==null?void 0:i.page,total:i==null?void 0:i.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"moderator_list",datas:(i==null?void 0:i.list)||[],itemsMapper:{photos:{getView(n,l,o,d){return S.ImageElement().getView(n,`${l[0].startsWith("/")?b:""}${l[0]}`,o,d)}},id:{getView(n,l,o,d){return e.jsxs("div",{ref:d,children:["#",l.split("-")[0]]},o.id)}},name:S.StringElement({size_interval:[50,200]}),status:{getView(n,l,o,d){return de.getView(n,"VISIBLE",o,d)}},created_at:S.DateStringElement({size:200})},onItemsSelected:(n,l)=>{l.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="")}),n.forEach(o=>{o.$itemRef&&(o.$itemRef.style.background="#00f2")}),t(n[0]),s({moderator_id:n[0].id}).setAbsPath(["moderators","moderator_profile"])},onQuery:n=>{a(n)},top_height:40,canPaginate:!0})})})}function Ws(){const{current:c,json:s}=I(),{user:i}=p(),{selectedModerator:t,setModeratorById:a}=me(),{store:r}=p(),[n]=h.useState(!1),o=re().width<1e3?"wrap":"";return h.useEffect(()=>{c("moderator_profile")&&(s!=null&&s.moderator_id)&&r&&a(s.moderator_id)},[s,r]),c("moderator_profile")&&(t?e.jsxs("div",{className:"moderator-profile",ref:K,children:[e.jsx("h1",{children:"Moderator Information"}),e.jsxs("section",{className:"editor "+o,children:[e.jsx("div",{className:"left-right",children:e.jsx(Ce,{name:"moderator_profile",images:t.photos||[],cannotEdit:!0})}),e.jsxs("div",{className:"left-side",children:[e.jsx(R,{isCheckRequired:n,label:"Moderator Id",value:(t==null?void 0:t.id)||""}),e.jsx(R,{prompt:"Moderator Name",isCheckRequired:n,min:3,check:"auto",max:50,label:"Name",placeholder:"Catalog Label",value:t==null?void 0:t.name}),e.jsx(R,{prompt:"Moderator Email",isCheckRequired:n,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:t==null?void 0:t.email}),e.jsx(R,{label:"created At",value:t==null?void 0:t.created_at}),e.jsx(R,{label:"Join Store At",value:t==null?void 0:t.join_at}),i&&t.id!=i.id&&e.jsx(Be,{user:t,channel:"discussions_admin"})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function Ks(){const{check:c,current:s,setAbsPath:i}=I();return c("moderators")&&e.jsxs("div",{className:"moderator-page",children:[s("moderators","moderator_profile")&&e.jsx(De,{active:"moderators",setActive:t=>i(t.path)}),e.jsx(Fs,{}),e.jsx(Ws,{})]})}const ne=ae(c=>({json_roles:void 0,roles:void 0,selectedRole:void 0,async setSelectedRole(s){c(()=>({selectedRole:s}))},async setRoleById(s){const i=ne.getState().roles,t=i==null?void 0:i.list.find(a=>a.id==s);if(t)c(()=>({selectedRole:t}));else if(p.getState().store){const r=await ne.getState().fetchRoles({role_id:s});c(()=>({selectedRole:r==null?void 0:r.list.find(n=>n.id==s)}))}else{const r=Date.now(),n=setInterval(async()=>{if(Date.now()-r>10*1e3&&clearInterval(n),p.getState().store){clearInterval(n);const o=await ne.getState().fetchRoles({role_id:s});c(()=>({selectedRole:o==null?void 0:o.list.find(d=>d.id==s)}))}},100)}},async newRole(s){var o;if(!s.name)return console.log("Name required");if(!s.options||s.options.length==0)return console.log("Option Is required");const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new FormData;a.append("name",s.name),a.append("store_id",i.id),(o=s.options)==null||o.forEach(d=>{a.append(d,"1")});const r=new Headers;r.append("Authorization",`Bearer ${t.token}`);const l=await(await fetch(`${b}/create_collaborator_role`,{method:"POST",body:a,headers:r})).json();!l||!l.id||(console.log("new role",l),c(()=>({selectedRole:l})),U.getState().fetchUsersVar(),I.getState().setAbsPath(["roles","edit_role"]))},async updateRole(s){var d,u;console.log("data",s);const i=ne.getState().selectedRole;if(!i)return;if(!s.name&&!s.options)return console.log("data",s);if(!p.getState().store)return;let a=p.getState().user;if(!a)return;const r=new FormData;r.append("role_id",i.id),s.name&&r.append("name",s.name),((d=s.options)==null?void 0:d.length)>0&&r.append("newOptions","ok"),(u=s.options)==null||u.forEach(m=>{r.append(m,"1")});const n=new Headers;n.append("Authorization",`Bearer ${a.token}`);const o=await(await fetch(`${b}/update_role`,{method:"PUT",body:r,headers:n})).json();!o||!o.id||c(()=>({selectedRole:o}))},async deleteRole(s){console.log(s);const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new Headers;a.append("Authorization",`Bearer ${t.token}`);const r=new FormData;r.append("store_id",i.id),r.append("role_id",s);const n={method:"DELETE",headers:a,body:r};(await(await fetch(`${b}/delete_role`,n)).json()).deleted&&c(()=>({selectedRole:void 0})),U.getState().fetchUsersVar()},async fetchRolesJson(){const i=await(await fetch(`${b}/get_roles_json`)).json();i&&c(()=>({json_roles:i}))},async fetchRoles(s={}){const i=p.getState().store;if(!i)return;let t=p.getState().user;if(!t)return;const a=new Headers;a.append("Authorization",`Bearer ${t.token}`);const r={method:"GET",headers:a};s.store_id=i.id;const n=new URLSearchParams({});for(const d in s){const u=s[d];n.set(d,u)}const o=await(await fetch(`${b}/get_store_roles/?${n.toString()}`,r)).json();if(console.log("roles",o),!(!o||!o.list))return c(()=>({roles:o})),o}}));function Qs(){const{current:c,setAbsPath:s,qs:i}=I(),{roles:t,setSelectedRole:a,fetchRoles:r}=ne(),{store:n}=p();return h.useEffect(()=>{c("roles")&&n&&r()},[n]),c("roles")&&e.jsx("div",{className:"collaborator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"collaborator_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{id:{getView(l,o,d,u){return e.jsxs("div",{ref:u,children:["#",o.split("-")[0]]},d.id)}},name:S.StringElement({size_interval:[50,200]}),created_at:S.DateStringElement({size:200})},onItemsSelected:(l,o)=>{o.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="")}),l.forEach(d=>{d.$itemRef&&(d.$itemRef.style.background="#00f2")}),a(l[0]),i({role_id:l[0].id}).setAbsPath(["roles","edit_role"])},onQuery:l=>{r(l)},canAddNew:!0,onNewRequired:()=>{s(["roles","create_role"])},top_height:40,canPaginate:!0})})})}function Xs(){const{selectedRole:c,setRoleById:s,updateRole:i,newRole:t,deleteRole:a,json_roles:r}=ne(),{current:n,json:l}=I(),[o]=h.useState({}),d=n("edit_role"),u=n("create_role");return h.useEffect(()=>{l!=null&&l.role_id&&s(l==null?void 0:l.role_id)},[l]),(d||u)&&(!c&&d?e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}):e.jsxs("div",{className:"role-dash",ref:K,children:[e.jsx(pe,{title:"Role Information",mode:d?"delete":"create",deteleKey:c==null?void 0:c.id,onDelete:()=>{c&&a(c.id)},onCreate:()=>{t(o)}}),e.jsxs("section",{className:"editor",children:[e.jsxs("div",{className:"left-side",children:[e.jsx(R,{min:3,max:25,placeholder:"Role Name",prompt:"Role Name",editable:!0,label:"Name",value:d?c==null?void 0:c.name:"",onChange:m=>{d?i({name:m}):o.name=m}}),d&&e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Id",value:c==null?void 0:c.id}),e.jsx(R,{label:"Created At",value:c==null?void 0:c.created_at}),e.jsx(R,{label:"Update At",value:c==null?void 0:c.updated_at}),e.jsx(Se,{})]})]}),e.jsx("div",{className:"right-side",children:e.jsx(ts,{role:c,json_roles:r,isNew:u,onChange:m=>{d?i({options:m}):o.options=m}})})]})]}))}function Js(){const{check:c,current:s,setAbsPath:i}=I();return c("roles")&&e.jsxs("div",{className:"role-page",children:[s("roles","edit_role")&&e.jsx(De,{active:"roles",setActive:t=>i(t.path)}),e.jsx(Qs,{}),e.jsx(Xs,{})]})}function Ys(){const{current:c,setAbsPath:s,qs:i}=I(),{collaborators:t,setSelectedCollaborator:a,fetchCollaborators:r}=le(),{store:n}=p(),{roles:l}=ne();return h.useEffect(()=>{c("collaborators")&&n&&r()},[n]),c("collaborators")&&e.jsx("div",{className:"collaborator-list",ref:K,children:e.jsx("div",{className:"list-ctn",children:e.jsx(S,{filter:{sortBy:"id",sortableColumns:["id","title","stock","price","date","status"],limit:t==null?void 0:t.limit,page:t==null?void 0:t.page,total:t==null?void 0:t.total,filter:{price:te([0,1e5],[0,1e4]),stock:te([0,1e4],[0,1e4]),status:_e(["PAUSE","TRASH","NEW"],[]),index:Ne([0,100]),is_dynamic_price:oe(),hasScene:oe()}},items_height:80,id:"collaborator_list",datas:(t==null?void 0:t.list)||[],itemsMapper:{photos:{getView(o,d,u,m){return S.ImageElement().getView(o,`${d[0].startsWith("/")?b:""}${d[0]}`,u,m)}},id:{getView(o,d,u,m){return e.jsxs("div",{ref:m,children:["#",d.split("-")[0]]},u.id)}},name:S.StringElement({size_interval:[50,200]}),email:S.StringElement({size:200}),status:de,role_id:{getView(o,d,u,m){var v;return e.jsx("div",{ref:m,children:(v=l==null?void 0:l.list.find($=>$.id==d))==null?void 0:v.name},u.id)}},join_at:S.DateStringElement({size:150}),created_at:S.DateStringElement({size:150})},onItemsSelected:(o,d)=>{d.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="")}),o.forEach(u=>{u.$itemRef&&(u.$itemRef.style.background="#00f2")}),a(o[0]),i({collaborator_id:o[0].id}).setAbsPath(["collaborators","collaborator_profile"])},onQuery:o=>{r(o)},canAddNew:!0,onNewRequired:()=>{s(["collaborators","new_collaborator"])},top_height:40,canPaginate:!0})})})}const Gs=["PAUSE","VISIBLE","NEW"];function Zs({onChange:c,status:s,canEdit:i}){const[t,a]=h.useState(s);return e.jsx("div",{className:"choise-status",children:e.jsx("div",{className:"ctn",children:Gs.map(r=>e.jsx("div",{className:"use-status "+r.toLocaleLowerCase()+" "+(t==r?"active":""),onClick:()=>{i&&a(r),i&&(c==null||c(r))},children:r},r))})})}function et(){const{current:c,json:s}=I(),{selectedCollaborator:i,setCollaboratorById:t,removeCollaborator:a,updateCollaborator:r,change_collaborator_role:n}=le(),[l]=h.useState(!1),{roles:o,fetchRoles:d}=ne(),m=re().width<1e3?"wrap":"",{store:v,user:$}=p();return h.useEffect(()=>{s!=null&&s.collaborator_id&&t(s==null?void 0:s.collaborator_id)},[s]),h.useEffect(()=>{d({})},[$]),console.log({roles:o}),c("collaborator_profile")&&(i?e.jsxs("div",{className:"collaborator-profile",ref:K,children:[e.jsx(pe,{title:"Collaborator Information",mode:"delete",deteleKey:i.id,onDelete:()=>{console.log(i.id),a(i.id)}}),e.jsxs("section",{className:"editor "+m,children:[e.jsxs("div",{className:"left-right",children:[e.jsx(Ce,{name:"collaborator_profile",images:i.photos||[],cannotEdit:!0}),e.jsx(R,{label:"Name",value:i==null?void 0:i.name}),e.jsx(R,{label:"Email",value:i==null?void 0:i.email}),e.jsx(R,{label:"created At",value:i==null?void 0:i.created_at}),e.jsx(R,{label:"Join Store At",value:i==null?void 0:i.join_at})]}),e.jsxs("div",{className:"left-side",children:[e.jsx(R,{label:"Store Name",value:(v==null?void 0:v.name)||"pppp"}),e.jsx(R,{label:"Store Id",value:v==null?void 0:v.id}),e.jsx(R,{isCheckRequired:l,label:(i==null?void 0:i.s_type)+" Id",value:(i==null?void 0:i.id)||""}),($==null?void 0:$.id)!=i.id&&e.jsxs("div",{className:"chat-btn-ctn",children:[e.jsx(Be,{user:i,channel:"discussions"}),window.location.pathname.split("/")[3]=="admin"&&e.jsx("div",{className:"btn-chat-admin",onClick:()=>{v&&window.open(`${as}/admin#chat/discussions={"store_id":"${v.id}","collaborator_id":"${i.id}"}`)},children:"Open as Admin"})]}),e.jsx(Zs,{status:(i==null?void 0:i.status)||"NEW",onChange:T=>{r({product_id:i.id,status:T})}}),e.jsx(Ze,{roles:(o==null?void 0:o.list)||[],canChange:()=>!0,role_id:i.role_id,onChange:T=>{n({new_role_id:T,collaborator_id:i.id})}}),e.jsx(Se,{})]})]})]}):e.jsx("div",{className:"not-found",children:e.jsx("div",{className:"img"})}))}function st(){const{current:c}=I(),{addCollaborator:s}=le(),{store:i}=p(),[t]=h.useState(!1),a=re(),{roles:r,fetchRoles:n}=ne();h.useEffect(()=>{n({})},[i]);const l=a.width<1e3?"wrap":"",[o]=h.useState({});return h.useEffect(()=>{},[]),c("new_collaborator")&&e.jsxs("div",{className:"collaborator-profile",ref:K,children:[e.jsx(pe,{terme:"white",mode:"create",title:"Collaborator Information",onCreate:()=>{s(o).then(d=>{console.log(d)})}}),e.jsxs("section",{className:"editor "+l,children:[e.jsxs("div",{className:"left-right",children:[e.jsx(R,{label:"Store Name",value:i==null?void 0:i.name}),e.jsx(R,{label:"Store Id",value:i==null?void 0:i.id}),e.jsx(R,{editable:!0,prompt:"Collaborator Email",isCheckRequired:t,min:3,check:"auto",max:50,label:"Email",placeholder:"Catalog Label",value:"",onChange:d=>{o.email=d}})]}),e.jsx("div",{className:"left-side",children:e.jsx(Ze,{roles:(r==null?void 0:r.list)||[],canChange:()=>!0,onChange:d=>{o.role_id=d}})})]})]})}function tt(){const{check:c,current:s,setAbsPath:i}=I();return c("collaborators")&&e.jsxs("div",{className:"collaborator-page",children:[s("collaborators","collaborator_profile","new_collaborator")&&e.jsx(De,{active:"collaborators",setActive:t=>i(t.path)}),e.jsx(Ys,{}),e.jsx(et,{}),e.jsx(st,{})]})}const Ye={store:"Store",products:"Products",categories:"Categories",features:"Features",catalogs:"Catalogs",dash_product:"Edit Product",dash_categories:"Edit Category",dash_features:"Edit Feature",dash_catalogs:"Edit Catalog",preview:"Preview",statistic:"Statistic",action:"Action",new_product:"New Product",new_category:"New Category",product_preview:"Product Preview",user:"Users",clients:"clients",collaborators:"Collaborator",client_profile:"Profile",collaborator_profile:"Profile",roles:"Roles",create_role:"New Role",edit_role:"Editor",new_collaborator:"New Collaborator",chat:"Chat",interface:"Interface",sessions:"Sessions",discussions:"Discussions",moderators:"Moderators",moderator_profile:"Moderator Profile"};function at(){const{currentChild:c,blur:s,openChild:i,fetchUsersVar:t,fetchStoreVar:a,T:r,setT:n,back_color:l}=U(),{authenticateUser:o,user:d,store:u}=p(),{pathList:m,setAbsPath:v}=I(),{fetchRolesJson:$}=ne(),T=[];return m.forEach(y=>{Ye[y]&&T.push(Ye[y])}),h.useEffect(()=>{i(void 0)},[m]),h.useEffect(()=>{o(),window.addEventListener("blur",()=>{i(void 0)})},[]),h.useEffect(()=>{u&&(a(),$(),t())},[u]),e.jsxs("div",{className:"dash "+(r?"sombre-mode-variable":""),children:[e.jsx(We,{blur:s}),!d&&e.jsx(ns,{}),e.jsx("div",{className:"dash-ctn "+(d?s?"blur":"":"blur"),children:e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"center-top",children:[e.jsxs("div",{className:"nav-min",onClick:()=>{i(e.jsx(We,{className:"max",blur:s}),!0,"#345b")},children:[" ",e.jsx("span",{})]}),e.jsx("div",{className:"page-path",children:T.map((y,_)=>e.jsxs("div",{className:"path",children:[e.jsxs("div",{className:"label",onClick:()=>{const N=m.slice(1,_+2);v(N)},children:[y,e.jsx("span",{})]}),T[_+1]?e.jsx("div",{className:"icon"}):void 0]},_))}),e.jsxs("div",{className:"dash-top-right",children:[e.jsxs("div",{className:"dark-mode "+r,onClick:()=>{n(r?"":"active")},children:[e.jsx("span",{className:"dark-mode-btn"})," ",e.jsx("span",{className:"dark-white-btn",children:" "})]}),e.jsxs("div",{className:"notf",children:[" ",e.jsx("span",{})]})]})]}),e.jsxs("div",{className:"center-ctn",ref:y=>{if(!y||y.dataset.init)return;y.dataset.init="true";const _=()=>{const N=document.querySelector(".dash .center .center-top");y.style.height=`calc(100% - ${N.getBoundingClientRect().height}px)`};window.addEventListener("resize",_),_()},children:[e.jsx(xs,{}),e.jsx(qs,{}),e.jsx(Os,{}),e.jsx(Vs,{}),e.jsx(js,{}),e.jsx(Ks,{}),e.jsx(tt,{}),e.jsx(Js,{}),e.jsx(As,{}),e.jsx(Ts,{})]})]})}),c&&e.jsx("div",{className:"child-viewer",onContextMenu:y=>{y.preventDefault(),i(void 0)},children:e.jsx("div",{className:"child-viewer-ctn",style:{background:l},onClick:()=>{i(void 0)},onContextMenu:y=>{y.preventDefault(),i(void 0)},children:c})})]})}const it=c=>c,ut=it(e.jsx(is.StrictMode,{children:e.jsx(at,{})}));export{ut as DashView};
